<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2025年终总结</title>
      <link href="/2025/12/12/2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2025/12/12/2025%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面">写在前面</h3><p>像是写作文一样写！</p><p>“叮叮叮~ 叮叮叮~”<br>上班的闹钟响起，我被迫睁开眼睛，习惯性的按掉闹钟；手机上显示闹钟将在10分钟再响。我又闭上了眼睛，大脑里却是思绪万千，虽然离上班还有一段时间，但也没了睡意；索性起来吧。穿衣、洗漱一气呵成；看了一眼窗外，外面还黑蒙蒙的，没有完全亮起来。穿过卧室的走廊，进入客厅，客厅的小爱同学正在进行天气预报。我看了一眼手机的日期，嘴里嘟囔着：“哦， 12月12号，周五了今天是；<u>今年就快要过去了啊</u>”。</p><h3 id="回顾">回顾</h3><p>“时间还早，不如回顾一下今年吧。”我自言自语道，“这一年都发生了什么呢？”</p><p>我翻开手机日历，思绪也随着日期慢慢浮起：</p><p>第一件大事，是我终于拥有了属于自己的房子，从此告别了租房的日子。年假结束后，我回到昆明的家，一个人住进三室两厅的空间，起初还真有些不习惯。加上刚装修完，屋里还残留着些许气味，尤其是卧室定做的衣柜，味道比较明显。于是，我干脆暂时睡在客厅的沙发上，这一睡就是大半年，直到今年国庆前后，才正式搬进卧室。</p><p>在新家，我添置了两样东西：一架电子琴，一个扫地机器人。电子琴是为了圆童年的一个兴趣梦，扫地机器人嘛，则是为了拯救我这个“懒癌晚期患者”🙃。可惜这一年里，琴键没碰几次，只断断续续跟着视频学了一小段<code>《大鱼海棠》</code>——还是得提醒自己，新的一年要好好练琴，怎么也得弹熟一首才行啊。至于扫地机器人，可真是“救星”般的存在，彻底把我从扫地拖地的家务中解放出来。出门前用手机点一下，回家便是光洁的地面，心情也跟着明亮起来。<psw>关于新独居生活，抽空我会好好写一篇文章单独记录</psw>。</p><p><img src="http://pic.fasty97.top/fasty26/IMG_20250522_182837.jpg@sm" alt="小区的蓝花楹 "></p><h3 id="见闻">见闻</h3><h4 id="亲人别离">亲人别离</h4><blockquote><p>生命虽短，爱却绵长。愿您安息，也愿生者珍惜当下，带着您的爱继续前行。</p></blockquote><p>春夏之交，奶奶永远地离开了我们。先是行动渐渐不便，后来水米难进，直至生命静默。回乡奔丧，灵堂素白，亲人的哭声萦绕耳际，一切恍惚得像一场不真实的梦。生命如此短暂脆弱，教人更觉当下时光的珍贵。</p><p>守夜的那晚，我久久凝视着案上那只黑色的匣子，想起童年时分。父母忙于工作，我的许多日子都在奶奶身边度过，那时……回忆如烛火，微弱却坚定地亮着。长夜无眠，烛影摇曳，我并不害怕，哪怕只有我一人守到天明。</p><h4 id="话剧体验">话剧体验</h4><p>不知怎么的，有一天感觉非常无聊，就尝试性的去体验了一下现场话剧表演；感觉挺不错的。下面是其中的一小段视频：</p><div class="video"><video controls preload><source src='http://pic.fasty97.top/fasty26/VID_20251018_212548.mp4' type='video/mp4'>Your browser does not support the video tag.</video></div><h3 id="工作相关">工作相关</h3><p>自去年12月完成郑州富士康的设备调试工作后，年后我接到了新任务：在原有程序基础上开发一套工厂信息管理系统。该系统结构复杂，开发持续了大半年，至今尚未完全竣工，仍需逐步完善。之后，我接手了汕头的一个保健药品生产项目，首次负责编写AGV逻辑，这无疑是一场硬仗。由于提供的CAD图纸与现场实际情况存在误差，导致AGV运动轨迹难以匹配，位置偏差较大。通过这个项目，我对AGV系统有了更深入的理解，相信在未来的项目中会更加得心应手。接下来，即将开启北京的项目，继续努力，加油！😌</p><h3 id="旅行">旅行</h3><p>今年偶然的机会，约着朋友去了一趟<code>杭州——上海</code>。</p><h4 id="乌镇">乌镇</h4><blockquote><p>上有天堂，下有苏杭，而乌镇，是嵌在杭嘉湖平原上的一枚温润玉珏。</p></blockquote><p>清晨从昆明出发，抵达杭州萧山机场后，沿着清晰的指示标志前行，轻松找到汽车客运站，搭乘直达乌镇的班车。一路上，江南水乡的景致逐渐在眼前展开。</p><p>抵达乌镇景区门口，一位热情的重庆籍揽客阿姨将我们引至一家小店。价格合理，每晚仅需120元，我们便决定入住。安顿好后，在附近寻了一家饭店解决午餐。乌镇的特色菜是<strong>酱鸭</strong>，用浓稠的酱料精心腌制，远远便能闻到其特有的酱香。本以为杭州饮食偏清淡，实则不然，当地人善用酱油与醋调味，只是不喜辣味。</p><p>我们点了<strong>东坡肉</strong>、虾仁炒蛋及几样小菜。其中东坡肉尤为出彩——方正的猪肉块以草绳十字捆绑，食用时剪断草绳，用筷子轻轻拨开，入口咸香四溢，肥而不腻。</p><p>餐后便进入乌镇景区。我曾想象乌镇如大理古城般保有原生生活气息，却发现它已高度商业化。虽是淡季，恰逢周末，游客依然不少。景区内古韵盎然，一条主河横贯其中，两岸民居依水而建，再现了“水镇一体”的江南格局。</p><p>在入口处，我们选择了<strong>摇橹船</strong>水上游。听船夫和我们介绍：“<u>这条河是京杭大运河的支流，历史悠久</u>”。 乌篷船在碧绿的水面缓缓前行，船橹划出涟漪，两岸粉墙黛瓦徐徐后退。船至中途，华灯初上，灯光倒映水中，如梦似幻。</p><p>登岸后，沿狭窄巷弄前行，一家<strong>萝卜丝饼</strong>小店前排起长队。这正是入住时阿姨推荐的当地特色——将萝卜切丝裹面糊炸至金黄，外酥里嫩，入口既有面香又带着萝卜的清甜与一丝辛辣。边品尝萝卜丝饼，边漫步青石板路，两旁茶馆、咖啡馆、小酒吧林立。不少身着古装的少女在拍照，即便寒冬也不减热情。</p><p>踱至河边，恰见船只正在装卸货物。得知这个港口负责清运垃圾、运输物资，我这位云南人首次见识水乡的后勤运作，倍感新奇。</p><p>游毕西栅，时间尚早，我们便步行1.5公里至<code>东栅</code>。这里更为原生态，商业化痕迹较少，古老巷弄中可见居民手工制作酱鸭、花糕，不少本地人仍临水而居，保留了更浓郁的生活气息。东西栅虽风貌各异，却共同构成了乌镇“中国最后的枕水人家”的完整意象。</p><div class="gallery">  <div class="fj-gallery page_img_lazyload lazyload btn_album_detail_lazyload data" data-rowHeight="220" data-limit="3">    <span class="gallery-data">[{"url":"http://pic.fasty97.top/fasty26/202512151946382.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151947578.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151947578.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151948706.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151948582.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151948861.jpg@sm","alt":""}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>Load More</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div><h4 id="西湖冬日">西湖冬日</h4><blockquote><p>水光潋滟晴方好，山色空蒙雨亦奇。<br>欲把西湖比西子，淡妆浓抹总相宜。</p><p>——《饮湖上初晴后雨》 苏轼</p></blockquote><p>离了乌镇，我们乘早班大巴返回杭州，在西湖畔寻了处住所安顿。稍作休整后，便按图索骥，开始了环湖之旅。</p><p>从龙翔桥地铁站C口步入湖滨，冬日的西湖别具清韵。虽是旅游淡季，湖畔仍不乏与我们一般的寻幽客。<strong>柳浪闻莺</strong>处，千丝垂柳缀着疏疏黄叶，虽未闻莺啼，但见阳光在粼粼波光上碎成万千金箔，也别有一番意境。</p><p>行至钱王祠码头，我们登上前往<strong>三潭印月</strong>的画舫。这座被誉为“西湖第一胜境”的湖心岛，正是人民币一元纸币背面的图案。我们特意备好纸币比对取景，只见三座石塔鼎足而立，与水中倒影相映成趣。船工笑说若值月夜，可在塔孔点烛，映出三十三个月影的奇观。冬日虽不见“接天莲叶”的盛景，但残荷疏影间，自有一番中国画般的留白意境。</p><p>从花港观鱼码头上岸，<strong>雷峰塔</strong>巍然矗立夕照山上。登塔方知，古塔曾在1924年倒塌，现存塔体为2002年重建。新塔采用钢架铜饰结构，既保留了宋塔形制，又创新地采用“塔中塔”设计，将遗址妥善保护于玻璃围罩内。登至顶层俯瞰，西湖如碧玉镶嵌城中，苏堤如带飘落湖面，现代城郭与千年胜景在此奇妙交融。</p><p>沿<strong>苏堤</strong>北行，这条由苏轼疏浚西湖时以湖泥筑就的长堤，如今仍是贯通西湖的脉络。堤上六桥起伏，两侧水光潋滟。沿途的苏东坡纪念馆，详实记述着这位文人太守跌宕起伏的仕途，以及他以淤泥筑堤、植柳固基的水利智慧。顺道拜谒岳王庙，忠烈之气与文雅之风，在这条路上达成了某种精神的契合。</p><p>杭州的智慧，在于将整个西湖区域规划为开放式景区。若觉步行疲惫，可租用共享单车，或搭乘环湖公交。我们选择缓步慢行，让这座城的湖光山色、文脉风流，渐渐浸润心田。</p><div class="gallery">  <div class="fj-gallery page_img_lazyload lazyload btn_album_detail_lazyload data" data-rowHeight="220" data-limit="3">    <span class="gallery-data">[{"url":"http://pic.fasty97.top/fasty26/202512151939246.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151942129.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151942654.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151951061.jpg@sm","alt":""}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>Load More</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div><h4 id="上海">上海</h4><blockquote><p>从杭嘉湖的温润水乡，倏忽间便扎进了<strong>黄浦江的万家灯火</strong>里</p></blockquote><p>晨间还在西湖畔凭栏，傍晚时分高铁已抵达上海虹桥站。我们预定的青旅标间<strong>300元一晚</strong>，与乌镇120元的临水客栈相比，瞬间让人体会到魔都的物价水准。</p><p>放下行李便直奔<strong>南京路步行街</strong>。恰逢华灯初上，整条街道宛如一条发光的长河，两侧摩天楼群的玻璃幕墙将夕阳折射成万千碎金。作为老二次元，我自然被街边的二次元商场吸引。这里如同一个次元裂隙：大白兔奶糖与M豆巧克力旗幡旁，藏着免费漫画阅览区与自助妆造间。这种“<strong>社恐友好</strong>”的购物环境确实贴心，让同好能自在徜徉于手办与漫画之间。</p><p>步行街尽头豁然开朗，<strong>外滩</strong>在眼前铺展。此侧是<strong>万国建筑博览群</strong>，52栋老建筑在灯光勾勒下宛如一排沉默的史书；隔江望去，陆家嘴的摩天楼群则像未来派画卷——<strong>东方明珠</strong>、<strong>国金中心</strong>与“三件套”共同勾勒出魔都的天际线过江的方式有多种，可以驾车从桥上过去，也可以乘坐地铁过去；甚至如果你是骑电动车的话。有专门接驳的<code>公交船</code>,单车、摩托都可以通过公交船到达对岸。我们专门去乘坐了一次，到达了对岸陆家嘴。</p><p>登岸后，我们扫了共享单车沿<strong>滨江步道</strong>骑行。夜风习习，对岸外滩的建筑群如金箔镶嵌的浮雕，而身旁的<strong>国金中心</strong>幕墙如蓝宝石镜面，将夜空与灯火尽数收纳在dy团了券，我们登上了国金中心观景台；在观景台上，360度环视这片传奇土地：黄浦江如一条发光绸带将城市分割，浦西的<strong>万国建筑群</strong>与浦东的<strong>摩天楼群</strong>隔江对话。远处高架桥的车流划出光轨，近处江面游船曳出波光，整座城市宛如一部精密运转的巨型机器，却又在夜色中展现出奇异的温柔。</p><div class="gallery">  <div class="fj-gallery page_img_lazyload lazyload btn_album_detail_lazyload data" data-rowHeight="220" data-limit="3">    <span class="gallery-data">[{"url":"http://pic.fasty97.top/fasty26/202512151943692.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151943161.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151944542.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151952349.jpg@sm","alt":""},{"url":"http://pic.fasty97.top/fasty26/202512151953323.jpg@sm","alt":"南京路步行街"}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>Load More</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div><hr><p>后续几天里，我们还去了许多地方：徐汇书院、 田子坊、城隍庙、豫园、中共一大、 静安寺等…</p><h3 id="思考">思考</h3><p>去过杭州、去过上海我感觉这些地方的旅游已经非常成熟了，商业化比较严重；城市大了，人也就显得渺小了。如果有机会的话，再去苏州看看吧，很多东西只有自己去看看才知道到底是什么样子。</p><h3 id="新年寄语">新年寄语</h3><p>在新的一年即将到来之际，希望在新的一年里；自己可以平视自己的内心；好好工作，好好生活。</p><p>不要太荒废时间，抽空练练钢琴，写好代码，游戏上线steam；新的一年继续加油！</p><h3 id="脚注">脚注</h3><ol><li>各种不同的划船方式</li></ol><table><thead><tr><th style="text-align:left">名称</th><th style="text-align:left">主要特点</th><th style="text-align:left">使用方式</th><th style="text-align:left">适用场景</th></tr></thead><tbody><tr><td style="text-align:left"><strong>船篙</strong></td><td style="text-align:left">一根长长的竹竿或木棍，结构最简单。</td><td style="text-align:left"><strong>撑</strong>：插入水底或岸边，利用反作用力推船前进。</td><td style="text-align:left">浅水区、河道、靠近岸边时。</td></tr><tr><td style="text-align:left"><strong>棹 / 棹竿</strong></td><td style="text-align:left">长的船桨，古代常见叫法。</td><td style="text-align:left"><strong>划</strong>：在水中前后划动，拨水使船行进。</td><td style="text-align:left">水深不足以使用船篙的区域。</td></tr><tr><td style="text-align:left"><strong>橹</strong></td><td style="text-align:left">比桨大，支在船尾或船侧的橹担上。</td><td style="text-align:left"><strong>摇</strong>：一直在水下往复摆动，连续拨水，效率高。</td><td style="text-align:left">替代长桨，有“一橹抵三桨”的说法。</td></tr></tbody></table><ol start="2"><li>注：本文使用Ai进行润色。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 年终总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeCanvas自定义图树</title>
      <link href="/2024/04/03/NodeCanvas%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%91/"/>
      <url>/2024/04/03/NodeCanvas%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9B%BE%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>NodeCanvas</code>是一款很棒的插件，包含了行为树、对话树、状态机等数据结构，提供可视化的图形服务，依此我们可以扩展一种<code>FlowTree</code>的流式图。</p></blockquote><h2 id="思考">思考</h2><h3 id="FlowTree">FlowTree</h3><p>FlowTree是我想要实现的一种数据结构，即流程树结构；在流程树中的所有节点会根据检查条件选择适合的分支依次执行。这其实和官方提供的<code>DialogTree</code>对话树的逻辑是差不多的；但是在对话树基本节点是对话节点。</p><p>为了能够执行一些列操作，而这一些操作可能包含对话也可能只是纯粹的Action，故而需要一种新的流程树形式。</p><p><img src="http://pic.fasty97.top/NotePad/202404031031392.png" alt="image-20240403103133264"></p><p>从上图中可以看出，我们可以不再依赖于对话节点，我们可以 行为、条件、子图作为起始，也可以根据这些元素作为结尾任意的连接数据。{.yellow}</p><h2 id="实现">实现</h2><p><img src="http://pic.fasty97.top/NotePad/202404030935948.png" alt="目录结构"></p><p>以上是一个基本树的目录组成结构，分别包括：</p><ul><li>++FlowTreeOwner++ 树持有者，继承自<code>MonoBehaviour</code></li><li>++FlowTree++ 树数据，继承自<code>Graph</code></li><li>++FTNode++ 基础节点数据，继承自<code>Node</code></li><li>++FTConnection++ 基础连接数据，继承自<code>Connection</code></li></ul><figure class="highlight csharp"><figcaption><span>FlowTreeOwner</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FlowTreeOwner</span>: <span class="title">GraphOwner</span>&lt;<span class="title">FlowTree</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>FlowTree</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;ParadoxNotion/NodeCanvas/Flow Tree Asset&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FlowTree</span> : <span class="title">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> Type baseNodeType =&gt; <span class="keyword">typeof</span>(FTNode);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> requiresAgent =&gt; <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> requiresPrimeNode =&gt; <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> isTree =&gt; <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> PlanarDirection flowDirection =&gt; PlanarDirection.Horizontal;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> allowBlackboardOverrides =&gt; <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> canAcceptVariableDrops =&gt; <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> _intTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">float</span> _updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Status _rootStatus;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> FTNode _currentNode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGraphStarted</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;FlowTree <span class="subst">&#123;name&#125;</span> 启动&quot;</span>);</span><br><span class="line">        _currentNode = primeNode <span class="keyword">as</span> FTNode;</span><br><span class="line">        EnterNode(_currentNode != <span class="literal">null</span> ? _currentNode : (FTNode)primeNode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGraphUpdate</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> ( _currentNode <span class="keyword">is</span> IUpdatable ) &#123;</span><br><span class="line">            ( _currentNode <span class="keyword">as</span> IUpdatable )?.Update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnGraphStoped</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _currentNode = <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoNext</span>(<span class="params"><span class="built_in">int</span> index = <span class="number">0</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; _currentNode.outConnections.Count - <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Stop(<span class="literal">true</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        _currentNode.outConnections[index].status = Status.Success; <span class="comment">//editor vis</span></span><br><span class="line"></span><br><span class="line">        EnterNode(_currentNode.outConnections[index].targetNode <span class="keyword">as</span> FTNode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EnterNode</span>(<span class="params">FTNode node</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _currentNode = node;</span><br><span class="line">        _currentNode.Reset(<span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span> (_currentNode.Execute(agent, blackboard) == Status.Error)</span><br><span class="line">        &#123;</span><br><span class="line">            Stop(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>FTNode</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">FTNode</span> : <span class="title">Node</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> maxInConnections =&gt; <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> maxOutConnections =&gt; <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> Type outConnectionType =&gt; <span class="keyword">typeof</span>(FTConnection);</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> allowAsPrime =&gt; <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> canSelfConnect =&gt; <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> Alignment2x2 commentsAlignment =&gt; Alignment2x2.Right;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> Alignment2x2 iconAlignment =&gt; Alignment2x2.Right;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 流程树</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">protected</span> FlowTree FlowTree =&gt; (FlowTree)graph;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnNodeInspectorGUI</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnNodeInspectorGUI();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">override</span> UnityEditor.<span class="function">GenericMenu <span class="title">OnContextMenu</span>(<span class="params">UnityEditor.GenericMenu menu</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            menu.AddItem(<span class="keyword">new</span> GUIContent(<span class="string">&quot;Breakpoint&quot;</span>), isBreakpoint, () =&gt; &#123; isBreakpoint = !isBreakpoint; &#125;);</span><br><span class="line">            <span class="keyword">return</span> menu;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>FTConnection</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FTConnection</span>:<span class="title">Connection</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="树步进和条件">树步进和条件</h3><p>有了数据结构还不行，我们还需要让数据按我们期望的方式流转起来，其实也就是我们需要告诉我们的树何时应该执行下一步。</p><figure class="highlight csharp"><figcaption><span>树步进</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoNext</span>(<span class="params"><span class="built_in">int</span> index = <span class="number">0</span></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt; _currentNode.outConnections.Count - <span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        Stop(<span class="literal">true</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _currentNode.outConnections[index].status = Status.Success; <span class="comment">//editor vis</span></span><br><span class="line"></span><br><span class="line">    EnterNode(_currentNode.outConnections[index].targetNode <span class="keyword">as</span> FTNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">EnterNode</span>(<span class="params">FTNode node</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _currentNode = node;</span><br><span class="line">    _currentNode.Reset(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">if</span> (_currentNode.Execute(agent, blackboard) == Status.Error)</span><br><span class="line">    &#123;</span><br><span class="line">        Stop(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在FlowTree中有这样一个方法用于控制树步进，传入一个index代表选择的链接分支索引，用于进入下一个节点，如果节点返回失败则停止图，如果成功则进入下一个。</p><blockquote><p>我们需要在所有需要进入下一个节点的地方调用<code>GoNext</code></p></blockquote><p>例如当Action节点执行完时:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnActionEnd</span>(<span class="params"><span class="built_in">bool</span> success</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ( success ) &#123;</span><br><span class="line">        status = Status.Success;</span><br><span class="line">        FlowTree.GoNext();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    status = Status.Failure;</span><br><span class="line">    FlowTree.Stop(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例如当条件节点执行完时：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Status <span class="title">OnExecute</span>(<span class="params">Component agent, IBlackboard bb</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (outConnections.Count == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Error(<span class="string">&quot;There are no connections on the Dialogue Condition Node&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Condition == <span class="literal">null</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Error(<span class="string">&quot;There is no Conidition on the Dialoge Condition Node&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> isSuccess = Condition.CheckOnce(agent.transform, graphBlackboard);</span><br><span class="line">    status = isSuccess ? Status.Success : Status.Failure;</span><br><span class="line">    FlowTree.GoNext(status== Status.Success ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>例如当子图执行完成时：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">OnDLGFinished</span>(<span class="params"><span class="built_in">bool</span> success</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (status == Status.Running)</span><br><span class="line">    &#123;</span><br><span class="line">        status = success ? Status.Success : Status.Failure;</span><br><span class="line">        </span><br><span class="line">        FlowTree.GoNext(); <span class="comment">//让流程树继续</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>对于条件节点的处理，我们只需要提供一个<code>ConditionTask</code>用于处理即可：</p></blockquote><figure class="highlight csharp"><figcaption><span>ConditionNode</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">global::ParadoxNotion.Design.Icon(<span class="string">&quot;Condition&quot;</span>)</span>]</span><br><span class="line">    [<span class="meta">Color(<span class="string">&quot;b3ff7f&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ConditionNode</span> : <span class="title">FTNode</span>, <span class="title">ITaskAssignable</span>&lt;<span class="title">ConditionTask</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField</span>] <span class="keyword">private</span> ConditionTask _condition;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> ConditionTask Condition</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> =&gt; _condition;</span><br><span class="line">            <span class="keyword">set</span> =&gt; _condition = <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Task task</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span> =&gt; Condition;</span><br><span class="line">            <span class="keyword">set</span> =&gt; Condition = (ConditionTask)<span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">int</span> maxOutConnections =&gt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Status <span class="title">OnExecute</span>(<span class="params">Component agent, IBlackboard bb</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (outConnections.Count == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Error(<span class="string">&quot;There are no connections on the Dialogue Condition Node&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Condition == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> Error(<span class="string">&quot;There is no Conidition on the Dialoge Condition Node&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> isSuccess = Condition.CheckOnce(agent.transform, graphBlackboard);</span><br><span class="line">            status = isSuccess ? Status.Success : Status.Failure;</span><br><span class="line">            FlowTree.GoNext(status== Status.Success ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">GetConnectionInfo</span>(<span class="params"><span class="built_in">int</span> i</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> i == <span class="number">0</span> ? <span class="string">&quot;Then&quot;</span> : <span class="string">&quot;Else&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="子图-外接图">子图/外接图</h3><blockquote><p>对于子图来说，其实也是属于一个节点，所以本质是继承自<code>FTNode</code>。</p></blockquote><figure class="highlight csharp"><figcaption><span>FTNodeNested</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Category(<span class="string">&quot;SubGraphs&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">Color(<span class="string">&quot;ffe4e1&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">FTNodeNested</span>&lt;<span class="title">T</span>&gt; : <span class="title">FTNode</span>, <span class="title">IGraphAssignable</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">Graph</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="keyword">private</span> List&lt;BBMappingParameter&gt; _variablesMap;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> BBParameter subGraphParameter &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T currentInstance &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> T subGraph &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    Graph IGraphAssignable.currentInstance &#123; <span class="keyword">get</span> =&gt; currentInstance;</span><br><span class="line">        <span class="keyword">set</span> =&gt; currentInstance = (T)<span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Graph IGraphAssignable.subGraph &#123; <span class="keyword">get</span> =&gt; subGraph;</span><br><span class="line">        <span class="keyword">set</span> =&gt; subGraph = (T)<span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;Graph, Graph&gt; instances &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;BBMappingParameter&gt; variablesMap &#123; <span class="keyword">get</span> =&gt; _variablesMap;</span><br><span class="line">        <span class="keyword">set</span> =&gt; _variablesMap = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里我们考虑使FlowTree中可以接入子图<code>DialogTree</code>:</p><figure class="highlight csharp"><figcaption><span>NestedDT</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Name(<span class="string">&quot;Sub Dialogue&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">Description(<span class="string">&quot;Executes a sub Dialogue Tree. Returns Running while the sub Dialogue Tree is active. You can Finish the Dialogue Tree with the &#x27;Finish&#x27; node and return Success or Failure.&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">global::ParadoxNotion.Design.Icon(<span class="string">&quot;Dialogue&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">DropReferenceType(typeof(DialogueTree))</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">NestedDT</span> : <span class="title">FTNodeNested</span>&lt;<span class="title">DialogueTree</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField, ExposeField, Name(<span class="string">&quot;Sub Tree&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">readonly</span> BBParameter&lt;DialogueTree&gt; _nestedDialogueTree = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> DialogueTree subGraph</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span> =&gt; _nestedDialogueTree.<span class="keyword">value</span>;</span><br><span class="line">        <span class="keyword">set</span> =&gt; _nestedDialogueTree.<span class="keyword">value</span> = <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> BBParameter subGraphParameter =&gt; _nestedDialogueTree;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Status <span class="title">OnExecute</span>(<span class="params">Component agent, IBlackboard blackboard</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (subGraph == <span class="literal">null</span> || subGraph.primeNode == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> Status.Optional;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status == Status.Resting)</span><br><span class="line">        &#123;</span><br><span class="line">            status = Status.Running;</span><br><span class="line">            <span class="keyword">this</span>.TryStartSubGraph(agent, OnDLGFinished);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status == Status.Running)</span><br><span class="line">        &#123;</span><br><span class="line">            currentInstance.UpdateGraph(<span class="keyword">this</span>.graph.deltaTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">      </span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnDLGFinished</span>(<span class="params"><span class="built_in">bool</span> success</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (status == Status.Running)</span><br><span class="line">        &#123;</span><br><span class="line">            status = success ? Status.Success : Status.Failure;</span><br><span class="line">            </span><br><span class="line">            FlowTree.GoNext(); <span class="comment">//让流程树继续</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnReset</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (currentInstance != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            currentInstance.Stop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> NodeCanvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 行为树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YooAssets初体验</title>
      <link href="/2023/07/13/YooAssets%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2023/07/13/YooAssets%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>版本号</th><th>创建/更新时间</th><th>操作</th></tr></thead><tbody><tr><td>V1.0</td><td>2023-07-13 09:10:43</td><td>创建</td></tr><tr><td>V1.1</td><td>2023-07-19 09:33:17</td><td>添加着色器变体说明</td></tr></tbody></table><blockquote><p><code>YooAssets</code> 是一个资源管理工具，基于ab包实现。</p><p>通过<code>YooAssets</code> 可以方便的对资源进行管理、分析、更新。</p></blockquote><h2 id="快速食用">快速食用</h2><p>打开管理界面 <strong>Edit/Project Settings/Package Manager</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输入以下内容（中国版）</span></span><br><span class="line">Name: package.openupm.cn</span><br><span class="line">URL: https:<span class="comment">//package.openupm.cn</span></span><br><span class="line">Scope(s): com.tuyoogame.yooasset</span><br></pre></td></tr></table></figure><p>在包管理器中安装YooAssets</p><h3 id="划分组别">划分组别</h3><p><img src="http://pic.fasty97.top/NotePad/202307140936034.png" alt="image-20230714093639774"></p><h3 id="构建工具">构建工具</h3><p><img src="http://pic.fasty97.top/NotePad/202307140940872.png" alt="image-20230714093947222"></p><h3 id="报告工具">报告工具</h3><p>在打包后可以使用报告工具查看相关数据：</p><p><img src="http://pic.fasty97.top/NotePad/202307140941088.png" alt="image-20230714094110038"></p><h2 id="调试工具">调试工具</h2><p><img src="http://pic.fasty97.top/NotePad/202307140943294.png" alt="image-20230714094332240"></p><h2 id="模式">模式</h2><table><thead><tr><th>模式</th><th>说明</th></tr></thead><tbody><tr><td>编辑器模式EditorSimulateMode</td><td>无需构建，直接使用</td></tr><tr><td>离线模式OfflinePlayMode</td><td>单机游戏使用</td></tr><tr><td>在线模式HostPlayMode</td><td>在线游戏热更新</td></tr></tbody></table><h2 id="代码范例">代码范例</h2><h3 id="封装资源加载">封装资源加载</h3><blockquote><p>我们可以对通用资源加载进行封装，使用1行代码实现资源加载。</p></blockquote><figure class="highlight csharp"><figcaption><span>封装资源加载</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">T</span>&gt; <span class="title">LoadAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> key</span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">&#123;</span><br><span class="line">    key = key.Replace(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;_&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (_package.CheckLocationValid(key))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> handle = _package.LoadAssetAsync(key, <span class="keyword">typeof</span>(T));</span><br><span class="line">        <span class="keyword">await</span> handle.Task;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> handle.AssetObject <span class="keyword">as</span> T;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogError(<span class="string">$&quot;<span class="subst">&#123;key&#125;</span> 資源尋址地址錯誤！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="通用示例">通用示例</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> Scenes.YooTest;</span><br><span class="line"><span class="keyword">using</span> Sirenix.OdinInspector;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.SceneManagement;</span><br><span class="line"><span class="keyword">using</span> YooAsset;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YooAssetTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> ResourcePackage _package;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="built_in">string</span> PackName = <span class="string">&quot;DefaultPackage&quot;</span>;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>] <span class="keyword">private</span> EPlayMode playMode;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        YooAssets.Initialize();</span><br><span class="line">        _package = YooAssets.CreatePackage(PackName);</span><br><span class="line">        YooAssets.SetDefaultPackage(_package);</span><br><span class="line">        InitializationOperation hand;</span><br><span class="line">        <span class="keyword">switch</span> (playMode)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> EPlayMode.EditorSimulateMode:</span><br><span class="line">                <span class="comment">//編輯器模式</span></span><br><span class="line">                <span class="keyword">var</span> sm = <span class="keyword">new</span> EditorSimulateModeParameters</span><br><span class="line">                &#123;</span><br><span class="line">                    SimulateManifestFilePath = EditorSimulateModeHelper.SimulateBuild(PackName)</span><br><span class="line">                &#125;;</span><br><span class="line">                hand = _package.InitializeAsync(sm);</span><br><span class="line">                <span class="keyword">await</span> hand.Task;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EPlayMode.OfflinePlayMode:</span><br><span class="line">                <span class="comment">//離線模式</span></span><br><span class="line">                hand = _package.InitializeAsync(<span class="keyword">new</span> OfflinePlayModeParameters());</span><br><span class="line">                <span class="keyword">await</span> hand.Task;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> EPlayMode.HostPlayMode:</span><br><span class="line">                <span class="comment">//在線模式</span></span><br><span class="line">                <span class="keyword">var</span> hs = <span class="keyword">new</span> HostPlayModeParameters()</span><br><span class="line">                    &#123; QueryServices = <span class="keyword">new</span> YooHostQuery(), RemoteServices = <span class="keyword">new</span> YooRemote() &#125;;</span><br><span class="line">                hand = _package.InitializeAsync(hs);</span><br><span class="line">                <span class="keyword">await</span> hand.Task;</span><br><span class="line">                <span class="keyword">if</span> (hand.Status == EOperationStatus.Succeed)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">&quot;资源包初始化成功！当前资源版本:&quot;</span>+ _package.GetPackageVersion());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.LogError(<span class="string">$&quot;资源包初始化失败：<span class="subst">&#123;hand.Error&#125;</span>&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                StartCoroutine(HostLink());</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> IEnumerator <span class="title">HostLink</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//檢查版本</span></span><br><span class="line">        <span class="keyword">var</span> upHandle = _package.UpdatePackageVersionAsync(<span class="literal">false</span>); <span class="comment">//關閉時間戳</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> upHandle;</span><br><span class="line">        <span class="keyword">if</span> (upHandle.Status == EOperationStatus.Succeed)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//更新成功</span></span><br><span class="line">            <span class="built_in">string</span> packageVersion = upHandle.PackageVersion;</span><br><span class="line">            Debug.Log(<span class="string">$&quot;已获取到最新版本号 : <span class="subst">&#123;packageVersion&#125;</span>&quot;</span>);</span><br><span class="line">            HotConfig.NewVision = packageVersion;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//更新失败</span></span><br><span class="line">            Debug.LogError(upHandle.Error);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新資源</span></span><br><span class="line">        <span class="keyword">var</span> upAssetHandle = _package.UpdatePackageManifestAsync(upHandle.PackageVersion, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> upAssetHandle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (upAssetHandle.Status == EOperationStatus.Succeed)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;更新完成！&quot;</span>);</span><br><span class="line">            StartCoroutine(Download());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(<span class="string">&quot;更新失敗：&quot;</span> + upAssetHandle.Error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> IEnumerator <span class="title">Download</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> downloadingMaxNum = <span class="number">10</span>;</span><br><span class="line">        <span class="built_in">int</span> failedTryAgain = <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">var</span> package = _package;</span><br><span class="line">        <span class="keyword">var</span> downloader = package.CreateResourceDownloader(downloadingMaxNum, failedTryAgain);</span><br><span class="line">    </span><br><span class="line">        print(<span class="string">&quot;需要下载的资源数量：&quot;</span>+downloader.TotalDownloadCount);</span><br><span class="line">        <span class="comment">//没有需要下载的资源</span></span><br><span class="line">        <span class="keyword">if</span> (downloader.TotalDownloadCount == <span class="number">0</span>)</span><br><span class="line">        &#123;  </span><br><span class="line">            <span class="keyword">yield</span> <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要下载的文件总数和总大小</span></span><br><span class="line">        <span class="built_in">int</span> totalDownloadCount = downloader.TotalDownloadCount;</span><br><span class="line">        <span class="built_in">long</span> totalDownloadBytes = downloader.TotalDownloadBytes;    </span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册回调方法</span></span><br><span class="line">        downloader.OnDownloadErrorCallback = (x,a)=&gt;&#123;print(<span class="string">&quot;下载资源出错！&quot;</span>);&#125;;</span><br><span class="line">        downloader.OnDownloadProgressCallback =(x,a,c,b)=&gt;&#123;print(<span class="string">$&quot;当前下载进度：<span class="subst">&#123;a&#125;</span>/<span class="subst">&#123;x&#125;</span>&quot;</span>);&#125;;</span><br><span class="line">        downloader.OnDownloadOverCallback = (x)=&gt;&#123;print(<span class="string">&quot;下载完成&quot;</span>);&#125;;</span><br><span class="line">        downloader.OnStartDownloadFileCallback = (x,a)=&gt;&#123;print(<span class="string">&quot;开始下载&quot;</span>);&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启下载</span></span><br><span class="line">        downloader.BeginDownload();</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">return</span> downloader;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//检测下载结果</span></span><br><span class="line">        <span class="keyword">if</span> (downloader.Status == EOperationStatus.Succeed)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//下载成功</span></span><br><span class="line">            print(<span class="string">&quot;下载成功！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//下载失败</span></span><br><span class="line">            print(<span class="string">&quot;下载失败：&quot;</span>+downloader.Error);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">CreateUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> root = GameObject.Find(<span class="string">&quot;Canvas&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> go = <span class="keyword">await</span> LoadAsync&lt;GameObject&gt;(<span class="string">&quot;UI/Image&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (go)</span><br><span class="line">        &#123;</span><br><span class="line">            Instantiate(go, root.transform, <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">CreateCube</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> g= <span class="keyword">await</span> LoadAsync&lt;GameObject&gt;(<span class="string">&quot;UI/Cube&quot;</span>);</span><br><span class="line">        Instantiate(g);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Button</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">LoadScene</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> sc = _package.LoadSceneAsync(<span class="string">&quot;Scene_1&quot;</span>, LoadSceneMode.Additive);</span><br><span class="line">        <span class="keyword">await</span> sc.Task;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="着色器变体收集">着色器变体收集</h2><h3 id="什么是着色器变体">什么是着色器变体</h3><blockquote><p>当我们写完一个shader以后，unity需要加载和编译，这个过程由着色器的构建管线来完成，它的输入是着色器，而它的输出就是今天的主角—着色器变体；每一个着色器进入构建管线后会被解析，然后提取着色器片段（顶点着色器和片元着色器等），收集预处理指令，然后每一个着色器变体会有一个参数表；<br>————————————————<br>版权声明：本文为CSDN博主「莫之」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_36383623/article/details/103327389">https://blog.csdn.net/qq_36383623/article/details/103327389</a></p></blockquote><h3 id="YooAsset-收集着色器变体">YooAsset 收集着色器变体</h3><p><img src="http://pic.fasty97.top/NotePad/202307190950490.png" alt="image-20230719095020282"></p><blockquote><p>收集的着色器变体文件需要打包进AB中，在AB中加载。</p></blockquote><h2 id="配合UnityCDN使用">配合UnityCDN使用</h2><blockquote><p>PS：YooAsset通过获取版本号，再更新对应版本资源。</p><p>故可以将获取补丁文件的路径设置为动态的，通过获取到的版本号来获取对应资源，有利于资源在CDN的存储结构。</p></blockquote><ol><li>创建一个Bucket存储池：</li></ol><p><img src="http://pic.fasty97.top/NotePad/202307140956218.png" alt="image-20230714095638150"></p><ol start="2"><li>下载相关Unity 插件</li></ol><p><img src="http://pic.fasty97.top/NotePad/202307140958953.png" alt="image-20230714095811900"></p><ol start="3"><li>填写好相关key</li></ol><p><img src="http://pic.fasty97.top/NotePad/202307140959349.png" alt=""></p><ol start="4"><li>上传相关文件</li></ol><p><img src="http://pic.fasty97.top/NotePad/202307141001266.png" alt="image-20230714100120217"></p><h2 id="相关链接">相关链接</h2><ul><li><a href="https://www.yooasset.com/">Hello from YooAsset | YooAsset</a></li><li>+<a href="https://uos.unity.cn/apps">UOS Developer Portal (unity.cn)</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 热更新 </tag>
            
            <tag> 资源管理 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EnhancedScroller的使用</title>
      <link href="/2023/07/07/EnhancedScroller%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2023/07/07/EnhancedScroller%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><img src="http://pic.fasty97.top/NotePad/202307071101983.png" alt="image-20230707110146287"></p><p><code>EnhancedScroller</code>是一个加强版本的滚动区域组件，可以改善滚动条的性能并实现例如无限滚动的效果。</p><h2 id="简单示例">简单示例</h2><p>创建一个滑动区域：</p><p><img src="http://pic.fasty97.top/NotePad/202307071349322.png" alt="image-20230707134942227"></p><blockquote><ul><li>滑动区域需要3个部分：滑动区域、滚动条、Mask</li></ul></blockquote><p><img src="http://pic.fasty97.top/NotePad/202307071354735.png" alt="image-20230707135435704"></p><Center>可以使用Rect Mask 2D 替代Mask获得更好效果</Center><p>列表内容都需要继承<code>EnhancedScrollerCellView</code></p><figure class="highlight csharp"><figcaption><span>PersonItem</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonItem</span>: <span class="title">EnhancedScrollerCellView</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> TextMeshProUGUI _text;</span><br><span class="line">    <span class="keyword">private</span> PersonModel _model;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Button _button;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        _text = GetComponentInChildren&lt;TextMeshProUGUI&gt;();</span><br><span class="line">        _button = GetComponent&lt;Button&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetData</span>(<span class="params">PersonModel model</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _model = model;</span><br><span class="line"></span><br><span class="line">        _text.text = _model.Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>列表需要实现<code>IEnhancedScrollerDelegate</code>接口</p><figure class="highlight csharp"><figcaption><span>PersonList</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PersonList</span> : <span class="title">MonoBehaviour</span>,<span class="title">IEnhancedScrollerDelegate</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">private</span> EnhancedScroller _enhancedScroller;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> List&lt;PersonModel&gt; _list = <span class="keyword">new</span> List&lt;PersonModel&gt;();</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">public</span> EnhancedScrollerCellView cellViewPrefab;</span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">      _enhancedScroller = GetComponent&lt;EnhancedScroller&gt;();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//需要在Start方法中，设定委托对象为当前</span></span><br><span class="line">      _enhancedScroller.Delegate = <span class="keyword">this</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++)</span><br><span class="line">      &#123;</span><br><span class="line">         _list.Add(<span class="keyword">new</span> PersonModel()&#123;Name = <span class="string">&quot;AAA&quot;</span>+i&#125;);</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="comment">//装载初始化对象</span></span><br><span class="line">      _enhancedScroller.ReloadData();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//数据个数</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">GetNumberOfCells</span>(<span class="params">EnhancedScroller scroller</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> _list.Count;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//每个子项目的大小</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="built_in">float</span> <span class="title">GetCellViewSize</span>(<span class="params">EnhancedScroller scroller, <span class="built_in">int</span> dataIndex</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">30</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建初始化一个子项目</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> EnhancedScrollerCellView <span class="title">GetCellView</span>(<span class="params">EnhancedScroller scroller, <span class="built_in">int</span> dataIndex, <span class="built_in">int</span> cellIndex</span>)</span></span><br><span class="line">   &#123;</span><br><span class="line">      <span class="comment">//创建一个子项</span></span><br><span class="line">      <span class="keyword">var</span> cellView = scroller.GetCellView(cellViewPrefab) <span class="keyword">as</span> PersonItem;</span><br><span class="line">      cellView.name = <span class="string">&quot;cell &quot;</span> + dataIndex;</span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      cellView.SetData(_list[dataIndex]);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> cellView;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="效果展示">效果展示</h3><p><img src="http://pic.fasty97.top/NotePad/202307071404120.gif" alt="动画"></p><p>如上所示：当我滚动列表时，左侧列表也会随之变化，重复使用对象。</p><h3 id="无限循环列表">无限循环列表</h3><p><img src="http://pic.fasty97.top/NotePad/202307071411713.png" alt="image-20230707141151672"></p><p>勾选此选项可以开启无限循环模式，在这个模式下，可以无限滑列表。</p><p><img src="http://pic.fasty97.top/NotePad/202307071411315.gif" alt="动画"></p><Center>无限循环列表效果</Center><h3 id="跳转位置">跳转位置</h3><p><img src="http://pic.fasty97.top/NotePad/202307071438598.gif" alt="动画"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">int</span>.TryParse(keyTex.text, <span class="keyword">out</span> <span class="keyword">var</span> data))</span><br><span class="line">           &#123;</span><br><span class="line">               data = Mathf.Clamp(data, <span class="number">0</span>, _list.Count);</span><br><span class="line">               _enhancedScroller.JumpToDataIndex(data, tweenTime: <span class="number">0.5f</span>, tweenType: EnhancedScroller.TweenType.easeInSine);</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure><h2 id="说明">说明</h2><p>除此之外，插件还支持例如：下拉加载、多种类子项、Gird布局等。。。</p><p>在使用几百个下拉项时，Unity自带的滚轮区域会卡顿，特别是在初始化时会造成峰值，使用此插件可以避免这种情况😄.</p>]]></content>
      
      
      
        <tags>
            
            <tag> 好物推荐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Address快速食用指南</title>
      <link href="/2023/06/29/Address%E5%BF%AB%E9%80%9F%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2023/06/29/Address%E5%BF%AB%E9%80%9F%E9%A3%9F%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="📑写在前面">📑写在前面</h2><p>Address是Unity推出的Ab包的新封装，可以更方便的实现Ab包的资源加载，为做区分这里将Address打出的包称之为aa包。</p><h2 id="需求环境">需求环境</h2><blockquote><p>在什么情况下我们需要使用Address呢？</p></blockquote><ol><li>当我们需要使用Ab包时，可以使用Address替代传统Ab包。</li><li>当我们需要将资源进行分组时，例如美术场景和程序分离。</li><li>当我们需要进行热更新时。</li><li>当我们希望在外部更新程序或资源时。</li><li>…</li></ol><h2 id="1-构建本地静态包">1.构建本地静态包</h2><p>先来</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在Unity使用SqlLite</title>
      <link href="/2023/05/10/%E5%9C%A8Unity%E4%BD%BF%E7%94%A8SqlLite/"/>
      <url>/2023/05/10/%E5%9C%A8Unity%E4%BD%BF%E7%94%A8SqlLite/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><p>在游戏存储中我们可以使用多种方法，json、二进制、xml、csv、excel、或者是文本、自定义格式等等。使用这些的时候我们基本都需要将文件整个读入内存中，那有没有一种办法可以不用将所有数据载入内存呢?</p><p>答案就是————使用++数据库++。</p><p>数据库的种类很多，大都都服务于网络服务，在单机游戏中使用数据库的话，可以选择sqllite。</p><h2 id="SqlLite">SqlLite</h2><p>sqllite是一种轻量的文件型数据库，整个数据库只有一个<code>.db文件</code>而且其使用范围非常广，支持的平台多，是我们在使用Unity开发单机游戏时的好选择。</p><h2 id="快速食用">快速食用</h2><p>要使用SqlLite，我们至少需要导入:</p><ul><li>sqllte3.dll</li><li>Mono.Data.Sqllite.dll</li></ul><p>在这里我们额外导入Dapper作为Orm方便我们对数据进行curd：</p><ul><li>Dapper.dll</li><li>Dapper.Contrib.dll</li><li>Mono.Data.Sqlite.dll</li></ul><h3 id="创建数据表">创建数据表</h3><p>首先我们创建一个数据表的模型类User如下：</p><p>在类名上标注表的名称，++这个名称需要和db文件中的数据表名称对应++。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> Dapper.Contrib.Extensions;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Scenes.SqlLiteDB.Tables</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Table(<span class="string">&quot;User&quot;</span>)</span>]</span><br><span class="line">    [<span class="meta">Serializable</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">User</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Key</span>] <span class="keyword">public</span> <span class="built_in">int</span> id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> pass;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;id:<span class="subst">&#123;id&#125;</span> name:<span class="subst">&#123;name&#125;</span> pass:<span class="subst">&#123;pass&#125;</span> age:<span class="subst">&#123;age&#125;</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 数据存储 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SqlLite </tag>
            
            <tag> 存储 </tag>
            
            <tag> 数据库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通知系统</title>
      <link href="/2023/03/09/%E9%80%9A%E7%9F%A5%E7%B3%BB%E7%BB%9F/"/>
      <url>/2023/03/09/%E9%80%9A%E7%9F%A5%E7%B3%BB%E7%BB%9F/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>通知系统</code>在各种各样的游戏、应用中都有。</p></blockquote><p>相信大家都看过win10的通知消息，在游戏中，我们获得xx道具、达成xx成就、或是做了xx事情需要通知给玩家，这些都可以看作是通知。</p><h2 id="通知系统的特点">通知系统的特点</h2><p>通知系统具备以下特点：</p><ol><li>时效性: 每一个通知就像一条讯息，存在<code>存活时间</code>,死亡后就应该从屏幕空间消失。</li><li>排列性：按照先来先服务原则，很有可能上一条讯息还处于存活时间，就来了很多条新讯息，此时新讯息不应该抢占当前讯息的存活时间，而是在等待讯息死亡后再按照排列进行数据显示。</li><li>置顶性：通知系统应该具备较高的<code>显示优先级</code>，即不该被基础元素遮挡。</li><li>显示层：以上几点均为逻辑设计，一般来说，通知系统显示新消息时会将旧消息<code>顶</code>上去。</li></ol><p>依据以上特点我们可以这样考虑：</p><h3 id="时效性">时效性</h3><p>自消息显示时开始记录时效，在指定时间后 <code>杀死消息</code>。</p><h3 id="排列性">排列性</h3><p>遵循先来先服务的原则，我们可以使用一个队列结构对等待消息进行缓存。在显示消息时将消息从队列中移除。</p><h3 id="置顶性">置顶性</h3>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MarkLight以XML编写UI</title>
      <link href="/2023/02/07/MarkLight%E4%BB%A5Xml%E7%BC%96%E5%86%99UI/"/>
      <url>/2023/02/07/MarkLight%E4%BB%A5Xml%E7%BC%96%E5%86%99UI/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><blockquote><p>接触过web前端的人，应该都知道网页 以<code>Html+Css+Js</code>的形式构成，这种高度灵活的方式一直延续至今。当然后续推出了如<code>Vue</code>、<code>Rective</code>等前端框架和<code>Thymeleaf</code>、<code>Asp</code>等模板引擎。。。扯远了…</p><p>总之，我们可以借鉴Web的做法，使用类似的结构去编写Unity Ui，如Unity 的新UI系统 <code>UIElement（UiToolkit</code>）也是这么做的。此文并不想介绍UIElement，因为通过作者实际使用体验来说，UIElement还有很多路要走，可能在制作编辑器领域可以打破原先Gui的桎梏，然而在运行时下的UI，MarkLight 则舒服许多。</p></blockquote><h2 id="关于MarkLight">关于MarkLight</h2><p>在Ui框架的领域中一直流行MVVM的设计，M 模型 V 视图 VM 视图模型 通过三者的配合，可以将表现层与逻辑层相分离，有利于解除耦合。MarkLight 同样是使用了这一套设计方案，通过Xml文件编写View,配合ViewModel的C#文件进行控制。同时吸纳了Html的优点，使用类Css的Xml文件可以对控件进行统一的样式配置，这让换肤和界面规范统一变得十分容易。</p><h2 id="快速食用">快速食用</h2><p>首先我们可以通过包管理器或者其他方式，将MarkLight导入项目中。</p><p>此时我们创建如下文件夹：</p><p><img src="http://pic.fasty97.top/NotePad/202302071005066.png" alt="image-20230207100516762"></p><table><thead><tr><th>Resources</th><th>存放所有的图片、音效等资源</th></tr></thead><tbody><tr><td>ViewModels</td><td>存放所有的View对应的ViewModel</td></tr><tr><td>View</td><td>存放所有的UI元素</td></tr></tbody></table><h3 id="创建一个视图View">创建一个视图View</h3><blockquote><p>右键-&gt;Create-&gt;View 创建一个名为MainMenu的xml</p></blockquote><p>给新创建的Xml，写入如下内容：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">MainMenu</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Region</span> <span class="attr">Width</span>=<span class="string">&quot;25%&quot;</span> <span class="attr">Alignment</span>=<span class="string">&quot;Left&quot;</span> <span class="attr">BackgroundColor</span>=<span class="string">&quot;#353535&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Group</span> <span class="attr">Spacing</span>=<span class="string">&quot;10px&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;Play&quot;</span> <span class="attr">Click</span>=<span class="string">&quot;Play&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;Options&quot;</span> <span class="attr">Click</span>=<span class="string">&quot;Options&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Id</span>=<span class="string">&quot;btn&quot;</span> <span class="attr">Text</span>=<span class="string">&quot;Quit&quot;</span> <span class="attr">Click</span>=<span class="string">&quot;Quit&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Button</span> <span class="attr">Text</span>=<span class="string">&quot;测试&quot;</span> <span class="attr">Click</span>=<span class="string">&quot;Test&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Group</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Region</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Region</span> <span class="attr">Width</span>=<span class="string">&quot;75%&quot;</span> <span class="attr">Alignment</span>=<span class="string">&quot;Right&quot;</span> <span class="attr">BackgroundColor</span>=<span class="string">&quot;#949494&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Region</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">MainMenu</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>右键-&gt;Create-&gt;View 创建一个名为MainMenuScene的xml 作为根Ui</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">MainMenuScene</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">UserInterface</span> <span class="attr">Width</span>=<span class="string">&quot;1024&quot;</span> <span class="attr">Height</span>=<span class="string">&quot;768&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">MainMenu</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">UserInterface</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">EventSystem</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">MainMenuScene</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>创建一个空物体改名<code>UIRoot</code>并为其添加如下脚本，设置MainView为MainMenuScene，Default Theme 为Flat。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202302071026717.png" alt="image-20230207102610139"></p><p>此时你将会看到场景中多了UI，并且在UIRoot下生成了许多子物体。</p><p><img src="http://pic.fasty97.top/NotePad/202302071029753.png" alt="image-20230207102854443"></p><p><img src="http://pic.fasty97.top/NotePad/202302071030826.png" alt=""></p><h3 id="绑定ViewModel">绑定ViewModel</h3><blockquote><p>在ViewModels文件夹下创建一个MainMenu.cs 文件</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MainMenu</span>: <span class="title">UIView</span></span><br><span class="line">&#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Play</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;Play&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Options</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            print(<span class="string">&quot;Options&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Quit</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            print(<span class="string">&quot;Quit&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>在其中添加方法可以绑定到Button的Click事件。</p><p>++ PS：在MarkLight中使用名称强相关进行绑定，所以所有的文件名、方法名都需要一致。 ++</p>]]></content>
      
      
      <categories>
          
          <category> UI框架 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XML </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于树的操作</title>
      <link href="/2023/01/29/%E5%85%B3%E4%BA%8E%E6%A0%91%E7%9A%84%E6%93%8D%E4%BD%9C/"/>
      <url>/2023/01/29/%E5%85%B3%E4%BA%8E%E6%A0%91%E7%9A%84%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<figure class="highlight csharp"><figcaption><span>一个简单树</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; Items &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="keyword">new</span> List&lt;Item&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>基础数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> List&lt;Item&gt;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;A&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> b = <span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;B&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;C&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> d = <span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;D&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> e = <span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;E&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line">a.Items.Add(<span class="keyword">new</span> Item &#123; Name = <span class="string">&quot;a1&quot;</span> &#125;);</span><br><span class="line">a.Items.Add(<span class="keyword">new</span> Item &#123; Name = <span class="string">&quot;a2&quot;</span> &#125;);</span><br><span class="line"></span><br><span class="line">e.Items.Add(<span class="keyword">new</span> Item &#123; Name = <span class="string">&quot;e1&quot;</span> &#125;);</span><br><span class="line">e.Items.Add(<span class="keyword">new</span> Item() &#123; Name = <span class="string">&quot;e2&quot;</span> &#125;);</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>简单遍历</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Loop2</span>(<span class="params">List&lt;Item&gt; aa, <span class="built_in">string</span> key</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//根</span></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> aa)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.Name==key)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Dosomething</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;OK&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Loop2(item.Items, key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>以上的内容都很简单，现在我们来思考一下，假如我们需要返回一个值？ 例如是否存在指定Name节点的布尔值。</p></blockquote><p>暂时只想到这样的办法，肯定有更好的方案。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bool</span> res = <span class="literal">false</span>;</span><br><span class="line">LoopAct(aa, (x) =&gt; &#123; <span class="keyword">if</span> (x.Name == <span class="string">&quot;e1&quot;</span>) res = <span class="literal">true</span>; &#125;);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(res);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 数据结构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 思维 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>坐标系变换</title>
      <link href="/2023/01/06/%E5%9D%90%E6%A0%87%E7%B3%BB%E5%8F%98%E6%8D%A2/"/>
      <url>/2023/01/06/%E5%9D%90%E6%A0%87%E7%B3%BB%E5%8F%98%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<h2 id="坐标转换">坐标转换</h2><p>已知云端坐标点A（10,10），需要转换到本地坐标轴下的位置 B？</p><h3 id="可能的问题">可能的问题</h3><ul><li>坐标平移</li><li>坐标旋转</li></ul><h3 id="参考">参考</h3><ul><li><a href="https://blog.csdn.net/xinzhilinger/article/details/122209787">Unity 不同空间坐标转换中的矩阵应用_心之凌儿的博客-CSDN博客_unity 空间变换</a></li></ul><h2 id="Unity中内置转换">Unity中内置转换</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"> </span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 坐标转换工具类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">CTUtils</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 世界坐标转屏幕坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">World2Screen</span>(<span class="params">Vector3 wp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.WorldToScreenPoint(wp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕坐标转世界坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Screen2World</span>(<span class="params">Vector3 sp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.ScreenToWorldPoint(sp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 世界坐标转视口坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">World2Viewport</span>(<span class="params">Vector3 wp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.WorldToViewportPoint(wp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 视口坐标转世界坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Viewport2World</span>(<span class="params">Vector3 vp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.ViewportToWorldPoint(vp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕坐标转视口坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">Screen2Viewport</span>(<span class="params">Vector2 sp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.ScreenToViewportPoint(sp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 视口坐标转屏幕坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">Viewport2Screen</span>(<span class="params">Vector2 vp, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (camera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            camera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> camera.ViewportToScreenPoint(vp);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 屏幕坐标转UI坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">Screen2UI</span>(<span class="params">Vector2 sp, RectTransform rect, Camera camera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector2 uiLocalPos;</span><br><span class="line">        RectTransformUtility.ScreenPointToLocalPointInRectangle(rect, sp, camera, <span class="keyword">out</span> uiLocalPos);</span><br><span class="line">        <span class="keyword">return</span> uiLocalPos;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 世界坐标转UI坐标</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;isUIObj&quot;&gt;</span>是否为ui物体<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector2 <span class="title">World2UI</span>(<span class="params"><span class="built_in">bool</span> isUIObj, Vector3 wp, RectTransform rect, Camera uiCamera, Camera worldCamera = <span class="literal">null</span></span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (worldCamera == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            worldCamera = Camera.main;</span><br><span class="line">        &#125;</span><br><span class="line">        Vector2 screenPos = World2Screen(wp, isUIObj ? uiCamera : worldCamera);</span><br><span class="line">        <span class="keyword">return</span> Screen2UI(screenPos, rect, uiCamera);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏数学 </category>
          
          <category> 矩阵 </category>
          
          <category> 坐标系 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数学 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022年终总结</title>
      <link href="/2022/12/27/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2022/12/27/2022%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<blockquote><p>不知不觉，一年的时间就这么过去了😢.回顾这一年的种种，大致可以将其划分为上半年和下半年两大部分。</p></blockquote><h2 id="上半年">上半年</h2><blockquote><p>上半年 大概都是找工作的事情</p></blockquote><p>上半年的时候，基本还在考编制。印象最深的莫过于获得了烟草公司的笔试机会，在对计算机专业知识一通复习后，我自我感觉良好，没想到行测考的太差与面试失之交臂。自这一场考试深深的提醒了我对于行测等知识的学习能力很差，要想通过行测申论来考取一个工作机会是困难的。而我能为之依靠的除了自身的专业知识之外也没有什么其他的东西了，看着越来越卷的编制大环境，我放弃了省考的机会开始找工作之旅。</p><h3 id="论失业1年如何重获工作">论失业1年如何重获工作</h3><p>自之前从朋友介绍的工作离职，我已经很久（将近一年）没工作了，对于这次找工作可谓是恐惧与期待并存——害怕开始却也期待新的变革。静下心来，好好整理了一份工作简历，把学生时代的一些荣誉填上去、再加上一些自我认知的东西。我觉得，学生时代打下的基础多少能有一些用。整理好了简历，我开始在网络上投递简历，心想着现在就去做游戏吧。我把城市选在了成都，成都离云南不太远，不知道是不是在云南待的有些久了，竟然有些缺乏了走出去的勇气。在成都投递了几天简历，也主动联系了几家公司，都要求要有项目上线经验。其中倒是也有无需上线经验的，但是是做Cos cos，想都没想我就拒绝了。</p><p>随后，以试试看的心态，在云南看看，发现云南的游戏工作室非常少，可以说是屈指可数，而且大都非常差劲。直到我发现了<code>螺舟</code>,对，就是那个太吾绘卷的游戏工作室。我直接投递了简历，然而并没有什么回声，直接石沉大海了。（想必是看不上一个没有游戏上线经验的小白吧。）本来想着上门亲自自荐，后来冷静下来想想也就算了。</p><p>那如果不能做游戏我能做什么呢？我不禁自己问自己。回去写Web？或者转写Java？不，我想至少有机会从事Unity相关的工作会比较好一些。直接搜索Unity下，我发现云南有一些数字孪生、数字工厂的岗位需求，大多数是Unity也有需要UE的（没想到在这种信息化发展很差的地方,也还是有Unity出场的地方而且需求量比游戏要多一些。）随即，我将自己的简历挂了上去。</p><p>其实当时在想，如果云南没有合适的岗位、成都又需求上线经验，要不就直接去上海、杭州、深圳找个正经游戏公司待。大概是命运使然吧，在挂上简历的第二天我就收到了x公司Hr的私信，让我过去面试。</p><h3 id="x公司面试">x公司面试</h3><p>越好时间之后，一大早我就做地铁30多公里来到了公司楼下，找了一个复印店，打印了一份简历，同时特意购买了了一个文件夹把简历包装好，我相信面试的态度和用心也决定了面试成败和薪资。带着简历，我找到了公司，公司的地理位置十分偏僻。不远处便可以看到大山。旁边是一个小村落，公路上的车辆很少，只有过路的货车和在园区这边上班的人。</p><p>走进去，Hr只会我在进门一侧的小桌子坐下，随即扔给我一份测试题。我也曾想过可能会有测试题，并不感到有什么意外，大致翻看了一下，都是一些基础性知识，在最后有二道简单算法题目。”什么Unity生命周期“，”什么Linq“，“什么对象池”，“一个排序和一个二叉树”。看着那份测试题，我脑海里猜想着我需要从事的工作内容。然后便是一名三十来岁的男子，走过来招呼我去面试，这次则是到了楼上，“我们公司分为2层”他解释道。</p><p>开场先来一个标准性的自我介绍，随后就是一些工作经验问答，最后聊了一下设计模式,我自我感觉我聊的应该不错，测试完成的也很棒，在薪资环节，我大胆的高要了一步，在走的时候，我问“什么时候能知道结果？”，他说“像你这样的应该很快”。</p><p>不久我就收到了电话，要和我谈谈薪资，我就重复说要面试时开出的薪资，对方软磨硬泡，最终公司决定先给我发offer，给我一周的时间考虑。</p><h3 id="y公司面试">y公司面试</h3><p>在这一周的时间里，我也想看看别的机会，果然在第三天，我收到了y公司的面试邀请。y公司是一家以做工程项目起家的公司，现在数字孪生、数字城市是公司的创新项目。与x公司不同，有公司在市区，就是位置有点偏僻，周围都是建筑公司和建筑工地。来到一间会议室，安排我坐下，随即就扔给我一份面试题。Hr介绍说：“面试分为HR面试和技术面试两个环节。”</p><p>面试题并非x公司的专业性知识，而是一则冗长的个人情况调查，掺杂着一些心理测试。看到卷面，我就感到有些不适：</p><ul><li>各种家庭关系、父母工作、</li><li>以前的工作经历和薪资、</li><li>如果有机会让你做其他岗位你最想做什么？</li><li>你想成为孙悟空还是沙和尚？</li><li>…</li></ul><p>要填的公司有多又长，满满两大页纸。</p><p>然后便是HR和我聊对公司的认识，聊信念。</p><p>最后的最后，我一个技术人员终于迎来了技术面试，来的是一男一女，都挺年轻的。看了我的简历，看了很久。然后介绍了一下主要的工作内容，要到实地去驻场开发。等了好久，面试官也没有问我技术问题，我果断直接开问。“你们不问我技术问题吗？”面试官笑笑“看你的简历就知道了，不用问”。随后便是期望薪资，我说了和x公司一样的。最后hr问我，“对这次面试还满意不？”，我说除了开头那些测试太多、而且有些侵犯个人隐私之外都挺好的，她说让我打个分，我说“80”分吧。 其实这不是给这次面试打分，而是给整个公司打分，得益于公司是在市区，而且提供一顿早饭的缘故，我还是和hr强调我也已经拿到一份offer，有结果还请尽快联系我。</p><h3 id="碎碎念">碎碎念</h3><p>如果以分值100作为评定，我觉得双方都是80分，x公司很期望我入职，尽管觉得我要价太高，还是给我发了一份他能给的薪资offer、而且有很好的上司，纯互联网公司，但地理位置偏远。y公司，在市区地理位置较好，提供早饭，本质是工程类公司的技术部门，但感觉录取一个技术人员，全看人事Hr，技术员在里面话语权很低。</p><hr><p>最终，在x公司的最后一天，我也没接到y公司的通知，又暂时没有更好的机会，我便来到了x公司。在入职x公司一周后，我才接到了y公司面试失败的消息。（其实我觉得这么久，也多半是凉了。）</p><h2 id="下半年">下半年</h2><blockquote><p>下半年基本都是 工作后的事情</p></blockquote><p>7月底，我入职了。</p><p>入职的第一项工作是实现一个基于A星寻路的算法.</p><p><img src="http://pic.fasty97.top/NotePad/202301131025414.gif" alt="动画"></p><p>然后便是一个处理一个环穿车，大概长这样：</p><p><img src="http://pic.fasty97.top/NotePad/202301170922143.png" alt="image-20230117092249989"></p><p>一辆小车在一个环形轨道上运动，根据远端的传感器数据来确定小车的移动速度和停留位置。单纯从单机的角度上考虑，这项工作很容易，然而在结合生成环境下就出现很多问题。</p><ol><li>测量数据是又误差的</li><li>远端数据存在丢包现象，且不可校正——接受的数据时间间隔不统一</li><li>小车存在加减速过程</li></ol><p>之前都是使用自己的服务，分包、粘包，丢包也会重发。对于这种问题并没有什么经验，还好最终是解决了。</p><p>++其余的有空再单独抽一篇来写吧++</p><h2 id="公司年会">公司年会</h2><p>“恭喜xx获得一台冰箱”，那好像喊的是我的名字。我有些不知所措，又有些惊喜，我抬头看看电子荧幕上我的名字，再看了一眼周围的同事。嗯，没错，确实是我抽中了。和我一同抽中的还有坐我旁边的一位同事，另一位则是个女生。合影留念后，我回到饭桌，大家都露出恭喜之色。</p><p>虽是好事但是也多了忧虑“我现在并用不到那么大的冰箱，租房处也容纳不了，况且我已经有一台小冰箱了，已经足够了。”，该怎么出手成了一个问题，和PS5这样的游戏机不同，冰箱这种体积庞大，运费昂贵的居家物件并不是好出手的类型。不过我运气还算不错，有位同事想要，我也就降了几百块出给他了。</p><p>虽然我抽中了奖品，但是我还是想要吐槽一下，年会的饭菜着实是有些拉了，特别是我们那一桌都是男的，上一碟菜就吃完，坐等下一碟，上菜断断续续的菜上齐，我们桌上已经多了不少空盘子，哈哈哈。😄</p><h2 id="🤹‍♂️自我认知">🤹‍♂️自我认知</h2><blockquote><p>回顾这一年，算是重要变迁的一年，也是真正走向社会的一年。</p></blockquote><p>随着年纪的增长，对未来的忧虑更重了。得想办法赚更多的钱，不论是工作上、副业还是其他什么的，总之，感觉得想点办法去做。</p><p>同学朋友们，有考入编制的、有进入银行的、有当老师的，似乎毕业这一年多时间里大家都找到了自己为之奋斗一生的赛道，我想自己应该也要有所成就了。未来半年里，也就是<code>2023年7月时</code>希望自己可以有大的提升和改变。</p><h2 id="🚄新年祈愿">🚄新年祈愿</h2><p>新的一年里，希望自己可以发挥自己所有的潜力，看看自己能走多远；也希望自己，新的一年平安喜乐。</p><ol><li>上架一个游戏（Steam平台）</li><li>完善<code>FanlFrameWork</code>的开发</li><li>读几本书</li><li>年收入提升</li></ol>]]></content>
      
      
      <categories>
          
          <category> 年终总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2023年终总结</title>
      <link href="/2022/12/27/2023%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2022/12/27/2023%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>一句话即可概括：</p><blockquote><p>我在人间凑数的日子 —— 2023</p></blockquote><hr><h3 id="思考">思考</h3><p>更多的生活属于平静（摆烂），我只记得公司年会上 老板说着什么经济形式不好，竞争对手死了一半，合作伙伴也死了不少；说罢便提到今年 年终奖缓发的消息。</p><p>2023了，又过去了一年，每每这种时候看看自己的qq资料卡看到自己年龄又增长一岁，感觉有些恍惚。仔细琢磨，就会感觉头开始疼了，仿佛这是什么不可思考的禁忌法则，无形之中有什么因果规则之力。</p><p>“有一间住所、一台电脑、水电网、有吃的，好像我可以在这种地方住一辈子”，有时我不禁这么想。</p><h3 id="见闻">见闻</h3><p>寒假时候，妹妹从哈尔滨会昆明来，住在我这里；有幸她拿到了一个区检察院的实习机会。因为工作地点离家很远，我建议他就近找个住处。每周天去晚上回住处，每周五下午回到我这来，每次回来她总有一些青旅的见闻给我分享。</p><p>“北上广的画家，厌倦了大城市的钢铁森林，放弃高薪工作；选择到大理居家做自由画家。” “我看到那些高楼大厦就害怕”青年女画家这样说道。在上海工作10年，来到大理，租下一间小屋，在院子里种满花；好好生活好好画画。</p><p>“我也是大学毕业”一个中年妇女说道，“直到现在做保姆”。我忍不住插嘴，大学生也有做保姆的吗？而且在我印象中青旅应该年轻的刺头们选择的居所。妹妹说，青旅大部分是年轻人，但也有一些年纪稍大的人。大家每天都要煮火锅，一起做饭、一起唱歌什么的；  “选择住青旅的人都是比较活络的人吧”</p><h3 id="接亲">接亲</h3><p>今年算得上重要的一件事，我发小也是我表弟结婚了。我特意周五买了晚上的车票，准备一大早随车队去接亲。接亲的位置在大山里面，沿着山路环绕而上，翻过去再环绕而下就到了。在我们几个发小兄弟中，如我们所料，第一个结婚的是我表弟。++过程省略一万字…++</p><p>通过这次活动，感觉自己已经不再是小孩子了，未来的路要站在一个成年人的角度去思考；更理智、更成熟的面对问题。</p><h3 id="旅行">旅行</h3><p>一直打算的旅行计划算是完美实施了，大理——保山——芒市——腾冲——保山——大理。</p><iframe height=600 src="https://pic.fasty97.top/Video/VID_20240212_183646.mp4"></iframe>]]></content>
      
      
      <categories>
          
          <category> 年终总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（十一）让画面动起来</title>
      <link href="/2022/12/26/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E8%AE%A9%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/"/>
      <url>/2022/12/26/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%8D%81%E4%B8%80%EF%BC%89%E8%AE%A9%E7%94%BB%E9%9D%A2%E5%8A%A8%E8%B5%B7%E6%9D%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="UnityShader的内置时间变量">UnityShader的内置时间变量</h2><p><img src="http://pic.fasty97.top/NotePad/202212261137373.png" alt="image-20221226113747301"></p><h2 id="序列帧动画">序列帧动画</h2><p><img src="http://pic.fasty97.top/NotePad/202212261519510.gif" alt=""></p><blockquote><p>通过使用Time实现循环的特效播放。</p></blockquote><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Unlit/Exp2Shader&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color (&quot;Color Tint&quot;,Color)=(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _MainTex (&quot;Texture&quot;, <span class="number">2</span>D) = &quot;white&quot; &#123;&#125;</span><br><span class="line"></span><br><span class="line">        _HorizontalAmount(&quot;Horizontal Amount&quot;,Float)=<span class="number">4</span></span><br><span class="line">        _VerticalAmount(&quot;Vertical Amount&quot;,Float)=<span class="number">4</span></span><br><span class="line">        _Speed(&quot;Speed&quot;,Range(<span class="number">1</span>,<span class="number">100</span>))=<span class="number">30</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;Queue&quot;=&quot;Transparent&quot; &quot;IgnoreProjector&quot;=&quot;True&quot; &quot;RenderType&quot;=&quot;Transparent&quot;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line">            <span class="comment">// make fog work</span></span><br><span class="line">            <span class="meta">#pragma multi_compile_fog</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            struct appdata</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                float4 vertex : SV_POSITION;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="type">sampler2D</span> _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line"></span><br><span class="line">            v2f vert(appdata v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.uv = TRANSFORM_TEX(v.uv, _MainTex);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">float</span> _Speed;</span><br><span class="line">            <span class="type">float</span> _HorizontalAmount, _VerticalAmount;</span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            fixed4 frag(v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">float</span> time = <span class="built_in">floor</span>(_Time.y * _Speed);</span><br><span class="line">                <span class="type">float</span> row = <span class="built_in">floor</span>(time / _HorizontalAmount);</span><br><span class="line">                <span class="type">float</span> column = time - row * _VerticalAmount;</span><br><span class="line"></span><br><span class="line">                half2 uv = i.uv + half2(column, -row);</span><br><span class="line">                uv.x /= _HorizontalAmount;</span><br><span class="line">                uv.y /= _VerticalAmount;</span><br><span class="line"></span><br><span class="line">                fixed4 c = tex2D(_MainTex, uv);</span><br><span class="line">                c.rgb *= _Color;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;    Fallback &quot;Transparent/VertexLit&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="无限滚动背景">无限滚动背景</h2><p>很多无限滚动的背景也是使用了纹理动画。纹理资源： <a href="https://opengameart.org/">OpenGameArt.org</a></p><blockquote><p>注意： uv现已经不存在zw值。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">Shader <span class="string">&quot;Unlit/BackGroundShader&quot;</span></span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainTex (<span class="string">&quot;Texture&quot;</span>, <span class="number">2</span>D) = <span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">        _DetailTex(<span class="string">&quot;2nd Layer (RGB)&quot;</span>,<span class="number">2</span>D)=<span class="string">&quot;white&quot;</span> &#123;&#125;</span><br><span class="line">        _ScrollX(<span class="string">&quot;Base Layer Scrool Speed&quot;</span>,Float)=<span class="number">1.0</span></span><br><span class="line">        _Scroll2X(<span class="string">&quot;2nd Layer Scroll Speed&quot;</span>,Float)=<span class="number">1.0</span></span><br><span class="line">        _Multiplier(<span class="string">&quot;Layer Multiplier&quot;</span>,Float)=<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;RenderType&quot;</span>=<span class="string">&quot;Opaque&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> vertex vert</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> fragment frag</span></span><br><span class="line">            <span class="comment">// make fog work</span></span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> multi_compile_fog</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> appdata</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex : POSITION;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">struct</span> v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float2 uv : TEXCOORD0;</span><br><span class="line">                UNITY_FOG_COORDS(<span class="number">1</span>)</span><br><span class="line">                float4 vertex : SV_POSITION;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            sampler2D _MainTex, _DetailTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            <span class="built_in">float</span> _ScrollX, _Scroll2X, _Multiplier;</span><br><span class="line">            float4 _DetailTex_ST;</span><br><span class="line"></span><br><span class="line">            <span class="function">v2f <span class="title">vert</span>(<span class="params">appdata v</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.vertex = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.uv.xy = TRANSFORM_TEX(v.uv, _MainTex) + frac(float2(_ScrollX, <span class="number">0.0</span>) * _Time.y);</span><br><span class="line">                o.uv.zw = TRANSFORM_TEX(v.uv, _DetailTex) + frac(float2(_Scroll2X, <span class="number">0.0</span>) * _Time.y);</span><br><span class="line">                UNITY_TRANSFER_FOG(o, o.vertex);</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="function">fixed4 <span class="title">frag</span>(<span class="params">v2f i</span>) : SV_Target</span></span><br><span class="line">            &#123;</span><br><span class="line">                fixed4 firstLayer = tex2D(_MainTex, i.uv.xy);</span><br><span class="line">                fixed4 secondLayer = tex2D(_DetailTex, i.uv.zw);</span><br><span class="line"></span><br><span class="line">                fixed4 c = lerp(firstLayer, secondLayer, secondLayer.a);</span><br><span class="line">                c.rgb *= _Multiplier;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> c;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback <span class="string">&quot;VertexLit&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="顶点动画">顶点动画</h2>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（七）基础纹理</title>
      <link href="/2022/12/26/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%83%EF%BC%89%20%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/"/>
      <url>/2022/12/26/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%83%EF%BC%89%20%E5%9F%BA%E7%A1%80%E7%BA%B9%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1>Unity Shader 第七章 基础纹理</h1><blockquote><p>纹理——使用一张图片来控制模型的外观，使用纹理映射技术把一张图黏在模型表面，逐纹素地控制模型的颜色。</p></blockquote><p>通常使用纹理映射坐标对应纹理中的2D坐标，这被称为是UV坐标。</p><p>顶点UV坐标的范围通常被归一到[0,1]范围内。</p><p>DirectX 中原点位于左上角，OpenGL中原点位于左下角。</p><p>$\color{red}{Unity 使用的是OpenGL的坐标，即原点位于左下角}$</p><p><img src="http://pic.fasty97.top/NotePad/202209131416024.png" alt="image-20220824104021468"></p><h2 id="纹理采样">纹理采样</h2><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Upgrade <span class="doctag">NOTE:</span> replaced &#x27;mul(UNITY_MATRIX_MVP,*)&#x27; with &#x27;UnityObjectToClipPos(*)&#x27;</span></span><br><span class="line"></span><br><span class="line">Shader &quot;Book/SingleTexture&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _Color(&quot;Color Tint&quot;,Color)=(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _MainTex (&quot;Texture&quot;, <span class="number">2</span>D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">        <span class="comment">//        反射</span></span><br><span class="line">        _Specular(&quot;Specular&quot;,Color)=(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        <span class="comment">//        高光</span></span><br><span class="line">        _Gloss(&quot;Gloss&quot;,Range(<span class="number">8.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Tags</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;RenderType&quot;=&quot;Opaque&quot;</span><br><span class="line">            &quot;LightMode&quot;=&quot;ForwardBase&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        LOD <span class="number">100</span></span><br><span class="line"></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// make fog work</span></span><br><span class="line">            <span class="meta">#pragma multi_compile_fog</span></span><br><span class="line"></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// 声明对应变量</span></span><br><span class="line">            fixed4 _Color;</span><br><span class="line">            <span class="type">sampler2D</span> _MainTex;</span><br><span class="line">            float4 _MainTex_ST;</span><br><span class="line">            fixed4 _Specular;</span><br><span class="line">            <span class="type">float</span> _Gloss;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 输入</span></span><br><span class="line">            struct a2v</span><br><span class="line">            &#123;</span><br><span class="line">                float4 vertex: POSITION;</span><br><span class="line">                float3 normal: NORMAL;</span><br><span class="line">                float4 texcoord: TEXCOORD0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos: SV_POSITION;</span><br><span class="line">                float3 worldNormal: TEXCOORD0;</span><br><span class="line">                float3 worldPos: TEXCOORD1;</span><br><span class="line">                float2 uv: TEXCOORD2;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 进行顶点着色器</span></span><br><span class="line">            v2f vert(a2v v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line"></span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.worldNormal = UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                o.worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 计算Thing And Offset</span></span><br><span class="line">                o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">                <span class="comment">// 可使用Unity内置宏</span></span><br><span class="line">                <span class="comment">// o.uv = TRANSFORM_TEX(v.texcoord, _MainTex);</span></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 进行片元着色器</span></span><br><span class="line">            fixed4 frag(v2f i): SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 光线方向</span></span><br><span class="line">                fixed3 worldNormal = <span class="built_in">normalize</span>(i.worldNormal);</span><br><span class="line">                fixed3 worldLightDir = <span class="built_in">normalize</span>(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 纹理采样</span></span><br><span class="line">                fixed3 albedo = tex2D(_MainTex, i.uv).rgb * _Color.rgb;</span><br><span class="line">                <span class="comment">// 环境光</span></span><br><span class="line">                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 漫反射- 半兰伯特模型</span></span><br><span class="line">                fixed3 diffuse = _LightColor0.rgb * albedo * <span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">dot</span>(worldNormal, worldLightDir));</span><br><span class="line"></span><br><span class="line">                fixed3 viewDir = <span class="built_in">normalize</span>(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line"></span><br><span class="line">                fixed3 halfDir = <span class="built_in">normalize</span>(worldLightDir + viewDir);</span><br><span class="line">                <span class="comment">// 高光反射</span></span><br><span class="line">                fixed3 specular = _LightColor0.rgb * _Specular.rgb * <span class="built_in">pow</span>(<span class="built_in">max</span>(<span class="number">0</span>, <span class="built_in">dot</span>(worldNormal, halfDir)), _Gloss);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> fixed4(ambient + diffuse + specular, <span class="number">1.0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    Fallback &quot;Specular&quot;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/202209131416080.png" alt="image-20220824164058414"></p><p>值得注意的是：</p><blockquote><p>如果导入的纹理大小超过了Max Texture Size中的设置值，那么Unity将会把该纹理缩放为这个最大分辨率。理想情况下，导入的纹理可以是非正方形的，但长宽的大小应该是2的幂，例如2、4、8、16、32、64等。如果使用了非2的幂大小（Non Power of Two, NPOT）的纹理，那么这些纹理往往会占用更多的内存空间，而且GPU读取该纹理的速度也会有所下降。有一些平台甚至不支持这种NPOT纹理，这时Unity在内部会把它缩放成最近的2的幂大小。出于性能和空间的考虑，我们应该尽量使用2的幂大小的纹理。</p></blockquote><h2 id="凹凸映射">凹凸映射</h2><p>纹理的一种应用是凹凸映射（使用一张纹理来修改模型表面的法线，以便为模型提供更多的细节。）——++ 法线贴图 ++。</p><p>有以下两种映射方式【高度纹理，法线纹理】：</p><p><img src="http://pic.fasty97.top/NotePad/202209131416788.png" alt="image-20220830094021154"></p><h3 id="高度纹理">高度纹理</h3><p>存储颜色强度值来表示海拔高度，颜色越深表面越向外凸起，颜色越钱表面越向内凹陷。</p><p>优点：直观明显</p><p>缺点：计算复杂，不能实时计算得到表面法线，消耗性能。</p><p><img src="http://pic.fasty97.top/NotePad/202209131416546.png" alt="image-20220830094546307"></p><h3 id="法线纹理">法线纹理</h3><p>存储表面法线方向，范围值为[-1,1],而像素分量范围为[0,1]，需要进行映射。</p><p><img src="http://pic.fasty97.top/NotePad/202209131417006.png" alt="image-20220830094820422"></p><p>在对法线纹理进行采样后，还需要对结果进行一次反映射得到法线方向：</p><p><code>normal=pixel*2-1</code></p><p>根据使用的坐标系分为：</p><ol><li><p>模型空间的法线纹理</p><p>因为法线方向各不相同，在对应到贴图上是会呈现出不同的颜色，不同的颜色就对应不同的法线方向。——直观</p></li><li><p>切线空间的法线纹理</p><p>切线空间下的法线则呈现浅蓝色</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SLATE-时间轴插件</title>
      <link href="/2022/11/18/SLATE-%E6%97%B6%E9%97%B4%E8%BD%B4%E6%8F%92%E4%BB%B6/"/>
      <url>/2022/11/18/SLATE-%E6%97%B6%E9%97%B4%E8%BD%B4%E6%8F%92%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>对于Unity官方的TimeLine相必我们都很熟悉了，使用时间轴我们可以实现许多功能，这里推荐一款同样优秀的第三方TimeLine插件——<code>SLATE</code>。</p></blockquote><h2 id="快速食用">快速食用</h2><p><img src="http://pic.fasty97.top/NotePad/202211181413161.png" alt="image-20221118141337920"></p><p>首先，让我们创建一个<code>CuteScene</code>,点击EDIT 打开编辑窗口。</p><p><img src="http://pic.fasty97.top/NotePad/202211181415502.png" alt="image-20221118141536452"></p><h2 id="相关链接">相关链接</h2><ol><li><a href="https://slate.paradoxnotion.com/">SLATE | Realtime Cinematic Sequencer for Unity (paradoxnotion.com)</a></li><li><a href="https://www.lfzxb.top/unity-slate-study-and-extendplan/">ParadoxNotion-Slate学习笔记与拓展计划 | 烟雨迷离半世殇的成长之路 (lfzxb.top)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 好物推荐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TimeLine </tag>
            
            <tag> 剧情编排 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>从程序员到独立游戏开发者</title>
      <link href="/2022/10/24/%E4%BB%8E%E7%A8%8B%E5%BA%8F%E5%91%98%E5%88%B0%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E8%80%85/"/>
      <url>/2022/10/24/%E4%BB%8E%E7%A8%8B%E5%BA%8F%E5%91%98%E5%88%B0%E7%8B%AC%E7%AB%8B%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91%E8%80%85/</url>
      
        <content type="html"><![CDATA[<blockquote><p>💨 每朵云都下落不明，每盏月亮都不知所踪。</p></blockquote><h2 id="按照传统程序员思维来开发游戏或许并不那么合适。">按照传统程序员思维来开发游戏或许并不那么合适。</h2><p>从大一开始接触程序设计时，老师让我们学习<code>编程思维</code>。</p><p>所谓编程思维，也就是将一个复杂问题进行拆解，然后按部就班的去完成的能力。</p><p>对于大多数程序开发来说，这种思维确实是至关重要的，可以公式化处理问题，但在需求多变的游戏开发中，很难做到公式化处理。</p><h2 id="是否过分重视框架式设计">是否过分重视框架式设计</h2><blockquote><p>++过早优化是大忌，对于游戏开发来说这一点尤为明显。++</p><p>有一些水平的程序员总是期望自己写出优雅的代码：逻辑清晰、结构稳定、高效复用。</p></blockquote><p>然而在实际开发时，往往我们很难一次性就处理好软件之间的结构和复杂逻辑，我们需要一边实践一边证明自己的想法是否可行，并不断修正直到自己觉得满意。</p><p>有时我们为了写出<code>完美的代码</code>而花费许多时间和精力，也许此时看来完美的代码在反而制约了你新功能的实现，在我们没有确定需求时不要过早过度的优化程序。</p><blockquote><p>算法——解决问题的有限步骤，我们习惯按部就班的完成任务，这显得逻辑清晰。</p></blockquote><p>在一开始我们就试图搭建一个完美的框架，考虑性能高效、逻辑严密，作为商业游戏这是没问题的，但作为独立游戏这往往制约了游戏的完成。</p><h2 id="是什么在制约我们完成游戏">是什么在制约我们完成游戏</h2><p>不乏能力很强的游戏开发人，并没有真正属于自己的独立游戏。++是什么在制约我们完成游戏制作呢，明明我们那么热爱游戏开发.++</p><p>从小时候到现在我都是一个相比零食更爱玩具的人，精神世界比现实世界更为富足，有很多天马行空的想法。</p><h2 id="如何能更好的完成自己的游戏">如何能更好的完成自己的游戏</h2><p>📖 坚持去做是完成一个游戏始终要去做的事。</p><ul><li>找到自己的生活节奏，例如在下班后，坚持去写2小时的游戏并持之以恒。</li><li>搭建纸面原型或者简单游戏原型对自己的想法进行校验和校正。</li><li>制定<code>TODOList</code>让目标清晰可见。</li><li>及时提供正向反馈（做视频、写心得等）</li></ul>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自我认知 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于Git的笔记</title>
      <link href="/2022/10/18/%E5%85%B3%E4%BA%8EGit%E7%9A%84%E7%AC%94%E8%AE%B0/"/>
      <url>/2022/10/18/%E5%85%B3%E4%BA%8EGit%E7%9A%84%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="常用指令">常用指令</h2><table><thead><tr><th>说明</th><th>指令</th><th>备注</th></tr></thead><tbody><tr><td>克隆</td><td>git clone xxx</td><td></td></tr><tr><td>拉取</td><td>git pull</td><td></td></tr><tr><td>推送</td><td>git push</td><td></td></tr></tbody></table><h2 id="分支指令">分支指令</h2><table><thead><tr><th>说明</th><th>指令</th><th>备注</th></tr></thead><tbody><tr><td>创建分支</td><td>git branch (branchname)</td><td></td></tr><tr><td>切换分支</td><td>git checkout (branchname)</td><td></td></tr><tr><td>合并分支</td><td>git merge</td><td>将指定分支合并到当前分支</td></tr><tr><td>删除分支</td><td>git branch -d</td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 版本管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
            <tag> 版本管理 </tag>
            
            <tag> 多人协作 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mirror初体验</title>
      <link href="/2022/10/08/Mirror%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2022/10/08/Mirror%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="🔖快速食用">🔖快速食用</h2><p>在场景中创建一个空物体，并挂载如下几个脚本。</p><h3 id="网络管理器">网络管理器</h3><blockquote><p>其中，需要指定Player Prefab,勾选自动生成玩家可以在连接到服务器时，自动生成玩家对象。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202210191630256.png" alt="image-20221010100103105"></p><h3 id="玩家">玩家</h3><p>为玩家添加如下组件：</p><ul><li>Network Identity 表示这是一个需要进行网络同步的物体。</li><li>NetWork Transform 表示可同步Transfrom</li></ul><p><img src="http://pic.fasty97.top/NotePad/202210191630897.png" alt="image-20221010100400624"></p><blockquote><p>PS:注意勾选认证，让玩家只能控制自己的物体</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202210191630794.png" alt="image-20221010100615058"></p><figure class="highlight csharp"><figcaption><span>玩家控制脚本</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> Mirror;</span><br><span class="line"><span class="keyword">using</span> UniRx;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line">Qpublic <span class="keyword">class</span> <span class="title">PlayerCtr</span> : <span class="title">NetworkBehaviour</span></span><br><span class="line"> &#123;</span><br><span class="line">     [<span class="meta">SerializeField</span>] <span class="keyword">private</span> <span class="built_in">float</span> speed = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line">     [<span class="meta">SyncVar(hook = nameof(OnColorChanged))</span>]</span><br><span class="line">     <span class="keyword">private</span> Color _color;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">private</span> MeshRenderer _renderer;</span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">         _renderer = GetComponent&lt;MeshRenderer&gt;();</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">if</span> (isServer)</span><br><span class="line">         &#123;</span><br><span class="line">             RpcTest();</span><br><span class="line">         &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">         Observable.EveryUpdate().Where(_ =&gt; isLocalPlayer &amp;&amp; Input.GetKeyDown(KeyCode.Space)).Subscribe(_ =&gt;</span><br><span class="line">         &#123;</span><br><span class="line">             print(<span class="string">&quot;按下空格&quot;</span>);</span><br><span class="line">             <span class="keyword">var</span> color = _color == Color.white ? Color.black : Color.white;</span><br><span class="line">             CmdChangeColor(color);</span><br><span class="line">         &#125;);</span><br><span class="line"> </span><br><span class="line">         <span class="comment">//move</span></span><br><span class="line">         Observable.EveryUpdate().Where(_ =&gt; isLocalPlayer).Subscribe(_ =&gt;</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="keyword">var</span> h = Input.GetAxis(<span class="string">&quot;Horizontal&quot;</span>);</span><br><span class="line">             <span class="keyword">var</span> v = Input.GetAxis(<span class="string">&quot;Vertical&quot;</span>);</span><br><span class="line"> </span><br><span class="line">             <span class="keyword">if</span> (Mathf.Abs(h) &gt; <span class="number">0.1f</span> || Mathf.Abs(v) &gt; <span class="number">0.1f</span>)</span><br><span class="line">             &#123;</span><br><span class="line">                 <span class="keyword">var</span> dir = <span class="keyword">new</span> Vector3(h, <span class="number">0</span>, v).normalized;</span><br><span class="line">                 transform.Translate(dir * speed * Time.deltaTime);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnColorChanged</span>(<span class="params">Color oldColor, Color newColor</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         print(<span class="string">&quot;颜色变化&quot;</span>);</span><br><span class="line">         _renderer.material.color = newColor;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     [<span class="meta">Command</span>]</span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CmdChangeColor</span>(<span class="params">Color color</span>)</span></span><br><span class="line">     &#123;</span><br><span class="line">         _color = color;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">     [<span class="meta">ClientRpc</span>]</span><br><span class="line">     <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">RpcTest</span>()</span></span><br><span class="line">     &#123;</span><br><span class="line">         <span class="comment">//在服务器端调用时，分别在客户端进行调用</span></span><br><span class="line">         print(<span class="string">$&quot;当前客户端为：<span class="subst">&#123;<span class="keyword">this</span>.netId&#125;</span>&quot;</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="参考">参考</h2><ul><li><a href="https://blog.csdn.net/Cake_C/article/details/123165160?spm=1001.2014.3001.5502"> UnityMirror学习笔记(2)：使用SyncVar进行数据同步_Cake_C的博客-CSDN博客</a></li><li><a href="https://blog.csdn.net/Cake_C/article/details/123171120?spm=1001.2014.3001.5502">UnityMirror学习笔记(3)：服务器与客户端间的函数调用，互发控制指令：Command，ClientRpc，TargetRpc_Cake_C的博客-CSDN博客</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 网络连接 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 多人 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VContainer 初体验</title>
      <link href="/2022/10/01/VContainer%20%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2022/10/01/VContainer%20%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="IOC-控制反转">IOC 控制反转</h2><blockquote><p>IOC 提供一个对象生成容器，在我们需要取得某个对象时，不再使用<code>New</code>关键字进行对象生成操作，而是通过IOC容器内部控制来获得对象。</p></blockquote><p>使用这种思想方式，可以让我们无需关心对象的生成方式，只需要告诉容器我需要xxx对象即可，而高旭容器我需要xxx对象的方式就叫做DI依赖注入。</p><h2 id="DI依赖注入">DI依赖注入</h2><p>这种思想，<a href="http://xn--vjqw7sdsdbtiupf.net">我是在学习.net</a> core时发现的，一般采用<code>特性注入</code>或者使用<code>构造函数注入</code>。</p><p>经过标记的字段会在该类构造时在IOC容器中执行构造获取对应的对象示例。</p><h2 id="VContainer">VContainer</h2><p>VContainer是在Unity端使用的一种轻量级的DI框架，通过GameLifeScope划分作用域，和普通的web后端的Di框架不同的是，针对Unity的Mono特殊性，提出了GameLifeScope的方式，通过在Game Object上挂载Scope，可以在代码中动态切换使用的实例和Scope。并且提供了一种父子继承Scope方式供用户使用。</p><h2 id="Scope-作用域">Scope 作用域</h2><blockquote><p>作用域指函数、变量的作用范围，在Di中一般可以注册singleton单例，Trans复例等</p></blockquote><p>在netcore中有类似下面这样的形式：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serviceCollection = <span class="keyword">new</span> ServiceCollection()</span><br><span class="line">  .AddTransient&lt;ILoginService, EFLoginService&gt;()</span><br><span class="line">  .AddSingleton&lt;ILoginService, EFLoginService&gt;()</span><br><span class="line">  .AddScoped&lt;ILoginService, EFLoginService&gt;();</span><br></pre></td></tr></table></figure><p>其中添加的<code>Addxxxx</code>就是为其添加一项注入并指定注入作用域，同时在这里进行的是一个接口的注入操作，在使用这个接口依赖时会生成一个对应的接口实现实例。</p><p>在VContainer中的注入和以上的方式很像。</p><h3 id="单例？">单例？</h3><p>一般来说，在Unity中我们会继承自一个泛型单例类。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> 基础单例（线程锁）</span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">new</span>()</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> T _instance;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="keyword">get</span></span><br><span class="line">         &#123;</span><br><span class="line">             <span class="keyword">if</span> (_instance != <span class="literal">null</span>) <span class="keyword">return</span> _instance;</span><br><span class="line">             <span class="keyword">try</span></span><br><span class="line">             &#123;</span><br><span class="line">                 _instance = <span class="keyword">new</span> T();</span><br><span class="line">                 Debug.Log(<span class="string">$&quot;<span class="subst">&#123;<span class="keyword">typeof</span>(T)&#125;</span>&quot;</span>.Color(<span class="keyword">new</span> Color(<span class="number">0.2f</span>,<span class="number">0.6f</span>,<span class="number">0.8f</span>)) + <span class="string">&quot;|单例OK&quot;</span>);</span><br><span class="line">                 Monitor.Enter(_instance);</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">finally</span></span><br><span class="line">             &#123;</span><br><span class="line">                 Monitor.Exit(_instance);</span><br><span class="line">             &#125;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">return</span> _instance;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>例如继承自这个泛型单例来实现单例效果，在Di中我们的实例无需在外部控制单例，直接由IOC容器管理。</p><h3 id="GameLifeScope">GameLifeScope</h3><blockquote><p>为其GameObject添加一个继承自<code>LifetimeScope</code>的脚本即添加了一个Scope。</p><p>++ 游戏中至少需要有一个Scope ++</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20221006110921.png" alt="GameLifeScope"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseLifeScope</span> : <span class="title">LifetimeScope</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IContainerBuilder builder</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          builder.Register&lt;MusicManager&gt;(Lifetime.Singleton);</span><br><span class="line">          builder.RegisterInstance(GameSettingAssetMgr.Instance);</span><br><span class="line">          builder.Register&lt;UIManager&gt;(Lifetime.Singleton);</span><br><span class="line">          builder.RegisterEntryPoint&lt;GameLauncher&gt;();</span><br><span class="line">          builder.RegisterEntryPoint&lt;GameLoop&gt;();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>同时我们可以继承父级LifeScope来灵活选择我们的Scope实现。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameLiftScope</span> : <span class="title">BaseLifeScope</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">public</span> Character gamePanel;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IContainerBuilder builder</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">base</span>.Configure(builder);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          builder.RegisterComponentInNewPrefab(gamePanel, Lifetime.Scoped);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="可注入对象">可注入对象</h2><blockquote><p>在上面我们描述了Scope，使用<code> builder.Register&lt;T&gt;</code>进行注册。</p></blockquote><h3 id="Mono">Mono</h3><p>可注入Mono的对象，例如游戏中的UI等与Mono关系密切的对象。</p><p>可将场景中的GameObject直接注入到容器中来使用。</p><p><img src="https://pic.fasty97.top/NotePad/20221006113633.png" alt="image-20221006113633790"></p><h3 id="Instance">Instance</h3><p>可注入具体的对象实例，例如单例我们可以直接注入对象的单例，也可以在Scope中选择单例。</p><h3 id="EnterPoint">EnterPoint</h3><blockquote><p><code>EnterPoint</code>可以说是<code>VContainer</code>设计十分精妙的部分——将Mono转移到普通的C#类中。</p></blockquote><p>通过<code>builder.RegisterEntryPoint&lt;T&gt;();</code>注入一个入口点。这些入口点能够代替Unity的Start、Update、FixedUpdate等函数。</p><p>通过实现不同的&gt; Ixxx接口重写方法来编写原生Unity事件，如下例子：</p><hr><blockquote><p>这是一个类似Start的实现，继承自<code>IStartable</code>即可，同时这里我注入了<code>GameSettingAssetMgr</code>和<code>MusicManager</code>两个对象。</p><p>在游戏开始运行时，执行了打印当前游戏语言和播放Bgm的指令。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameLauncher</span> : <span class="title">IStartable</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Inject</span>] <span class="keyword">private</span> <span class="keyword">readonly</span> GameSettingAssetMgr _gameSettingAssetMgr;</span><br><span class="line">    [<span class="meta">Inject</span>] <span class="keyword">private</span> <span class="keyword">readonly</span> MusicManager _musicManager;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GameLauncher</span>(<span class="params">MusicManager musicManager, GameSettingAssetMgr gameSettingAssetMgr</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        _musicManager = musicManager;</span><br><span class="line">        _gameSettingAssetMgr = gameSettingAssetMgr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(_gameSettingAssetMgr.lan);</span><br><span class="line">        _musicManager.PlayBgm(<span class="string">&quot;12345SEX&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到，在我运行游戏时，根据依赖自动生成了对象并执行了相关操作。</p><p><img src="https://pic.fasty97.top/NotePad/20221006112341.png" alt="image-20221006112341489"></p><blockquote><p>同理我们可以，实现更多的接口来实现更多的Unity原生事件，将原本Mono脚本才能执行的内容转移到普通Class中。</p></blockquote><p>现在让我们为GameLauncher类实现Update实现。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">实现ITickable接口</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Tick</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Q))</span><br><span class="line">    &#123;</span><br><span class="line">        _uiManager.ShowPanel(<span class="string">&quot;GamePanel&quot;</span>, UILayer.Mid);</span><br><span class="line">        Debug.Log(<span class="string">&quot;显示面板&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.W))</span><br><span class="line">    &#123;</span><br><span class="line">        _uiManager.SwitchShowState(<span class="string">&quot;GamePanel&quot;</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;切换面板显示&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pic.fasty97.top/NotePad/20221006113216.gif" alt=""></p><h2 id="在Mono中使用">在Mono中使用</h2><blockquote><p>因为Mono不支持构造函数，所以在Mono中使用时必须使用注入特性或注入方法的方式。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">builder.RegisterComponentInHierarchy&lt;Character&gt;();</span><br></pre></td></tr></table></figure><h3 id="注入特性">注入特性</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Inject</span>] <span class="keyword">private</span> MusicManager _musicManager;</span><br><span class="line">[<span class="meta">Inject</span>] <span class="keyword">private</span> GameSettingAssetMgr _gameSettingAssetMgr;</span><br></pre></td></tr></table></figure><h3 id="注入方法">注入方法</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MusicManager _musicManager;</span><br><span class="line"><span class="keyword">private</span> GameSettingAssetMgr _gameSettingAssetMgr;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[<span class="meta">Inject</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Inject</span>(<span class="params">GameSettingAssetMgr gameSettingAssetMgr, MusicManager musicManager</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _gameSettingAssetMgr = gameSettingAssetMgr;</span><br><span class="line">    _musicManager = musicManager;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="相关链接">相关链接</h2><ol><li><a href="https://vcontainer.hadashikick.jp/">关于|虚拟容器 (hadashikick.jp)</a></li><li><a href="https://github.com/hadashiA/VContainer">hadashiA/VContainer: The extra fast, minimum code size, GC-free DI (Dependency Injection) library running on Unity Game Engine. (github.com)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 好物推荐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DI </tag>
            
            <tag> IOC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UniRx 初体验</title>
      <link href="/2022/09/22/UniRx%20%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2022/09/22/UniRx%20%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<h1>UniRx 初体验</h1><p><img src="http://pic.fasty97.top/NotePad/202209221112957.png" alt="查看源图像"></p><h2 id="链式编程">链式编程</h2><blockquote><p>所谓链式编程——使用. . . 像是链条一样进行编程。</p></blockquote><p>🔖 下面是一个延迟调用的示例：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UniRxTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">      Debug.Log(<span class="string">&quot;开始时间：&quot;</span>+Time.realtimeSinceStartup);</span><br><span class="line">      Observable.Timer(TimeSpan.FromSeconds(<span class="number">2</span>)).Subscribe((x) =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">         Debug.Log(<span class="string">&quot;现在时间：&quot;</span> + Time.realtimeSinceStartup);</span><br><span class="line">      &#125;).AddTo(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Observable.EveryUpdate().Where(_ =&gt; Input.GetKeyDown(KeyCode.A)).Subscribe(_ =&gt;</span><br><span class="line">      &#123;</span><br><span class="line">         Debug.Log(<span class="string">&quot;点击了&quot;</span>);</span><br><span class="line">      &#125;).AddTo(<span class="keyword">this</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Ui数据绑定">Ui数据绑定</h2><blockquote><p>原版本不支持绑定TextMeshPro</p></blockquote><figure class="highlight cs"><figcaption><span>UI数据绑定</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UniRx;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UI;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 数据绑定测试</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RxBingData</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Text titleTex;</span><br><span class="line">    <span class="keyword">public</span> Button clBtn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IModel model;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        model = <span class="keyword">new</span> GameData();</span><br><span class="line"></span><br><span class="line">        model.Name.SubscribeToText(titleTex);</span><br><span class="line">        clBtn.OnClickAsObservable().Subscribe(_ =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            model.Name.Value = <span class="string">&quot;以分行诉分行诉客户方&quot;</span>;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        Observable.EveryUpdate().Where(_ =&gt; Input.GetKeyDown(KeyCode.A)).Subscribe(_ =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            model.Name.Value = <span class="string">&quot;1111&quot;</span>;</span><br><span class="line">        &#125;).AddTo(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IModel</span></span><br><span class="line">&#123;</span><br><span class="line">    StringReactiveProperty Name &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameData</span> : <span class="title">IModel</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> StringReactiveProperty Name &#123; <span class="keyword">get</span>; &#125; = <span class="keyword">new</span> StringReactiveProperty(<span class="string">&quot;校长&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/202209201054684.gif" alt="动画"></p><h3 id="绑定TextMeshPro">绑定TextMeshPro</h3><blockquote><p>通过扩展方法增加支持</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">UnityUiExtensions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IDisposable <span class="title">SubscribeToText</span>(<span class="params"><span class="keyword">this</span> IObservable&lt;<span class="built_in">string</span>&gt; source, TextMeshProUGUI text</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> source.SubscribeWithState(text, (x, t) =&gt; t.text = x);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IDisposable <span class="title">SubscribeToText</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="keyword">this</span> IObservable&lt;T&gt; source, TextMeshProUGUI text</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> source.SubscribeWithState(text, (x, t) =&gt; t.text = x.ToString());</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/202209201113194.gif" alt="动画"></p><h3 id="绑定ScripTableObject">绑定ScripTableObject</h3><blockquote><p>在此我开始思考是否可以绑定ScripTableObject？💭</p><p>结果是：YES</p></blockquote><figure class="highlight csharp"><figcaption><span>Asset设定</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CreateAssetMenu</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameSetting</span> : <span class="title">ScriptableObject</span>,<span class="title">IAudioSetting</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> StringReactiveProperty ProfileName =&gt; profileName;</span><br><span class="line">    <span class="keyword">public</span> FloatReactiveProperty BgmVolume =&gt; bgmVolume;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> StringReactiveProperty profileName;</span><br><span class="line">    <span class="keyword">public</span> FloatReactiveProperty bgmVolume;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IAudioSetting</span></span><br><span class="line">&#123;</span><br><span class="line">    StringReactiveProperty ProfileName &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">    FloatReactiveProperty  BgmVolume &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>bing数据</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">gameSetting.profileName.SubscribeToText(title);</span><br><span class="line">gameSetting.bgmVolume.SubscribeToText(titleTex);</span><br><span class="line"></span><br><span class="line">clBtn.OnClickAsObservable().Subscribe(_ =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    gameSetting.profileName.Value = <span class="string">&quot;clicked Data&quot;</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">Observable.EveryUpdate().Where(_ =&gt; Input.GetKeyDown(KeyCode.A)).Subscribe(_ =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    gameSetting.profileName.Value = <span class="string">&quot;keyDown A&quot;</span>;</span><br><span class="line">&#125;).AddTo(<span class="keyword">this</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/202209201138687.gif" alt="动画"></p><center>数据实时绑定</center><blockquote><p>🏷️通过这种方式很快捷方便的就实现了数据的绑定，同时没有污染数据接口</p></blockquote><h2 id="Subject-和OnNext">Subject 和OnNext</h2><blockquote><p>++Subject既可以作为观察者也可以作为被观察对象++</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202209211032612.png" alt="image-20220921103234529"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> subject = <span class="keyword">new</span> Subject&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注册处理方式</span></span><br><span class="line">    subject.Subscribe(m =&gt; print(<span class="string">$&quot;接收到：<span class="subst">&#123;m&#125;</span>&quot;</span>));</span><br><span class="line">    <span class="comment">//传入参数进行处理</span></span><br><span class="line">    subject.OnNext(<span class="string">&quot;你好&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Subject实现了ISubject接口，其中ISubject接口声明如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span>&lt;<span class="title">TSource</span>, <span class="title">TResult</span>&gt; : <span class="title">IObserver</span>&lt;<span class="title">TSource</span>&gt;, <span class="title">IObservable</span>&lt;<span class="title">TResult</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span>&lt;<span class="title">T</span>&gt; : <span class="title">ISubject</span>&lt;<span class="title">T</span>, <span class="title">T</span>&gt;, <span class="title">IObserver</span>&lt;<span class="title">T</span>&gt;, <span class="title">IObservable</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>在其中实现了IObserver<T>接口，这是一个微软官方的观察者模式的实现接口，可参考<code>参考资料2</code></p></blockquote><figure class="highlight csharp"><figcaption><span>IObserver</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">System</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>提供用于接收基于推送的通知的机制。<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>提供通知信息的对象。<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span>&lt;<span class="keyword">in</span> <span class="title">T</span>&gt;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>向观察者提供新数据。<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>当前通知信息。<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnNext</span>(<span class="params">T <span class="keyword">value</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>通知观察者提供程序遇到错误情况。<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;error&quot;&gt;</span>提供有关错误的附加信息的对象。<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnError</span>(<span class="params">Exception error</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span>通知观察者提供程序已完成发送基于推送的通知。<span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnCompleted</span>()</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="事件的过滤和筛选">事件的过滤和筛选</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> subject = <span class="keyword">new</span> Subject&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//注册处理方式</span></span><br><span class="line">    subject.Subscribe(m =&gt; print(<span class="string">$&quot;接收到：<span class="subst">&#123;m&#125;</span>&quot;</span>));</span><br><span class="line">    subject.Subscribe(m =&gt; print(<span class="string">&quot;处理方式二|&quot;</span> + m));</span><br><span class="line">    </span><br><span class="line">    subject.Where(x=&gt;x==<span class="string">&quot;你好&quot;</span>).Subscribe(m =&gt; print(<span class="string">$&quot;接收到特殊：<span class="subst">&#123;m&#125;</span>&quot;</span>));</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//传入参数进行处理</span></span><br><span class="line">    subject.OnNext(<span class="string">&quot;你好&quot;</span>);        </span><br><span class="line">    subject.OnNext(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">    subject.OnNext(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">    subject.OnNext(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><code>  subject.Where(x=&gt;x==&quot;你好&quot;).Subscribe(m =&gt; print($&quot;接收到特殊：{m}&quot;));</code>使用Where操作符对输入参数进行了过滤，让其只处理特定的输入信息   😆 。</p></blockquote><p>📖PS: 可以定义自定义的过滤运算符来指定过滤操作。</p><h2 id="UniRX-流">UniRX 流</h2><p>调用<code>OnError、OnCompleted</code>将会终止流，并销毁流对象。（后续监听被终止）</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> subject = <span class="keyword">new</span> Subject&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册处理方式</span></span><br><span class="line">subject.Subscribe(m =&gt; print(<span class="string">$&quot;接收到：<span class="subst">&#123;m&#125;</span>&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//传入参数进行处理</span></span><br><span class="line">subject.OnNext(<span class="string">&quot;你好&quot;</span>);        </span><br><span class="line">subject.OnNext(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">subject.OnCompleted();  <span class="comment">//流被终止，后续不再执行</span></span><br><span class="line">subject.OnNext(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">subject.OnNext(<span class="string">&quot;3&quot;</span>);</span><br></pre></td></tr></table></figure><h3 id="空参数">空参数</h3><blockquote><p>需要使用空参数的情况可以如下操作：</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sub = <span class="keyword">new</span> Subject&lt;Unit&gt;();</span><br><span class="line"></span><br><span class="line">sub.Subscribe(_ =&gt; print(<span class="string">&quot;触发事件&quot;</span>));</span><br><span class="line">sub.OnNext(Unit.Default);</span><br></pre></td></tr></table></figure><blockquote><ul><li>🔖对于不再使用的流要及时<code>OnCompleted</code>获得<code>Dispose</code>来释放内存以免出现空引用或内存泄漏。</li><li>🔖可以使用<code>AddTo()</code>将流的生命周期绑定到指定对象。对象被销毁，流也会被销毁。</li></ul></blockquote><h3 id="流的来源">流的来源</h3><blockquote><p>官方提供了创建流的几种方式：</p></blockquote><ul><li>Subject</li><li>ReactiveProperty</li><li>ReactiveCollection</li><li>ReactiveDictionary</li><li>UniRx提供的方法</li><li>UniRx.Trigger</li><li>UniRx的协程</li><li>UniRx转换后的UGUI事件</li></ul><h4 id="ReactiveCollection">ReactiveCollection</h4><p>ReactiveCollection与ReactiveProperty类似，++它是内置了一个通知状态变化功能的List++,ReactiveCollection可以像List一样使用，更棒的是，ReactiveCollection可以用来对List状态的变化进行Subscribe，所支持的状态变化订阅如下：</p><ul><li>添加元素时</li><li>删除元素时</li><li>集合数量变化时</li><li>集合元素变化时</li><li>元素移动时</li><li>清除集合时</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> ReactiveCollection&lt;<span class="built_in">string</span>&gt;()&#123;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>&#125;;</span><br><span class="line">list.ObserveAdd().Subscribe(x =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">$&quot;新增元素：<span class="subst">&#123;x&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">list.ObserveRemove().Subscribe(x =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">$&quot;删除元素：<span class="subst">&#123;x&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">list.ObserveMove().Subscribe(x =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">$&quot;移动元素：<span class="subst">&#123;x&#125;</span>&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">list.ObserveReset().Subscribe(_ =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">$&quot;重制&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line"></span><br><span class="line">list.Add(<span class="string">&quot;AA&quot;</span>);</span><br><span class="line">list.RemoveAt(<span class="number">0</span>);</span><br><span class="line">list.Clear();</span><br></pre></td></tr></table></figure><h4 id="UniRx-的工厂方法">UniRx 的工厂方法</h4><h5 id="UniRx-Trigger系列">UniRx.Trigger系列</h5><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.OnTriggerEnterAsObservable().Subscribe(x =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">$&quot;<span class="subst">&#123;x.gameObject.name&#125;</span> 进入触发区域&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">this</span>.OnTriggerExitAsObservable().Subscribe(x =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">$&quot;<span class="subst">&#123;x.gameObject.name&#125;</span> 离开触发区域&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/202209211335230.gif" alt="动画"></p><h2 id="在Player中的应用">在Player中的应用</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//间隔2S攻击</span></span><br><span class="line">    <span class="keyword">this</span>.UpdateAsObservable().Where(_ =&gt; Input.GetKeyDown(KeyCode.A)).ThrottleFirst(TimeSpan.FromSeconds(<span class="number">2f</span>))</span><br><span class="line">        .Subscribe(_ =&gt; Attack());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;Attack&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="使用Unirx设计PlayerController">使用Unirx设计PlayerController</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UniRx.Triggers;</span><br><span class="line"><span class="keyword">using</span> UniRx;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestUniRX</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> CharacterController characterController;</span><br><span class="line">    <span class="keyword">private</span> BoolReactiveProperty isJumping = <span class="keyword">new</span> BoolReactiveProperty();</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        characterController = GetComponent&lt;CharacterController&gt;();</span><br><span class="line"><span class="keyword">this</span>.UpdateAsObservable()</span><br><span class="line">    .Where(_ =&gt; !isJumping.Value)</span><br><span class="line">    .Select(_ =&gt; <span class="keyword">new</span> Vector3(Input.GetAxis(<span class="string">&quot;Horizontal&quot;</span>), <span class="number">0</span>, Input.GetAxis(<span class="string">&quot;Vertical&quot;</span>)))</span><br><span class="line">    .Where(x =&gt; x.magnitude &gt; <span class="number">0.1f</span>)</span><br><span class="line">    .Subscribe(x =&gt; Move(x.normalized));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.UpdateAsObservable()</span><br><span class="line">    .Where(_ =&gt; Input.GetKeyDown(KeyCode.Space) </span><br><span class="line">        &amp;&amp; !isJumping.Value &amp;&amp; characterController.isGrounded)</span><br><span class="line">    .Subscribe(_ =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        Jump();</span><br><span class="line">        isJumping.Value = <span class="literal">true</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    characterController</span><br><span class="line">    .ObserveEveryValueChanged(x =&gt; x.isGrounded)</span><br><span class="line">    .Where(x =&gt; x &amp;&amp; isJumping.Value)</span><br><span class="line">    .Subscribe(_ =&gt; isJumping.Value = <span class="literal">false</span>)</span><br><span class="line">    .AddTo(gameObject);</span><br><span class="line"></span><br><span class="line">    isJumping.Where(x =&gt; !x)</span><br><span class="line">    .Subscribe(_ =&gt; PlaySoundEffect());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">PlaySoundEffect</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;播放音效&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Jump</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;Jump&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 normalized</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;Move&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="针对协程流">针对协程流</h2><blockquote><p>UniRx 提供一种微协程的协程实现方式，性能比原生协程更佳。</p></blockquote><h3 id="串联协程">串联协程</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Observable.FromCoroutine(CoroutineA)</span><br><span class="line">        .SelectMany(CoroutineB)</span><br><span class="line">        .Subscribe(_=&gt;Debug.Log(<span class="string">&quot;CoroutineA 和CoroutineB 执行完成&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">IEnumerator <span class="title">CoroutineA</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;CoroutineA 开始&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">3</span></span>)</span>;</span><br><span class="line">    Debug.Log(<span class="string">&quot;CoroutineA 完成&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">IEnumerator  <span class="title">CoroutineB</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;CoroutineB 开始&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">10</span></span>)</span>;</span><br><span class="line">    Debug.Log(<span class="string">&quot;CoroutineB 完成&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="并联协程汇总再处理">并联协程汇总再处理</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Observable.WhenAll(</span><br><span class="line">            Observable.FromCoroutine&lt;<span class="built_in">string</span>&gt;(o =&gt; CoroutineA(o)),</span><br><span class="line">            Observable.FromCoroutine&lt;<span class="built_in">string</span>&gt;(o =&gt; CoroutineB(o))</span><br><span class="line">        ).Subscribe(xs =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> xs)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.Log(<span class="string">&quot;result:&quot;</span> + item);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">IEnumerator <span class="title">CoroutineA</span>(<span class="params">IObserver&lt;<span class="built_in">string</span>&gt; observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;CoroutineA 开始&quot;</span>);</span><br><span class="line">        <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">3</span></span>)</span>;</span><br><span class="line">        observer.OnNext(<span class="string">&quot;协程A 执行完成&quot;</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;A 3秒等待结束&quot;</span>);</span><br><span class="line">        observer.OnCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">IEnumerator <span class="title">CoroutineB</span>(<span class="params">IObserver&lt;<span class="built_in">string</span>&gt; observer</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;CoroutineB 开始&quot;</span>);</span><br><span class="line">        <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">1</span></span>)</span>;</span><br><span class="line">        observer.OnNext(<span class="string">&quot;协程B 执行完成&quot;</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;B 1秒等待结束&quot;</span>);</span><br><span class="line">        observer.OnCompleted();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="其他使用">其他使用</h2><h3 id="延迟和定时">延迟和定时</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延迟执行</span></span><br><span class="line">Observable.Timer(TimeSpan.FromSeconds(<span class="number">1</span>)).Subscribe((x) =&gt; &#123; print(<span class="string">&quot;执行&quot;</span>); &#125;).AddTo(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//循环执行</span></span><br><span class="line">Observable.Interval(TimeSpan.FromSeconds(<span class="number">1</span>)).Subscribe(_ =&gt; &#123; print(<span class="string">&quot;11&quot;</span>); &#125;).AddTo(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure><h2 id="个人总结">个人总结</h2><blockquote><p><code>unirx</code>提供了一种响应式的流编程模式，我觉得UniRx最强之处是以下几点：</p><ul><li>万事万物皆可以为流</li><li>提供一种微协程方式，线程回溯</li><li>观察者模式——数据绑定和监听（可用于UI）</li><li>装饰者模式——对操作和流进行灵活裁剪控制（Linq）</li></ul></blockquote><p>++🔖 UniRx是非常优秀的Unity框架!在之后我会在项目中尝试去使用它。++</p><h2 id="参考资料">参考资料</h2><ol><li><a href="http://www.ronpad.com/docs/tinax/unirx_learn_1.html">UniRx入门系列一 · 开发文档集合 (ronpad.com)</a></li><li><a href="https://learn.microsoft.com/zh-cn/dotnet/api/system.iobserver-1?view=net-6.0">IObserver 接口 (System) | Microsoft Learn</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 好物推荐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ui </tag>
            
            <tag> 链式编程 </tag>
            
            <tag> 响应式编程 </tag>
            
            <tag> 观察者模式 </tag>
            
            <tag> 异步 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity2D-UGUI多边形检测</title>
      <link href="/2022/09/21/Unity2D-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%A3%80%E6%B5%8B/"/>
      <url>/2022/09/21/Unity2D-%E5%A4%9A%E8%BE%B9%E5%BD%A2%E6%A3%80%E6%B5%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="PolygonCollider2D">PolygonCollider2D</h2><p>PolygonCollider2D是Unity用于多边形检测的组件，可以进行不规则UI、2d对象的射线检测。</p><p>为UI对象添加如下脚本：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CustomImage</span> : <span class="title">Image</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> PolygonCollider2D _polygon;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">private</span> PolygonCollider2D Polygon</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_polygon == <span class="literal">null</span>)</span><br><span class="line">                _polygon = GetComponent&lt;PolygonCollider2D&gt;();</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">return</span> _polygon;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">IsRaycastLocationValid</span>(<span class="params">Vector2 screenPoint, Camera eventCamera</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        Vector3 point;</span><br><span class="line">        RectTransformUtility.ScreenPointToWorldPointInRectangle(rectTransform, screenPoint, eventCamera, <span class="keyword">out</span> point);</span><br><span class="line">        <span class="keyword">return</span> Polygon.OverlapPoint(point);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>并将Button组件的source设置为上面的脚本即可。</p><h2 id="参考文章">参考文章</h2><ol><li><a href="https://blog.csdn.net/dengshunhao/article/details/103032147"> Unity UGUI学习系列(二) ------ PolygonCollider2D实现不规则碰撞范围_千喜的博客-CSDN博客</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> UGUI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ui </tag>
            
            <tag> 不规则检测 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity Ui 合批学习</title>
      <link href="/2022/09/20/Unity%20UI%E5%90%88%E6%89%B9/"/>
      <url>/2022/09/20/Unity%20UI%E5%90%88%E6%89%B9/</url>
      
        <content type="html"><![CDATA[<h1>Unity Ui 合批学习</h1><h2 id="Stats-统计面板">Stats 统计面板</h2><blockquote><p>stats面板可以展示摄像机范围内，所有游戏对象元素的顶点、面片、批处理次数、CPU耗时等。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202209191011750.png" alt="image-20220919101137617"></p><table><thead><tr><th>参数</th><th>说明</th><th>备注</th></tr></thead><tbody><tr><td>tris</td><td>三角形面数</td><td></td></tr><tr><td>verts</td><td>顶点数</td><td></td></tr><tr><td>Batches</td><td>批处理个数</td><td></td></tr><tr><td>Saved By batching</td><td>批处理被合并后的批处理个数</td><td>实际执行的批处理个数Draw Call</td></tr><tr><td>CPU</td><td>cpu执行耗时</td><td></td></tr><tr><td>FPS</td><td>时间段执行次数</td><td>流畅度</td></tr></tbody></table><h3 id="天空盒子">天空盒子</h3><blockquote><p>新建一个场景发现，有1.7k的三角和5k的顶点。</p><p>++ 这些顶点和三角面其实来源于天空盒，天空盒也是一个模型。 ++</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202209191019934.png" alt="image-20220919101907862"></p><p>修改为适用纯色背景：</p><p><img src="http://pic.fasty97.top/NotePad/202211281448056.png" alt="image-20221128144803967"></p><p>可以看到此时，降低到了2个三角面和4个顶点。如下图所示的分割情况.</p><p><img src="http://pic.fasty97.top/NotePad/202211281449253.png" alt="image-20221128144922221"></p><h2 id="批处理">批处理</h2><blockquote><p>我们最常看到的优化技术大概就是批处理了。批处理的实现原理就是为了减少每一帧需要的draw call数目。为了把一个对象渲染到屏幕上，CPU需要检查哪些光源影响了该物体，绑定Shader 被设置它的参数，再把渲染纹理发送给GPU。当场景中包含了大量对象时，这些操作就会非常耗时。一个极端的例子是，<code>如果我们需要渲染一千个三角形，把它们按一千个单独的网格进行渲染所花费的时间要远远大于渲染一个包含了一千个三角形的网格。在这两种情况下，GPU的性能消耗其实并没有多大的区别，但CPU的draw call数目就会成为性能瓶颈。</code>因此，批处理的思想很简单，就是在每次面对draw call 时尽可能多地处理多个物体。<br>使用同一个材质的物体可以一起处理。对于使用同一个材质的物体，它们之间的不同仅仅在于顶点数据的差别。我们可以把这些顶点数据合并在一起，再一起发送给GPU，就可以完成一次批处理。</p></blockquote><h3 id="Batches和Saved-by-batching">Batches和Saved by batching</h3><p><img src="http://pic.fasty97.top/NotePad/202211281518976.png" alt="image-20221128151826942"></p><ul><li>Batches 表示批处理次数</li><li>Saved byBatching 表示节省的批处理次数</li></ul><h3 id="动态批处理和静态批处理">动态批处理和静态批处理</h3><p>将物体标记为<code>Static</code>可以大幅优化批处理。—— 静态批处理</p><h2 id="参考资料">参考资料</h2><ol><li><p><a href="https://blog.csdn.net/sinat_25415095/article/details/112388638">Unity3D UGUI系列之合批_WangShade的博客-CSDN博客_ugui合批</a></p></li><li><p><a href="https://blog.csdn.net/sinat_25415095/article/details/104383738">Unity3D客户端项目优化总结之Stats统计面板_WangShade的博客-CSDN博客</a></p></li><li><p><a href="https://blog.csdn.net/sinat_25415095/article/details/104419571">Unity3D客户端项目优化总结之静态批处理Static Batching_WangShade的博客-CSDN博客</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Unity Ui </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> ui </tag>
            
            <tag> 性能优化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（十）高级纹理</title>
      <link href="/2022/09/20/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%8D%81%EF%BC%89%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/"/>
      <url>/2022/09/20/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%8D%81%EF%BC%89%E9%AB%98%E7%BA%A7%E7%BA%B9%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1>高级纹理</h1><ul><li>基础纹理：法线纹理、渐变纹理、遮罩纹理等。</li><li>高级纹理：CubeMap、Render Texture、Procedure Texture</li></ul><h2 id="CubeMap立方体纹理">CubeMap立方体纹理</h2><blockquote><p>在图形学中，立方体纹理是环境映射的一种实现方法。</p></blockquote><img src="http://pic.fasty97.top/NotePad/202209131407838.png" alt="image-20220913140753789" style="zoom:50%;" /><center>立方体纹理采样</center><p>立方体纹理常常用于天空盒、环境映射。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>插件-TureShadow</title>
      <link href="/2022/09/08/%E6%8F%92%E4%BB%B6-TureShadow/"/>
      <url>/2022/09/08/%E6%8F%92%E4%BB%B6-TureShadow/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>TureShadow</code> 和名称一样——真阴影</p><p>其作用就是为图像、文字添加阴影效果，通常我们使用Ps之类的软件为其添加阴影，现在使用这个插件就可以自动动态的实现阴影。</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20220908195829.gif" alt=""></p><blockquote><p>添加TureShadow脚本</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20220908195929.png" alt="image-20220908195929046"></p>]]></content>
      
      
      <categories>
          
          <category> 好物推荐 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity插件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>下班后开始新的一天</title>
      <link href="/2022/09/04/%E4%B8%8B%E7%8F%AD%E5%90%8E%E5%BC%80%E5%A7%8B%E6%96%B0%E7%9A%84%E4%B8%80%E5%A4%A9/"/>
      <url>/2022/09/04/%E4%B8%8B%E7%8F%AD%E5%90%8E%E5%BC%80%E5%A7%8B%E6%96%B0%E7%9A%84%E4%B8%80%E5%A4%A9/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近,我在微信读书上看到可这本书，感觉正是处在我这个阶段所需要的，几个问题深深的抓住了我。</p></blockquote><ul><li>晚上还有4个小时，缺在苦苦等待周末</li><li>光靠工资，可能财富自由吗</li><li>辞职之后，就能做想做的事情吗</li><li>一辈子只做工作这一件事，就能感到幸福吗？</li></ul><blockquote><p>++要把生活过得幸福又笃定~++</p></blockquote><p>不论处在什么样的生活环境下，我们都要笃定的去生活，不必让自己成为某一个行业的顶尖或者是专家，而是持续去做自己想做的，能让自己感到幸福的事情，并为此付出巨大努力。</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自我认知 </tag>
            
            <tag> 人生意义 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MRTK开发记录</title>
      <link href="/2022/08/31/MRTK%20%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/"/>
      <url>/2022/08/31/MRTK%20%E5%BC%80%E5%8F%91%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1>MRTK 开发记录</h1><p>MRTK是微软官方推出的针对MR(<code>混合现实</code>)开发的一套工具集。</p><p>同时官方提供了一个MRFT工具进行相关工具包的管理。</p><p><img src="http://pic.fasty97.top/NotePad/202208311312682.png" alt="image-20220812095331431"></p><p>MRTK的体系架构：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313036.png" alt="image-20220815105452428"></p><h2 id="MRFT">MRFT</h2><p>在选定一个Unity项目之后可以使用此工具导入相关的工具。</p><p><img src="http://pic.fasty97.top/NotePad/202208311313494.png" alt="image-20220812095525069"></p><blockquote><p>使用此工具其实是通过修改Unity的包管理器中的Json来管理</p></blockquote><p>我们至少需要安装:</p><p><img src="http://pic.fasty97.top/NotePad/202208311313477.png" alt="image-20220812104205094"></p><p>在Unity2021.x之后版本我们官方推荐使用<code>OpenXR</code>工具来管理。</p><blockquote><p>😄当然我们可以选择性的使用。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311313228.png" alt="image-20220812104327280"></p><h2 id="Unity设置">Unity设置</h2><p><code>Unity版本:2020.3.8f1</code></p><blockquote><p>导入Unity项目中后，可以看到如下提示。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311313899.png" alt="image-20220812103958699"></p><p><img src="http://pic.fasty97.top/NotePad/202208311313019.png" alt="image-20220812165915460"></p><p>同时我们需要做如下设置：</p><p>切换平台到通用平台：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313007.png" alt="image-20220812104526170"></p><p>依据导入的选择设置XR相关设置：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313869.png" alt="image-20220812104933901"></p><blockquote><p>我这里没有使用OPen XR 所以没有勾选支持。</p></blockquote><p>可以导入相关的example来查看示例：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313331.png" alt="image-20220812111136533"></p><blockquote><p>使用上下左右移动视角。鼠标右键按住旋转视角。</p><p>鼠标左键点击。</p></blockquote><p>可以在这里打开相关的打包工具：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313346.png" alt="image-20220812110738654"></p><p>可以看到如下所示的打包工具：</p><p><img src="http://pic.fasty97.top/NotePad/202208311313426.png" alt="image-20220812110816035"></p><p>默认是打包生成VS项目：</p><p>生成的项目是一个使用c++的Windows UWP项目。</p><p><img src="http://pic.fasty97.top/NotePad/202208311313535.png" alt="image-20220812110949329"></p><p>在设置项目中可以设置要获取的权限。</p><p><img src="http://pic.fasty97.top/NotePad/202208311313135.png" alt="image-20220812113114132"></p><blockquote><p>PS: 😿打包的时候务必将画质调到最低，模拟器性能极差。</p></blockquote><h2 id="安装HoloLens2模拟器">安装HoloLens2模拟器</h2><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/develop/advanced-concepts/using-the-hololens-emulator#installing-the-hololens-emulator">使用 HoloLens 仿真器 - Mixed Reality | Microsoft Docs</a></p><blockquote><p>在使用模拟器之前，还需要打开Hype-V</p></blockquote><p>安装好之后，会在Vs中看到：<img src="http://pic.fasty97.top/NotePad/202208311313970.png" alt="image-20220812111306982"></p><p>选择到此设备后启动项目：</p><p>弹出一个黑框：</p><p><img src="http://pic.fasty97.top/NotePad/202208311314514.png" alt="image-20220812111414847"></p><p>等待模拟器启动.</p><p><img src="http://pic.fasty97.top/NotePad/202208311314965.png" alt="image-20220812113600735"></p><p>按照公司的电脑i5-8400 32g 1060 的配置，在模拟器下运行MRTK的示例场景都是困难的，一打开CPU马上占用100%😢。</p><blockquote><p>后续我自建了一个场景只放了一个Cube，将所有质量拉到低之后勉强可以运行，还好可以在Unity下流畅运行。</p></blockquote><h2 id="创建一个新场景">创建一个新场景</h2><blockquote><p>MR场景和我们通常的场景不同，需要特点的摄像机和移动方式。</p><p>MRTK已经为我们准备好了这些。</p></blockquote><p>创建一个新场景，从选项卡选择 Add to…</p><p>发现左侧面板为我们增加了3个对象：</p><ul><li>ToolKit</li><li>MR玩家空间-摄像机</li><li>MR屏幕内容</li></ul><p><img src="http://pic.fasty97.top/NotePad/202208311314233.png" alt="image-20220815100722745"></p><p>此时运行场景：</p><p><img src="http://pic.fasty97.top/NotePad/202208311314636.gif" alt=""></p><blockquote><p>可以看到鼠标变成一个小店，而且会有一个能量条类似的东西用于描述当前的程序性能。</p></blockquote><h3 id="MixedRealityToolkit">MixedRealityToolkit</h3><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/configuration/mixed-reality-configuration-guide?view=mrtkunity-2022-05">MRTK2 配置文件配置指南 - MRTK 2 | Microsoft Docs</a></p><p><img src="http://pic.fasty97.top/NotePad/202208311314143.png" alt="image-20220815101123490"></p><p>在这里我们可以对MRTK进行配置，点击<code>Copy</code>可以复制一份配置文件。</p><p>通过修改这个来控制性能面板的开关：</p><p><img src="http://pic.fasty97.top/NotePad/202208311314036.png" alt="image-20220815103841608"></p><h2 id="UX组件">UX组件</h2><blockquote><p>MRTK为我们提供了一组规范的UI组件，通过这些组件我们可以方便的构建出常用的UX。</p></blockquote><h3 id="边界控制">边界控制</h3><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/features/ux-building-blocks/bounds-control?view=mrtkunity-2022-05">边界控制 - MRTK 2 | Microsoft Docs</a></p><p><img src="http://pic.fasty97.top/NotePad/202208311314142.png" alt="Bounds control"></p><blockquote><p>边界控制在我实际使用时发现了很多坑💭</p><ol><li>使用边界控制的物体依赖于<code>Box Collider</code></li><li>在移动了使用边界组件的物体后，其边界框的绘制位置可能出错，需要手动调用UpdateBound更新。</li><li>需要关闭BoxCollider才能关闭绘制，设置Active有可能无法去除边界框。</li></ol></blockquote><h3 id="按钮">按钮</h3><blockquote><p>有基于碰撞的按钮和基于UI的按钮</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311314706.png" alt="image-20220815140928969"></p><center>基于物理碰撞的按钮</center><h4 id="基于UI的按钮">基于UI的按钮</h4><p>创建一个Canvas，点击按钮转换为MR的Ui Canvas</p><p><img src="http://pic.fasty97.top/NotePad/202208311314972.png" alt="image-20220815141142436"></p><p>++ 注意在使用UnityUi形式的button时，在HoloLens实机上需要按下手势，不太方便操作，考虑使用3D按钮 ++</p><p><img src="http://pic.fasty97.top/NotePad/202301291520465.png" alt="image-20230129152013229"></p><p>随后可以不使用HoloLens的图集，直接修改Sprite为自己要使用的即可：</p><p><img src="http://pic.fasty97.top/NotePad/202301291521714.png" alt="image-20230129152126667"></p><h4 id="让UI支持直接点击">让UI支持直接点击</h4><p>需要添加如下几个组件：</p><p><img src="http://pic.fasty97.top/NotePad/202301301807614.png" alt="image-20230130180717373"></p><ul><li>组件</li></ul><p><img src="http://pic.fasty97.top/NotePad/202301301808469.png" alt="image-20230130180802422"></p><p>注意框选的这两个部分：</p><ul><li>Moving Button Visual 用于进行检测按钮——这里使用自己即可</li><li>注意添加Event绑定刀Trigger中。</li></ul><p><img src="http://pic.fasty97.top/NotePad/202301301808204.png" alt="image-20230130180853141"></p><h3 id="交互">交互</h3><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/features/ux-building-blocks/interactable?view=mrtkunity-2022-05">可交互 - MRTK 2 | Microsoft Docs</a></p><blockquote><p>添加此脚本为对象增加可交互性，并且可设置交互时的动画或效果变化。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311314216.png" alt="image-20220815143319004"></p><blockquote><p>设置不同行为的状态表现。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311314309.png" alt="image-20220815143435847"></p><h3 id="可操作对象">可操作对象</h3><p>对于我们需要控制移动的对象为其添加脚本：</p><blockquote><p>设定使用单手、双手控制对象移动</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311314471.png" alt="image-20220815155426005"></p><blockquote><p>PS: 😄我们可以通过指定HostTransform 来设定以谁作为轴，默认以自身为轴，此时移动时是独立的。</p><ol><li>以父对象为Host则移动此对象时，所有以此父对象为Host的对象都会移动</li><li>以外部对象为Host则移动此对象时，此对象将会绕着Host.</li></ol></blockquote><p>🎫可以添加约束管理器组件来约束行为表现。</p><blockquote><p>ℹ️此组件同样依赖于<code>BoxCollider</code>。</p></blockquote><h3 id="约束管理器">约束管理器</h3><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/features/ux-building-blocks/constraint-manager?view=mrtkunity-2022-05">约束管理器 - MRTK 2 | Microsoft Docs</a></p><blockquote><p>使用约束管理器，可以将一组约束组件应用于转换。 可以考虑使用附加到游戏对象的 <a href="https://docs.microsoft.com/zh-CN/dotnet/api/microsoft.mixedreality.toolkit.ui.transformconstraint"><code>TransformConstraint</code></a> 类型的组件。 默认情况下，约束管理器将自动收集附加到游戏对象的所有<a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/features/ux-building-blocks/constraint-manager?view=mrtkunity-2022-05#transform-constraints">约束组件</a>，并将其应用于已处理的转换。 但是，用户可以选择手动配置应用的约束列表，只允许应用附加约束的一个子集。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202208311314078.png" alt="image-20220815161016632"></p><h3 id="求解器">求解器</h3><p><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/features/ux-building-blocks/solvers/solver?view=mrtkunity-2022-05">求解器概述 - MRTK 2 | Microsoft Docs</a></p><h4 id="Orbital">Orbital</h4><p>Orbital用于保持对象与视线的相对位置。</p><p><img src="http://pic.fasty97.top/NotePad/202208311315321.gif" alt=""></p><h4 id="Follow">Follow</h4><p>Follow 用于让某对象跟随视线。</p><p><img src="http://pic.fasty97.top/NotePad/202208311315967.gif" alt=""></p><h3 id="ToolTips">ToolTips</h3><blockquote><p>在MRTK中自制使用TextMeshPro当做提示文件会导致边界框组件渲染异常😢，网络上也没有任何相关的资料。所以想要在MR中对相关的游戏对象显示ToolTip可能只能使用官方的组件。</p></blockquote><p>📖官方的ToolTips组件，相比TextMeshPro还有一个优点是可以始终面向摄像机或始终面向游戏对象。</p><p><img src="http://pic.fasty97.top/NotePad/202208311315335.png" alt="image-20220823141857540"></p><p>添加此组件设定好使用的Prefab和要显示的提示内容，有需要可重新指定锚点。</p><p><img src="http://pic.fasty97.top/NotePad/202208311315826.png" alt="image-20220823142055145"></p><h2 id="皮肤">皮肤</h2><p>在MRTK中，使用ScripttableObject来配置使用的样式。</p><p>例如在边界框组件中在Visuals 下就可以配置不同的边界框显示样式。</p><p><img src="http://pic.fasty97.top/NotePad/202208311315774.png" alt="image-20220823101336950"></p><p>在可交互对象中，也可以配置具体的动画交互表现：</p><p><img src="http://pic.fasty97.top/NotePad/202208311315781.png" alt="image-20220823101508110"></p><h2 id="相关链接">相关链接</h2><ul><li><a href="https://docs.microsoft.com/zh-cn/windows/mixed-reality/mrtk-unity/mrtk2/?view=mrtkunity-2022-05">MRTK2-Unity 开发人员文档 - MRTK 2 | Microsoft Docs</a></li><li><a href="https://docs.microsoft.com/zh-cn/dotnet/api/microsoft.mixedreality.toolkit?view=mixed-reality-toolkit-unity-2020-dotnet-2.8.0">Microsoft.MixedReality.Toolkit Namespace | Microsoft Docs</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> VR/AR </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VR/AR/MR </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MMD导入Unity</title>
      <link href="/2022/07/08/MMD%E5%AF%BC%E5%85%A5Unity/"/>
      <url>/2022/07/08/MMD%E5%AF%BC%E5%85%A5Unity/</url>
      
        <content type="html"><![CDATA[<h2 id="通过Blender">通过Blender</h2><blockquote><p>下载：<a href="https://github.com/absolute-quantum/cats-blender-plugin">https://github.com/absolute-quantum/cats-blender-plugin</a></p></blockquote><p>安装插件后：</p><p><img src="http://pic.fasty97.top/NotePad/20220708134034.png" alt="image-20220708133125255"></p><p>然后选择，Fix Model 修正。</p><p><img src="http://pic.fasty97.top/NotePad/20220708134203.png" alt="image-20220708134203907"></p><p>修正后选择Export Modle导出为Fbx即可。</p><h2 id="通过Unity插件">通过Unity插件</h2><blockquote><p>安装MMD4unity插件可以直接导入到Unity，不经过Blender，实测在某些模型下会发生一些奇怪的错误。</p></blockquote><h2 id="改变渲染材质">改变渲染材质</h2><blockquote><p>可以使用卡渲来优化渲染效果</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220708150520.png" alt="image-20220708150520449"></p>]]></content>
      
      
      <categories>
          
          <category> MMD </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MMD </tag>
            
            <tag> PMX </tag>
            
            <tag> 模型 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Effective C# 笔记1</title>
      <link href="/2022/06/30/Effective%20C#%20%E7%AC%94%E8%AE%B01/"/>
      <url>/2022/06/30/Effective%20C#%20%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<blockquote><p>今天我要再开一个新坑，学习一下《Effective C#》,百闻不如一见，确实有必要好好梳理一下自己的代码方式。</p></blockquote><h2 id="第1条：优先使用隐式类型的局部变量">第1条：优先使用隐式类型的局部变量</h2><p>用var来声明变量而不指明其类型，可以令开发者把注意力更多地集中在名称上面，从而更好地了解其含义。</p><h2 id="第2条：考虑用readonly代替const">第2条：考虑用readonly代替const</h2><p>C#有两种常量，一种是编译期（compile-time）的常量，另一种是运行期（runtime）的常量，它们的行为大不相同。常量如果选得不合适，那么程序开发工作可能会受影响。编译期的常量虽然能令程序运行得稍快一点，但却远不如运行期的常量那样灵活。只有当程序性能极端重要且常量取值不会随版本而变化的情况下，才可以考虑选用这种常量。</p><blockquote><p>运行期的常量用<code>readonly</code>关键字来声明，编译期的常量用<code>const</code>关键字来声明</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 优雅写代码 </category>
          
          <category> 《Effective C#》 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Unity Ui事件接口</title>
      <link href="/2022/06/18/Unity%20Ui%E4%BA%8B%E4%BB%B6%E6%8E%A5%E5%8F%A3/"/>
      <url>/2022/06/18/Unity%20Ui%E4%BA%8B%E4%BB%B6%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<p>在Unity中UI事件有两种方式，一种使用数据接口的方式，另一种使用监听组件的方式。</p><h2 id="使用数据接口">使用数据接口</h2><p>通过继承数据额接口实现接口方法我们可以对Ui事件进行处理。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">APanel</span> : <span class="title">MonoBehaviour</span>, <span class="title">IPointerClickHandler</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnPointerClick</span>(<span class="params">PointerEventData eventData</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">&quot;Ui被点击了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Unity提供了各种各样的数据接口给我们使用，这里不在一一赘述。</p><p>需要注意的一点是，使用Drag类的接口时，我们必须使用Drag接口，其他的BeginDrag、EndDrag等接口才会响应。{.blue}</p><h2 id="使用监听组件">使用监听组件</h2><p>我们最常用的监听组件是<code>Button组件</code>，我们可以给任意一个Ui添加一个Button组件来让Ui具有Button的效果。</p><p>在处理复杂的监听事件时，我们可以使用<code>Event trigger</code>组件。</p><p><img src="http://pic.fasty97.top/NotePad/20220622225810.png" alt=""></p><p><code>Event trigger</code>监听绑定和Button基本一致，我们可以在面板上通过拖拽来设定我们的响应事件和要触发的行为。</p><p><img src="http://pic.fasty97.top/NotePad/20220622225909.png" alt=""></p><h3 id="使用代码绑定">使用代码绑定</h3><p>使用那来绑定Event Trigger的方式和Button略有不同。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> EventTrigger _eventTrigger;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    _eventTrigger = GetComponent&lt;EventTrigger&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span>  entry=<span class="keyword">new</span> EventTrigger.Entry()&#123;eventID = EventTriggerType.PointerClick&#125;;</span><br><span class="line">    </span><br><span class="line">    entry.callback.AddListener((a) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">&quot;被点击了@！&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    _eventTrigger.triggers.Add(entry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要使用Entry()的一个类似工厂方法的方式来创建一个回调实体，并指定事件类型。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ui </tag>
            
            <tag> 小技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《游戏编程模式》-书评</title>
      <link href="/2022/06/14/%E3%80%8A%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F%E3%80%8B-%E4%B9%A6%E8%AF%84/"/>
      <url>/2022/06/14/%E3%80%8A%E6%B8%B8%E6%88%8F%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F%E3%80%8B-%E4%B9%A6%E8%AF%84/</url>
      
        <content type="html"><![CDATA[<h2 id="开始">开始</h2><p>第一次打开《游戏编程模式》这本书已经好像已经是两年前的事情了，断断续续的算是读完了，其实花费的时间应该是大于9小时的，</p><p>相比传统的设计模式来说，本书结合了游戏设计方面的思考，让我这个游戏程序员读的很起劲。</p><p><img src="http://pic.fasty97.top/NotePad/20220614012226.png" alt=""></p><h2 id="感悟">感悟</h2><p>书中使用C++进行讲解，除了设计模式本身，也让我使用底层c++搭建游戏引擎有了一个基本认知，其实很多设计模式我们在平时已经在不经意间使用到了，只是不明确我们使用的是什么模式而已❤️。结合之前学习的<code>《大话设计模式》</code>,这算是第二次学习设计模式相关内容了，但我自我感觉自己在代码架构设计方面还是存在一些薄弱。之后考虑再读一下<code>《设计模式与游戏完美开发》</code>，主要是结合C#看一下在Unity中使用设计模式的具体方式。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 书评 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>优化型模式-脏标记模式</title>
      <link href="/2022/06/14/%E4%BC%98%E5%8C%96%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E8%84%8F%E6%A0%87%E8%AE%B0%E6%A8%A1%E5%BC%8F/"/>
      <url>/2022/06/14/%E4%BC%98%E5%8C%96%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E8%84%8F%E6%A0%87%E8%AE%B0%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>将工作推迟到必要时进行以避免不必要的工作。</p></blockquote><h2 id="说明">说明</h2><p>但一组数据因为另一组数据的变动而变动时，为了确认具体需要变动的数据，我们为数据进行标记。</p><p>++一组原始数据随时间变化。一组衍生数据经过一些代价昂贵的操作由这些数据确定。一个脏标记跟踪这个衍生数据是否和原始数据同步。它在原始数据改变时被设置。如果它被设置了，那么当需要衍生数据时，它们就会被重新计算并且标记被清除。否则就使用缓存的数据。++</p><blockquote><p>仅当性能问题严重到值得增加代码复杂度时才使用它</p></blockquote><p>2022年6月14日00:38:00</p><p>++等待更新++</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>解耦性模式-服务定位器</title>
      <link href="/2022/06/13/%E8%A7%A3%E8%80%A6%E6%80%A7%E6%A8%A1%E5%BC%8F-%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8/"/>
      <url>/2022/06/13/%E8%A7%A3%E8%80%A6%E6%80%A7%E6%A8%A1%E5%BC%8F-%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>通过阅读<code>《游戏编程模式》</code>在我的理解下，服务定位器就是：++将需要全局使用的对象进行统一的管理++。</p></blockquote><p>主要是为了解决单例对象在众多系统中被使用暴露了真实系统实现的问题，通过在单例系统外围包裹一层，然后通过访问外界的定位器来范围真实的服务对象。</p><p>当然这样就意味着，我们需要在定位器中对服务进行初始化管理。</p><p>Ps：使用这样的方式，我们就可以通过定位器快捷的替换服务器的具体实现对象，以指定使用例如测试音频模块、发布音频模块等的发布环境区分的子服务类型。{.red}</p><blockquote><p>Tips: 其实对于上述的环境区分，我们也可以通过宏定义来处理。</p></blockquote><h2 id="时序耦合">时序耦合</h2><p><img src="https://pic.fasty97.top/NotePad/20220614002525.png" alt=""></p><p>在书中提到了一个++时序耦合++的概念，所谓时序耦合就是指两个或多个独立系统因为依赖关系导致，必须有A才能使用B的情况出现，解决时序耦合可以让我们真正让每个系统独立。</p><p>为了防止出现NULL的情况，我们可以为服务指定一个默认初始化方式或默认初始化对象，同时我们可以在想要禁用该项服务时，返回这个默认的空对象。</p><h2 id="说明">说明</h2><blockquote><p>服务定位器模式在很多方面和单例模式（第6章）非常相近，所以值得考虑两者来决定哪一个更适合你的需求。</p></blockquote><ul><li><p>Unity[插图]框架把这个模式和组件模式（第14章）结合起来，并使用在了GetComponent()方法中。</p></li><li><p>Microsoft的XNA[插图]游戏开发框架将这个模式内嵌到它的核心Game类中。每个实例有一个GameServices对象，能够用来注册和定位任何类型的服务。</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity 新技术UIkit</title>
      <link href="/2022/06/11/Unity%20%E6%96%B0%E6%8A%80%E6%9C%AFUIkit/"/>
      <url>/2022/06/11/Unity%20%E6%96%B0%E6%8A%80%E6%9C%AFUIkit/</url>
      
        <content type="html"><![CDATA[<h1>简单介绍</h1><h2 id="UIBulider的使用">UIBulider的使用</h2><blockquote><p>UIElement是一种类似于Html形式进行界面开发的方式,创建的EditorWidow包括以下3个文件。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220317003758.png" alt="image-20220317003751243"></p><ul><li>C#-代码控制界面逻辑 类似于js</li><li>Uss-样式控制器 类似于Css</li><li>Uxml-基础骨架模板 类型Html</li></ul><p><img src="http://pic.fasty97.top/NotePad/20220317004247.png" alt="image-20220317004247734"></p><center>UIBulider界面</center><h2 id="双击Asset打开编辑窗">双击Asset打开编辑窗</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">DialogGraphEditWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> VisualElement rootMain;</span><br><span class="line">    </span><br><span class="line">    [<span class="meta">OnOpenAsset(1)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">OpenAsset</span>(<span class="params"><span class="built_in">int</span> id,<span class="built_in">int</span> line</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (EditorUtility.InstanceIDToObject(id) <span class="keyword">is</span> DialogTreeGraphAsset graph)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> window = GetWindow&lt;DialogGraphEditWindow&gt;();</span><br><span class="line">            window.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;对话窗&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> root = AssetDatabase.LoadAssetAtPath&lt;VisualTreeAsset&gt;(<span class="string">&quot;Assets/Editor/GraphWindow.uxml&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (rootMain==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rootMain = root.Instantiate();</span><br><span class="line">            &#125;</span><br><span class="line">            window.rootVisualElement.Add(rootMain);</span><br><span class="line">            window.minSize = <span class="keyword">new</span> Vector2(<span class="number">600</span>, <span class="number">450</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Uss-样式表">Uss 样式表</h2><blockquote><p>形如这样的称为样式表uss，uss决定了ui元素的显示效果。</p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Label</span> &#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">20px</span>;</span><br><span class="line">    -unity-<span class="attribute">font-style</span>: bold;</span><br><span class="line">    <span class="attribute">color</span>: <span class="built_in">rgb</span>(<span class="number">68</span>, <span class="number">138</span>, <span class="number">255</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Uxml-模板">Uxml 模板</h2><blockquote><p>uxml模板类似于html，其中包含了所有的静态元素内容。</p><p>uxml使用uss决定其中ui元素的具体显示效果。</p></blockquote><p>双击打开uxml时默认会自动打开可视化工具——UIBulider,在UiBulider中进行可视化的数据操作。</p><h2 id="Ui-绑定">Ui 绑定</h2><blockquote><p>Ui绑定文件类似于JavaScript代码</p></blockquote><p>我们可以在代码中使用相关的Api对Ui元素和样式表进行操作,如下所示：</p><figure class="highlight csharp"><figcaption><span>动态操作</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BagMgrWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Window/UI Toolkit/BagMgrWindow&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowExample</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        BagMgrWindow wnd = GetWindow&lt;BagMgrWindow&gt;();</span><br><span class="line">        wnd.titleContent = <span class="keyword">new</span> GUIContent(<span class="string">&quot;BagMgrWindow&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">CreateGUI</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Each editor window contains a root VisualElement object</span></span><br><span class="line">        VisualElement root = rootVisualElement;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// VisualElements objects can contain other VisualElement following a tree hierarchy.</span></span><br><span class="line">        VisualElement label = <span class="keyword">new</span> Label(<span class="string">&quot;Hello World! From C#&quot;</span>);</span><br><span class="line">        root.Add(label);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Import UXML</span></span><br><span class="line">        <span class="keyword">var</span> visualTree = AssetDatabase.LoadAssetAtPath&lt;VisualTreeAsset&gt;(<span class="string">&quot;Assets/EditorWindows/BagMgrWindow.uxml&quot;</span>);</span><br><span class="line">        VisualElement labelFromUXML = visualTree.Instantiate();</span><br><span class="line">        root.Add(labelFromUXML);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// A stylesheet can be added to a VisualElement.</span></span><br><span class="line">        <span class="comment">// The style will be applied to the VisualElement and all of its children.</span></span><br><span class="line">        <span class="keyword">var</span> styleSheet = AssetDatabase.LoadAssetAtPath&lt;StyleSheet&gt;(<span class="string">&quot;Assets/EditorWindows/BagMgrWindow.uss&quot;</span>);</span><br><span class="line">        VisualElement labelWithStyle = <span class="keyword">new</span> Label(<span class="string">&quot;Hello World! With Style&quot;</span>);</span><br><span class="line">        labelWithStyle.styleSheets.Add(styleSheet);</span><br><span class="line">        root.Add(labelWithStyle);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Debug-工具">Debug 工具</h2><blockquote><p>提供有Ui检查工具，其中可以查看Ui元素的显示状态和包围盒结构，树形结构等，类似html的浏览器F12.</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202211211500451.png" alt="image-20221121150027349"></p><h2 id="流程模板">流程模板</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.UIElements;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">IndexEditorWindow</span> : <span class="title">EditorWindow</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> VisualElement rootMain;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Fasty/主界面&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Open</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> root = AssetDatabase.LoadAssetAtPath&lt;VisualTreeAsset&gt;(<span class="string">&quot;Assets/Index.uxml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        rootMain = root.Instantiate();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> window = GetWindow&lt;IndexEditorWindow&gt;();</span><br><span class="line"></span><br><span class="line">        window.rootVisualElement.Add(rootMain);</span><br><span class="line"></span><br><span class="line">        CreateUi();</span><br><span class="line">        InitEvent();</span><br><span class="line"></span><br><span class="line">        window.Show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 动态创建Ui</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">CreateUi</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">       </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 处理事件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitEvent</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> btn = rootMain.Q&lt;Button&gt;(<span class="string">&quot;showBtn&quot;</span>);</span><br><span class="line">        btn.clicked += () =&gt; &#123; rootMain.Q&lt;Label&gt;(<span class="string">&quot;title&quot;</span>).text = <span class="string">&quot;查看被点击了&quot;</span>; &#125;;</span><br><span class="line"></span><br><span class="line">        btn = rootMain.Q&lt;Button&gt;(<span class="string">&quot;descBtn&quot;</span>);</span><br><span class="line">        btn.clicked += () =&gt; &#123; rootMain.Q&lt;Label&gt;(<span class="string">&quot;title&quot;</span>).text = <span class="string">&quot;说明被点击了&quot;</span>; &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>装备管理小案例</h1><blockquote><p>++2022年11月21日10:32:00更新++</p><p>此案例为Uitoolkit练习，使用Unity2021.3.11f1c2</p></blockquote><h2 id="初步设计">初步设计</h2><p><img src="http://pic.fasty97.top/NotePad/202211211054281.png" alt="image-20221121105406061"></p><center>简单装备管理设计</center><p>其中涉及到<code>ListView</code>控件参考：[Unity - Manual: Create list and tree views (<a href="http://unity3d.com">unity3d.com</a>)](<a href="https://docs.unity3d.com/2022.1/Documentation/Manual/UIE-ListView-TreeView.html#:~:text=Create">https://docs.unity3d.com/2022.1/Documentation/Manual/UIE-ListView-TreeView.html#:~:text=Create</a> a list view 1 Right-click in the,the ListView control in the Hierarchy window. 更多项目)</p><p>++ 🔖值得注意的是： 当因为修改脚本导致窗口无法打开时，可能是因为查找不到窗口的实例，在修正错误后，重启Unity编辑器才能正常打开窗体。++</p><h2 id="ListView的使用">ListView的使用</h2><blockquote><p>这里点击使用的是通用注册事件，同时也可以使用ListView的OnValueChange方法监听，在监听时获取不到text属性，可以在生成时将数据绑定到<code>viewDataKey</code>。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = _rootMain.Q&lt;ListView&gt;();</span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> ArrayList() &#123; <span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span> &#125;;</span><br><span class="line">list.itemsSource = data;</span><br><span class="line">list.makeItem = () =&gt; <span class="keyword">new</span> Label();</span><br><span class="line">list.bindItem = (element, index) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    ((Label)element).text = data[index].ToString();</span><br><span class="line">    element.viewDataKey = data[index].ToString();</span><br><span class="line">    element.RegisterCallback&lt;MouseDownEvent&gt;((c) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;点击了选项：<span class="subst">&#123;element.viewDataKey&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;, TrickleDown.TrickleDown);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Unity 新技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ui </tag>
            
            <tag> 编辑器扩展 </tag>
            
            <tag> uitoolkit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于状态机的思考</title>
      <link href="/2022/06/11/%E5%85%B3%E4%BA%8E%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2022/06/11/%E5%85%B3%E4%BA%8E%E7%8A%B6%E6%80%81%E6%9C%BA%E7%9A%84%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<blockquote><p>状态机是对状态模式的一种使用。用于独立处理在各个状态的具体情况和转换关系。</p></blockquote><h2 id="开始">开始</h2><p>当我们需要处理带流程响应的问题时，可以将其抽象为状态问题。</p><p>例如下图的我们需要处理OnEnter、OnUpdate、OnExit三个部分。{.red}</p><p><img src="http://pic.fasty97.top/NotePad/20220615115055.png" alt=""></p><h2 id="有限状态机">有限状态机</h2><blockquote><p>有且仅有可能处于一种状态，解决状态区分和转换问题。</p><p>有限状态机是下列几种状态机的基础，下面的状态机都基于有限状态机进行相关功能的扩充。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220615115505.png" alt=""></p><h3 id="转换方式">转换方式</h3><p>在状态机中，我们需要使用一种转换方式来进行状态切换，在Unity的Animator中使用条件参数进行跳转。我们可以使用类似事件的方式来跳转、或者使用任意能够保证正确进行 原状态到目标状态 转换的方式。</p><h3 id="实现方式">实现方式</h3><blockquote><p>对于有限状态机来说，我们只需要保证具有<code>状态</code>、<code>转换关系</code>即可。</p></blockquote><h4 id="状态">状态</h4><p>状态是我们需要管理的核心，状态中可以包含转换关系Dict。</p><figure class="highlight csharp"><figcaption><span>非继承式状态</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 简单Fsm状态</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FsmState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, FsmTranslation&gt; translationDict;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FsmState</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.Name = name;</span><br><span class="line">        translationDict = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, FsmTranslation&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="转换条件">转换条件</h4><p>转换条件包括了起止状态和状态切换时要执行的回调函数。</p><figure class="highlight csharp"><figcaption><span>转换条件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 简单Fsm转换条件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FsmTranslation</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> FsmState fromState;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> FsmState toState;</span><br><span class="line">    <span class="keyword">public</span> FsmTranslationCallBack callBack;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 创建条件</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fromState&quot;&gt;</span>开始状态<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>响应事件<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;toState&quot;&gt;</span>目标状态<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;callBack&quot;&gt;</span>转换回调<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FsmTranslation</span>(<span class="params">FsmState fromState, <span class="built_in">string</span> name, FsmState toState, FsmTranslationCallBack callBack</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.fromState = fromState;</span><br><span class="line">        <span class="keyword">this</span>.toState = toState;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.callBack = callBack;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="控制机器">控制机器</h4><p>我们需要一个控制机器来管理我们的状态和条件，让整个系统能够自动化的运转起来，这个部分我将其称之为++状态机器++。<br>状态机器存储了当前的状态情况，以及根据条件转变条件的方法<code>HandleEvent</code>。</p><figure class="highlight csharp"><figcaption><span>机器</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当前状态</span></span><br><span class="line"><span class="keyword">public</span> FsmState CurState &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">Dictionary&lt;<span class="built_in">string</span>, FsmState&gt; StateDict = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, FsmState&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 添加状态</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;state&quot;&gt;</span>State.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddState</span>(<span class="params">FsmState state</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    StateDict[state.Name] = state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 添加条转</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;translation&quot;&gt;</span>Translation.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddTranslation</span>(<span class="params">FsmTranslation translation</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    StateDict[translation.fromState.Name].translationDict[translation.name] = translation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 启动状态机</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;state&quot;&gt;</span>State.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Start</span>(<span class="params">FsmState state</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    CurState = state;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 处理事件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;name&quot;&gt;</span>Name.<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HandleEvent</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (CurState != <span class="literal">null</span> &amp;&amp; CurState.translationDict.ContainsKey(name))</span><br><span class="line">    &#123;</span><br><span class="line">        UnityEngine.Debug.Log(<span class="string">&quot;fromState:&quot;</span> + CurState.Name);</span><br><span class="line"></span><br><span class="line">        CurState.translationDict[name].callBack();</span><br><span class="line">        CurState = CurState.translationDict[name].toState;</span><br><span class="line"></span><br><span class="line">        UnityEngine.Debug.LogWarning(<span class="string">&quot;toState:&quot;</span> + CurState.Name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="思考">思考</h3><p>通过上面这一步我们已经搭建了一个基本的状态机模板，上面使用的是++非继承的模式++,当然我们可以将状态机接口抽象出去，成为一个接口。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> FSM有限状态机接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IFsmState</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnEnter</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnUpdate</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnExit</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上所示这种形式，我们的状态类通过继承接口来外挂状态行为，这种方式有好有坏，好处是：++可以结构更加严谨的使用状态机接口，逻辑清晰++。</p><p>坏处是：++在使用时也许我们会为了一个状态而去创建一个子类，导致子类过多，而子类的功能本身存在重合的情况++。</p><h2 id="并发状态机">并发状态机</h2><blockquote><p>相当于同时运行多个有限状态机，解决多状态并行问题。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220622170627.png" alt=""></p><p>在Unity的Animator Controller中，我们每一个创建的控制器就是一个FSM状态机，但我们使用多个时，这些状态机并不会相互干扰，独立并发的运行，此时我们可以将这种多个状态机同时运行的情况称之为是并发状态机。</p><h2 id="分层状态机">分层状态机</h2><blockquote><p>相当于在有限状态机中添加层级划分，通过层级来指定当前使用的状态机。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220622170913.png" alt=""></p><p>在动画系统中可以看到有Layer的概念，这就是使用分层状态机的概念，不过在我们的普通分层状态中，我们的每个层级权重都为1，也就是说每次运行一个层级时有且只运行这一个层级，而Unity增加了权重的概念，这个概念让状态层级之间可以可以状态和层级的混合。</p><h2 id="下推状态机">下推状态机</h2><blockquote><p>相当于使用一个栈来存储状态的历史记录，以便在需要时回到原先的状态。</p><p>在退出一个状态时，自动恢复到之前的状态。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220622171349.png" alt=""></p><p>如图所示：每个次级状态都与前一个状态存在回溯关系（++这个回溯关系是不需要条件的++），当我们退出C状态时，我们会自动回到B状态，退出B状态时自动回到A状态。</p><p>状态机会将每一个使用的状态放入状态栈中，在退出当前状态时自动回溯到上一个状态。{.red}</p><p><img src="http://pic.fasty97.top/NotePad/20220622171829.png" alt=""></p><h2 id="相关阅读">相关阅读</h2><ol><li><a href="https://fasty97.top/2021/09/08/NodeCanvas%E4%B9%8BFSM%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/">NodeCanvas之FSM有限状态机 - NodeCanvas - 游戏开发 | Fasty Blog = 指尖小屋</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 状态机 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 状态机 </tag>
            
            <tag> 有限状态机 </tag>
            
            <tag> 并发状态机 </tag>
            
            <tag> 分层状态机 </tag>
            
            <tag> 下推状态机 </tag>
            
            <tag> AI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>URP下自定义后处理</title>
      <link href="/2022/06/08/URP%E4%B8%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8E%E5%A4%84%E7%90%86/"/>
      <url>/2022/06/08/URP%E4%B8%8B%E8%87%AA%E5%AE%9A%E4%B9%89%E5%90%8E%E5%A4%84%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="说明">说明</h2><blockquote><p>在URP中Unity通过定义<code>RenderFeature</code>来编写自定义后处理效果，实现<code>SRP渲染管线</code>。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  Vlome--&gt;RenderFeature --&gt; RenderPass1 --&gt; RenderPass2--&gt; ......</span><br><span class="line">  </span><br><span class="line">  RenderPass--&gt; Shader--&gt; ShaderPass1--&gt;ShaderPass2--&gt;......</span><br></pre></td></tr></table></figure><center>流程如上</center><h2 id="Step1-编写后处理Shader">Step1 编写后处理Shader</h2><h2 id="Setp2-编写Render-Feature">Setp2 编写Render Feature</h2><h3 id="Render-Feature">Render Feature</h3><blockquote><p>Render Feature是一个处理集，继承自<code>ScriptableRendererFeature</code>，可以包含多个Render Pass。</p></blockquote><p><code>public override void Create()</code></p><p>用于在RenderFeature创建时调用，一般在这里进行使用到的RenderPass的初始化操作。</p><p><code>public override void AddRenderPasses(ScriptableRenderer renderer, ref RenderingData renderingData)</code></p><p>用于指定渲染队列信息，通过<code>renderer.EnqueuePass(renderpass)</code>方法来将renderpass加入渲染队列。</p><h3 id="Render-Pass">Render Pass</h3><blockquote><p>RenderPass类似于ShaderPass，是一块处理单元，通过继承<code>ScriptableRenderPass</code>,实现生命周期和处理行为。</p></blockquote><center>按照生命周期流程如下</center><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">  OnCameraSetup--&gt;Execute --&gt; OnCameraCleanup</span><br></pre></td></tr></table></figure><ul><li><p><code>public override void OnCameraSetup(CommandBuffer cmd, ref RenderingData renderingData)</code></p><p>用于初始化RenderPass，完成基础操作。</p></li><li><p><code>public override void Execute(ScriptableRenderContext context, ref RenderingData renderingData)</code></p><p>用于处理Pass逻辑。</p></li><li><p><code>public override void OnCameraCleanup(CommandBuffer cmd)</code></p><p>用于进行收尾操作，释放资源等。</p></li></ul><h2 id="Setp3-编写Volume-Component">Setp3 编写Volume Component</h2><p>创建一个类继承自<code>VolumeComponent</code>,实现<code>IPostProcessComponent</code>接口。</p><p>定义<code>VolumeComponentMenu</code>菜单路径。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Serializable, VolumeComponentMenu(<span class="string">&quot;MyPost-processing/Translation&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TranslationEffect</span> : <span class="title">VolumeComponent</span>, <span class="title">IPostProcessComponent</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Range(0.0f, 1f)</span>] <span class="keyword">public</span> FloatParameter width = <span class="keyword">new</span> FloatParameter(<span class="number">0.5f</span>);</span><br><span class="line">    [<span class="meta">Range(0.0f, 1f)</span>] <span class="keyword">public</span> FloatParameter height = <span class="keyword">new</span> FloatParameter(<span class="number">0.5f</span>);</span><br><span class="line">    [<span class="meta">Range(0.0f, 1f)</span>] <span class="keyword">public</span> FloatParameter scale = <span class="keyword">new</span> FloatParameter(<span class="number">0.5f</span>);</span><br><span class="line">    <span class="keyword">public</span> Vector2Parameter viewport=<span class="keyword">new</span> Vector2Parameter(<span class="keyword">new</span> Vector2(<span class="number">0.5f</span>,<span class="number">0.5f</span>));</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsActive</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> scale.<span class="keyword">value</span> &gt;= <span class="number">0f</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsTileCompatible</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>PS：书写参数时,必须使用经过保证的参数类型，如Float应该使用FloatParameter类型代替。</p></blockquote><h2 id="Setp4-编写控制脚本">Setp4 编写控制脚本</h2><h2 id="参考资料">参考资料</h2><ol><li><a href="https://www.bilibili.com/video/BV1Nk4y1o7wH?spm_id_from=333.999.0.0">【鸡丝菌的ShaderGraph小教室】动物森友会转场效果的实现_哔哩哔哩_bilibili</a></li><li><a href="https://docs.unity3d.com/ScriptReference/Rendering.ScriptableRenderContext.html">Unity - Scripting API: ScriptableRenderContext (unity3d.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/400858121">URP自定义后处理 - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/161658349">如何扩展Unity URP的后处理Volume组件 - 知乎 (zhihu.com)</a></li><li><a href="https://zhuanlan.zhihu.com/p/373273390">URP系列教程 | 如何使用Scriptable Renderer Feature来自定义后处理效果 - 知乎 (zhihu.com)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> URP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渲染管线 </tag>
            
            <tag> 后处理 </tag>
            
            <tag> 可编程渲染管线（SRP） </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>行为型模式-字节码</title>
      <link href="/2022/06/07/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%AD%97%E8%8A%82%E7%A0%81/"/>
      <url>/2022/06/07/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E5%AD%97%E8%8A%82%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<blockquote><p>将指令抽象为一组字节码，通过字节码的排列组合定义游戏行为，使得玩家或者策划能够自由设计游戏行为（例如AI）。</p><p><code>数据驱动</code>让游戏逻辑脱离编码的限制，赋予数据 行为。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//使用这样的一种数据驱动的模式来编程,让游戏逻辑脱离编码的限制，赋予数据 行为</span></span><br><span class="line">            <span class="comment">//</span></span><br><span class="line">            <span class="comment">//使用堆栈存储指令，每次将堆栈中的指令出栈执行再入栈，直到栈空</span></span><br><span class="line">            <span class="keyword">var</span> stack = <span class="keyword">new</span> Stack&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">            <span class="keyword">var</span> actlist = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">50</span>, <span class="number">1</span>, <span class="number">21</span>, <span class="number">2</span>, <span class="number">100</span>,<span class="number">3</span> &#125;;</span><br><span class="line">            actlist.ForEach(x =&gt; &#123; stack.Push(x); &#125;);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> player = <span class="keyword">new</span> Character();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//解析字节码</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (stack.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> act = (ActType)stack.Pop();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">switch</span> (act)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> ActType.AddHp:</span><br><span class="line">                        <span class="keyword">var</span> parm = stack.Pop();</span><br><span class="line">                        player.AddHp(parm);</span><br><span class="line">                        <span class="comment">//stack.Push(player.Hp);</span></span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> ActType.PlaySound:</span><br><span class="line">                        parm = stack.Pop();</span><br><span class="line">                        player.PlaySound(parm);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> ActType.Spell:</span><br><span class="line">                        parm = stack.Pop();</span><br><span class="line">                        player.Spell(parm);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="literal">default</span>:</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">enum</span> ActType</span><br><span class="line">    &#123;</span><br><span class="line">        AddHp = <span class="number">1</span>,</span><br><span class="line">        Spell = <span class="number">2</span>,</span><br><span class="line">        PlaySound = <span class="number">3</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Character</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Mp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddHp</span>(<span class="params"><span class="built_in">int</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Hp += <span class="keyword">value</span>;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;增加生命值：<span class="subst">&#123;<span class="keyword">value</span>&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Spell</span>(<span class="params"><span class="built_in">int</span> pos</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;释放法术：<span class="subst">&#123;pos&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">PlaySound</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;播放音效: <span class="subst">&#123;id&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>行为型模式-类型对象</title>
      <link href="/2022/06/07/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E7%B1%BB%E5%9E%8B%E5%AF%B9%E8%B1%A1/"/>
      <url>/2022/06/07/%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F-%E7%B1%BB%E5%9E%8B%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>通过创建一个类来支持新类型的灵活创建，其每个实例都代表一个不同的对象类型。</p></blockquote><h2 id="问题">问题</h2><p>试着想象一下，如果我们来设计一个怪物的数据我们会如何？</p><ul><li>名称</li><li>种族</li><li>生命值</li><li>攻击力</li><li>…</li></ul><p>以及我们的Attack行为。</p><p>可以想到诸如这些的属性，在以这些数据的基础上来派生更多的特殊化数据。</p><h2 id="传统设计">传统设计</h2><p>按照我们的常规思维，我们很容易想到如下的设计方案。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">MosterBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Race &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Damage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BigCat</span> : <span class="title">MosterBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Attack();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;喵！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Elf</span>: <span class="title">MosterBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">base</span>.Attack();</span><br><span class="line">        Console.WriteLine(<span class="string">&quot;精灵攻击&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>假如,此时我们希望怪物的数值和种族挂钩。</p></blockquote><p>我们第一时间想到的肯定是将<code>种族</code>也划分为一个类。</p><p>于是我们有了以下的代码：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Race</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Damage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">MosterBase</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> Damage &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Race Race &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Attack</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>Race</code>类可以帮助我们存放所有同种族 怪物的共享信息。</p><blockquote><p>这种,类似组合的设计方案，帮助我们共享一部分数据，但在行为层面 也导致了我们子类过多的问题。</p></blockquote><h2 id="使用类型对象">使用类型对象</h2><blockquote><p>在类中放置一个对象引用来表述类型，通过怪物+种族的组合方式，来解决子类过多的设计。</p><p>❤️ 放置的对象引用已经表述了类型，就无需通过继承来表达关系。</p><p>❤️ 通过类型对象搭建工厂生成对象。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             * 类型对象：是指通过组合的方式去解决继承导致的强耦合问题</span></span><br><span class="line"><span class="comment">             * 例如：在下面的例子中，如果我们将种族放在Moster中，然后通过继承的方式实现抽象类Moster，会导致子类过多，耦合强。</span></span><br><span class="line"><span class="comment">             * 使用一个单独的对象将种族抽离出来，通过怪物和种族的组合方式就可以创建不同的怪物。</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> breed = <span class="keyword">new</span> Breed &#123; AttackLevel = <span class="number">5</span>, BaseHp = <span class="number">50</span>, Name = <span class="string">&quot;狼&quot;</span> &#125;;</span><br><span class="line">            Console.WriteLine(<span class="keyword">new</span> Moster() &#123; Hp = <span class="number">100</span>, Name = <span class="string">&quot;灰狼&quot;</span>, Breed = breed &#125;);</span><br><span class="line">            Console.WriteLine(<span class="keyword">new</span> Moster() &#123; Hp = <span class="number">50</span>, Name = <span class="string">&quot;白狼&quot;</span>, Breed = breed &#125;);</span><br><span class="line"></span><br><span class="line">            Console.WriteLine(breed.NewMoster());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> breed2 = <span class="keyword">new</span> Breed &#123; AttackLevel = <span class="number">6</span>, Name = <span class="string">&quot;死灵狼&quot;</span>, Parent = breed &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> mos = breed2.NewMoster(<span class="string">&quot;恐怖之狼&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//Console.WriteLine(mos);</span></span><br><span class="line"></span><br><span class="line">            Console.WriteLine(breed2);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 怪物</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Moster</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Breed Breed &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> SumHp =&gt; Breed.BaseHp + Hp;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;<span class="subst">&#123;Name&#125;</span> HP:<span class="subst">&#123;SumHp&#125;</span> breedName：<span class="subst">&#123;Breed.Name&#125;</span> AttackLevel:<span class="subst">&#123;Breed.AttackLevel&#125;</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 种族</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Breed</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> AttackLevel &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//为了区分是否为子种族重写值，我们可以如此判定</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> baseHp;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> BaseHp</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (baseHp == <span class="number">0</span> &amp;&amp; Parent != <span class="literal">null</span>)</span><br><span class="line">                &#123; <span class="keyword">return</span> Parent.baseHp; &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> baseHp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">set</span> &#123; baseHp = <span class="keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以通过这种方式为种族添加一个方法工厂化生成Moster</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Moster <span class="title">NewMoster</span>(<span class="params"><span class="built_in">string</span> name = <span class="string">&quot;&quot;</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Moster() &#123; Breed = <span class="keyword">this</span>, Name = name &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可以通过指定父种族指定层级关系,不使用继承，存储内存地址，在子类和父类仅仅只是数据上不同时，可以避免子类数目过多</span></span><br><span class="line">        <span class="keyword">public</span> Breed Parent &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;<span class="subst">&#123;Parent.Name&#125;</span>-&gt;<span class="subst">&#123;Name&#125;</span> AttackLevel:<span class="subst">&#123;AttackLevel&#125;</span> BaseHp:<span class="subst">&#123;BaseHp&#125;</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（九）复杂光照</title>
      <link href="/2022/05/20/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B9%9D%EF%BC%89%E5%A4%8D%E6%9D%82%E5%85%89%E7%85%A7/"/>
      <url>/2022/05/20/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B9%9D%EF%BC%89%E5%A4%8D%E6%9D%82%E5%85%89%E7%85%A7/</url>
      
        <content type="html"><![CDATA[<h1>复杂光照</h1><p>在之前的学习中，我们使用的都是单一光照，实际在游戏中可能存在多个光源，不同的光源会互相影响构成真正的光照系统，在这一节我们将实现一个真正可用的光照模型。</p><h2 id="渲染路径-Rendering-Path">渲染路径 Rendering Path</h2><blockquote><p>📖 决定了光照是如何应用到Unity Shader中的。</p></blockquote><p>我们只有为Shader正确地选择和设置了需要的渲染路径，该Shader的光照计算才能被正确执行。</p><p>🏷️渲染路径的分类</p><ul><li>前向渲染路径（Forward Rendering Path）</li><li>延迟渲染路径（Deferred Rendering Path）</li><li>顶点照明渲染路径（Vertex Lit Rendering Path）——已经被弃用</li></ul><p>目前unity提供了新的渲染路径代替了原来的渲染路径。</p><blockquote><p>默认使用 Graphics中的设置，可以在摄像机中对设置进行覆盖。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202209021127030.png" alt="image-20220902112709918"></p><p>在Shader Pass中来指定该Pass使用的渲染路径：</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pass  &#123; Tags  &#123;  &quot;LightMode&quot;  =  &quot;ForwardBase&quot;  &#125; &#125;</span><br></pre></td></tr></table></figure><p>LightMode标签可供使用的渲染路径：</p><p><img src="http://pic.fasty97.top/NotePad/202209021129823.png" alt="image-20220902112959760"></p><p>💭为Pass指定正确的渲染路径对于Unity光照变量正确赋值具有重要意义。</p><blockquote><p>Unity默认使用前向渲染光照路径.</p></blockquote><h3 id="前向渲染路径">前向渲染路径</h3><blockquote><p>前向渲染是传统渲染方式，也是我们常用的一种渲染路径。</p></blockquote><p>📖 原理：每进行一次完整的前向渲染，我们需要渲染该对象的渲染图元，并计算两个缓冲区的信息：颜色缓冲区和深度缓冲区。</p><center>前向渲染伪代码</center><p><img src="http://pic.fasty97.top/NotePad/202209021402465.png" alt="image-20220902140220407"></p><p>每个光照下的物体都需要进行一次逐像素的Pass，也就是在一个场景中，n个物体m个光源的下，渲染场景需要n*m次Pass。</p><h3 id="Unity中的前向渲染">Unity中的前向渲染</h3><p>Unity中照亮物体有3种方式：</p><ol><li>逐顶点处理 Spherical</li><li>逐像素处理 Harmonics</li><li>球谐函数 SH</li></ol><p>光源使用哪一种处理方式取决于它的类型和渲染模式。</p><p><img src="http://pic.fasty97.top/NotePad/202209021411344.png" alt="image-20220902141112298"></p><blockquote><p>将渲染类型设置为Important（重要的）来告诉Unity这个光源是重要的，把它当成一个逐像素光源来处理。</p><p>通常，Unity会自动根据远近、强度等参数对光源的重要性进行排序。</p></blockquote><ul><li><p>场景中最亮的平行光总是按逐像素处理的。</p></li><li><p>渲染模式被设置成Not Important的光源，会按逐顶点或者SH处理。·渲染模式被设置成Important的光源，会按逐像素处理。</p></li><li><p>如果根据以上规则得到的逐像素光源数量小于Quality Setting中的逐像素光源数量(Pixel Light Count)，会有更多的光源以逐像素的方式进行渲染。</p></li></ul><h3 id="内置变量函数">内置变量函数</h3><p><img src="http://pic.fasty97.top/NotePad/202209021420443.png" alt="image-20220902142017381"></p><p><img src="http://pic.fasty97.top/NotePad/202209021420246.png" alt="image-20220902142034183"></p><h3 id="相关参考">相关参考</h3><p><a href="https://zhuanlan.zhihu.com/p/93846000">Unity渲染路径 - 知乎 (zhihu.com)</a></p><h2 id="顶点照明渲染路径">顶点照明渲染路径</h2><blockquote><p>顶点照明渲染路径是对硬件配置要求最少、运算性能最高，但同时也是得到的效果最差的一种类型，它不支持那些逐像素才能得到的效果，例如阴影、法线映射、高精度的高光反射等。</p></blockquote><p>📖同理，使用逐顶点的方式进行光照计算。——是前向渲染的一个子集。</p><h2 id="延迟渲染路径">延迟渲染路径</h2><blockquote><p>当场景中包含大量实时光源时，前向选人的性能会急速下降。</p></blockquote><p>除了前向渲染中使用的颜色缓冲和深度缓冲之外，延迟渲染还需要利用额外的缓冲——这些缓冲被统称为GBuffer。</p><h3 id="原理">原理</h3><p><img src="http://pic.fasty97.top/NotePad/202209021438497.png" alt="image-20220902143817442"></p><p>在光照计算Pass中直接存储法线，表面情况等，从Gbuff取到数据后直接在光照Pass中计算，故而延迟渲染和场景复杂度不挂钩，通常就只使用两个Pass完成故而效率较高。</p><h3 id="缺点">缺点</h3><ul><li>不支持真正的抗锯齿（anti-aliasing）功能。</li><li>不能处理半透明物体。</li><li>对显卡有一定要求。如果要使用延迟渲染的话，显卡必须支持MRT（Multiple Render Targets）、Shader Mode 3.0及以上、深度渲染纹理以及双面的模板缓冲。</li></ul><blockquote><p>通常我们使用前向渲染路径类型:)</p></blockquote><h2 id="Unity光源类型">Unity光源类型</h2><h2 id="阴影">阴影</h2><h3 id="不透明物体的阴影">不透明物体的阴影</h3><p><img src="http://pic.fasty97.top/NotePad/202209131137666.png" alt="image-20220913113734111"></p><center>通过MeshRender可以设置阴影</center><p>将CastShaows 设置为<code>Two Sided</code>可以双面渲染。</p><blockquote><p>Unity选择使用一个额外的Pass来专门更新光源的阴影映射纹理，这个Pass就是<code>LightMode</code>标签被设置为<code>ShadowCaster</code>的<code>Pass</code>。</p></blockquote><ul><li>接收阴影：对阴影纹理进行采样，最终把阴影纹理和光照进行相乘。</li><li>投射阴影：加入到光源的阴影纹理计算中，通过指定的Pass来实现，如果使用了屏幕空间投射，还会生成一张摄像机的深度图。</li></ul><h4 id="接收阴影">接收阴影</h4><ol><li>在BasePass中包含内置文件：</li></ol><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#include &quot;AutoLight.cginc&quot;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>在顶点着色器的输出结构体中添加<code>SHADOW_COORDS</code></li></ol><p>SHADOW_COORDS(2)</p><ol start="3"><li>在顶点着色器返回之前添加一个内置宏<code>TRANSFER_SHADOW</code></li></ol><p>TRANSFER_SHADOW(o)</p><ol start="4"><li>在片元着色器中计算阴影值，使用<code>SHADOW_ATTENUATION</code></li></ol><p>fixed shadow=SHADOW_ATTENUATION(i)</p><blockquote><p>📖PS:由于这些宏中会使用上下文变量来进行相关计算，例如TRANSFER_SHADOW会使用v.vertex或a.pos来计算坐标，因此为了能够让这些宏正确工作，我们需要保证自定义的变量名和这些宏中使用的变量名相匹配。我们需要保证：a2f结构体中的顶点坐标变量名必须是vertex，顶点着色器的输出结构体v2f必须命名为v，且v2f中的顶点位置变量必须命名为pos。</p></blockquote><h3 id="透明物体的阴影">透明物体的阴影</h3>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity InputSystem使用</title>
      <link href="/2022/05/16/Unity%20InputSystem%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/05/16/Unity%20InputSystem%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>InputSystem 是Unity新推出的输入管理系统。</p><p>相比传统的输入系统，<code>InputSystem </code>支持对设备拔插状态监听和自定义按键映射。</p></blockquote><h1>以代码的方式运行</h1><h2 id="简单使用">简单使用</h2><p>以下为获取使用游戏手柄的方式。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取最后使用的游戏手柄</span></span><br><span class="line"><span class="keyword">var</span> gamePad = Gamepad.current;</span><br><span class="line"></span><br><span class="line"><span class="comment">// print(gamePad.name);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//持续判断按键按下</span></span><br><span class="line"><span class="keyword">if</span> (gamePad.dpad.up.isPressed)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;按下 上&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//按下一次执行一次</span></span><br><span class="line"><span class="keyword">if</span> (gamePad.dpad.up.wasPressedThisFrame)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;按 上&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取左摇杆的值</span></span><br><span class="line">move = gamePad.leftStick.ReadValue();</span><br></pre></td></tr></table></figure><p>同理可以获取键盘和鼠标的输入：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取当前的键盘</span></span><br><span class="line"><span class="keyword">var</span> keyboard = Keyboard.current;</span><br><span class="line">print(<span class="string">&quot;键盘：&quot;</span> + keyboard.name);</span><br><span class="line"><span class="keyword">if</span> (keyboard.kKey.wasPressedThisFrame)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;按下K&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取当前的鼠标</span></span><br><span class="line"><span class="keyword">var</span> mouse = Mouse.current;</span><br><span class="line"><span class="keyword">if</span> (mouse.leftButton.wasPressedThisFrame)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;点击鼠标左键&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//兼容多个输入</span></span><br><span class="line"><span class="keyword">if</span> (gamepad.aButton.wasPressedThisFrame || keyboard.jKey.wasPressedThisFrame)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;攻击&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="获取连接设备">获取连接设备</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//所有连接的游戏手柄</span></span><br><span class="line"><span class="keyword">var</span> all = Gamepad.all;</span><br><span class="line"><span class="keyword">var</span> allGamepad = InputSystem.devices.Select(x =&gt; x <span class="keyword">is</span> Gamepad);</span><br></pre></td></tr></table></figure><h2 id="监听设备改变事件">监听设备改变事件</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">InputSystem.onDeviceChange += (a, change) =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">switch</span> (change)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> InputDeviceChange.Added:</span><br><span class="line">            print(<span class="string">&quot;新设备加入&quot;</span> + a.name);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> InputDeviceChange.Disconnected:</span><br><span class="line">            print(a.name + <span class="string">&quot;设备断开&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> InputDeviceChange.Reconnected:</span><br><span class="line">            print(<span class="string">&quot;重新连接&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1>InputActionAsset映射</h1><blockquote><p>通过输入信号指定-&gt;输入行为</p><p>可以通过不同的输入信号 比如鼠标左右键 键盘WASD键 而这些输入信号又可以来自于不同的输入设备 比如鼠标 键盘 通过InputSystem 各种输入设备可以无缝切换。</p><p>也就是说 <strong>输入设备绑定了各种输入信号 而输入信号触发了输入动作</strong></p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220517014535.png" alt=""></p><h2 id="ActionMaps-动作表">ActionMaps(动作表)</h2><blockquote><p>动作表表示一套输入动作，可以同时拥有多个动作表，并切换使用</p></blockquote><p>注：指定动作表的<code>Scheme</code>来指定该动作表可以使用的游戏控制器</p><p><img src="http://pic.fasty97.top/NotePad/20220517021443.png" alt="image-20220517021443591"></p><p>使用多个动作表可以分离输入和动作，即使在动作表中存在一致的输入也不会冲突。</p><p>Ps：玩家控制时使用PlayerController动作表、控制UI时使用UI动作表</p><p><img src="http://pic.fasty97.top/NotePad/20220517015115.png" alt="image-20220517015113956"></p><h3 id="ActionType">ActionType</h3><p>其中Value指代各种连续变化的输入，比如鼠标移动，摇杆偏移，手柄扳机等，但这个选项只会获取当前受控制的一个设备输入。</p><p>Button则表示按钮输入，无论是鼠标按钮或是手柄按钮，其输入结果为布尔型。</p><p>PassThrough和Value基本相同，但它可以获取所有可用输入设备的输入。</p><p><img src="http://pic.fasty97.top/NotePad/20220517015834.png" alt="image-20220517015834087"></p><h3 id="ControlType">ControlType</h3><p><img src="http://pic.fasty97.top/NotePad/20220517020054.png" alt="image-20220517020054781"></p><p>生成C#类：</p><p><img src="http://pic.fasty97.top/NotePad/20220517021932.png" alt="image-20220517021932810"></p><figure class="highlight csharp"><figcaption><span>全代码控制</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameInput</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> PlayerControls playerControls;</span><br><span class="line">    <span class="keyword">private</span> Rigidbody rigidbody;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnEnable</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        playerControls?.Enable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnDisable</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        playerControls?.Disable();</span><br><span class="line">        playerControls?.Dispose();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        playerControls = <span class="keyword">new</span> PlayerControls();</span><br><span class="line">        rigidbody = GetComponent&lt;Rigidbody&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Vector2 moveDir;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        playerControls.PlayerMap.Jump.performed += (x) =&gt;</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;跃动&quot;</span>);</span><br><span class="line">            rigidbody.AddForce(Vector3.up * <span class="number">200</span>);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        playerControls.PlayerMap.Attack1.performed += (x) =&gt; &#123; print(<span class="string">&quot;攻击&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.Dpd.performed += (x) =&gt; &#123; print(<span class="string">&quot;按下上键&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.Start.performed += x =&gt; &#123; print(<span class="string">&quot;按下start&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.Select.performed += x =&gt; &#123; print(<span class="string">&quot;按下Select&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.L.performed += x =&gt; &#123; print(<span class="string">&quot;按下L&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.LShouder.performed += x =&gt; &#123; print(<span class="string">&quot;按下左肩键&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.Spell.performed += x =&gt; &#123; print(<span class="string">&quot;连按触发&quot;</span>); &#125;;</span><br><span class="line">        playerControls.PlayerMap.Spell2.performed += x =&gt; &#123; print(<span class="string">&quot;触发组合键&quot;</span>); &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        moveDir = playerControls.PlayerMap.Move.ReadValue&lt;Vector2&gt;() * Time.deltaTime * <span class="number">5</span>;</span><br><span class="line">        transform.Translate(moveDir.x, <span class="number">0</span>, moveDir.y);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/20220517044539.png" alt="image-20220517044539871"></p><h1>在移动设备中使用</h1><blockquote><p>在移动设备中，我们希望能处理操作轴和按钮两种输入事件。</p><p>在unity官方demo中，提出了相关的解决方案。</p></blockquote><h1>在UI中使用</h1><blockquote><p>经过测试在Ui中和之前的使用没啥区别，唯一就是要把EventSystem的组件更改一下。</p><p>同时之前的Ipoint系列接口也能够正常使用。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220517052201.png" alt="image-20220517052201158"></p>]]></content>
      
      
      <categories>
          
          <category> unity 新技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 输入系统 </tag>
            
            <tag> 手柄 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于科学使用Spine3.8.75</title>
      <link href="/2022/05/15/%E5%85%B3%E4%BA%8E%E7%A7%91%E5%AD%A6%E4%BD%BF%E7%94%A8Spine3.8.75/"/>
      <url>/2022/05/15/%E5%85%B3%E4%BA%8E%E7%A7%91%E5%AD%A6%E4%BD%BF%E7%94%A8Spine3.8.75/</url>
      
        <content type="html"><![CDATA[<blockquote><p>由于Spine3.8.75网络上传播太多，所以官方针对这个版本做了限制，由该版本导出的Spine动画不能在Unity中正确读取。</p></blockquote><h2 id="修改json">修改json</h2><p>在以json格式导出的动画中，可以直接编辑文件修改版本号，修改版本号后就可以被Unity正确识别了。</p><h2 id="修改二进制">修改二进制</h2><p>上面的方法虽然方便，但是处于对性能的考量，现在基本都是用二进制数据，通过测试发现，修改二进制文件的版本号同样可以正确使用。</p><p>但是修改二进制十分麻烦，使用二进制查看器去改位非常麻烦，而且在每次导出时都需要修改一次才能正确使用。于是我做了一个简单的小工具。</p><figure class="highlight csharp"><figcaption><span>核心代码</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="keyword">new</span> FileStream(path, FileMode.Open, FileAccess.ReadWrite);</span><br><span class="line"></span><br><span class="line"><span class="comment">//找到的标志位</span></span><br><span class="line">fs.Position = <span class="number">33</span>;</span><br><span class="line">fs.WriteByte(<span class="number">9</span>);</span><br><span class="line">fs.WriteByte(<span class="number">9</span>);</span><br></pre></td></tr></table></figure><p>核心代码如上，通过二进制查看器或，for循环找出需要修改的数据的位置，然后写入即可。</p><p><img src="https://pic.fasty97.top/NotePad/20220520071302.png" alt="image-20220520071302609"></p><p>使用修正器属于修正的目录，就可以自动修正二进制文件，愉快的在Unity中使用了。</p><p>Ps：此方法仅供学习交流，请大家多多支持正版。</p>]]></content>
      
      
      <categories>
          
          <category> GC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 游戏开发小工具 </tag>
            
            <tag> 自制工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>我的工具集FastyTools</title>
      <link href="/2022/05/13/%E6%88%91%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86FastyTools/"/>
      <url>/2022/05/13/%E6%88%91%E7%9A%84%E5%B7%A5%E5%85%B7%E9%9B%86FastyTools/</url>
      
        <content type="html"><![CDATA[<h2 id="写在开始">写在开始</h2><blockquote><p>此文用于简单介绍<code>FastyTools</code>工具集，详细使用情况后面有空我再写。😃</p></blockquote><p><code>FastyTools</code>是我个人一直在使用的一套Unity工具链，包含了一些Unity常用的功能封装和基础轮子，可以大大提升开发效率，我个人用起来很爽。</p><h2 id="BaseSystem">BaseSystem</h2><blockquote><p>BaseSystem是工具集的基础。</p></blockquote><p>包括以下内容：</p><ol><li>EventCenter 事件中心</li><li>MonoController 全局Mono</li><li>ObjectPool 对象池</li><li>ResLoad 资源加载</li><li>Singleton 单例</li></ol><h2 id="GamePlay">GamePlay</h2><p>包括以下内容：</p><ol><li><p>Bag 背包系统</p></li><li><p>Csv  处理Csv的相关操作</p></li><li><p>Localization 本地化</p></li><li><p>Music 音效管理系统</p></li><li><p>Save 存储系统</p></li><li><p>SceneSwitch 场景选择器</p></li><li><p>TurnSystem 回合制系统</p></li><li><p>任务链系统</p></li></ol><h2 id="Numerical">Numerical</h2><p>包括以下内容：</p><ol><li>角色数值</li><li>数据类型枚举</li><li>玩家主角数据</li><li>Skill技能系统</li><li>Buffer系统</li></ol><h2 id="InputCenter">InputCenter</h2><p>包括：</p><ol><li>玩家输入中心</li><li>Touch输入</li></ol><h2 id="AI">AI</h2><ol><li>FSM有限状态机</li><li>Astar寻路</li><li>BT行为树</li></ol><h2 id="FFGraphSystem">FFGraphSystem</h2><ol><li>Story对话</li><li>Gift天赋树</li><li>Flow流程</li></ol><h2 id="相关功能的一些展示">相关功能的一些展示</h2><h3 id="Console控制台">Console控制台</h3><p><img src="https://pic.fasty97.top/NotePad/20220713120625.png" alt="image-20220713120625197"></p><p><img src="https://pic.fasty97.top/NotePad/20220713123704.png" alt="image-20220713123704232"></p><p><img src="https://pic.fasty97.top/NotePad/20220713123741.png" alt="image-20220713123741834"></p><p><img src="https://pic.fasty97.top/NotePad/20220713123955.png" alt="image-20220713123955029"></p><p><img src="https://pic.fasty97.top/NotePad/20220713124014.png" alt="image-20220713124014087"></p><p><img src="https://pic.fasty97.top/NotePad/20220713124107.png" alt="image-20220713124107515"></p><p><img src="https://pic.fasty97.top/NotePad/20220713124120.png" alt="image-20220713124119977"></p><h3 id="可视化结点管理">可视化结点管理</h3><p><img src="https://pic.fasty97.top/NotePad/20220713114413.png" alt="image-20220713114406841"></p><p><img src="https://pic.fasty97.top/NotePad/20220713115650.png" alt="image-20220713115649893"></p><p><img src="https://pic.fasty97.top/NotePad/20220713120400.png" alt="image-20220713120400229"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>在开发互动叙事类游戏时的思考</title>
      <link href="/2022/05/02/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%BA%92%E5%8A%A8%E5%8F%99%E4%BA%8B%E7%B1%BB%E6%B8%B8%E6%88%8F%E6%97%B6%E7%9A%84%E6%80%9D%E8%80%83/"/>
      <url>/2022/05/02/%E5%9C%A8%E5%BC%80%E5%8F%91%E4%BA%92%E5%8A%A8%E5%8F%99%E4%BA%8B%E7%B1%BB%E6%B8%B8%E6%88%8F%E6%97%B6%E7%9A%84%E6%80%9D%E8%80%83/</url>
      
        <content type="html"><![CDATA[<blockquote><p>以下用于记录我在开发<code>《如果世界没有你》</code>时的一些思考</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220502031244.png" alt="image-20220502031244404"></p><p><code>《如果世界没有你》</code>是一款互动叙事类游戏，以下简称<code>没你</code>，起初我在接手时，一听伪3D的对话冒险游戏，我觉得我不是轻轻松松解决嘛，事实上在实际的游戏开发中，我还是发现了一些特殊的地方，由此文记录，以便日后自己在面对类似情况时少踩坑。</p><h2 id="策划设计方面">策划设计方面</h2><p>在这种注重游戏互动叙事的游戏中，策划设计方案显得尤为重要 ，以下从游戏性和美术学方面讨论。</p><h3 id="游戏性">游戏性</h3><blockquote><p>游戏性的重要组成是游戏的核心玩法，对于普遍的解密探索类游戏来说，通过玩家点击，找到相关线索，使用道具，推进故事。</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   玩家互动 --&gt; 寻找线索--&gt; 使用相关道具--&gt; 推进故事</span><br></pre></td></tr></table></figure><p>这是一套大家总结出来的通用的游戏流程，也是市面上最多的游戏流程。</p><p>拿第一个场景（学校）来说几个可交互地点：</p><ol><li>学校大门</li><li>猫</li><li>商店</li><li>路牌</li></ol><p>作为一个不大的场景，有4个交互点，其实并不算少，只是我们能否在有限的空间内利用出最大的效能，让玩家能够记住这个场景（除了外形之外情节上的记忆）。如果我们只是在这4个交互点显示一些暗淡冰冷的文字，玩家对于这些交互大概也不会留下什么感情，而且大概玩家在3分钟之内就会玩透这些交互并厌倦。</p><h4 id="让玩家投入更多">让玩家投入更多</h4><p>玩家可以投入什么？</p><p>不论是<code>时间</code>、<code>感情</code>、<code>精神</code>、<code>金钱</code>、… 总之得去做点什么</p><p>让我们改变这个场景的设计，让玩家给我们的游戏<code>投入</code>。</p><h4 id="让交互关联">让交互关联</h4><blockquote><p>无巧不成书，我们看书都知道，书总是围绕这那么几个角色在讲述 ，这些角色承担着剧情中不同的因素。</p></blockquote><p>游戏性的一大体现，让<code>要素相关</code>。</p><h4 id="游戏反馈">游戏反馈</h4><blockquote><p>游戏反馈作为老生常谈的话题，在任何游戏都至关重要。</p></blockquote><p>在横版过关游戏中，例如超级玛丽，使用金币为玩家建立正反馈，因为金币，游戏作者可以<code>控制</code>玩家的路线，因为金币玩家不觉得这一路往前走是跑步模拟器，也因为金币玩家愿意到一些压根不用走的道路，金币给道路赋予了意义。</p><p>现在来看这个游戏，玩家的行走的意义在于什么？对于故事谜团的好奇。</p><p>这应该是最核心最能抓住玩家的<code>意义</code>。</p><h4 id="如何设计">如何设计</h4><blockquote><p>作为游戏的第一个场景，承担了很大的责任,要交代故事，同时也要教会玩家游戏的操作方式和核心玩法。</p></blockquote><h3 id="美术学">美术学</h3><blockquote><p>美术就像是一个人的衣服，玩家的第一印象多半来自于美术。</p></blockquote><p>在项目中，使用3D模型+2D纸片的复合方式来搭建游戏场景，这样的设计并非是我们独创，例如在八方旅人中就使用了这种设计风格。</p><p><img src="http://pic.fasty97.top/NotePad/20220515010626.png" alt="image-20220515010608309"></p><p>PS🎏 :以前是因为硬件和软件的多方限制导致游戏表现，现在的游戏可以选择很多不同方面的技术来提升游戏效果，传统意义上的2D和3D游戏的界限已经变得逐渐模糊。</p><h2 id="其他">其他</h2><p>关于在游戏程序向设计和开发中的思考，请看在开发互动叙事类游戏的程序设计思考。</p>]]></content>
      
      
      <categories>
          
          <category> 开发思考 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 互动叙事 </tag>
            
            <tag> 实战项目 </tag>
            
            <tag> 解密探索 </tag>
            
            <tag> 开发总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity tip提示框闪烁</title>
      <link href="/2022/04/01/Unity%20tip%E6%8F%90%E7%A4%BA%E6%A1%86%E9%97%AA%E7%83%81/"/>
      <url>/2022/04/01/Unity%20tip%E6%8F%90%E7%A4%BA%E6%A1%86%E9%97%AA%E7%83%81/</url>
      
        <content type="html"><![CDATA[<h1>说明</h1><p>在我们制作如下的提示框时，会使用到<code>IPointerEnterHandler, IPointerExitHandler</code></p><blockquote><p>但是，会出现提示框闪烁（其实是进入离开疯狂调用）</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220401175208.png" alt="image-20220401175200980"></p><h1>解决方案</h1><ol><li>将提示框射线检测去掉（避免新生成的提示框隔断）</li><li>控制提示框的锚点远离一些</li><li>为提示框添加组件</li></ol><p><img src="http://pic.fasty97.top/NotePad/20220401175514.png" alt="image-20220401175514800"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> 坑 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022-目标和方向</title>
      <link href="/2022/03/15/2022-%E7%9B%AE%E6%A0%87%E5%92%8C%E6%96%B9%E5%90%91/"/>
      <url>/2022/03/15/2022-%E7%9B%AE%E6%A0%87%E5%92%8C%E6%96%B9%E5%90%91/</url>
      
        <content type="html"><![CDATA[<blockquote><p>此文用于计划<code>2022</code>年的目标。</p></blockquote><h2 id="🔝-总体目标">🔝 总体目标</h2><ul><li>[x] 找到一份合适工作</li><li>[ ] 购置一台4K显示器</li><li>[ ] 发布一套课程</li><li>[ ] Bili Bili 粉丝&gt;3000</li></ul><h2 id="📜-Unity技术目标">📜 Unity技术目标</h2><blockquote><p>研究新的技术配套游戏框架</p></blockquote><ul><li><p>[ ] UIElement 学习</p><ul><li>[ ] 考虑设计一套资源管理器替换Odin</li></ul></li><li><p>[x] GraphView 学习 （尝试之后考虑使用原先的xnode方式）</p><ul><li>[x] 设计一套通用的 graph 框架</li><li>[x] 移植天赋树系统</li></ul></li></ul><h3 id="Shader">Shader</h3><ul><li>[ ] shader入门精要</li></ul><h2 id="❤️美术音乐目标">❤️美术音乐目标</h2><blockquote><p>为了独立游戏梦，程序员也要学美术​音乐😄。</p><p>这个部分的目标较为不明确，会将学习成果记录在下面的各项中。</p></blockquote><h3 id="绘画">绘画</h3><blockquote><p>考虑学习像素画和板绘，角色原画，特效等</p></blockquote><h3 id="动画">动画</h3><blockquote><p>考虑学习Spine骨骼2D动画</p></blockquote><h3 id="建模">建模</h3><blockquote><p>考虑学习Blender的角色建模，简单场景的搭建</p></blockquote><h3 id="编曲">编曲</h3><blockquote><p>学习基础乐理和常用的电子乐器，目标是能编制简单的曲子。</p></blockquote><h2 id="💭-项目目标">💭 项目目标</h2><ul><li>[ ] 完善卡牌游戏</li><li>[ ] 制作一个练手塔防游戏</li></ul><h2 id="📚-读书目标">📚 读书目标</h2><blockquote><p>读一点杂书，开阔自己的视野。</p><p><code>阅读2本以上课外书</code></p></blockquote><ul><li>[ ] 追风筝的人-完成书评</li><li>[ ] 1Q84-完成书评</li><li>[x] 《游戏编程模式》</li></ul>]]></content>
      
      
      <categories>
          
          <category> 每年目标 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 总结 </tag>
            
            <tag> 目标 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity截图保存</title>
      <link href="/2022/03/07/Unity%E6%88%AA%E5%9B%BE%E4%BF%9D%E5%AD%98/"/>
      <url>/2022/03/07/Unity%E6%88%AA%E5%9B%BE%E4%BF%9D%E5%AD%98/</url>
      
        <content type="html"><![CDATA[<h2 id="说明">说明</h2><p>以下是关于一个游戏存档的设计，包括截取游戏画面，记录时间和存储数据等内容，记录一下，以备以后回顾。</p><blockquote><p>大致的效果如下，将所有存档展示出来，有截图对应，点选载入存档。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220302204934.png" alt=""></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = Application.persistentDataPath + <span class="string">&quot;/aa111.png&quot;</span>;</span><br><span class="line">print(<span class="string">$&quot;PATH:<span class="subst">&#123;path&#125;</span>&quot;</span>);</span><br><span class="line">ScreenCapture.CaptureScreenshot(path);<span class="comment">// 截图并保存截图文件</span></span><br></pre></td></tr></table></figure><blockquote><p>结合存档系统，就可以设计出如下所示的存档功能</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220302230034.gif" alt=""></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> 游戏管理器</span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameManager</span> : <span class="title">SingletonManager</span>&lt;<span class="title">GameManager</span>&gt;</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> startScene = <span class="number">1</span>;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> startLine = <span class="number">0</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> 存档系统 </tag>
            
            <tag> 截图 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>像素画-1 常用功能和快捷键</title>
      <link href="/2022/02/04/%E5%83%8F%E7%B4%A0%E7%94%BB-1%20%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E5%92%8C%E5%BF%AB%E6%8D%B7%E9%94%AE/"/>
      <url>/2022/02/04/%E5%83%8F%E7%B4%A0%E7%94%BB-1%20%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E5%92%8C%E5%BF%AB%E6%8D%B7%E9%94%AE/</url>
      
        <content type="html"><![CDATA[<h2 id="软件选择">软件选择</h2><blockquote><p>在软件选择上，对于我这种没有绘画基础的程序员来说，果断选择了轻量级的<code>Aseprite</code>。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220204122833.png" alt="image-20220204122833691"></p><h3 id="工作界面">工作界面</h3><p><img src="http://pic.fasty97.top/NotePad/20220204124222.png" alt="image-20220204124222847"></p><center>工作界面</center><p>如图可以看到工作界面，在界面上有<code>菜单栏</code>、<code>颜色选择器</code>、<code>工具栏</code>、<code>主工作区</code>和<code>动画帧图层工作区</code>几个部分组成。</p><h3 id="快捷键">快捷键</h3><table><thead><tr><th style="text-align:center">快捷按键</th><th>作用</th></tr></thead><tbody><tr><td style="text-align:center">B</td><td>画笔</td></tr><tr><td style="text-align:center">L</td><td>线条工具</td></tr><tr><td style="text-align:center">U</td><td>形状工具</td></tr><tr><td style="text-align:center">D</td><td>轮廓工具，它的功能是在你画出任意形状的轮廓之后将这个轮廓自动填充颜色。这个工具能让你快速绘制任意形状的实色物体。</td></tr><tr><td style="text-align:center">I</td><td>拾色器</td></tr><tr><td style="text-align:center">G</td><td>油漆桶</td></tr><tr><td style="text-align:center"></td><td></td></tr><tr><td style="text-align:center"></td><td></td></tr><tr><td style="text-align:center"></td><td></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 程序员也要学美术 </category>
          
          <category> 从零开始的像素画历程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 像素画 </tag>
            
            <tag> Aseprite </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity ScrollView(滑动区域)的使用</title>
      <link href="/2022/02/03/Unity%20ScrollView(%E6%BB%91%E5%8A%A8%E5%8C%BA%E5%9F%9F)%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2022/02/03/Unity%20ScrollView(%E6%BB%91%E5%8A%A8%E5%8C%BA%E5%9F%9F)%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1>前言</h1><blockquote><p>🔹ScrollView是我们经常使用的一个UI组件，但时常容易忘记具体的使用细节，故在此文予以记录。++主要用于需要滑动的区域++</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220203155850.png" alt="image-20220203155843510"></p><center>ScrollView组件如图所示</center><h1>组成部分</h1><blockquote><p>ScrollView包含Content、Scrollbar、OneValueChange三部分组成。</p></blockquote><ol><li>Content用于显示内容，通过mask遮罩来过滤大于显示区域的内容。</li><li>Scrollbar用于滚动条、</li><li>OneValueChange 用于滚动监听</li></ol><h1>使用示例</h1><p>++注意在Content中设定好大小，保证能够包裹所有子物体++</p><p>也可以添加<img src="http://pic.fasty97.top/NotePad/20220203162937.png" alt="image-20220203162937825"></p><p>制作完成效果如图所示：</p><p><img src="http://pic.fasty97.top/NotePad/20220203163135.gif" alt="ani"></p>]]></content>
      
      
      
        <tags>
            
            <tag> Unity </tag>
            
            <tag> UI组件 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021年终总结</title>
      <link href="/2022/01/17/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2022/01/17/2021%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>++2021++年不知不觉就过去了，不知道为什么，我感觉时间过得越来越快了🙂.</p><p>!!回首过去的一年里，我好像也没做什么事情!!</p><h2 id="前言">前言</h2><blockquote><p>我向来觉得对自己的生活进行阶段性记录是很有必要的，通过这种方式可以记录下很多东西，在迷茫时看看从前的自己说不定能获得什么能量吧~</p></blockquote><h2 id="关于自设框架">关于自设框架</h2><h3 id="数值系统">数值系统</h3><p>引入了数据修改器的概念，所以对于游戏的各种数据都需要分门别类的管理，特别是针对于Character的数据。</p><p><img src="http://pic.fasty97.top/NotePad/20220125114721.png" alt="数值系统"></p><h3 id="任务系统">任务系统</h3><p><img src="http://pic.fasty97.top/NotePad/20220125114810.png" alt="image-20220125114810766"></p><h3 id="buff系统">buff系统</h3><p>关于Buff系统在我的自制框架中，制作了一版实时的，在开发回合制卡牌游戏原型时，发现回合制的Buff和实时的Buff有较大差别，重新设计了一版回合制的，考虑在之后放入到自制框架中。</p><p><img src="http://pic.fasty97.top/NotePad/20220125115301.png" alt="Buffer系统"></p><h2 id="关于我开始成为Up主">关于我开始成为Up主</h2><blockquote><p>在Bilibili投稿成为偶像？哈</p></blockquote><h3 id="兴趣点">兴趣点</h3><p>大概是想要获得一些成就感来鼓励自己单调的生活吧，我开始发布一些编程相关的教程和知识分享，教别人的学习效率大概是自学的2倍吧❤️，同时也希望能够记录自己的成长。</p><h3 id="视频收益">视频收益</h3><p>哈哈哈，在制作视频的时候我是没想过能够在经济上有什么获得的，但现在b站的投稿大环境还是挺好的，各种各样的活动和推广。</p><p>在精心制作一天之后，我发出了这个教程（也是目前我最成功的一个视频😺),前后有30块左右收益，粉丝也涨了近300左右。</p><p><img src="http://pic.fasty97.top/NotePad/20220125120136.png" alt="image-20220125115931021"></p><h2 id="关于新设备">关于新设备</h2><h3 id="小米11">小米11</h3><blockquote><p>总而言之：小爱同学很好用，小米11很垃圾。</p></blockquote><h3 id="Switch">Switch</h3><blockquote><p>自PSV之后，好久没碰掌机了。</p><p>实际体验下来，掌机平台的游戏确实和PC的有很大的差距，介于硬件的差异，switch上很多游戏在画质上并比不上PC，但他们巧妙的利用掌机的特性，提供了非常多PC所不能提供的功能，例如面对面多人连接，把2台Switch靠在一起就可以进行画面的拼合，感觉很奇妙😄.</p></blockquote><h3 id="麦克风">麦克风</h3><blockquote><p>因为录制教程的关系，购置了闪客461T麦克风，但感觉还是有不小的底噪，使用obs降噪后勉强可用。</p><p>果然还是太便宜了吗😂</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20220117183236.png" alt="image-20220117183236853"></p><h3 id="数位板">数位板</h3><blockquote><p>购置了一块超便宜的高漫数位板，录制教程的时候可以画画图，自己平时也可以画画风景什么的，=不过要拿出作品可能还需要超级久吧=。</p></blockquote><h2 id="关于好剧">关于好剧</h2><h3 id="动漫">动漫</h3><ol><li><p>世界顶尖的暗杀者</p><p>优质的作画和精心设计的剧情，感觉是最近最强了吧。</p><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fi0.hdslb.com%2Fbfs%2Farticle%2F56e339f84b90d6f60980ed003311c220863fbc0f.jpg&amp;refer=http%3A%2F%2Fi0.hdslb.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1645634472&amp;t=3957a9b0aff315dff6ab3e4bec92522b" alt="img"></p></li><li><p>超智游戏</p><p>偶然发现的好番，有点像之前看过的赌博默示录系列，但主要讲的是棒球比赛中关于人性的一些猜测和打压，虽然是运动番（个人并不喜欢运动番😃)，但玩心理的感觉真的很爽！</p><p><img src="http://pic.fasty97.top/NotePad/R-C.jfif" alt=""></p></li><li><p>忧国的莫里亚蒂</p></li></ol><p>和福尔摩斯的对手戏很精彩，站在黑暗面拯救社会的感觉.</p><h3 id="电视剧">电视剧</h3><ol><li>青瓷</li><li>3年A班[日]</li><li>孤独的美食家[日]</li></ol><h2 id="关于编制">关于编制</h2><p>还有大概2次机会（几个月时间），是时候决出胜负了！🔥</p><h2 id="🚄新年祈愿">🚄新年祈愿</h2><p>在新的一年里，希望自己能够事事顺利，以下是几个小目标：</p><blockquote><p>改一改自己的拖延症，今日事今日毕</p></blockquote><ol><li>b站粉丝数&gt;8000</li><li>发布一套自己的专属课程</li><li>找到一个心仪的工作</li><li>完善FanlFrameWork的开发</li><li>…</li></ol>]]></content>
      
      
      <categories>
          
          <category> 年终总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>类杀戮尖塔-卡牌游戏原型总结</title>
      <link href="/2022/01/06/%E7%B1%BB%E6%9D%80%E6%88%AE%E5%B0%96%E5%A1%94-%E5%8D%A1%E7%89%8C%E6%B8%B8%E6%88%8F%E5%8E%9F%E5%9E%8B%E6%80%BB%E7%BB%93/"/>
      <url>/2022/01/06/%E7%B1%BB%E6%9D%80%E6%88%AE%E5%B0%96%E5%A1%94-%E5%8D%A1%E7%89%8C%E6%B8%B8%E6%88%8F%E5%8E%9F%E5%9E%8B%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<blockquote><p>现在是 2022年12月29日 16:22:06 没想到拖了整整一年才捡起这件事。</p><p>回顾整个项目，虽然完成了很多通用的模块，但这些模型也仅仅只是demo级别，尚还缺乏验证，且游戏设计思想仍然不够完整，对于游戏地图的设计也缺乏确定的解决方案。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/202212291634128.png" alt="image-20221229163422695"></p><p><img src="http://pic.fasty97.top/NotePad/202212291634235.png" alt="image-20221229163443191"></p>]]></content>
      
      
      <categories>
          
          <category> 游戏项目 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 自制项目 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C#自定义特性</title>
      <link href="/2021/12/28/C#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%89%B9%E6%80%A7/"/>
      <url>/2021/12/28/C#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>自定义特性可以用来标记一些类或类成员</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Author(<span class="string">&quot;Fasty&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span>: <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Show(<span class="keyword">typeof</span>(Test));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//用反射获取自定义特性</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>(<span class="params">Type t</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> attr = Attribute.GetCustomAttributes(t);</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> attribute <span class="keyword">in</span> attr)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (attribute <span class="keyword">is</span>  AuthorAttribute)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> a = attribute <span class="keyword">as</span> AuthorAttribute;</span><br><span class="line">                    Debug.Log(a.version);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//自定义特性</span></span><br><span class="line">    [<span class="meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AuthorAttribute</span> : <span class="title">Attribute</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">string</span> name;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">double</span> version;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AuthorAttribute</span>(<span class="params"><span class="built_in">string</span> name</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            version = <span class="number">1.0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Csharp 进阶 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（五）Shader入门</title>
      <link href="/2021/12/07/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%BA%94%EF%BC%89Shader%E5%85%A5%E9%97%A8/"/>
      <url>/2021/12/07/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%BA%94%EF%BC%89Shader%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shaderGraph常用功能释义</title>
      <link href="/2021/12/04/shaderGraph%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E9%87%8A%E4%B9%89/"/>
      <url>/2021/12/04/shaderGraph%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD%E9%87%8A%E4%B9%89/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文用于记录一些使用Shader实现的基础性效果</p><p>Unity2020.3.8f1</p></blockquote><h1>基础设置</h1><p>创建一个空Shader，可以设置Graph以满足需要。</p><p><img src="http://pic.fasty97.top/NotePad/20211204140159.png" alt="image-20211204140152535"></p><h1>顶点着色器</h1><h2 id="法线外扩">法线外扩</h2><blockquote><p>可以改变一个模型的大小</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20211204141255.png" alt="image-20211204141255134"></p><p>其中获取法线方向也可以使用：</p><p><img src="http://pic.fasty97.top/NotePad/20211204144226.png" alt="image-20211204144226426"></p><p>通过将法线位置（物体本地位置）归一化得到法线，然后乘以一个数值来实现。</p><p><img src="http://pic.fasty97.top/NotePad/20211204141734.gif" alt="112"></p><h2 id="模型裁切">模型裁切</h2><blockquote><p>原理：<code>AlphaClip</code>的值如果比<code>Alpha</code>的值大，则会不显示</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20211204153235.png" alt="image-20211204153235344"></p><p>简单效果预览：</p><p><img src="http://pic.fasty97.top/NotePad/20211204153431.gif" alt="112"></p><p>加强版本</p><p><img src="http://pic.fasty97.top/NotePad/20211207153433.png" alt="image-20211207153426670"></p><p>效果预览</p><p><img src="http://pic.fasty97.top/NotePad/20211207153856.gif" alt="112"></p><h3 id="Remap-重映射">Remap 重映射</h3><blockquote><p>根据输入In在InMinMax中的插值，计算输出。(按照比例位置输出)</p></blockquote><p>比如输入In为0，InMinMax时（-10，10），那么In在InMinMax的<br>位置就是0.5，如果OutMinMax为（0，10），那么输出Out就是5<br>公式为： Out = OutMinMax.x + (In - InMinMax.x) * (OutMinMax.y - OutMinMax.x) / (InMinMax.y -<br>InMinMax.x)</p><h3 id="One-Minus-1减去">One Minus 1减去</h3><blockquote><p>输出1-in</p></blockquote><h3 id="Step-阶梯">Step 阶梯</h3><blockquote><p>输入in大于等于 Edge取 1，否则取0</p></blockquote><h2 id="溶解">溶解</h2><blockquote><p>原理：<code>AlphaClip</code>的值如果比<code>Alpha</code>的值大，则会不显示</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20211207162307.gif" alt="112"></p><h3 id="边缘发光">边缘发光</h3><p><img src="http://pic.fasty97.top/NotePad/20211207163904.png" alt="image-20211207163904223"></p><p>效果预览</p><p><img src="http://pic.fasty97.top/NotePad/20211207164030.gif" alt="112"></p><h3 id="Subtract-减法">Subtract 减法</h3><blockquote><p>A-B</p></blockquote><h3 id="Saturate-0-1">Saturate 0-1</h3><blockquote><p>将输入控制在[0-1]</p></blockquote><h2 id="边缘发光-v2">边缘发光</h2><p><img src="http://pic.fasty97.top/NotePad/20211207165311.png" alt="image-20211207165311854"></p><h2 id="简单卡通效果">简单卡通效果</h2><p><img src="http://pic.fasty97.top/NotePad/20211207171547.png" alt="image-20211207171547100"></p><h3 id="Dot-Product-点乘">Dot Product 点乘</h3><blockquote><p>计算2个向量点乘</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20211207171656.png" alt="image-20211207171656516"></p><h2 id="表面叠加">表面叠加</h2><p><img src="http://pic.fasty97.top/NotePad/20211207173140.png" alt="image-20211207173140006"></p><p><img src="http://pic.fasty97.top/NotePad/20211207173246.gif" alt="112"></p><h3 id="Tiling-And-Offset-平铺和偏移">Tiling And Offset 平铺和偏移</h3><p>这个功能我们会经常用到，一般只要有贴图的材质上都会有Tiling And Offset。<br>将输入参数UV的值，通过Tiling和Offset改变平铺和偏移。</p><h2 id="像素化">像素化</h2><p><img src="http://pic.fasty97.top/NotePad/20211207182510.gif" alt="112"></p><h2 id="粒子消融">粒子消融</h2>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> ShaderGraph </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（四） 数学基础</title>
      <link href="/2021/12/03/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%9B%9B%EF%BC%89%20%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/"/>
      <url>/2021/12/03/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E5%9B%9B%EF%BC%89%20%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最常使用到的就是矢量和矩阵（数学的分支之一——线性代数）</p></blockquote><h1>笛卡尔坐标系</h1><blockquote><p>大部分的计算位置、距离和角度等变量都是在笛卡尔坐标系下进行的。</p></blockquote><h2 id="二维笛卡尔坐标系">二维笛卡尔坐标系</h2><ul><li>一个特殊的位置，原点，它是整个坐标系的中心</li><li>两条过原点相互垂直的矢量，x轴和y轴。</li></ul><p><img src="https://pic.fasty97.top/NotePad/20211203134502.png" alt="image-20211203134455788"></p><blockquote><p>不同的渲染方式，坐标系不同</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20211203134650.png" alt="image-20211203134650147"></p><h2 id="三维笛卡尔坐标系">三维笛卡尔坐标系</h2><ul><li>三个坐标轴相互垂直，长度为1，这样的基矢量被称为标准正交基</li><li>这三个坐标轴被称为是基矢量</li></ul><p><img src="https://pic.fasty97.top/NotePad/20211203134755.png" alt="image-20211203134755628"></p><h2 id="左手坐标系和右手坐标系">左手坐标系和右手坐标系</h2><blockquote><p>在二维笛卡尔坐标系中，我们可以通过旋转将任何的坐标系重合，也就是说所有的二维笛卡尔坐标系都是等价的。</p><p>但对于<code>三维坐标系</code>，有时不能靠这种旋转来使2个不同朝向的坐标系重合。</p></blockquote><h3 id="左手坐标系">左手坐标系</h3><p><img src="https://pic.fasty97.top/NotePad/20211203135648.png" alt="image-20211203135647988"></p><h3 id="右手坐标系">右手坐标系</h3><p><img src="https://pic.fasty97.top/NotePad/20211203135727.png" alt="image-20211203135727456"></p><h2 id="Unity的坐标系">Unity的坐标系</h2><ul><li>在模型空间和世界空间中，使用左手坐标系</li><li>观察空间，使用右手坐标系，z轴坐标的减少意味着场景深度的增加</li></ul><p><img src="https://pic.fasty97.top/NotePad/20211203140041.png" alt="image-20211203140041620"></p><h2 id="练习">练习</h2><ol><li>右手坐标系</li><li></li></ol><h1>点和矢量</h1><h1>矩阵</h1><h1>矩阵变换</h1><h1>坐标空间</h1><h1>法线变换</h1>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（三）UnityShader</title>
      <link href="/2021/11/30/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%89%EF%BC%89UnityShader/"/>
      <url>/2021/11/30/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%89%EF%BC%89UnityShader/</url>
      
        <content type="html"><![CDATA[<h1>第三章 UnityShader基础</h1><blockquote><p>正式进入shader学习了，好耶！</p></blockquote><p>使用UnityShader的流程：</p><ol><li>创建一个材质</li><li>创建一个UnityShader，为材质添加</li><li>把材质赋给对象</li><li>调整shader属性</li></ol><p><img src="https://pic.fasty97.top/NotePad/20211130223524.png" alt="image-20211130223524763"></p><h2 id="创建Shader">创建Shader</h2><p>Unity包含了多种shader模板供我们使用。</p><table><thead><tr><th>Standard Surface Shader</th><th>标准光照模型</th></tr></thead><tbody><tr><td>Unlit Shader</td><td>不包含光照（但包含雾效）</td></tr><tr><td>mage Effect Shader</td><td>实现各种屏幕后处理效果</td></tr><tr><td></td><td></td></tr></tbody></table><p>Unity Shader的导入面板还可以方便地查看其使用的渲染队列（Render queue）、是否关闭批处理（Disablebatching）、属性列表（Properties）等信息。</p><h2 id="ShaderLab">ShaderLab</h2><p>ShaderLab是Unity为我们抽象的一种shader语言，可以更方便的通用。</p><p><img src="https://pic.fasty97.top/NotePad/20211130224529.png" alt="image-20211130224529408"></p><h3 id="基本结构">基本结构</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;ShaderName&quot;&#123;</span><br><span class="line">Properties&#123;</span><br><span class="line"><span class="comment">//属性</span></span><br><span class="line">        </span><br><span class="line">        Name(&quot;display name&quot;, PropertyType)=DefaultValue</span><br><span class="line">&#125;</span><br><span class="line">SubShader&#123;</span><br><span class="line"><span class="comment">//A着色器</span></span><br><span class="line">&#125;</span><br><span class="line">SubShader&#123;</span><br><span class="line"><span class="comment">//B着色器</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Fallback &quot;VertexLit&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="属性类型">属性类型</h3><p><img src="https://pic.fasty97.top/NotePad/20211130225328.png" alt="image-20211130225328452"></p><p>根据以上属性得到的Shader放置在材质上效果：</p><p><img src="https://pic.fasty97.top/NotePad/20211201122201.png" alt="image-20211201122154053"></p><h3 id="SubShader">SubShader</h3><blockquote><p>每个Unityshader可以包含多个SubShader，<code>最少要有一个</code>。</p></blockquote><p>加载时会自动选择第一个可以执行的SubShader，如果都不支持的话，使用FallBack指定的shader。（为了解决不同显卡的差异）</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SubShader&#123;</span><br><span class="line">    <span class="comment">//可选的</span></span><br><span class="line">    [Tages]</span><br><span class="line">    <span class="comment">//可选的</span></span><br><span class="line">    [RenderSetup]</span><br><span class="line">    </span><br><span class="line">    Pass &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//other Passes</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>每个Pass定义了一次完整的渲染流程，Pass过多，性能下降。</p><h4 id="状态设置">状态设置</h4><p>在SubShader中我们可以设置渲染的一些状态。</p><p><img src="https://pic.fasty97.top/NotePad/20211201123019.png" alt="image-20211201123019333"></p><p>在SubShader中设置的状态会应用到所有的Pass，也可以在Pass中单独设置。</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Tags&#123;&quot;TagName1&quot;=&quot;Value1&quot; &quot;TagName2&quot;=&quot;CC&quot;&#125; <span class="comment">//Tags是一些str键值对</span></span><br></pre></td></tr></table></figure><h4 id="SubShader标签类型">SubShader标签类型</h4><p><img src="https://pic.fasty97.top/NotePad/20211201123359.png" alt="image-20211201123359479"></p><blockquote><p>这些标签只能在SubShader中申明不可在Pass中申明</p></blockquote><h3 id="Pass">Pass</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">    [Name]</span><br><span class="line">    [Tags]</span><br><span class="line">    [RenderSetup]</span><br><span class="line">    <span class="comment">//Other</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>可以通过Name来使用Pass，例如：</p><p><code>UsePass &quot;MyShader/PASSNAME&quot;</code></p><blockquote><p>默认Unity会将所有Pass名称转换为大写，所以使用时需要使用大写名称</p></blockquote><h4 id="Pass标签类型">Pass标签类型</h4><p><img src="https://pic.fasty97.top/NotePad/20211201124000.png" alt="image-20211201124000121"></p><ul><li><p>·UsePass：如我们之前提到的一样，可以使用该命令来复用其他Unity Shader中的Pass；</p></li><li><p>·GrabPass：该Pass负责抓取屏幕并将结果存储在一张纹理中，以用于后续的Pass处理（详见10.2.2节）。</p></li></ul><h3 id="FallBack">FallBack</h3><p>在SubShader后定义，如果上述的都不支持，用这个最低级的Shader吧！</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Fallback &quot;name&quot;</span><br><span class="line"><span class="comment">//或者</span></span><br><span class="line">Fallback off</span><br></pre></td></tr></table></figure><blockquote><p>FallBack 还会影响阴影的透射</p></blockquote><h2 id="Unity-Shader形式">Unity Shader形式</h2><p>着色器代码可以写在SubShader中（表面着色器做法），也可以写在Pass语义块中（顶点/片元着色器和固定函数着色器的做法）。</p><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;MyShader&quot;&#123;</span><br><span class="line">    Properties&#123;</span><br><span class="line">        <span class="comment">//所需的各种属性</span></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    SubShader&#123;</span><br><span class="line">        <span class="comment">//真正意义上的shader代码会放在这里</span></span><br><span class="line">        <span class="comment">//表面着色器（Surface Shader）</span></span><br><span class="line">        <span class="comment">//顶点/片元着色器（Vertex/Fragment Shader)</span></span><br><span class="line">        <span class="comment">//固定函数着色器（Fixed Function Shader）</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader&#123;</span><br><span class="line">        <span class="comment">//和上一哥SubShader类似</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="表面着色器-Surface-Shader">表面着色器(Surface Shader)</h3><blockquote><p>是Unity自己创造的一种着色器代码类型，需要的代码量少，渲染代价比较大</p></blockquote><p>在背后，任然转换为顶点片元着色器。</p><figure class="highlight glsl"><figcaption><span>简单表面着色器</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/Simple&quot;&#123;</span><br><span class="line">    SubShader&#123;</span><br><span class="line">        Tags&#123;&quot;RenderType&quot;= &quot;Opaque&quot;&#125;</span><br><span class="line">        CGPROGRAM</span><br><span class="line">        <span class="meta">#pragma suface surf lambert</span></span><br><span class="line">            struct Input&#123;</span><br><span class="line">                float4 color: COLOR;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="type">void</span> surf(Input In,<span class="keyword">in</span> <span class="keyword">out</span> SurfaceOutput o)&#123;</span><br><span class="line">            o.Albedo=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ENDCG</span><br><span class="line">    &#125;</span><br><span class="line">    Fallback &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>表面着色器不需要关心，有多少个Pass，每个Pass如何渲染</p><p>CGPROGRAM和ENDCG之间的代码是使用CG/HLSL编写的，也就是说，我们需要把CG/HLSL语言嵌套在ShaderLab语言中。</p><h3 id="顶点片元着色器（Vertex-Fragment-Shader）">顶点片元着色器（Vertex/Fragment Shader）</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/Simple VertexFragment Shader&quot;&#123;</span><br><span class="line">    SubShader&#123;</span><br><span class="line">        Pass&#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag float4 vert(float4 v: POSITION):SV_POSITION&#123;</span></span><br><span class="line">                    <span class="keyword">return</span> mul(UNITY_MATRIX_MVP,v);</span><br><span class="line">                &#125;</span><br><span class="line">            fixed4 frag():SV_Target&#123;</span><br><span class="line">                <span class="keyword">return</span> fixed4(<span class="number">1.0</span>,<span class="number">0.0</span>,<span class="number">0.0</span>,<span class="number">1.0</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>顶点/片元着色器的代码也需要定义在CGPROGRAM和ENDCG之间，但不同的是，顶点/片元着色器是写在Pass语义块内，而非SubShader内的.</p><h3 id="固定函数着色器">固定函数着色器</h3><blockquote><p>对于一些比较老旧的设备，不支持可编程管线着色器，就需要使用固定函数着色器</p></blockquote><h3 id="使用哪种形式？">使用哪种形式？</h3><ul><li>如果你想和各种光源打交道，你可能更喜欢使用表面着色器，但需要小心它在移动平台的性能表现。</li><li>如果你需要使用的光照数目非常少，例如只有一个平行光，那么使用顶点/片元着色器是一个更好的选择。</li><li>最重要的是，如果你有很多自定义的渲染效果，那么请选择顶点/片元着色器。</li></ul><blockquote><p>至此，第三章完！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity中的单例模式</title>
      <link href="/2021/10/17/Unity%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2021/10/17/Unity%E4%B8%AD%E7%9A%84%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><p>单例模式在Unity中是一种非常常用的方式，和传统单例不同，在Unity中针对不同的情况可分为以下几种方式❤️ 。</p><p><img src="http://pic.fasty97.top/NotePad/20211017134711.jpg" alt="87590528_p0"></p><h2 id="普通单例">普通单例</h2><ul><li>适用于普通的Mono类。</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">singleton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 单例</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span> : <span class="title">new</span>()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> T _instance;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_instance!=<span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> _instance;</span><br><span class="line">                &#125;</span><br><span class="line">                _instance=<span class="keyword">new</span> T();</span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="单例管理器">单例管理器</h2><ul><li>适用于继承自Mono的类。</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">singleton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 单例管理器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">SingletonManager</span>&lt;<span class="title">T</span>&gt; : <span class="title">MonoBehaviour</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> T _instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">            </span><br><span class="line">                <span class="keyword">if</span> (_instance != <span class="literal">null</span>) <span class="keyword">return</span> _instance;</span><br><span class="line">                <span class="comment">//在场景中寻找是否已经存在相同的管理器</span></span><br><span class="line">                <span class="keyword">var</span> go= GameObject.Find(<span class="keyword">typeof</span>(T) + <span class="string">&quot;&quot;</span>).GetComponent&lt;T&gt;();</span><br><span class="line">                <span class="keyword">if</span> (go!=<span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    _instance = go;</span><br><span class="line">                    <span class="keyword">return</span> _instance;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> ins = <span class="keyword">new</span> GameObject(<span class="keyword">typeof</span>(T)+<span class="string">&quot;&quot;</span>);</span><br><span class="line">                _instance = ins.AddComponent&lt;T&gt;();</span><br><span class="line">                Debug.Log(<span class="string">$&quot;创建 <span class="subst">&#123;<span class="keyword">typeof</span>(T)&#125;</span> &quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">private</span> <span class="keyword">set</span> &#123; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//防止加载场景销毁</span></span><br><span class="line">            DontDestroyOnLoad(gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="单例ScriptableObject">单例ScriptableObject</h2><ul><li>适用于ScriptableObject 单例数据存储</li><li>需要放置在Resource目录下用于读取</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">singleton</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> So单例</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">SingletonSoManager</span>&lt;<span class="title">T</span>&gt; : <span class="title">ScriptableObject</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">Object</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> T _instance;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_instance!=<span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> _instance;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> ins= Resources.FindObjectsOfTypeAll&lt;T&gt;().FirstOrDefault();</span><br><span class="line">                <span class="keyword">if</span> (!ins)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.LogError(<span class="keyword">nameof</span>(T)+<span class="string">&quot; 不存在！！&quot;</span>);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                _instance = ins;</span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Unity </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Async代替协程</title>
      <link href="/2021/10/16/Async%E4%BB%A3%E6%9B%BF%E5%8D%8F%E7%A8%8B/"/>
      <url>/2021/10/16/Async%E4%BB%A3%E6%9B%BF%E5%8D%8F%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在之前Unity想要实现延迟执行或者是等待，要么只能使用自己计数的方法，要么使用协程。</p></blockquote><h1>Ep.1 协程</h1><p>首先让我们来看一个协程示例：</p><p>示例是循环10次，每次等待0.2s。</p><figure class="highlight csharp"><figcaption><span>协程示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">IEnumerator <span class="title">Func</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(i);</span><br><span class="line">        <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">0.2f</span></span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//启动协程</span></span><br><span class="line">StartCoroutine(Func());</span><br></pre></td></tr></table></figure><h1>Ep.2 Async 异步</h1><blockquote><p>Async异步的概念是微软基于多线程提出的Task解决方案，相比传统多线程具有很多优势。</p></blockquote><ul><li>❤️相比协程来说，异步的方式不需要搭建基础的协程框架（<code>不需要新创建一个方法</code>），可以直接在方法中使用关键字实现等待。</li><li>不需要启动</li></ul><figure class="highlight csharp"><figcaption><span>Async示例</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">AsyncFunc</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(i);</span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Ep.3 解决痛点</h1><blockquote><p>其实async还有其他的优势，让我们来看看这些例子😺</p></blockquote><h2 id="协程队列">协程队列</h2><p>🌓 有时我们需要这样一种情况，需要在A执行结束后执行B，B执行结束后执行C。</p><h3 id="协程解决方案">协程解决方案</h3><p>可以看到，通用的解决方案需要创建多个协程方法，并创建一个总协程方法来为所有参与协程进行排序。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">IEnumerator <span class="title">FunAll</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="title">FunA</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="title">FunB</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="title">FunC</span>()</span>;</span><br><span class="line">    print(<span class="string">&quot;全部执行结束！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">FunA</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">1f</span></span>)</span>;</span><br><span class="line">    print(<span class="string">&quot;A执行结束！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">FunB</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">1f</span></span>)</span>;</span><br><span class="line">    print(<span class="string">&quot;B执行结束！&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">IEnumerator <span class="title">FunC</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">2f</span></span>)</span>;</span><br><span class="line">    print(<span class="string">&quot;C执行结束！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="异步解决方案">异步解决方案</h3><p>按照协程的思路我们可以这样来替换。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Run</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Fun1();</span><br><span class="line">    <span class="keyword">await</span> Fun2();</span><br><span class="line">    print(<span class="string">&quot;FunEnd&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">Fun1</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">2000</span>);</span><br><span class="line">    print(<span class="string">&quot;Fun1&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task <span class="title">Fun2</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">await</span> Task.Delay(<span class="number">2000</span>);</span><br><span class="line">    print(<span class="string">&quot;Fun2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="特殊使用">特殊使用</h2><h3 id="持续执行">持续执行</h3><p>可以使用如下的方式来持续执行一系列的动作！😏</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">async</span> Task <span class="title">Rote</span>(<span class="params"><span class="built_in">float</span> endTime, Vector3 dir</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">while</span> (Time.time &lt; endTime)</span><br><span class="line">    &#123;</span><br><span class="line">        transform.position += dir;</span><br><span class="line">        <span class="comment">//线程让步，让线程池重新排</span></span><br><span class="line">        <span class="keyword">await</span> Task.Yield();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;执行完成&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="多任务并行">多任务并行</h3><p>可以为Start方式设定异步Async</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> tasks=<span class="keyword">new</span> List&lt;Task&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//异步启动多个Task任务</span></span><br><span class="line">        tasks.Add(Fun1());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> Task.WhenAll(tasks);</span><br><span class="line">    print(<span class="string">&quot;全部执行完&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1>Ep.4 总结</h1><blockquote><p>使用这样Async方式，大大简化了协程的使用复杂度，简化了代码数量，重要的是可以将一些Task的特性使用出来。</p><p>✔️同时，Unity再也不是虚假的多线程了！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Unity 新技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 协程 </tag>
            
            <tag> Async </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>有太多要打破的东西</title>
      <link href="/2021/10/15/%E6%9C%89%E5%A4%AA%E5%A4%9A%E8%A6%81%E6%89%93%E7%A0%B4%E7%9A%84%E4%B8%9C%E8%A5%BF/"/>
      <url>/2021/10/15/%E6%9C%89%E5%A4%AA%E5%A4%9A%E8%A6%81%E6%89%93%E7%A0%B4%E7%9A%84%E4%B8%9C%E8%A5%BF/</url>
      
        <content type="html"><![CDATA[<blockquote><p>因在世界上与他人的联系，我们的存在有了价值。</p></blockquote><p>这是我很久之前，大概是在《四月是你的谎言》里听<code>薰</code>对<code>有马</code>说的话，我们享受着这份链接，也受制于这份链接。</p><p>每个人都有必须要去做的事情，可能是使命一样的东西，有的是自己给自己的，有的是被社会或环境所强压的。</p><blockquote><p>受制于这种链接，要想去打破，就像是打破规则，要挣脱太多的锁链捆绑。</p></blockquote><p>和人世分得太清楚就会孤寡。和人世走得太近则会前行受困。</p><p>如何保持一种微妙平衡已成为全面认识事物的希冀📬 。</p><blockquote><p>比起为无能为力的事而后悔，还不如去做力所能及的事！——侑子</p></blockquote><img src="http://i2.3conline.com/images/piclib/201004/27/batch/1/58767/127233758094237zw8ypjg6.jpg" alt="img" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（二）</title>
      <link href="/2021/09/10/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2021/09/10/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<blockquote><p>因为第一章内容太少，就再更一章吧~</p></blockquote><h1>第二篇 渲染流水线</h1><p>Q:渲染流水线在干什么？</p><p>A:渲染流水线的最终目的在于生成或者说是渲染一张二维纹理，即我们在电脑屏幕上看到的所有效果。它的输入是一个虚拟摄像机、一些光源、一些Shader以及纹理等。</p><p>使用流水线的好处在于可以提高单位时间的生产量。</p><p><img src="http://pic.fasty97.top/NotePad/20210911215359.png" alt="image-20210911215352715"></p><p>流水线系统中决定最后生产速度的是最慢的工序所需的时间(<code>短板效应</code>)</p><p>理想情况下，如果把一个非流水线系统分成n个流水线阶段，且每个阶段耗费时间相同的话，会使整个系统得到n倍的速度提升。（多线渲染？）</p><h2 id="渲染流程-概念上的流水线">渲染流程(概念上的流水线)</h2><blockquote><p>渲染流程分成3个阶段：应用阶段（Application Stage）、几何阶段（Geometry Stage）、光栅化阶段（Rasterizer Stage）。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210911215704.png" alt="image-20210911215704318"></p><h3 id="应用阶段">应用阶段</h3><p>这个阶段<code>是由我们的应用主导</code>的，因此通常由<code>CPU负责实现</code>。主要包含三个任务：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">准备场景数据 --&gt; 粗粒度剔除culling--&gt; 渲染图元and输出渲染所需几何信息</span><br></pre></td></tr></table></figure><h3 id="几何阶段">几何阶段</h3><p>几何阶段用于处理所有和我们要绘制的几何相关的事情。例如，决定需要绘制的图元是什么，怎样绘制它们，在哪里绘制它们。这一阶段<code>通常在GPU上</code>进行。几何阶段负责和每个渲染图元打交道，进行逐顶点、逐多边形的操作。这个阶段<code>可以进一步分成更小的流水线阶段</code>，这在下一章中会讲到。几何阶段的一个重要任务就是<code>把顶点坐标变换到屏幕空间中</code>，再交给光栅器进行处理。通过对输入的渲染图元进行多步处理后，这一阶段将会输出屏幕空间的二维顶点坐标、每个顶点对应的深度值、着色等相关信息，并传递给下一个阶段。</p><h3 id="光栅化阶段">光栅化阶段</h3><p>这一阶段将会使用上个阶段传递的数据来产生屏幕上的像素，并<code>渲染出最终的图像</code>。<code>这一阶段也是在GPU上运行</code>。光栅化的任务主要是<code>决定每个渲染图元中的哪些像素应该被绘制在屏幕上</code>。它需要对上一个阶段得到的逐顶点数据（例如纹理坐标、顶点颜色等）进行插值，然后再进行逐像素处理。和上一个阶段类似，光栅化阶段也<code>可以分成更小的流水线阶段</code>。</p><h2 id="CPU与GPU通信">CPU与GPU通信</h2><blockquote><p>真实的流水线🔨</p></blockquote><p>渲染流水线的起点是CPU，即应用阶段。应用阶段大致可分为下面3个阶段：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">把数据加载到显存中 --&gt; 设置渲染状态--&gt; 调用DrawCall</span><br></pre></td></tr></table></figure><h3 id="把数据加载到显存中">把数据加载到显存中</h3><p>数据需要从硬盘到内存再到显存，显存读取速度快！加载之后就会丢弃，为了运算，某些数据不应该被丢弃，</p><p><img src="http://pic.fasty97.top/NotePad/20210911221304.png" alt="image-20210911221304571"></p><p>因为从硬盘加载到RAM的过程是十分耗时的，故我们要编写程序指导CPU ，不要丢弃。</p><blockquote><p>9.14 继续更新啦😃</p></blockquote><h3 id="设置渲染状态">设置渲染状态</h3><blockquote><p>这些状态定义了场景中的网格是怎样被渲染的</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210914131155.png" alt="image-20210914131148894"></p><center>在同一状态下渲染3个网格。由于没有更改渲染状态，因此3个网格的外观看起来像是同一种材质的物体</center><h3 id="调用Draw-Call">调用Draw Call</h3><p>在设置好渲染状态后，就开始绘制了。<code>由CPU发起，GPU接收</code>。</p><blockquote><p>11.30 继续更新 😺</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20211130192907.png" alt="image-20211130192900305"></p><h2 id="GPU流水线">GPU流水线</h2><blockquote><p>当GPU收到渲染命令后，进行一系列流水线操作，将图元渲染到屏幕上</p></blockquote><p>GPU主要实现 几何阶段和光栅化阶段。</p><p><img src="https://pic.fasty97.top/NotePad/20211130193451.png" alt="image-20211130193451213"></p><p>其中说明如下：</p><ul><li>完全可编程控制： 顶点着色器、曲面细分着色器、几何着色器、片元着色器</li><li>可配置不可编程：逐片元、裁剪、</li><li>不可控制：屏幕映射、三角形设置、三角形遍历</li><li><code>实现为必须由开发者实现，虚线为可选</code></li></ul><h3 id="顶点着色器">顶点着色器</h3><p>完全可编程</p><blockquote><p>用于实现顶点的空间变换、顶点着色</p></blockquote><ol><li>输入来自于CPU</li><li>处理单位为顶点</li><li>不可以创建或销毁顶点、无法得到顶点之间的关系</li><li>处理速度很快</li><li>进行坐标变换和顶点光照</li><li>还可以输出后续所需要的一些数据</li></ol><p><img src="https://pic.fasty97.top/NotePad/20211130214131.png" alt="image-20211130214131052"></p><p>核心任务：**顶点坐标从<code>模型空间</code>转换到<code>齐次裁剪空间</code></p><p><img src="https://pic.fasty97.top/NotePad/20211130214642.png" alt="image-20211130214642514"></p><p>转换到齐次裁减空间后，硬件通过做透视触发得到<code>NDC（设备坐标）</code>下的坐标。</p><blockquote><p>NDC OpenGL(Unity) 范围在【-1,1】</p></blockquote><h3 id="曲面细分着色器">曲面细分着色器</h3><p>是一个可选的着色器，它用于细分图元</p><h3 id="几何着色器">几何着色器</h3><p>是一个可选的着色器，它可以被用于执行逐图元（Per-Primitive）的着色操作，或者被用于产生更多的图元</p><h3 id="裁剪">裁剪</h3><p><strong>可配置但不可编程。</strong></p><blockquote><p>这一阶段的目的是将那些不在摄像机视野内的顶点裁剪掉，并剔除某些三角图元的面片</p></blockquote><p><code>用于完成裁剪掉只有部分在摄像机范围内出现的物体。</code></p><p><img src="https://pic.fasty97.top/NotePad/20211130215204.png" alt="image-20211130215204031"></p><p>经过裁剪，会在相交处生成新的点，同时原先的旧的点（在范围外）将被删除掉。</p><h3 id="屏幕映射">屏幕映射</h3><p>输入三维坐标，二维屏幕坐标</p><blockquote><p>任务：把每个图元的X和y坐标转换到屏幕坐标系</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20211130215609.png" alt="image-20211130215609144"></p><p>在OpenGL中，原点位于左下角，在DirectX中，原点在左上角</p><p><img src="https://pic.fasty97.top/NotePad/20211130215806.png" alt="image-20211130215806421"></p><h3 id="三角形遍历">三角形遍历</h3><blockquote><p>检查每个像素是否被一个三角网格所覆盖。如果被覆盖就生成一个`片元，输出片元序列。</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20211130220052.png" alt="image-20211130220052140"></p><h3 id="片元着色器">片元着色器</h3><p>计算出颜色</p><blockquote><p>经过前面的三角形步骤，获得了一系列的数据信息，用来表述一个三角形网格式怎样覆盖到每个像素的。</p><p>输入为：顶点插值数据</p><p>输出为：一个或多个颜色</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20211130220450.png" alt="image-20211130220450027"></p><h3 id="逐片元">逐片元</h3><p>渲染流水线的最后一步❤️</p><blockquote><p>逐片元操作（Per-FragmentOperations）阶段负责执行很多重要的操作，例如<code>修改颜色</code>、<code>深度缓冲</code>、<code>进行混合等</code></p><p>用于合并数据。</p></blockquote><p>这一个阶段有如下任务：</p><ol><li>决定每个片元的可见性。这涉及了很多测试工作，例如深度测试、模板测试等。</li><li>如果一个片元通过了所有的测试，就需要把这个片元的颜色值和已经存储在颜色缓冲区中的颜色进行合并，或者说是混合。</li></ol><p><img src="https://pic.fasty97.top/NotePad/20211130220813.png" alt="image-20211130220813558"></p><p>需要通过所有的测试，才能和颜色缓冲区混合，最后写入颜色缓冲区</p><blockquote><p>这些测试用于筛选掉一些无用片元</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20211130221004.png" alt="image-20211130221004246"></p><p>当片元通过了所有测试，就会进入混合阶段</p><p><img src="https://pic.fasty97.top/NotePad/20211130221310.png" alt="image-20211130221310360"></p><p>对于透明效果需要开启混合，对于不透明物体可以选择关闭混合效果</p><blockquote><p>出于性能考虑，很多GPU会先进行测试在进行片元着色器—— Early-Z技术</p></blockquote><p>为了避免我们看到正在光栅化的图元，GPU使用<code>双重缓冲</code>，我们看到的是前置渲染结构，同时后置渲染也在工作，但后置渲染完成就会交换前后渲染的内容。</p><h1>什么是Shader?</h1><ul><li>GPU流水线上一些可高度编程的阶段，而由着色器编译出来的最终代码是会在GPU上运行的（对于固定管线的渲染来说，着色器有时等同于一些特定的渲染设置）</li><li>有一些特定类型的着色器，如顶点着色器、片元着色器等；</li></ul><blockquote><p>第二章完！</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shader入门精要（一）</title>
      <link href="/2021/09/10/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2021/09/10/Shader%E5%85%A5%E9%97%A8%E7%B2%BE%E8%A6%81%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="致自己">致自己</h2><blockquote><p>之前我学习过一段时间的Shader入门精要（大概是学到第六章吧），但后面的章节都没有学习，加上时间久远很多内容都忘记了，故打算重新学一遍。</p><p>为了勉励自己坚持下去，也为了记录一些学习过程，此系列就出现啦！</p><p>❤️ ❤️</p><p>(希望自己能够坚持学完，在渲染方面有所收获，可以制作出满意的效果)</p><p>📑 此系列每周一更</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20210910151044.png" alt="image-20210910151043222"></p><h1>第一篇 欢迎来到Shader的世界</h1><h2 id="语录">语录</h2><ul><li><p>程序员的三大浪漫是编译原理、操作系统和图形学（是的，我已经听到很多人在反驳这句话了，不要当真啦）</p></li><li><p>我们是程序员中的“外貌协会”，期待着用代码编写出一个绚丽多姿的世界。这就是我们的浪漫。</p></li><li><p>我们之所以要学习Shader，是想要学习如何把物体按照自己的意愿渲染到屏幕上，但是，Shader只是整个渲染流程中的一个子部分。</p></li><li><p>和C++这样的高级语言不同，尽管Shader的编写语言已经达到了我们可以理解的程度，但Shader更多地是面向GPU的工作方式，所以它的一些语法对我们来说并不那么直观。</p></li></ul><h2 id="基础篇大纲1-4章">基础篇大纲1-4章</h2><ol><li><code>第2章 渲染流水线</code> 这一章讲解了现代GPU是如何实现整个渲染流水线的，这些内容对于理解Shader的工作原理有着非常重要的作用。</li><li><code>第3章Unity Shader基础</code> Unity在原有的渲染流程上进行了封装，并提供给开发者新的图像编程接口——Unity Shader。这一章将讲解Unity Shader的实现原理和基本语法</li><li><code>第4章 学习Shader所需的数学基础</code> 数学向来是初学者面对的一大学习障碍。然而，在初级阶段的渲染学习中，我们需要掌握的数学理论实际并不复杂。本章将为读者讲解渲染过程中常见的数学知识，如矢量、矩阵运算、坐标空间等。</li></ol><h2 id="自我理解">自我理解</h2><p>本章主要讲述了本书的结构的内容大纲，引出了shader学习的问题。</p><p>尽管是第二次读，依然觉得有趣~</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
          <category> Shader入门精要 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shader </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeCanvas扩展</title>
      <link href="/2021/09/10/NodeCanvas%E6%89%A9%E5%B1%95/"/>
      <url>/2021/09/10/NodeCanvas%E6%89%A9%E5%B1%95/</url>
      
        <content type="html"><![CDATA[<blockquote><p>除去三大功能外，NodeCanvas还有一些别的有趣的东西，能帮助我们改进3大流程。</p></blockquote><h3 id="Standalone-Action-List">Standalone Action List</h3><p><img src="http://pic.fasty97.top/NotePad/20210910101555.png" alt="image-20210910101555501"></p><p>给对线添加如上脚本后，我们可以在对象上进行一些可视化的对话构建。</p><h3 id="自定义Action和Condition">自定义Action和Condition</h3><blockquote><p>我们可以自定义自己的节点，方便我们在3大功能上使用。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210910101826.png" alt="image-20210910101826535"></p><p>生成脚本如下：</p><figure class="highlight csharp"><figcaption><span>生成的行为</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> NodeCanvas.Framework;</span><br><span class="line"><span class="keyword">using</span> ParadoxNotion.Design;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NodeCanvas.Tasks.Actions</span>&#123;</span><br><span class="line"></span><br><span class="line">   [<span class="meta">Category(<span class="string">&quot;my&quot;</span>)</span>]</span><br><span class="line">   [<span class="meta">Description(<span class="string">&quot;输出一些内容&quot;</span>)</span>]</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Mylog</span> : <span class="title">ActionTask</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use for initialization. This is called only once in the lifetime of the task.</span></span><br><span class="line">      <span class="comment">//Return null if init was successfull. Return an error string otherwise</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">OnInit</span>()</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//This is called once each time the task is enabled.</span></span><br><span class="line">      <span class="comment">//Call EndAction() to mark the action as finished, either in success or failure.</span></span><br><span class="line">      <span class="comment">//EndAction can be called from anywhere.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnExecute</span>()</span>&#123;</span><br><span class="line">         EndAction(<span class="literal">true</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called once per frame while the action is active.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnUpdate</span>()</span>&#123;</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called when the task is disabled.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnStop</span>()</span>&#123;</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called when the task is paused.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnPause</span>()</span>&#123;</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建之后可以在Action中找到：</p><p><img src="http://pic.fasty97.top/NotePad/20210910102308.png" alt="image-20210910102308892"></p><p>条件如下：</p><figure class="highlight csharp"><figcaption><span>生成的条件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> NodeCanvas.Framework;</span><br><span class="line"><span class="keyword">using</span> ParadoxNotion.Design;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">NodeCanvas.Tasks.Conditions</span>&#123;</span><br><span class="line"></span><br><span class="line">   [<span class="meta">Category(<span class="string">&quot;my&quot;</span>)</span>]</span><br><span class="line">   [<span class="meta">Description(<span class="string">&quot;控制条件&quot;</span>)</span>]</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">myCon</span> : <span class="title">ConditionTask</span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Use for initialization. This is called only once in the lifetime of the task.</span></span><br><span class="line">      <span class="comment">//Return null if init was successfull. Return an error string otherwise</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">OnInit</span>()</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called whenever the condition gets enabled.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnEnable</span>()</span>&#123;</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called whenever the condition gets disabled.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnDisable</span>()</span>&#123;</span><br><span class="line">         </span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//Called once per frame while the condition is active.</span></span><br><span class="line">      <span class="comment">//Return whether the condition is success or failure.</span></span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="built_in">bool</span> <span class="title">OnCheck</span>()</span>&#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在图中使用：</p><p><img src="http://pic.fasty97.top/NotePad/20210910102705.png" alt="image-20210910102705181"></p><h3 id="全局黑板">全局黑板</h3><blockquote><p>可以在所有图中使用</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210910102835.png" alt="image-20210910102835494"></p><h3 id="类型管理器">类型管理器</h3><blockquote><p>用于管理添加新的数据类型</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210910103000.png" alt="image-20210910103000347"></p><h3 id="图控制台">图控制台</h3><p><img src="http://pic.fasty97.top/NotePad/20210910103100.png" alt="image-20210910103100590"></p><h3 id="结构视图">结构视图</h3><blockquote><p>可快速定位到对应节点</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210910103148.png" alt="image-20210910103148583"></p><h3 id="运行视图">运行视图</h3><p>方便在游戏运行中，显示运行的所有树</p><p><img src="http://pic.fasty97.top/NotePad/20210910103307.png" alt="image-20210910103307475"></p><h3 id="总结">总结</h3><blockquote><p>比起另一套行为树插件来说，<code>NodeCanvas</code>提供的功能比较基础，其更像是一个程序框架，因此其扩展性也更佳，通过提供的接口和程式，我们可以打造定制化的工作流，代码设计简洁有力。</p></blockquote><p>总之还是非常不错的！😏</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> NodeCanvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeCanvas之对话树</title>
      <link href="/2021/09/09/NodeCanvas%E4%B9%8B%E5%AF%B9%E8%AF%9D%E6%A0%91/"/>
      <url>/2021/09/09/NodeCanvas%E4%B9%8B%E5%AF%B9%E8%AF%9D%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h2 id="主要功能">主要功能</h2><blockquote><p>基础功能都有，具备良好的扩展性。</p></blockquote><ol><li>播放对话</li><li>对话音效</li><li>分支对话</li><li>概览对话</li><li>条件对话</li><li>…</li></ol><h2 id="快速食用">快速食用</h2><h3 id="添加脚本">添加脚本</h3><p><img src="http://pic.fasty97.top/NotePad/20210910095523.png" alt="image-20210910095523494"></p><h3 id="添加角色并给角色添加">添加角色并给角色添加</h3><p><img src="http://pic.fasty97.top/NotePad/20210910100346.png" alt="image-20210910100346800"></p><h3 id="编写对话树">编写对话树</h3><p><img src="http://pic.fasty97.top/NotePad/20210910095400.png" alt="image-20210910095352935"></p><h4 id="启动对话树">启动对话树</h4><blockquote><p><code>默认是不启动</code>对话树的，可以在代码中控制启动也可以在属性面板设置游戏开始时启动。</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> DialogueTreeController dialogueTreeController;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.X))</span><br><span class="line">    &#123;</span><br><span class="line">        dialogueTreeController.StartBehaviour();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>为了保证对话正确显示，在UI层需要添加官方的预制体和事件系统监听</p><p><img src="http://pic.fasty97.top/NotePad/20210910100905.png" alt="image-20210910100905937"></p><h2 id="存在的问题待学习">存在的问题待学习</h2><ol><li><p>❓NodeCanvas的对话树似乎 在显示富文本内容时存在问题。例如使用颜色代码，会出现输出颜色代码之后再实现效果的问题</p></li><li><p>❓ 其配置的UI显示界面不清楚是如何进行绑定的</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> NodeCanvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeCanvas之FSM有限状态机</title>
      <link href="/2021/09/08/NodeCanvas%E4%B9%8BFSM%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/"/>
      <url>/2021/09/08/NodeCanvas%E4%B9%8BFSM%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<blockquote><p>FSM有限状态机是一种设计方式，用于处理不同状态的切换</p><p>其主要包含以下几个部分：</p><ol><li>状态（进入、更新、离开）</li><li>过渡条件 【<code>用于控制状态的切换</code>】</li><li>状态机控制器【<code>用于控制状态机</code>】</li></ol></blockquote><p>本文主要介绍<code>NodeCanvas</code>的FSM使用，具体基础FSM概念不做解释。</p><p><img src="http://pic.fasty97.top/NotePad/20210908225324.png" alt="image-20210908225324425"></p><center>FSM示例图</center><h2 id="开始">开始</h2><p>为游戏对象添加如下脚本：</p><p><img src="http://pic.fasty97.top/NotePad/20210909125307.png" alt="image-20210909125300176"></p><h2 id="结点类型">结点类型</h2><p>NodeCanvas中结点分为几个类型：</p><ol><li>Action State（动作状态，只处理进入状态）</li><li>Super Action State （超级动作状态，能处理进入、更新、离开状态）</li><li>Pass（过渡态，不做任何处理）</li><li>Parallel（并行。 在状态机处于任意状态时，并行执行）</li><li>Any State（能够从任意状态进行状态切换，在状态机过程中，时刻监听）</li></ol><h2 id="结语">结语</h2><p>在FSM中，也没什么太多可以讲的，其条件和行为结点为<code>NodeCanvas</code>行为树、状态机、对话树所共用。</p><blockquote><p>个人感觉，NodeCanvas设计最棒的一点就是，他三种系统用的同一个底层，而且可以互相嵌套兼容。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> NodeCanvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Tool </tag>
            
            <tag> FSM </tag>
            
            <tag> 状态机 </tag>
            
            <tag> 有限状态机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spine初体验</title>
      <link href="/2021/09/08/Spine%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2021/09/08/Spine%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p><code>Spine</code> 是市面上流行的2D动画解决方案，其支持2D图片制作动画。</p><p>考虑到之后我要学习一下绘画，那就必须得学习一下Spine咯，此文用于记录一些学习过程😄 。</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20210908121220.png" alt="image-20210908121213419"></p><h2 id="制作流程">制作流程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">创建项目 --&gt; 导入图片 --&gt; 装配图片--&gt; 创建骨骼--&gt; 将图片和骨骼进行匹配--&gt;制作动画--&gt; 导出</span><br></pre></td></tr></table></figure><h2 id="设置模式（装配模式）式">设置模式（装配模式）式</h2><p><img src="http://pic.fasty97.top/NotePad/20210908124518.png" alt="image-20210908124518412"></p><blockquote><p>在此模式下操作骨骼时，注意将骨骼进行<code>合理命名</code>，方便后续动画制作。</p></blockquote><h2 id="动画模式">动画模式</h2><p><img src="http://pic.fasty97.top/NotePad/20210908124815.png" alt="image-20210908124815902"></p><h3 id="动画曲线">动画曲线</h3><p>动画曲线用于控制两个关键帧之间的动画变化方式。</p><p><img src="http://pic.fasty97.top/NotePad/20210908125000.png" alt="image-20210908125000724"></p><h2 id="简单动画效果预览">简单动画效果预览</h2><p><img src="http://pic.fasty97.top/NotePad/20210908125252.gif" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 游戏美术 </category>
          
          <category> Spine </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spine </tag>
            
            <tag> 2D </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NodeCanvas之行为树</title>
      <link href="/2021/09/04/NodeCanvas%E4%B9%8B%E8%A1%8C%E4%B8%BA%E6%A0%91/"/>
      <url>/2021/09/04/NodeCanvas%E4%B9%8B%E8%A1%8C%E4%B8%BA%E6%A0%91/</url>
      
        <content type="html"><![CDATA[<h2 id="认识行为树">认识行为树</h2><ol><li>什么是行为树？<br>自顶向下的树形结构</li></ol><p>行为树Behavior Tree 是一种数据结构，自顶向下的树形结构。</p><ol start="2"><li>什么情况下要使用行为树？<br>情况多变，条件复杂</li></ol><p>在处理逻辑复杂的问题时，这个复杂可能是条件复杂，情况多样。</p><p>行为树并非是游戏Ai的专属，在处理其他复杂业务逻辑或可能时都可以尝试用行为树来解决。</p><ol start="3"><li>行为树有什么优点？<br>高效可读，易于扩展</li></ol><p>行为树解决的问题是将复杂的关系，简单化，能很大程度的加强程序的可读性，健壮性。</p><ol start="4"><li><p>行为树由哪几部分组成？<br>主要由四部分  CDAC 组成 ，两根两叶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Composites  组合节点    只能作为根节点，控制子节点的执行（顺序）</span><br><span class="line">Decorator 装饰节点         只能作为根节点，修饰子节点</span><br><span class="line">Actions     行为节点         只能作为叶子节点，执行具体动作</span><br><span class="line">Conditinals 条件节点       只能作为叶子节点，判断条件</span><br></pre></td></tr></table></figure><ol start="5"><li>行为树的工作流程？<br>自顶向下，从左至右（并发进行），逐层进行</li></ol></li></ol><blockquote><p>行为树执行的成果（成功/失败），由其子节点决定，子节点执行完成后会向父节点传递成功/失败的消息，<br>最终这些来自各个子枝的消息汇聚到行为树，行为树将结果整合得到行为树的最终执行结果。<br>其最终结果：同真为真，一假则假</p></blockquote><h2 id="关于NodeCanvas">关于NodeCanvas</h2><blockquote><p><code>NodeCanvas</code>是一个集成了:</p><ul><li>行为树</li><li>对话树</li><li>FSM有限状态机</li></ul><p>的可视化 开发工具。</p></blockquote><h2 id="快速开始">快速开始</h2><h3 id="准备">准备</h3><p>准备一个角色，1.  配置好动画控制器，2. 进行NaveMesh的网格烘焙。</p><p><img src="https://pic.fasty97.top/NotePad/20210904203556.png" alt="Aa"></p><p>添加上以下组件:</p><p><img src="https://pic.fasty97.top/NotePad/20210904203733.png" alt="image-20210904203733291"></p><h3 id="创建行为树">创建行为树</h3><p>可以看到由两个部分组成</p><p><img src="https://pic.fasty97.top/NotePad/20210904204124.png" alt="image-20210904204124080"></p><h4 id="数据黑板">数据黑板</h4><blockquote><p>“黑板”（Blackboard）在人工智能领域已经是一个很古老的东西了，它基于一种很直观的概念，就是一群人为了解决一个问题，在黑板前聚集，每个人都可以发表自己的意见，然后在黑板上写下自己的看法，当然你也可以基于别人记录在黑板上的看法，来发表和更新自己的看法，在这样不断的意见交换，看法更新的过程中，越来越趋向于对于问题的最终解答。一开始的黑板系统就是这样一个由多个子系统来共同协作的人工智能解决方案。</p></blockquote><p>可参考: <a href="http://www.aisharing.com/archives/801">http://www.aisharing.com/archives/801</a></p><p><code>在NodeCanvas里，我们可以把需要共享点数据放在黑板里，在多个行为树中共享。</code></p><h4 id="操作窗口">操作窗口</h4><p><img src="https://pic.fasty97.top/NotePad/20210904204714.png" alt="image-20210904204714062"></p><p>左上可以导入导出，右上是黑板数据。</p><p>可以添加不同类型点节点，<code>行为树一般从流程节点开始</code>。</p><p><img src="https://pic.fasty97.top/NotePad/20210904204908.png" alt="image-20210904204908578"></p><h4 id="基本流程">基本流程</h4><ol><li><p>Sequencer 依次执行直到失败</p><p><img src="https://pic.fasty97.top/NotePad/20210904205615.png" alt="image-20210904205615378"></p><p><img src="https://pic.fasty97.top/NotePad/20210904205615.png" alt=""><br>完成效果如下:<br><img src="https://pic.fasty97.top/NotePad/20210904210007.gif" alt=""></p></li><li><p>Selector 依次执行直到成功</p></li></ol><p><img src="https://pic.fasty97.top/NotePad/20210904210501.png" alt="image-20210904210501209"></p><ol start="3"><li>Parallel  并行执行</li></ol><p><img src="https://pic.fasty97.top/NotePad/20210904210629.png" alt="image-20210904210629825">其中，可以结束配置参数：</p><p>第一次成功、第一次失败、第一次成功或失败。</p><p><img src="https://pic.fasty97.top/NotePad/20210904211016.png" alt="image-20210904211016371"></p><h2 id="完成的行为树">完成的行为树</h2><blockquote><p>包含攻击、追逐、徘徊、巡逻几个状态</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20210905162014.png" alt="image-20210905162014408"></p><h3 id="节点介绍">节点介绍</h3><p><a href="https://www.jianshu.com/p/a12470577fd0">NodeCanvas——行为树节点介绍 - 简书 (jianshu.com)</a></p><h2 id="扩展-分层行为树">扩展-分层行为树</h2><p>参考：<a href="https://blog.csdn.net/weixin_41624024/article/details/80879294">分层机制 - 复杂行为树的行为控制_一生做游戏-CSDN博客_复杂行为树</a></p><h2 id="综合参考">综合参考</h2><p><img src="https://pic.fasty97.top/NotePad/20210905122921.png" alt="image-20210905122914367"></p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> NodeCanvas </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unity Tool </tag>
            
            <tag> 行为树 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VFXGraph体验-火花效果</title>
      <link href="/2021/07/26/VFXGraph%E4%BD%93%E9%AA%8C-%E7%81%AB%E8%8A%B1%E6%95%88%E6%9E%9C/"/>
      <url>/2021/07/26/VFXGraph%E4%BD%93%E9%AA%8C-%E7%81%AB%E8%8A%B1%E6%95%88%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文采用：unity2021.1.5f1c1 HDRP渲染管线</p></blockquote><h1>开始</h1><p>创建HDRP项目，并设置好相关配置。</p><p><img src="http://pic.fasty97.top/NotePad/20210726143925.png" alt="image-20210726143918376"></p><p>搭建的场景如图所示：</p><p><img src="http://pic.fasty97.top/NotePad/20210726144023.png" alt="image-20210726144023543"></p><h1>🔸认识VFX Graph</h1><p>创建一个VFX Graph可以点击Edit进入编辑界面，其编辑界面和ShaderGraph类似。</p><p><img src="http://pic.fasty97.top/NotePad/20210726144442.png" alt="image-20210726144442857"></p><h1>🔹 编写Graph</h1><h2 id="孵化器循环">孵化器循环</h2><blockquote><p>针对于持续性和非持续性进行区分</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210726144914.png" alt="image-20210726144914494"></p><h2 id="初始化粒子">初始化粒子</h2><p><img src="http://pic.fasty97.top/NotePad/20210726150137.png" alt="image-20210726150137280"></p><blockquote><p>完成上述2个步骤时，效果如下，记得替换粒子的贴图</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210726145903.gif" alt=""></p><h2 id="渲染粒子">渲染粒子</h2><p><img src="http://pic.fasty97.top/NotePad/20210726230116.png" alt="image-20210726230116859"></p><blockquote><p>通过渲染器设置，火花效果更好了</p></blockquote><p><img src="https://pic.fasty97.top/NotePad/20210726230231.gif" alt="效果"></p><h2 id="更新粒子-使用重力">更新粒子-使用重力</h2><p>现在我们的火花是直线发射的，我们想让其受到一个重力自动下垂。</p><p>在更新粒子模块，增加重力，设置一个随机数重力。</p><p><img src="http://pic.fasty97.top/NotePad/20210726230856.png" alt="image-20210726230856799"></p><blockquote><p>添加重力后，可以看到我们的粒子受重力而下垂。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210726231034.gif" alt=""></p><h1>❤️完善火花</h1><h2 id="发射形状">发射形状</h2><p><img src="http://pic.fasty97.top/NotePad/20210726233034.png" alt="image-20210726233034173"></p><h2 id="Local和World坐标">Local和World坐标</h2><p><img src="http://pic.fasty97.top/NotePad/20210726233115.png" alt="image-20210726233115448"></p><blockquote><p>在布局坐标中，粒子效果不会残留，为了让我们的火花可以在世界中残留，需该为世界坐标系</p></blockquote><h1>添加碰撞</h1><blockquote><p>我们希望火花粒子能够和周围环境产生碰撞</p></blockquote><h2 id="碰撞框">碰撞框</h2><p>添加如下碰撞框组件：</p><p>其中：<code>LifeTime Loss为生命损失</code></p><p><img src="http://pic.fasty97.top/NotePad/20210729201759.png" alt="image-20210729201752721"></p><p>发现我们的粒子在接触碰撞框时会被弹开。</p><p><img src="http://pic.fasty97.top/NotePad/20210729201835.gif" alt=""></p><h2 id="碰撞事件">碰撞事件</h2><blockquote><p>为了响应碰撞添加如下组件</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210729202054.png" alt="碰撞响应"></p><p><img src="http://pic.fasty97.top/NotePad/20210729202141.png" alt="事件处理"></p><blockquote><p>其效果如下，每个粒子碰撞死亡后将生产1个蓝色粒子</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210729202653.gif" alt=""></p><h1>完善和脚本控制</h1><p>调整一下粒子，将循环关闭，使用脚本控制粒子。</p><figure class="highlight csharp"><figcaption><span>脚本控制VFX</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">VFXTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> GameObject vfx;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> go = Instantiate(vfx, transform.position, Quaternion.identity);</span><br><span class="line">            <span class="keyword">var</span> vf = go.GetComponent&lt;VisualEffect&gt;();</span><br><span class="line">            vf.Play();</span><br><span class="line">            Destroy(go, <span class="number">2f</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>其效果如下图所示，按下A自动生成一个特效</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210729205458.gif" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ASE体验-菲涅尔效果</title>
      <link href="/2021/07/20/ASE%E4%BD%93%E9%AA%8C-%E8%8F%B2%E6%B6%85%E5%B0%94%E6%95%88%E6%9E%9C/"/>
      <url>/2021/07/20/ASE%E4%BD%93%E9%AA%8C-%E8%8F%B2%E6%B6%85%E5%B0%94%E6%95%88%E6%9E%9C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>体验一下ASE插件</p></blockquote><h3 id="体验">体验</h3><p>创建一个ASE Suface shader，依图连接节点。<img src="https://pic.fasty97.top/NotePad/20210720212833.png" alt="image-20210720212826746"></p><p>效果如下：</p><p><img src="http://pic.fasty97.top/NotePad/20210720213139.gif" alt=""></p><h3 id="感受">感受</h3><blockquote><p>整体感受ASE插件，在某些方面确实强于ShaderGraph ，例如可以直接在默认渲染管线中使用。</p><p>总之，用起来挺爽的。😄</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Unity 新技术HDRP</title>
      <link href="/2021/06/08/Unity%20%E6%96%B0%E6%8A%80%E6%9C%AFHDRP/"/>
      <url>/2021/06/08/Unity%20%E6%96%B0%E6%8A%80%E6%9C%AFHDRP/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本系列基于Unity2021.1.5f1c1</p></blockquote><h2 id="安装HDRP">安装HDRP</h2><p>在管理器安装hdrp后会自动弹出此初始化对话框。</p><p><img src="http://pic.fasty97.top/NotePad/20210608121937.png" alt="image-20210608121930293"></p><p>根据对话框检测的步骤，将需要修正的地方进行修正。</p><blockquote><p>修正后全部呈现绿√。</p></blockquote><p>修正完成，系统自动添加了如下包。</p><p><img src="http://pic.fasty97.top/NotePad/20210608122232.png" alt="image-20210608122232513"></p><h3 id="添加天空盒子">添加天空盒子</h3><p>在Volume组件中添加如下组件，可以设置天空盒。</p><p><img src="http://pic.fasty97.top/NotePad/20210730125729.png" alt="image-20210730125722895"></p><h3 id="调节光线亮度">调节光线亮度</h3><p>在Volume组件中添加如下组件，可以设置调节光线。</p><p><img src="http://pic.fasty97.top/NotePad/20210730125833.png" alt="image-20210730125833770"></p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Unity 新技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
            <tag> HDRP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>走进UE2-使用动画模型</title>
      <link href="/2021/06/07/%E8%B5%B0%E8%BF%9BUE2-%E4%BD%BF%E7%94%A8%E5%8A%A8%E7%94%BB%E6%A8%A1%E5%9E%8B/"/>
      <url>/2021/06/07/%E8%B5%B0%E8%BF%9BUE2-%E4%BD%BF%E7%94%A8%E5%8A%A8%E7%94%BB%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>上一节中，我们熟悉了Ue的基本操作并编写简单蓝图控制了一个椅子的移动，这一节我们来进一步完善我们的主角~</p></blockquote><h1>导入资源</h1><p>首先我们选择一个人物模型导入。</p><p>删除原先的静态网格椅子模型，在Mesh中选择导入的模型Skeletal Mesh。</p><p><img src="http://pic.fasty97.top/NotePad/20210607103237.png" alt="image-20210607103237589"></p><p>可以看到我们的角色替换成了模型：</p><p><img src="http://pic.fasty97.top/NotePad/20210607103417.png" alt="image-20210607103416955"></p>]]></content>
      
      
      <categories>
          
          <category> 走进UE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UE4 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>走进UE1-进入UE世界</title>
      <link href="/2021/06/02/%E8%B5%B0%E8%BF%9BUE1-%E8%BF%9B%E5%85%A5UE%E4%B8%96%E7%95%8C/"/>
      <url>/2021/06/02/%E8%B5%B0%E8%BF%9BUE1-%E8%BF%9B%E5%85%A5UE%E4%B8%96%E7%95%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>UE4 每个月送免费资源，实在是太香了。 😄</p></blockquote><p>所以本系列是一个进入UE4学习过程的记录。</p><h1>参考文档</h1><ol><li>官方文档： <a href="https://docs.unrealengine.com/4.26/zh-CN/Basics/Actors">https://docs.unrealengine.com/4.26/zh-CN/Basics/Actors</a></li></ol><h1>前置准备</h1><p>首先下载EPIC，使用EPIC下载UE4，这里使用的是4.26.2。</p><h2 id="设置语言为中文">设置语言为中文</h2><p>编辑器默认是英文的，可以根据需要设置为中文。</p><p><img src="http://pic.fasty97.top/NotePad/20210602170135.png" alt="image-20210602170135583"></p><p><img src="http://pic.fasty97.top/NotePad/20210602170203.png" alt="设置中文"></p><h1>基础概念介绍</h1><h2 id="界面布局">界面布局</h2><p>基础的界面布局如下图所示。</p><p><img src="http://pic.fasty97.top/NotePad/20210602170639.png" alt="image-20210602170639546"></p><h2 id="Player-Start-玩家出生点">Player Start 玩家出生点</h2><p>Player Start 为玩家的出生点（起点），游戏开始时，玩家从这里开始。</p><h2 id="游戏模式">游戏模式</h2><blockquote><p>游戏模式是游戏的基本设定，每一个游戏都必须有一个游戏模式设置。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210604194800.png" alt="image-20210604194752974"></p><blockquote><p>默认Pawn类选择游戏角色。</p></blockquote><p>需要在世界场景设置中设置当前需要使用的游戏模式。</p><p><img src="http://pic.fasty97.top/NotePad/20210604195146.png" alt="image-20210604195146023"></p><center>世界场景设置</center><h2 id="项目输入设置">项目输入设置</h2><blockquote><p>为了映射按键操作我们需要在项目设置中进行按键映射。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210604195720.png" alt="image-20210604195719983"></p><h2 id="设定角色使其移动">设定角色使其移动</h2><h3 id="设定物件">设定物件</h3><p>首先需要设置，角色的静态网格（决定呈现内容），设置摄像机（用于拍摄游戏角色）。</p><p><img src="http://pic.fasty97.top/NotePad/20210604203512.png" alt="image-20210604203512863"></p><p><img src="http://pic.fasty97.top/NotePad/20210604203525.png" alt="image-20210604203525271"></p><h3 id="设定角色行为蓝图">设定角色行为蓝图</h3><blockquote><p>通过蓝图我们来进行角色行为设置</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210604204643.png" alt="image-20210604204643632"></p><center>前后左右移动基本蓝图</center><p>角色旋转值设定</p><p><img src="http://pic.fasty97.top/NotePad/20210604205720.png" alt="image-20210604205720790"></p><p>上下旋转设定</p><p><img src="http://pic.fasty97.top/NotePad/20210606143318.png" alt=""></p><blockquote><p>效果测试如下</p></blockquote><p><video src="http://pic.fasty97.top/UE1.mp4" controls="controls"></video></p>]]></content>
      
      
      <categories>
          
          <category> 走进UE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UE4 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Blazor初体验</title>
      <link href="/2021/04/05/Blazor%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2021/04/05/Blazor%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用Blazor 来实现前后端统一使用C#开发，用C#写前端，想想就刺激😃</p></blockquote><h2 id="什么是Blazor">什么是Blazor</h2><p>Blazor 是一个使用 <a href="https://docs.microsoft.com/zh-cn/dotnet/standard/tour">.NET</a> 生成交互式客户端 Web UI 的框架：</p><ul><li>使用 <a href="https://docs.microsoft.com/zh-cn/dotnet/csharp/">C#</a> 代替 <a href="https://www.javascript.com/">JavaScript</a> 来创建信息丰富的交互式 UI。</li><li>共享使用 .NET 编写的服务器端和客户端应用逻辑。</li><li>将 UI 呈现为 HTML 和 CSS，以支持众多浏览器，其中包括移动浏览器。</li><li>与新式托管平台（如 <a href="https://docs.microsoft.com/zh-cn/dotnet/standard/microservices-architecture/container-docker-introduction/index">Docker</a>）集成。</li></ul><p>使用 .NET 进行客户端 Web 开发可提供以下优势：</p><ul><li>使用 C# 代替 JavaScript 来编写代码。</li><li>利用现有的 <a href="https://docs.microsoft.com/zh-cn/dotnet/standard/class-libraries">.NET 库</a>生态系统。</li><li>在服务器和客户端之间共享应用逻辑。</li><li>受益于 .NET 的性能、可靠性和安全性。</li><li>在 Windows、Linux 和 macOS 上使用 <a href="https://visualstudio.microsoft.com/">Visual Studio</a> 保持高效工作。</li><li>以一组稳定、功能丰富且易用的通用语言、框架和工具为基础来进行生成</li></ul><blockquote><p>Blazor应用基于组件。 Blazor 中的组件是指 UI 元素，例如页面、对话框或数据输入窗体。</p></blockquote><p>组件是内置到 <a href="https://docs.microsoft.com/zh-cn/dotnet/standard/assembly/">.NET 程序集</a>的 .NET C# 类，它们用于：</p><ul><li>定义灵活的 UI 呈现逻辑。</li><li>处理用户事件。</li><li>可以嵌套和重用。</li><li>可作为 <a href="https://docs.microsoft.com/zh-cn/aspnet/core/razor-pages/ui-class?view=aspnetcore-5.0">Razor 类库</a>或 <a href="https://docs.microsoft.com/zh-cn/nuget/what-is-nuget">NuGet 包</a>共享和分发。</li></ul><h2 id="创建项目">创建项目</h2><blockquote><p>此文使用 vs2019 .net core 3.1</p></blockquote><p><code>这里我从空项目开始创建。</code></p><p><img src="http://pic.fasty97.top/NotePad/20210406092431.png" alt="image-20210406092424290"></p><h2 id="配置项目">配置项目</h2><h3 id="配置Starup">配置Starup</h3><figure class="highlight csharp"><figcaption><span>ConfigureServices</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ConfigureServices</span>(<span class="params">IServiceCollection services</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//启用RazorPage</span></span><br><span class="line">    services.AddRazorPages();</span><br><span class="line">    <span class="comment">//启用服务端Blazor</span></span><br><span class="line">    services.AddServerSideBlazor();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>Configure</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Configure</span>(<span class="params">IApplicationBuilder app, IWebHostEnvironment env</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (env.IsDevelopment())</span><br><span class="line">            &#123;</span><br><span class="line">                app.UseDeveloperExceptionPage();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//启用静态文件</span></span><br><span class="line">            app.UseStaticFiles();</span><br><span class="line">            <span class="comment">//启用路由</span></span><br><span class="line">            app.UseRouting();</span><br><span class="line">            <span class="comment">//启用终端节点</span></span><br><span class="line">            app.UseEndpoints(endpoints =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//配置实时连接SinglR</span></span><br><span class="line">                endpoints.MapBlazorHub();</span><br><span class="line">                <span class="comment">//配置Blazor的主页</span></span><br><span class="line">                endpoints.MapFallbackToPage(<span class="string">&quot;_Host&quot;</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h3 id="配置通用依赖项">配置通用依赖项</h3><p>创建_Imports.razor 文件加入内容</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@using System.Net.Http</span><br><span class="line">@using Microsoft.AspNetCore.Authorization</span><br><span class="line">@using Microsoft.AspNetCore.Components.Authorization</span><br><span class="line">@using Microsoft.AspNetCore.Components.Forms</span><br><span class="line">@using Microsoft.AspNetCore.Components.Routing</span><br><span class="line">@using Microsoft.AspNetCore.Components.Web</span><br><span class="line">@using Microsoft.JSInterop</span><br><span class="line">@using BlazorAppGo</span><br><span class="line">@using BlazorAppGo.Shared</span><br></pre></td></tr></table></figure><h3 id="书写-Host主页">书写_Host主页</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@page &quot;/&quot;</span><br><span class="line">@namespace BlazorAppGo.Pages</span><br><span class="line">@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers</span><br><span class="line">@&#123;</span><br><span class="line">    Layout = null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>BlazorAppGo<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;~/&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/bootstrap/bootstrap.min.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/site.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">app</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">component</span> <span class="attr">type</span>=<span class="string">&quot;typeof(App)&quot;</span> <span class="attr">render-mode</span>=<span class="string">&quot;ServerPrerendered&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">app</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;blazor-error-ui&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">include</span>=<span class="string">&quot;Staging,Production&quot;</span>&gt;</span></span><br><span class="line">            An error has occurred. This application may no longer respond until reloaded.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">include</span>=<span class="string">&quot;Development&quot;</span>&gt;</span></span><br><span class="line">            An unhandled exception has occurred. See browser dev tools for details.</span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;reload&quot;</span>&gt;</span>Reload<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;dismiss&quot;</span>&gt;</span>🗙<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;_framework/blazor.server.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Razor-页面">Razor 页面</h2><p>在Blazor中，每一个页面以.cshtml结尾，页面可以绑定一个模型类用户数据操作。</p><h2 id="Rezor布局">Rezor布局</h2><p>在Blazor中，在Shared文件夹下书写布局和通用组件。创建.razor结尾的文件写入如下文件。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@inherits LayoutComponentBase</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;sidebar&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NavMenu</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;top-row px-4&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://docs.microsoft.com/aspnet/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;content px-4&quot;</span>&gt;</span></span><br><span class="line">        @Body</span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>在布局文件中，使用@inherits LayoutComponentBase 来继承自LayoutComponentBase 标注为布局文件</p></blockquote><h3 id="App-razor">App.razor</h3><blockquote><p>创建App.razor文件用于配置路由情况和默认布局</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">AppAssembly</span>=<span class="string">&quot;@typeof(Program).Assembly&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Found</span> <span class="attr">Context</span>=<span class="string">&quot;routeData&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">RouteView</span> <span class="attr">RouteData</span>=<span class="string">&quot;@routeData&quot;</span> <span class="attr">DefaultLayout</span>=<span class="string">&quot;@typeof(MainLayout)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Found</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">NotFound</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">LayoutView</span> <span class="attr">Layout</span>=<span class="string">&quot;@typeof(MainLayout)&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Sorry, there&#x27;s nothing at this address.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">LayoutView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">NotFound</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Razor-组件">Razor 组件</h2><blockquote><p>创建.razor结尾的文件作为Razaor组件，组件可以在其他页面或组件中复用</p></blockquote><p>直接使用&lt;组件名称&gt;当作html元素使用即可。</p><h2 id="CURD小例子">CURD小例子</h2><h3 id="EF连接Sqlite">EF连接Sqlite</h3><blockquote><p>在数据库连接上，这里我使用比较简单的sqlite</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210406154848.png" alt="image-20210406154848381"></p><center>安装相关包</center><h4 id="实体配置">实体配置</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BlazorAppGo.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AppDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;User&gt; Users &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AppDbContext</span>(<span class="params">DbContextOptions&lt;AppDbContext&gt; options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnConfiguring</span>(<span class="params">DbContextOptionsBuilder optionsBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnConfiguring(optionsBuilder);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="注入">注入</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">services.AddDbContext&lt;AppDbContext&gt;(options =&gt; options.UseSqlite(Configuration.GetConnectionString(<span class="string">&quot;sqlite&quot;</span>)));</span><br></pre></td></tr></table></figure><h4 id="appsetting">appsetting</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//连接字符串</span></span><br><span class="line"> <span class="attr">&quot;ConnectionStrings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;sqlite&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Data Source=./myData.db&quot;</span></span><br><span class="line"> <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h4 id="service">service</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> BlazorAppGo.Models;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">BlazorAppGo.Services</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserService</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> AppDbContext dbContext;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">UserService</span>(<span class="params">AppDbContext dbContext</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.dbContext = dbContext;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">User user</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            dbContext.AddAsync(user);</span><br><span class="line">            dbContext.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"><span class="built_in">int</span> id, User data</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> user = dbContext.Users.FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">            user.Name = data.Name;</span><br><span class="line">            dbContext.Update(user);</span><br><span class="line">            dbContext.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Remove</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            dbContext.Remove(dbContext.Users.FirstOrDefault(x =&gt; x.Id == id));</span><br><span class="line">            dbContext.SaveChanges();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">List</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> dbContext.Users.ToList();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> User <span class="title">FindOne</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> dbContext.Users.FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>注入</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * AddSingleton 添加唯一注入</span></span><br><span class="line"><span class="comment"> * AddScoped 添加会话注入，每次会话不同</span></span><br><span class="line"><span class="comment"> * AddTransient 添加不同实例，每次请求都不同</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">services.AddScoped&lt;AppDbContext&gt;();</span><br><span class="line">services.AddScoped&lt;UserService&gt;();</span><br></pre></td></tr></table></figure><h3 id="Razor界面">Razor界面</h3><h4 id="userList">userList</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">&quot;/userList&quot;</span></span><br><span class="line">@using BlazorAppGo.Models</span><br><span class="line">@using BlazorAppGo.Services</span><br><span class="line">@inject BlazorAppGo.Services.UserService userService</span><br><span class="line">@inject NavigationManager NavigationManager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;button <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @onclick=<span class="string">&quot;Add&quot;</span>&gt;新增&lt;/button&gt;</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-1&quot;</span>&gt;ID&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-2&quot;</span>&gt;&lt;input type=<span class="string">&quot;text&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> @bind-<span class="keyword">value</span>=<span class="string">&quot;id&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-1&quot;</span>&gt;Name&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-2&quot;</span>&gt;&lt;input type=<span class="string">&quot;text&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> @bind-<span class="keyword">value</span>=<span class="string">&quot;name&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;table <span class="keyword">class</span>=<span class="string">&quot;table&quot;</span> style=<span class="string">&quot;margin-top:15px&quot;</span>&gt;</span><br><span class="line">    &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;ID&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Name&lt;/th&gt;</span><br><span class="line">            &lt;th&gt;Options&lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">    &lt;/thead&gt;</span><br><span class="line">    &lt;tbody&gt;</span><br><span class="line">        @foreach (<span class="keyword">var</span> user <span class="keyword">in</span> users)</span><br><span class="line">        &#123;</span><br><span class="line">            &lt;tr&gt;</span><br><span class="line">                &lt;td&gt;@user.Id&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;@user.Name&lt;/td&gt;</span><br><span class="line">                &lt;td&gt;</span><br><span class="line">                    &lt;button <span class="keyword">class</span>=<span class="string">&quot;btn btn-info&quot;</span> @onclick=<span class="string">&quot;@(e=&gt;Info(user.Id))&quot;</span>&gt;详细&lt;/button&gt;</span><br><span class="line">                    &lt;a href=<span class="string">&quot;/userUpdate/@user.Id&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;btn btn-warning&quot;</span>&gt;修改&lt;/a&gt;</span><br><span class="line">                    &lt;button <span class="keyword">class</span>=<span class="string">&quot;btn btn-danger&quot;</span> @onclick=<span class="string">&quot;@(e=&gt;Del(user.Id))&quot;</span>&gt;删除&lt;/button&gt;</span><br><span class="line">                &lt;/td&gt;</span><br><span class="line">            &lt;/tr&gt;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;@cid&lt;/h3&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> cid;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        users = userService.List();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Add</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.Add(<span class="keyword">new</span> User &#123; Id = id, Name = name &#125;);</span><br><span class="line">        users = userService.List();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重新绑定 刷新页面</span></span><br><span class="line">        <span class="comment">//StateHasChanged();</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//刷新</span></span><br><span class="line">        ShouldRender();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Info</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        NavigationManager.NavigateTo(<span class="string">$&quot;/userInfo/<span class="subst">&#123;id&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Del</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.Remove(id);</span><br><span class="line">        users = userService.List();</span><br><span class="line">        ShouldRender();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="userUpdate">userUpdate</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">&quot;/userUpdate/&#123;Id&#125;&quot;</span></span><br><span class="line">@inject BlazorAppGo.Services.UserService userService</span><br><span class="line"></span><br><span class="line">&lt;button <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span> @onclick=<span class="string">&quot;Save&quot;</span>&gt;保存&lt;/button&gt;</span><br><span class="line">&lt;div <span class="keyword">class</span>=<span class="string">&quot;row&quot;</span>&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-1&quot;</span>&gt;ID&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-2&quot;</span>&gt;&lt;input type=<span class="string">&quot;text&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> @bind-<span class="keyword">value</span>=<span class="string">&quot;Id&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-1&quot;</span>&gt;Name&lt;/div&gt;</span><br><span class="line">    &lt;div <span class="keyword">class</span>=<span class="string">&quot;col-2&quot;</span>&gt;&lt;input type=<span class="string">&quot;text&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;form-control&quot;</span> @bind-<span class="keyword">value</span>=<span class="string">&quot;name&quot;</span>&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">@if (show)</span><br><span class="line">&#123;</span><br><span class="line">    &lt;h4&gt;修改成功&lt;/h4&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;a href=<span class="string">&quot;/userList&quot;</span>&gt;返回&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Parameter</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">bool</span> show;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> user = userService.FindOne(<span class="built_in">int</span>.Parse(Id));</span><br><span class="line">        name = user.Name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Save</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        userService.Update(<span class="built_in">int</span>.Parse(Id), <span class="keyword">new</span> Models.User &#123; Id = <span class="built_in">int</span>.Parse(Id), Name = name &#125;);</span><br><span class="line">        show = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="userInfo">userInfo</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">&quot;/userInfo/&#123;Id&#125;&quot;</span></span><br><span class="line">@inject BlazorAppGo.Services.UserService userService</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;h1&gt;UserInfo @Id&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;h2&gt;Id:@Id&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt;Name:@Name&lt;/h2&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;/userList&quot;</span> <span class="keyword">class</span>=<span class="string">&quot;btn btn-primary&quot;</span>&gt;返回&lt;/a&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@code&#123;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Parameter</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> Name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnInitialized</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> user = userService.FindOne(<span class="built_in">int</span>.Parse(Id));</span><br><span class="line">        Name = user.Name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="效果">效果</h3><p><img src="http://pic.fasty97.top/NotePad/20210407091627.gif" alt="效果"></p>]]></content>
      
      
      <categories>
          
          <category> NetCore </category>
          
          <category> Blazor </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 新技术体验 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>孤独&amp;独立</title>
      <link href="/2021/03/09/%E5%AD%A4%E7%8B%AC&amp;%E7%8B%AC%E7%AB%8B/"/>
      <url>/2021/03/09/%E5%AD%A4%E7%8B%AC&amp;%E7%8B%AC%E7%AB%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>我不喜热闹，甚至很多时候会有逃避人群的念头；与其于人为伍，有时候我更喜欢与自己独处。</p></blockquote><p>可能我并不是一个好相处的人，虽然我周围的朋友都觉得我是一个随和的人；我常常感觉到社交的疲劳和烦躁，和大多数人不同我很多时候并没有感受到真正的社交的快乐。我羡慕那些能很快融入集体，自来熟的人；他们的快乐感觉比我来得简单🙂 。</p><blockquote><p>我享受着孤独，我习惯性的沉溺在自己的小世界中</p></blockquote><p>这大概也是我喜欢计算机，喜欢编程的原因吧；从小我的思想就和别人不同，因此也常受人排挤；人们总是对不符合自己预期的事物提出质疑和否定。那时候我觉得可能我真是个怪人吧😅。不和别人玩，大概就是奇怪吧。</p><blockquote><p>从开始实习后，和朋友疯玩了一阵，最后还是觉得索然无味，还是于自己独处最为有趣。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Unity PlasticSCM 托管</title>
      <link href="/2021/03/04/Unity%20PlasticSCM%20%E6%89%98%E7%AE%A1/"/>
      <url>/2021/03/04/Unity%20PlasticSCM%20%E6%89%98%E7%AE%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="写在前面">写在前面</h2><blockquote><p>记得之前unity也有自己的云同步，但是在使用后体验并不好，开启云同步后对于配置低的电脑软件负担会很大。而且在国内网络下，速度非常慢；所以在试过一次后我还是转战 github 和码云了。</p></blockquote><p>现在Unity推出了一套新的托管系统——<code>PlasticSCM</code></p><p>在创建项目时，勾选启用<code>PlasticSCM</code>，在第一次使用时会自动下载<code>PlasticSCM</code>客户端。</p><p><img src="http://pic.fasty97.top/NotePad/20210304092525.png" alt="创建项目"></p><h2 id="托管界面">托管界面</h2><h3 id="pending-changes">pending changes</h3><p>在<code>pending changes</code>界面会显示当前的<code>changeList</code>，默认勾选了AutoSave。</p><p><img src="http://pic.fasty97.top/NotePad/20210304094320.png" alt="托管界面"></p><h3 id="Changesets">Changesets</h3><p>Changesets面板显示项目的提交记录和资源变化。</p><p><img src="http://pic.fasty97.top/NotePad/20210304101907.png" alt="Changesets"></p><h2 id="客户端">客户端</h2><p>点击Launch Plastic 可以启动客户端。</p><p><img src="http://pic.fasty97.top/NotePad/20210304102159.png" alt="客户端"></p><p>客户端可以直观方便的管理托管项目。</p><h2 id="使用感受">使用感受</h2><ol><li>PlasticSCM 支持大文件存储，相比传统git更加适应游戏开发的需要。</li><li>与Unity高度集成，可以在unity中进行快捷操作</li><li>是替代git的不二选择</li></ol>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>原型模式</title>
      <link href="/2021/02/22/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/"/>
      <url>/2021/02/22/%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>原型模式：使用特定原型实例来创建特定种类的对象，并且通过拷贝原型来创建新的对象。</p></blockquote><h3 id="写在前面">写在前面</h3><p>假如在游戏中我们需要生成各种各样的怪物，我们需要一个孵化器，我们想到为每个怪物类型确定一个孵化器，如下图所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">   Ghost --&gt; GhostSpawner</span><br><span class="line">   Demo --&gt;  DemoSpawner</span><br></pre></td></tr></table></figure><p>✔️ 不难想到，我们可以抽象出怪物的基类对上面的结构进行优化。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> 怪物基类</span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Monster</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">float</span> Speed &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Monster <span class="title">Clone</span>()</span>;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="string">$&quot;Hp:<span class="subst">&#123;Hp&#125;</span> Speed:<span class="subst">&#123;Speed&#125;</span>&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> 幽灵类</span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">   <span class="keyword">class</span> <span class="title">Ghost</span>: <span class="title">Monster</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> Monster <span class="title">Clone</span>()</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> Ghost()&#123;Hp=<span class="keyword">base</span>.Hp,Speed = <span class="keyword">base</span>.Speed&#125;;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> 孵化器</span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">   <span class="keyword">class</span> <span class="title">Spawner</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">private</span> Monster _monster;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="title">Spawner</span>(<span class="params">Monster monster</span>)</span></span><br><span class="line">       &#123;</span><br><span class="line">           _monster = monster;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> Monster <span class="title">SpawnerMonster</span>()</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">return</span> _monster.Clone();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>调用</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gh = <span class="keyword">new</span> Ghost() &#123;Hp = <span class="number">45</span>, Speed = <span class="number">3.3f</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> spa = <span class="keyword">new</span> Spawner(gh);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> en= spa.SpawnerMonster();</span><br><span class="line">Console.WriteLine(en);</span><br></pre></td></tr></table></figure><h3 id="结论">结论</h3><blockquote><p>关于这个模式，有一点比较优雅的是，它不仅克隆原型类，而且它也克隆了对象的状态。</p></blockquote><p>基于这样的<code>模板(原型)</code>，我们可以创建出类似的一系列对象。</p><p>📘 Ps: 有兴趣的话可以去看看<code>Self语言</code>相信你会对原型，oop有新的认识——类并不是实现oop的唯一方法。</p><p>📖OOP的特征是它将状态和行为结合得更紧密。</p><h3 id="扩展">扩展</h3><p>正是self基于原型的设计理念，诞生了现在大受欢迎的<code>javascript</code>；</p><p>正是self不断强化编译技术，虚拟机效率，现在的动态语言才能高效执行。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>观察者模式</title>
      <link href="/2021/02/22/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/"/>
      <url>/2021/02/22/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>观察者模式（Observer）：在对象间定义一种<code>一对多</code>的依赖关系，以便当某对象的状态改变时，与它存在依赖关系的所有对象都能收到通知并自动进行更新。</p></blockquote><ul><li>MVC模式的底层可以说就是利用了观察者模式</li></ul><h2 id="基础设计">基础设计</h2><blockquote><p>我们可以使用如下的方式设计一个简单的观察者模式，在被观察者中需要存储一个观察者组，提供一个发送消息的方法对观察组进行消息推送。</p><p>在观察者中提供一个消息响应的方法，响应消息。</p></blockquote><figure class="highlight csharp"><figcaption><span>事件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> 事件</span></span><br><span class="line">   <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">   <span class="keyword">public</span> <span class="built_in">enum</span> Event</span><br><span class="line">   &#123;</span><br><span class="line">       捡到金币,</span><br><span class="line">       通关</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>接口</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> 观察者接口</span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IObserver</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> 接收通知</span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;subject&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;eventMsg&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">OnNotify</span>(<span class="params">Subject subject, Event eventMsg</span>)</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> 被观察者接口</span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ISubject</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="function">List&lt;IObserver&gt; <span class="title">Observers</span>()</span>;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">      <span class="function"><span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><figcaption><span>实体对象</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> 观察者</span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Observer</span> : <span class="title">IObserver</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">OnNotify</span>(<span class="params">Subject subject, Event eventMsg</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">switch</span> (eventMsg)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">case</span> Event.捡到金币:</span><br><span class="line">                  subject.Score += <span class="number">10</span>;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">              <span class="keyword">case</span> Event.通关:</span><br><span class="line">                  subject.Score += <span class="number">100</span>;</span><br><span class="line">                  <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> 被观察者</span></span><br><span class="line">  <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Subject</span> : <span class="title">ISubject</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">public</span> <span class="built_in">int</span> Score;</span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">readonly</span> List&lt;IObserver&gt; _observers;</span><br><span class="line"></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> 发送消息</span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">      <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;eventMsg&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Notify</span>(<span class="params">Event eventMsg</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          _observers.ForEach(x=&gt;x.OnNotify(<span class="keyword">this</span>,eventMsg));</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="title">Subject</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">          _observers = <span class="keyword">new</span> List&lt;IObserver&gt;();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> List&lt;IObserver&gt; <span class="title">Observers</span>()</span></span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">return</span> _observers;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          _observers.Add(observer);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">RemoveObserver</span>(<span class="params">IObserver observer</span>)</span></span><br><span class="line">      &#123;</span><br><span class="line">          _observers.Remove(observer);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h2 id="使用委托和事件">使用委托和事件</h2><p>在Csharp中内置了委托和事件来处理这种一对多的响应方式。</p><figure class="highlight csharp"><figcaption><span>c#内置了委托和事件</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ObserverPattern</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 观察者模式</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> c = <span class="keyword">new</span> Cat() &#123;Name = <span class="string">&quot;小白&quot;</span>&#125;;</span><br><span class="line">            <span class="keyword">var</span> m = <span class="keyword">new</span> Mouse(c) &#123;Name = <span class="string">&quot;小鼠&quot;</span>&#125;;</span><br><span class="line">            c.OnCatCom();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Cat</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">event</span> Action catCom;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">OnCatCom</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&#123;0&#125;来了&quot;</span>,Name);</span><br><span class="line">            catCom?.Invoke();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Mouse</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Mouse</span>(<span class="params">Cat cat</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//将事件绑定到方法</span></span><br><span class="line">            cat.catCom += <span class="keyword">this</span>.MouseRun;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">MouseRun</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;&#123;0&#125;快跑!!&quot;</span>,Name);</span><br><span class="line">        &#125;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="思考">思考</h2><p>其实观察者模式就是对象的一种<code>间接同步调用</code>，使用这种方法是为了解除耦合，达到统一分配管理的作用。</p><p>从上文提到的可以知道，这种模式是同步的，也就是说当存在一组观察者时，那么可能会导致<code>阻塞</code>,但在实际中可能没这么严重，但在使用中我们还需注意。</p><blockquote><p>如果你在每次响应后给出一个状态，表示通知的响应情况，那么这就接近 <code>责任链模式</code>了。</p></blockquote><h2 id="销毁对象">销毁对象?</h2><p>在书中提到一个问题很有趣，在观察者模式中销毁对象该怎么办呢？</p><p>在销毁对象前，需要解除监听，确保对象被正确销毁。</p><h2 id="现状">现状</h2><blockquote><p>观察者模式出现于1994年（比我还大😄),因此基本都是基于类来实现的，但现在更流行<code>函数式编程</code>，可能不太符合现在的编程美学。例如C#的event就是现代化的观察者模式。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python连接Mysql</title>
      <link href="/2021/02/22/python%E8%BF%9E%E6%8E%A5Mysql/"/>
      <url>/2021/02/22/python%E8%BF%9E%E6%8E%A5Mysql/</url>
      
        <content type="html"><![CDATA[<blockquote><p>python 3.x 开始需要下载安装<code>PyMySQL</code></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">user = <span class="string">&#x27;root&#x27;</span></span><br><span class="line">password = <span class="string">&#x27;&#x27;</span></span><br><span class="line">db = <span class="string">&#x27;spr&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;开始连接~&#x27;</span>)</span><br><span class="line">    <span class="comment"># 打开数据库连接</span></span><br><span class="line">    con = pymysql.connect(host=ip, port=<span class="number">3306</span>, user=user, passwd=password, db=db, charset=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 游标对象</span></span><br><span class="line">    cur = con.cursor()</span><br><span class="line">    <span class="comment"># 执行sql</span></span><br><span class="line">    cur.execute(<span class="string">&#x27;select * from food&#x27;</span>)</span><br><span class="line">    res = cur.fetchall()</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 插入</span></span><br><span class="line">    sql = <span class="string">&quot;insert into food (fName,fDesc) values(&#x27;%s&#x27;,&#x27;%s&#x27;)&quot;</span></span><br><span class="line">    data = (<span class="string">&#x27;小西瓜&#x27;</span>, <span class="string">&#x27;一毛一个&#x27;</span>)</span><br><span class="line">    cur.execute(sql % data)</span><br><span class="line">    con.commit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;成功插入&#x27;</span>, cur.rowcount, <span class="string">&#x27;条数据&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 关闭连接</span></span><br><span class="line">    con.close()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> python </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>学着生活</title>
      <link href="/2021/01/25/%E5%AD%A6%E7%9D%80%E7%94%9F%E6%B4%BB/"/>
      <url>/2021/01/25/%E5%AD%A6%E7%9D%80%E7%94%9F%E6%B4%BB/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://www.juzikong.com/posts/44391895-1f46-4549-b168-ef6b2d76405b">去交会让你开心的朋友，去爱不会让你流泪的人，去向自己想去的方向，去完成不论大小的梦想，生活应该是美好而又温柔的，你也是。</a></p></blockquote><p>大概是以前太贪玩了，亦或者是自己内心的世界太丰富多彩了吧，不会孤独，在自己的小天地里就仿佛拥有了整个世界。—— 宅着真爽♥️</p><p>有时候我觉得就这样宅着过一辈子也许也不错吧。</p><p>但其实，生活还有很多美好等着我去发现，早上的一杯热茶，一缕阳光，午后的一阵微风，幸福感就在我们身边左右徘徊等着我们去发现。</p><blockquote><p>大人才考虑傻不傻，小孩子只考虑能不能做</p></blockquote><p>不要觉得自己的做法很傻，只要做这件事能让自己开心，就放心去做吧，没有那么多机会在等待，没有那么多人原地徘徊。—— 希望我们永远都能做孩子💝</p><blockquote><p>一个人旅行，遇见更好的自己</p></blockquote><p>不知道你们有没有试过自己一个人去旅行，一个人解决吃饭，住宿。在这段时间我真正去一个人的旅行，婉言拒绝了朋友的陪同，想自己去走走，感受生活，也是为了更好的自己。</p><blockquote><p>人是群居动物，总是抱团取暖</p></blockquote><p>人们总是聚在一起，互相关心，以填补精神世界上的空洞；正是因为这些链接把我们串起来；让我们对彼此有了眷恋和感情。</p><blockquote><p>多出去走走，多看看自己</p></blockquote><p>以后的自己看到此文一定会觉得自己很傻吧，但是每一次觉得自己很傻的时刻，就代表了自己的进步吧！</p><hr><p>——此文 记于 2021年1月25日12:01:06  在昨天和朋友玩了一整天后🙂.</p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>《HELLO WORLD 》影评</title>
      <link href="/2021/01/19/%E3%80%8AHELLO%20WORLD%20%E3%80%8B%E5%BD%B1%E8%AF%84/"/>
      <url>/2021/01/19/%E3%80%8AHELLO%20WORLD%20%E3%80%8B%E5%BD%B1%E8%AF%84/</url>
      
        <content type="html"><![CDATA[<h2 id="前言">前言</h2><p>相信作为一个程序员面对<code>Helloworld</code> 应该不会陌生吧！</p><p>不论我们学习神门语言，第一段程序就是输出一段<code>HelloWorld</code></p><p>向世界问好~</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">print(&quot;HelloWorld&quot;);</span><br><span class="line">Console.log(&quot;HelloWorld&quot;);</span><br><span class="line">Console.WriteLine(&quot;HelloWorld&quot;);</span><br><span class="line">cout &lt;&lt; &quot;HelloWorld&quot; &lt;&lt; endl;</span><br></pre></td></tr></table></figure><p>🔸一看到这个特别的名字，我就被深深的吸引了，想着难不成是讲编程的故事吧<img src="http://pic.fasty97.top/NotePad/20210119093235.png" alt="2027"></p><center>2027 京都</center><blockquote><p>看了一段，我才发现这是一部爱情故事，男主为了找回女主的存在跨越时间空间去挽救，像极了《命运石之门》里面的世界线桥段。</p></blockquote><h2 id="数据世界">数据世界</h2><p>在未来的世界，科技无限的发展，任何事物都可以用数据来存储通过所谓的量子计算和无限存储来保存世界。</p><p><img src="http://pic.fasty97.top/NotePad/20210119145734.jpg" alt="数据世界"><br><img src="http://pic.fasty97.top/NotePad/20210119145752.jpg" alt="数据世界"><br><img src="http://pic.fasty97.top/NotePad/20210119145801.jpg" alt="等车"><br><img src="http://pic.fasty97.top/NotePad/20210119145813.jpg" alt="读书"><br>{.gallery data-height=“220”}</p><p>男主在未来的自己的指导下，手把手教撩妹？🙂</p><h2 id="真实世界？">真实世界？</h2><p>在男主成功追到妹子后，突然世界变了，原来未来的自己是为了拯救真实世界的自己，打算用数据世界的女主的数据来修复真实世界的女主的大脑。———反转😏</p><p><img src="http://pic.fasty97.top/NotePad/20210119145823.jpg" alt="真实世界？"><br><img src="http://pic.fasty97.top/NotePad/20210119145835.jpg" alt="真实世界？"><br><img src="http://pic.fasty97.top/NotePad/20210119145846.jpg" alt="真实世界？"><br><img src="http://pic.fasty97.top/NotePad/20210119145858.jpg" alt="真实世界？"><br>{.gallery data-height=“220”}</p><p>其中有一个桥段还是很感人的，现实世界的男主为了让女主苏醒，费尽心力，甚至让自己落下了肢体麻痹的毛病，在女主苏醒的时候，现实世界的男主紧紧抱住女主，喜悦无法言表。但女主感觉的出来，眼前的人并不是往日的男主，尽管男主按照未来自己的步骤去实施其印象却是不同的。</p><p>虽然如此，在最后男主带她回家时，她还是给了未来的男主一个拥抱。并说出了<code>你一定爱着我吧</code>这样的话。</p><blockquote><p>确实啊，能被人爱着是多么幸福的一件事，她给不了他什么，也不可能留下来，但对爱着自己的人说<code>谢谢</code>是对他最大的认可吧💖。</p></blockquote><h2 id="新世界">新世界</h2><p>最后，一个转场，看到的是未来的女主在守候着男主。原来这一切都是男主客服的困难，从沉睡中苏醒的故事。</p><p>——反转😏</p><p><img src="http://pic.fasty97.top/NotePad/20210119145911.jpg" alt="新世界"><br><img src="http://pic.fasty97.top/NotePad/20210119145920.jpg" alt="新世界"><br>{.gallery data-height=“220”}</p><p>未来他们已经在月球了吧，蔚蓝的地球在远方，究竟这个世界又是不是一个虚拟的数据世界呢，</p><p>这都不重要了，未来的生活总是充满期待！</p><h2 id="总结">总结</h2><p>这是一部蛮创新的动漫电影，名字创新，剧情反转，立意深刻。</p><p>其中提到的内存地址冲突，系统排异，像极了我们的编程系统。</p><blockquote><p>要好好管理内存地址鸭😄</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 影评 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 动漫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020年终总结</title>
      <link href="/2021/01/18/2020%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/"/>
      <url>/2021/01/18/2020%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<blockquote><p>不知道写点什么，就想着写点东西放博客上，希望以后的自己可以感谢现在的自己吧😄。</p></blockquote><h2 id="前言">前言</h2><p>不知不觉2020年就过去了，感觉这一年时间过得飞快！（[破音]不要啊，不想长大！）</p><p>这是糟糕的一年，不论是对于我还是对于大家想必都是吧😅。</p><p>用一句话总结一下：</p><blockquote><p>计划赶不上变化，生活总想让我低头</p></blockquote><p>从图片你就可以看出2020我超级摸鱼的。</p><img src="http://pic.fasty97.top/NotePad/20210118131259.png" alt="超级摸鱼" style="zoom: 50%;" /><h2 id="暑假中">暑假中</h2><blockquote><p>🛰️我从来没想到会放这样一个长假，大概一生也就这么一次了吧</p></blockquote><p>在假期中我每周都制定了计划，主要针对了<code>C++</code>和<code>Shader</code>进行学习。（不得不说C++牛逼）</p><h3 id="自设框架">自设框架</h3><blockquote><p>Final framework —— 希望它成为最终的框架</p></blockquote><p>其框架现在已经包含以下功能：</p><ol><li>资源加载<ol><li>Resource加载</li><li>AB包加载</li><li>Addressable加载</li></ol></li><li>单例<ol><li>非Mono单例</li><li>Mono单例</li></ol></li><li>全局Mono</li><li>对象池</li><li>音效管理器</li><li>输入管理器</li><li>UI管理器</li><li>FSM有限状态机</li><li>事件中心</li><li>对话系统</li><li>简易协程行为树</li><li>天赋树系统</li><li>背包系统</li><li>Astar寻路</li><li>存储系统</li></ol><p><strong>有空会开一篇文章专门介绍。</strong></p><h3 id="简易项目">简易项目</h3><p>在暑假里，和<code>小觉</code>，<code>刺客</code>一同制作了一个简易的2D横版解密过关游戏。</p><table><thead><tr><th>名称</th><th>担任</th></tr></thead><tbody><tr><td>小宇/Fasty</td><td>Programming</td></tr><tr><td>小觉</td><td>Programming</td></tr><tr><td>刺客</td><td>Design</td></tr></tbody></table><p><img src="http://pic.fasty97.top/NotePad/20210118140327.gif" alt="效果预览"></p><h2 id="暑假后开学">暑假后开学</h2><p>暑假后开学，在学校的生活还是非常好的，每天上一下少得可怜的课程。当然如期上了我们学校的`《游戏设计》课程，果不其然，并不是什么正经的游戏设计课程。简单说来就是使用python的pygame库；自己组队完成一款简单的2D游戏。其目的大概是强化一下我们的python的熟练程度吧。</p><h3 id="光之子">光之子</h3><p>对于这个名字我也不好评定，刚好那段时间育碧在免费送<code>光之子</code>,这个游戏也承载了我的很多回忆。大概是高中时候吧，那时候第一次看到这个游戏就被这个游戏的画风和剧情所深深吸引。</p><div class="gallery">  <div class="fj-gallery page_img_lazyload lazyload btn_album_detail_lazyload data" data-rowHeight="220" data-limit="2">    <span class="gallery-data">[{"url":"http://pic.fasty97.top/NotePad/20210118123146.jpeg","alt":"光之子"},{"url":"http://pic.fasty97.top/NotePad/20210118122142.jpeg","alt":"举剑"},{"url":"http://pic.fasty97.top/NotePad/20210118122627.jpeg","alt":"对话"},{"url":"http://pic.fasty97.top/NotePad/20210118123342.jpeg","alt":"空中的房间"},{"url":"http://pic.fasty97.top/NotePad/20210118123735.jpeg","alt":"宫殿"}]</span>  </div><button class="gallery-load-more" style="opacity:0">  <span>Load More</span>  <i class="anzhiyufont anzhiyu-icon-arrow-down"></i>  </button></div><h3 id="我们的光之子">我们的光之子</h3><blockquote><p>因为疫情的关系，老师希望我们的作品能够跟疫情挂钩。</p></blockquote><p>我用<code>pygame</code>试了一下，pygame效率很低，跑一个简单的2D场景，放置了几个精灵。凭借着我的2600cpu  rx580gpu 16g 2933，只能跑一百多。（可能pygame压根就没法调用GPU吧，CPU的效率也很低，果然pygame就只能写点小玩意玩玩 💔）<br>🏹而且pygame对效率很敏感，在加载资源和精灵渲染部分消耗极高。如果资源重复加载将造成帧率的大幅下降！</p><p>:::primary<br>So<br>:::</p><p>我们定下了，简单的<code>泡泡堂</code>游戏形式使用<code>炸弹</code>消灭地图中游荡的<code>病毒</code>。</p><p>➡️与之不同的是，我们加入了剧情和对话。</p><p>整个开发过程还是比较快乐的，吐槽一下pygame，聊聊天，大概一周的时间吧，我们的作品完成了！</p><p>最终《游戏设计》这门课程，老师给了我100分，给了自己一份满意的答卷。</p><h2 id="今年的新书">今年的新书</h2><p><img src="http://pic.fasty97.top/NotePad/20210118140916.png" alt="游戏优化"><br>{.gallery data-height=“220”}</p><h2 id="实习">实习</h2><p>​在今年十月份的时候，收到朋友邀请，我开始了实习生涯，在一家开发公司做web相关的开发。（本来打算自己找一家游戏开发公司的，结果学校催得紧，自己也没太多准备，又是朋友介绍，真香定律。）</p><p>老实说，这并不是我第一次实习了，在两年前，老师推荐下，我去了一家医疗系统开发的公司，讲道理公司非常坑😰，所以我的第一次实习经历并不是很好。不过不能一棍子打死，直到现在我依然待在这里实习，这里的员工有很多都是我的同学和朋友，虽然工资不高，生活却还舒适。该干活时干活，该玩时玩，以至于时间过得飞快。</p><h2 id="跨年">跨年</h2><p>喊着几个朋友跨年，感受新年的到来，看着时钟滴答滴答，看着时针，分针，秒针在辛苦忙碌了一天后的团聚，感觉生活真的需要仪式感🎴。</p><p>长这么大，我第一次发现，自己居然有射飞镖的天赋，10镖7中，赢了个小奖品。</p><p>权当是收到的新年礼物吧🎁!</p><h2 id="🚄新年祈愿">🚄新年祈愿</h2><p>在最后的最后，希望新的一年里，自己可以变得更好，发现更多生活的美！</p><p>永远积极向上，永远热爱编程，永远年轻！</p>]]></content>
      
      
      <categories>
          
          <category> 年终总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 生活 </tag>
            
            <tag> 年终总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NetCore WebAPI入门</title>
      <link href="/2021/01/14/NetCore%20WebAPI%E5%85%A5%E9%97%A8/"/>
      <url>/2021/01/14/NetCore%20WebAPI%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>IDE: vs2019</p><p>Core版本：.NET Core3.1</p></blockquote><h3 id="调整启动方式">调整启动方式</h3><blockquote><p>在进行开发webapi项目时，我们为了方便监听程序日志，我们可以选择一控制台方式启动。</p></blockquote><p><img src="http://pic.fasty97.top/NotePad/20210114170346.png" alt="image-20210114170339647"></p><h3 id="配置启动主页">配置启动主页</h3><p>在<code>launchSetting.json</code>里我们对启动项进行详细设置。</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;WebCore&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;commandName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Project&quot;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;launchBrowser&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;launchUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.html&quot;</span><span class="punctuation">,</span> <span class="comment">//启动时的Url</span></span><br><span class="line">     <span class="attr">&quot;environmentVariables&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">       <span class="attr">&quot;ASPNETCORE_ENVIRONMENT&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Development&quot;</span></span><br><span class="line">     <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">     <span class="attr">&quot;applicationUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://localhost:5000&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="启用静态资源">启用静态资源</h3><p>在项目根目录创建一个名为<code>wwwroot</code>的文件夹用于存放静态资源。</p><p>在<code>Startup.cs</code>中，<code> public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</code>方法中添加:</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseStaticFiles();</span><br></pre></td></tr></table></figure><h3 id="启用跨域">启用跨域</h3><p>在<code>ConfigureServices</code>设置跨域</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//跨域</span></span><br><span class="line">           services.AddCors(</span><br><span class="line">               m =&gt; m.AddPolicy(Any, a =&gt; a.SetIsOriginAllowed(_ =&gt; <span class="literal">true</span>).</span><br><span class="line">               AllowAnyMethod().</span><br><span class="line">               AllowAnyHeader().</span><br><span class="line">               AllowCredentials()));</span><br></pre></td></tr></table></figure><p>在<code>Configure</code>设置启用跨域</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseCors(Any);</span><br></pre></td></tr></table></figure><p>在Controller中启动跨域</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">EnableCors(<span class="string">&quot;Any&quot;</span>)</span>]</span><br></pre></td></tr></table></figure><h3 id="启用Session和Cookie">启用Session和Cookie</h3><h4 id="基础配置">基础配置</h4><p>在<code>ConfigureServices</code>中</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//启用Session</span></span><br><span class="line">           services.AddSession(options =&gt;</span><br><span class="line">           &#123;</span><br><span class="line">               options.Cookie.Name = <span class="string">&quot;.WebCore.Session&quot;</span>;</span><br><span class="line">               options.IdleTimeout = System.TimeSpan.FromSeconds(<span class="number">120</span>);<span class="comment">//设置session的过期时间</span></span><br><span class="line">               options.Cookie.HttpOnly = <span class="literal">true</span>;<span class="comment">//设置在浏览器不能通过js获得该cookie的值</span></span><br><span class="line">           &#125;);</span><br></pre></td></tr></table></figure><p>在<code>Configure</code>中</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.UseSession();<span class="comment">//UseSession配置在UseMvc之前</span></span><br></pre></td></tr></table></figure><h4 id="Session-帮助类">Session 帮助类</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.AspNetCore.Http;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebCore.Tool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Session 帮助类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SessionHelper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> IHttpContextAccessor _accessor;</span><br><span class="line">        <span class="keyword">private</span> ISession _session;</span><br><span class="line">        <span class="keyword">private</span> IRequestCookieCollection _requestCookie;</span><br><span class="line">        <span class="keyword">private</span> IResponseCookies _responseCookie;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">SessionHelper</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            _session = context.Session;</span><br><span class="line">            _requestCookie = context.Request.Cookies;</span><br><span class="line">            _responseCookie = context.Response.Cookies;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 设置session值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;session&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>键<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>值<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSession</span>(<span class="params"><span class="built_in">string</span> key, <span class="built_in">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> bytes = System.Text.Encoding.UTF8.GetBytes(<span class="keyword">value</span>);</span><br><span class="line">            _session.Set(key, bytes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获取Session值</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">GetSession</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">byte</span>[] bytes;</span><br><span class="line">            _session.TryGetValue(key, <span class="keyword">out</span> bytes);</span><br><span class="line">            <span class="keyword">if</span> (bytes == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> <span class="keyword">value</span> = System.Text.Encoding.UTF8.GetString(bytes);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(<span class="keyword">value</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">value</span> = <span class="built_in">string</span>.Empty;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">value</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>❤️  要使用Session和Cookie，可以使用<code>IHttpContextAccessor</code>来设置。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//存储Cookie</span></span><br><span class="line">accessor.HttpContext.Response.Cookies.Append(<span class="string">&quot;userId&quot;</span>, res2.Id.ToString());</span><br><span class="line"><span class="comment">//取得Cookie</span></span><br><span class="line"> <span class="keyword">var</span> userId = <span class="built_in">string</span>.Empty;</span><br><span class="line"> accessor.HttpContext.Request.Cookies.TryGetValue(<span class="string">&quot;userId&quot;</span>, <span class="keyword">out</span> userId);</span><br></pre></td></tr></table></figure><h3 id="依赖注入">依赖注入</h3><p>在<code>startup.cs</code>中<code>ConfigureServices.cs</code>的方法中注入：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用泛型注入一类对象</span></span><br><span class="line">services.AddTransient&lt;WebCore.Services.OrderService&gt;();</span><br></pre></td></tr></table></figure><p>在需要使用的地方的构造函数中注入：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">readonly</span> OrderService orderService;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">OrderController</span>(<span class="params">OrderService order</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">this</span>.orderService = order;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EF连接数据库">EF连接数据库</h3><h4 id="连接Mysql">连接Mysql</h4><p>▶️首先需要安装对应的依赖，包括：</p><p>😃记得和netcore 的版本号对应，此文netcore版本号为 3.1</p><ul><li>EntityFrameworkCore 3.1.8</li><li>EntityFrameworkCore.Tools 3.0.1</li><li>Pomelo.EntityFrameworkCore.MySql 3.2.0</li></ul><p><img src="http://pic.fasty97.top/NotePad/20210115094751.png" alt="image-20210115094744022"></p><h5 id="配置Mysql-连接字符串">配置Mysql 连接字符串</h5><figure class="highlight json"><figcaption><span>appsetting.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;ConnectionStrings&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;MysqlConnection&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Data Source=localhost;Database=coreDb;User ID=root;Password=;pooling=true;port=3306;sslmode=none;CharSet=utf8;&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure><h5 id="注册连接">注册连接</h5><figure class="highlight csharp"><figcaption><span>Startup.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//连接数据库</span></span><br><span class="line"><span class="keyword">var</span> connection = Configuration.GetConnectionString(<span class="string">&quot;MysqlConnection&quot;</span>);</span><br><span class="line">services.AddDbContext&lt;CoreDbContext&gt;(t =&gt; t.UseMySql(connection));</span><br></pre></td></tr></table></figure><h5 id="EF连接类">EF连接类</h5><p>在EF中我们需要创建一个数据库上下文对象的类，这个类需要继承自<code>DbContext</code>。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebCore.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 核心数据库上下文对象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoreDbContext</span> : <span class="title">DbContext</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;User&gt; Users &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Flower&gt; Flowers &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Order&gt; Orders &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Cart&gt; Carts &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;Address&gt; Addresses &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;LeaveWord&gt; LeaveWords &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;FlowerOrder&gt; FlowerOrders &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> DbSet&lt;FlowerPicture&gt; FlowerPictures &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">CoreDbContext</span>(<span class="params">DbContextOptions&lt;CoreDbContext&gt; options</span>) : <span class="title">base</span>(<span class="params">options</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnModelCreating</span>(<span class="params">ModelBuilder modelBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnModelCreating(modelBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">OnConfiguring</span>(<span class="params">DbContextOptionsBuilder optionsBuilder</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.OnConfiguring(optionsBuilder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="EF迁移指令">EF迁移指令</h4><p>☑️我们可以使用一下指令来操作EF迁移。</p><blockquote><p>每次使用EF迁移后都会生成一个迁移类，并在数据库中存储迁移的相关信息，可以很方便的使用数据回滚。</p></blockquote><table><thead><tr><th style="text-align:left">指令</th><th>作用</th></tr></thead><tbody><tr><td style="text-align:left">Add-Migration  xxx</td><td>添加一次迁移 迁移名称为xxx</td></tr><tr><td style="text-align:left">Update-Database</td><td>将当前迁移更新于数据库</td></tr><tr><td style="text-align:left"></td><td></td></tr></tbody></table><h3 id="搭建Model">搭建Model</h3><p>▶️ 我们可以构建一个基础实体类方便管理共有属性。</p><figure class="highlight csharp"><figcaption><span>BaseEntity.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">WebCore.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseEntity</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">Key</span>]</span><br><span class="line">        [<span class="meta">DatabaseGenerated(DatabaseGeneratedOption.Identity)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Id &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DateTime CreateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> DateTime UpdateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125; = DateTime.Now;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="特性注解">特性注解</h4><table><thead><tr><th>特性名称</th><th>特性作用</th></tr></thead><tbody><tr><td>[Key]</td><td>用于标注实体模型中的主键</td></tr><tr><td>[DatabaseGenerated(DatabaseGeneratedOption.Identity)]</td><td>用于标注Id自增</td></tr><tr><td></td><td></td></tr></tbody></table><blockquote><p>🙂待更新…</p></blockquote><h4 id="一对一">一对一</h4><h4 id="一对多">一对多</h4><h4 id="多对多">多对多</h4><h3 id="搭建DAL">搭建DAL</h3><p>▶️我们可以搭建一个通用的DAL层来进行数据访问。</p><figure class="highlight csharp"><figcaption><span>BaseService.cs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> Microsoft.EntityFrameworkCore;</span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Linq.Expressions;</span><br><span class="line"><span class="keyword">using</span> System.Threading.Tasks;</span><br><span class="line"><span class="keyword">using</span> WebCore.Models;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">WebCore.DAL</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BaseService</span>&lt;<span class="title">T</span>&gt; : <span class="title">IDisposable</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">BaseEntity</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">readonly</span> CoreDbContext coreDb;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">BaseService</span>(<span class="params">CoreDbContext coreDb</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.coreDb = coreDb;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Dispose</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            coreDb.Dispose();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 创建</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;t&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">bool</span>&gt; <span class="title">CreateAsync</span>(<span class="params">T t</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">await</span> coreDb.AddAsync&lt;T&gt;(t);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> coreDb.SaveChangesAsync().Result&gt;<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 编辑</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;t&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> <span class="title">Task</span>&lt;<span class="title">bool</span>&gt; <span class="title">EditAsync</span>(<span class="params">T t</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            coreDb.Set&lt;T&gt;().Update(t);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> coreDb.SaveChangesAsync()&gt;<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 删除</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;t&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">async</span> Task <span class="title">Remove</span>(<span class="params">T t</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            coreDb.Remove&lt;T&gt;(t);</span><br><span class="line">            <span class="keyword">await</span> coreDb.SaveChangesAsync();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得所有</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> IQueryable&lt;T&gt; <span class="title">GetAll</span>(<span class="params"><span class="built_in">bool</span> asc=<span class="literal">true</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (asc)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> coreDb.Set&lt;T&gt;().AsNoTracking().OrderBy(m=&gt;m.CreateTime);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> coreDb.Set&lt;T&gt;().AsNoTracking();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得所有</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;expression&quot;&gt;</span>指定条件<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> IQueryable&lt;T&gt; <span class="title">GetAll</span>(<span class="params">Expression&lt;Func&lt;T,<span class="built_in">bool</span>&gt;&gt; expression,<span class="built_in">bool</span> asc=<span class="literal">true</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetAll(asc).Where(expression);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得所有并分页</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;expression&quot;&gt;</span>条件<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageSize&quot;&gt;</span>数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pageIndex&quot;&gt;</span>页码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;asc&quot;&gt;</span>排序<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> IQueryable&lt;T&gt; <span class="title">GetAllPage</span>(<span class="params">Expression&lt;Func&lt;T, <span class="built_in">bool</span>&gt;&gt; expression,<span class="built_in">int</span> pageIndex , <span class="built_in">int</span> pageSize=<span class="number">10</span>, <span class="built_in">bool</span> asc = <span class="literal">true</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetAll(asc).Where(expression).Skip(pageSize*pageIndex).Take(pageSize);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得一个通过id</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> T <span class="title">GetOne</span>(<span class="params"><span class="built_in">int</span> id</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetAll().FirstOrDefault(x =&gt; x.Id == id);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得一个通过条件</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;expression&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> T <span class="title">GetOne</span>(<span class="params">Expression&lt;Func&lt;T, <span class="built_in">bool</span>&gt;&gt; expression</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> GetAll().FirstOrDefault(expression);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="搭建Services">搭建Services</h3><h3 id="搭建Dto">搭建Dto</h3>]]></content>
      
      
      <categories>
          
          <category> NetCore </category>
          
          <category> WebApi </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>html包含</title>
      <link href="/2021/01/07/html%E5%8C%85%E5%90%AB/"/>
      <url>/2021/01/07/html%E5%8C%85%E5%90%AB/</url>
      
        <content type="html"><![CDATA[<p>在编写html文件时，我们想把一些相同的部分比如头部和底部的共用部分编写在一个文件中，这样的话就可以保持网站风格一致性。</p><p>⚔️在spring中我们可以使用模板引擎<code>thymeleaf</code></p><p>🎯在.net 中我们可以使用<code>Razor</code></p><p>🔽在不依靠任何模板引擎的情况下，我们可以使用<code>object标签</code>来实现模板作用</p><figure class="highlight html"><figcaption><span>包含</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">style</span>=<span class="string">&quot;border:0px&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/x-scriptlet&quot;</span> <span class="attr">data</span>=<span class="string">&quot;top.html&quot;</span> <span class="attr">width</span>=<span class="string">100%</span> <span class="attr">height</span>=<span class="string">auto</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/NotePad/20210107111314.png" alt="image-20210107111127238"></p><center>效果</center>]]></content>
      
      
      <categories>
          
          <category> 前端技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 前端小技巧 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>享元模式</title>
      <link href="/2020/12/29/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/12/29/%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>享元模式(FlyweightPattern)：使用共享以高效地支持大量的细粒度对象。</p></blockquote><p>FlyweightPattern 的目的是 <code>提高效率，节省内存空间</code>。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新博客启动啦</title>
      <link href="/2020/12/25/%E6%96%B0%E5%8D%9A%E5%AE%A2%E5%90%AF%E5%8A%A8%E5%95%A6/"/>
      <url>/2020/12/25/%E6%96%B0%E5%8D%9A%E5%AE%A2%E5%90%AF%E5%8A%A8%E5%95%A6/</url>
      
        <content type="html"><![CDATA[<blockquote><p>​新博客启动咯！</p></blockquote><p>[✔️success]{.label .success}祝贺自己的新博客搭建完成！</p><hr><h2 id="博客历程">博客历程</h2><p>;;;id1 2019</p><ul><li>2019.6 萌生了搭建自己博客的想法</li><li>2019.10 购买了阿里云服务器和域名</li><li>2019.11 通过备案</li><li>2019.11 通过WordPress 搭建了自己的第一个博客</li><li>2019.12 改用七牛云CDN加速和图床</li><li>💝 之后一直使用WordPress 编写文章</li></ul><p>;;;</p><p>;;;id1 2020</p><ul><li>📌</li><li>2020.12.25 在圣诞节本博客诞生啦<ul><li>从服务器博客转战静态页面博客</li><li>全MD文件管理</li><li>挂靠github</li></ul></li></ul><p>;;;</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Unity热更新初步</title>
      <link href="/2020/09/11/Unity%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E6%AD%A5/"/>
      <url>/2020/09/11/Unity%E7%83%AD%E6%9B%B4%E6%96%B0%E5%88%9D%E6%AD%A5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>此文为热更新学习笔记记录</p></blockquote><h3 id="AB包">AB包</h3><p><img src="http://pic.fasty97.top/blog/20200911/aMXVGwgBYNkX.png" alt="AB包浏览器"><br><img src="http://pic.fasty97.top/blog/20200911/8uaUFBUnpFsG.png" alt="AB包配置"></p><ul><li>LZ4 比标准压缩程度小，但对于内存的占用相对较小，在使用时无需全部解压（<strong>推荐使用</strong>）</li><li>ETI 在资源包中不包含资源的类型信息</li><li>FR 重新打包时需要重新构建包和ClearFolders不同，它不会删除不存在的包。</li><li>ITTC 增量构建检查时，忽略类型数的更改</li><li>Append Hash 将文件哈希值附加到资源包名上</li><li>SM 严格模式，如果打包出错，则打包直接失败</li><li>DRB 运行时构建</li></ul><h4 id="打包">打包</h4><p>进过AB打包后，我们发现生成了如下的文件：<br><img src="https://pic.fasty97.top/blog/20200911/OOvX2aB3ieJj.png" alt="打包生成文件"><br>其中包含我们的<strong>主包文件</strong>PC和我们的资源包文件model。<br>打包完成的资源包以<strong>二进制存储</strong><br>manifest文件为对应资源的配置文件。<br><img src="https://pic.fasty97.top/blog/20200911/2xEeB6noUX5c.png" alt="AB包资源浏览"></p><h3 id="加载资源">加载资源</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载AB包</span></span><br><span class="line"><span class="keyword">var</span> ab= AssetBundle.LoadFromFile(Application.streamingAssetsPath + <span class="string">&quot;/model&quot;</span>);</span><br><span class="line"><span class="comment">//加载资源</span></span><br><span class="line"><span class="keyword">var</span> asset= ab.LoadAsset&lt;GameObject&gt;(<span class="string">&quot;Cube&quot;</span>);</span><br><span class="line">Instantiate(asset);</span><br><span class="line"><span class="comment">//注意Ab包不能重复加载（否则会出错）</span></span><br></pre></td></tr></table></figure><h4 id="异步加载资源">异步加载资源</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 异步加载资源</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;abName&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;resName&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;callBack&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function">IEnumerator <span class="title">LoadAbResAsync</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> abName, <span class="built_in">string</span> resName, UnityAction&lt;AssetBundleRequest&gt; callBack</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> ab = AssetBundle.LoadFromFileAsync(Application.streamingAssetsPath + <span class="string">&quot;/model&quot;</span>);</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> ab;</span><br><span class="line"><span class="keyword">var</span> res = ab.assetBundle.LoadAssetAsync&lt;T&gt;(resName);</span><br><span class="line"><span class="keyword">yield</span> <span class="keyword">return</span> res;</span><br><span class="line">callBack.Invoke(res);</span><br><span class="line"></span><br><span class="line"><span class="comment">//卸载单个ab包</span></span><br><span class="line">ab.assetBundle.Unload(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//卸载所有Ab包，选true会删除场景上通过ab包加载的资源</span></span><br><span class="line">AssetBundle.UnloadAllAssetBundles(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 异步加载</span></span><br><span class="line">StartCoroutine(LoadAbResAsync&lt;GameObject&gt;(<span class="string">&quot;model&quot;</span>, <span class="string">&quot;Cube&quot;</span>, a =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(<span class="string">&quot;资源加载完成！&quot;</span>);</span><br><span class="line">    Instantiate(a.asset);</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><h3 id="资源依赖">资源依赖</h3><p>如果一个资源被打包为ab包，那么这个资源使用的其他资源依赖会被默认打入资源包。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 网络连接 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
            <tag> 热更新 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>命令模式</title>
      <link href="/2020/07/04/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/"/>
      <url>/2020/07/04/%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<blockquote><p>游戏编程模式算是一本比较著名的书了，全书针对游戏编程中的问题介绍了多种设计模式。学习设计模式可以加强我们的程序架构能力，写出更加强大和优雅的程序。</p></blockquote><p><a href="https://try.dot.net/" title="在线C#">在线C#</a></p><h3 id="写在前面">写在前面</h3><p>其实针对<code>设计模式</code>，之前我就学习过《大话设计模式》自己也随书将二十多种设计模式实现了一遍；但我在学习游戏开发的过程中发现，标准的设计模式并非对游戏编程支持良好，故而有了专门看一看游戏设计模式的打算，加上寒假学习cpp，让我有了拿起这本书的想法。<br>此文仅为学习记录，欢迎指正。</p><p><code>设计模式并不是刻意为之的东西，是前辈经验的总结，也许你在不知不觉中就已经使用了某种设计模式。</code></p><h3 id="命令模式">命令模式</h3><blockquote><p>将一个请求封装成一个对象，从而允许你使用不同的请求、队列和日志将将客户端参数化，支持请求的撤销与恢复。</p></blockquote><p>从上述的描述中我们可以找到几个关键点：<code>请求队列</code>，<code>日志</code>，<code>撤销与恢复</code>。<br>如果你需要这些特性，此事不妨试试命令模式吧。</p><h4 id="适用场景">适用场景</h4><ol><li>试想一下，我们在游戏中需要监听用户的输入，以让我们控制的角色响应玩家发布的<code>命令</code>，这个命令可能是移动，攻击，也可能是打开菜单，退出游戏。在需要复杂的输入检测时，你可能需要将玩家输入进行组合，如在恰当的时机按下某几个键位就可以使用特殊技能。</li><li>在网络游戏中，我们操控我们的角色需要在所有连接的客户端中同步，其中有一种同步方式称为<code>状态同步</code>，及玩家操作角色时，客户端会向所有服务器执行相同的命令，以同步角色的状态信息。这样的情况，多少也使用了命令模式在里面。</li><li>如果你需要撤销和重做，如一款回合制策略游戏，你可能需要撤销之前的动作，让玩家更专注于策略本身。</li></ol><h3 id="代码">代码</h3><p>根据上述描述，我们可以建立一个最基础的命令模式模板。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">var</span> pl=<span class="keyword">new</span> Player(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    Console.WriteLine(pl);</span><br><span class="line">    <span class="keyword">var</span> moveC=<span class="keyword">new</span> MoveCommand(<span class="number">1</span>,<span class="number">0</span>,pl);</span><br><span class="line">    moveC.Excute();</span><br><span class="line">    Console.WriteLine(pl);</span><br><span class="line">    moveC.Undo();</span><br><span class="line">    Console.WriteLine(pl);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="built_in">int</span> x,y;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Player</span>(<span class="params"><span class="built_in">int</span> x,<span class="built_in">int</span> y</span>)</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">this</span>.x=x;</span><br><span class="line">    <span class="keyword">this</span>.y=y;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">$&quot;玩家pos:[<span class="subst">&#123;x&#125;</span>,<span class="subst">&#123;y&#125;</span>]&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">Command</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Excute</span>()</span>;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Undo</span>()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MoveCommand</span>:<span class="title">Command</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="built_in">int</span> x,y;</span><br><span class="line">  <span class="keyword">private</span> Player player;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">MoveCommand</span>(<span class="params"><span class="built_in">int</span> x,<span class="built_in">int</span> y,Player pl</span>)</span>&#123;<span class="keyword">this</span>.x=x;<span class="keyword">this</span>.y=y;<span class="keyword">this</span>.player=pl;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Excute</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Move Excute!&quot;</span>);</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Move To &#123;0&#125;,&#123;1&#125;&quot;</span>,x,y);</span><br><span class="line">    player.x+=x;</span><br><span class="line">    player.y+=y;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Undo</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Move Undo!!&quot;</span>);</span><br><span class="line">    player.x-=x;</span><br><span class="line">    player.y-=y;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如上所示就是一个命令模式的基本使用，在某些情况下我们应该将所有操作用命令管理，尽管这样比较麻烦，但一旦建立起一个统一的管理模式后，你会发现一切都是值得的。</p><h3 id="存在的问题">存在的问题</h3><p>仔细观察你会发现，我们每次我们使用一个命令都会创建一个命令对象，如果我们频繁的使用命令我们就会不断的创建对象，而这些对象其实我们只使用了一次。怎么解决这个问题呢？下一章的<code>享元模式</code>让我们一起来解决吧。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 《游戏编程模式》 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>位运算的秒用</title>
      <link href="/2020/07/02/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E7%A7%92%E7%94%A8/"/>
      <url>/2020/07/02/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%9A%84%E7%A7%92%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>位运算符想必大家都听说过,那如何正确使用位运算呢？</p><blockquote><p>今天，让我们来解决这样一个问题，用一个参数传递一组配置？</p></blockquote><p>这并非是一个难题，学习过最基本的编程知识，我相信你会用n种方法来解决这个问题。</p><h3 id="你可能的做法">你可能的做法</h3><p><code>配置项枚举类</code></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 配置项枚举</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="built_in">enum</span> Config</span><br><span class="line">&#123;</span><br><span class="line">    Item1,</span><br><span class="line">    Item2,</span><br><span class="line">    Item3</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 显示配置信息</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;configs&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowConfigInfo</span>(<span class="params">Config[] configs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> configs)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Console.WriteLine(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的做法可能是大多数人的做法，通过传递一组数据，进行数据配置的传递。</p><h3 id="使用位运算的做法">使用位运算的做法</h3><p>首先我们需要修改枚举类以适应我们的位运算。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> Config</span><br><span class="line">&#123;</span><br><span class="line">    Item1 = <span class="number">1</span> &lt;&lt; <span class="number">0</span>, <span class="comment">//1 </span></span><br><span class="line">    Item2 = <span class="number">1</span> &lt;&lt; <span class="number">1</span>, <span class="comment">//2</span></span><br><span class="line">    Item3 = <span class="number">1</span> &lt;&lt; <span class="number">2</span> <span class="comment">//4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>修改showConfigInfo方法如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowConfigInfo</span> (<span class="params">Config configs</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((configs &amp; Config.Item1) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Console.WriteLine (<span class="string">&quot;configs 包含 &#123;0&#125;&quot;</span>, Config.Item1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((configs &amp; Config.Item2) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Console.WriteLine (<span class="string">&quot;configs 包含 &#123;0&#125;&quot;</span>, Config.Item2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((configs &amp; Config.Item3) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        System.Console.WriteLine (<span class="string">&quot;configs 包含 &#123;0&#125;&quot;</span>, Config.Item3);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>调用时，只需要使用<code>|</code>运算符即可传递一组配置</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ShowConfigInfo (Config.Item1 | Config.Item3);</span><br></pre></td></tr></table></figure><p>如上输入时输出：<br><code>configs 包含 Item1 configs 包含 Item3</code></p><h3 id="分析">分析</h3><p>首先我们先来看一下二进制码</p><table><thead><tr><th>十进制</th><th>二进制</th></tr></thead><tbody><tr><td>1</td><td>001</td></tr><tr><td>2</td><td>010</td></tr><tr><td>3</td><td>011</td></tr><tr><td>4</td><td>100</td></tr></tbody></table><p>观察上表我们可以发现，<code>2的次方代表的数字，在二进制中总是只有一个1</code>。<br>然后我们再来看一下上面用到的几个位运算。</p><h4 id="按位或运算">按位或运算|</h4><p><code>|</code>运算表示将两个操作数的二进制码进行按位或运算，<code>一真则真</code>。<br>例如：</p><ul><li>我们计算1|2就是计算001|010，结果为：011 也就是十进制3。</li><li>计算 2|3 就是计算 010|011，结果为：011 也是 3。</li><li>计算 2|4 就是计算 010|100，结果为：110 十进制为 6</li></ul><p><code>通过上面你应该可以发现，当我们将2个2的次方数进行|运算，其实就是将2者特有的标志位1 整合到一起。</code>这是2的次方数所特有的，使用这一特性我们就可以使用二进制位来存储配置。</p><h4 id="按位或运算-v2">按位或运算&amp;</h4><p><code>&amp;</code> 运算表示将两个操作符的二进制进行按位与运算，<code>同真才为真，一假则假</code><br>例如：</p><ul><li>我们计算 1&amp;2 就是计算001&amp;010，结果为： 000 也就是 0</li><li>计算 2&amp;3 就是计算010&amp;011,结果为： 010 也就是 2</li><li>计算 2&amp;4 就是计算010&amp;100，结果为：000 也就是 0</li></ul><p><code>我们发现，当我们将2个2的次方数进行&amp;运算，其实就是将2者所特有的标志位1 全部置为0</code><br>使用这一特性我们就可以判断数据中是否存在某一指定位为1。</p><h3 id="使用-组合数据-解析数据">使用|组合数据&amp;解析数据</h3><p>通过|我们可以将指定位置1<br>通过&amp;我们可以判断是否包含指定位1</p><h3 id="其他的位操作">其他的位操作</h3><p>除了|和&amp;还有其他位操作，比如用于加密的异或^,用于补码的~，用于移位的&lt;&lt; 和 &gt;&gt;等。<br>使用这些位操作还能实现其他非常有趣的功能。本文重点介绍|和&amp;，其他位运算不做详细说明。</p><h3 id="总结">总结</h3><p>使用|和&amp;能够很好的按位存储和解析数据，运算效率高，能避免重复配置项，非常巧妙也十分有用！</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>舒服的2D相机-Cinemachine</title>
      <link href="/2020/05/23/%E8%88%92%E6%9C%8D%E7%9A%842D%E7%9B%B8%E6%9C%BA-Cinemachine/"/>
      <url>/2020/05/23/%E8%88%92%E6%9C%8D%E7%9A%842D%E7%9B%B8%E6%9C%BA-Cinemachine/</url>
      
        <content type="html"><![CDATA[<blockquote><p>上周我利用一周的时间完成了一个解密竞速小游戏，这也是没空更新的一个原因吧</p></blockquote><p>因为时间比较短，就选择了2D项目来练练手，在人物角色控制写完了之后，就想着写个摄像机来控制视野，索性就想到了<code>Cinemachine</code>，记得之前好像看到Cinemachine有一套比较好用的摄像机系统，就拿来试试了。</p><h3 id="效果预览">效果预览</h3><p><img src="http://pic.fasty97.top/blog/20200523/qb1Kss4Mw96k.gif" alt="效果预览"></p><p>可以看到其效果包含以下几个方面</p><ul><li>跟随玩家角色的移动</li><li>在小范围内移动不会触发摄像机位置的改变</li><li>摄像机缓动</li><li>摄像机视野不会超出地图范围</li></ul><p>这几个效果自己手写还是挺麻烦，让我们来看看<code>Cinemachine</code>怎么做。</p><h3 id="如何使用">如何使用</h3><ol><li>创建一个2D虚拟相机：</li></ol><p><img src="http://pic.fasty97.top/blog/20200523/AVXP8rVMR5N9.png" alt=""><br>2. 为虚拟相机指定Flow<br><img src="http://pic.fasty97.top/blog/20200523/KJPSbevHst01.png" alt=""><br>3. 设置活死区和插值<br><code>此时已经可以实现摄像机跟随了，但是此时摄像机可能会照到非地图区域</code><br>4. 设定地图碰撞区域<br>创建一个空物体并挂载多边形碰撞器（目前只支持这种类型的碰撞器）<code>记得设置为触发器</code><br><img src="http://pic.fasty97.top/blog/20200523/mjeXKALIvuha.png" alt=""><br>为虚拟相机添加如下组件，将碰撞设置进去<br><img src="http://pic.fasty97.top/blog/20200523/E1mVRf835ude.png" alt=""><br>此时你可以实现上述的所有功能了。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Cinemachine </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A*算法的研究和应用</title>
      <link href="/2020/05/10/A%E6%98%9F%E7%AE%97%E6%B3%95%E7%9A%84%E7%A0%94%E7%A9%B6%E5%92%8C%E5%BA%94%E7%94%A8/"/>
      <url>/2020/05/10/A%E6%98%9F%E7%AE%97%E6%B3%95%E7%9A%84%E7%A0%94%E7%A9%B6%E5%92%8C%E5%BA%94%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<blockquote><p>对A*算法早有耳闻，但一直未细致去分析过，最近重新看到这个概念，来尝试分析一波</p></blockquote><h3 id="算法定义">算法定义</h3><p>A* 算法常被表示为 f(n)=g(n)+h(n)</p><p>**f(n)**表示从状态n到达目标状态的花费的预测值<br>**g(n)**表示从初始状态到达状态n的花费<br>**h(n)**表示从状态n到达目标状态的花费预测值（最佳路径）</p><p>拖了蛮久了，差点我都忘记了我还有个博客等着我每周一更呢。</p><h3 id="效果预览">效果预览</h3><p><img src="http://pic.fasty97.top/blog/20200523/1Ark1TqLH5gG.gif" alt="效果预览"></p><hr><h3 id="A-格子数据">A* 格子数据</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">FastyTools.Astar</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 格子类型</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">enum</span> NodeType</span><br><span class="line">    &#123;</span><br><span class="line">        Walk,</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 障碍物</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        Obstacle</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> A*格子</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AstarNode</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> NodeType Type &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 总花费</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> F =&gt; G + H;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从起点到当前格子的花费</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> G &#123; <span class="keyword">get</span>;  <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 从当前格子到终点的花费</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">float</span> H &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 父节点</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="keyword">public</span> AstarNode Father &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> X &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Y &#123; <span class="keyword">get</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">AstarNode</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> y, NodeType type</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            X = x;</span><br><span class="line">            Y = y;</span><br><span class="line">            Type = type;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="A-寻路">A*寻路</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> FastyTools.Singleton;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">FastyTools.Astar</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">struct</span> Vec2</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> X &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> Y &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Vec2</span>(<span class="params"><span class="built_in">int</span> x, <span class="built_in">int</span> y</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            X = x;</span><br><span class="line">            Y = y;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//运算符重载</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Vec2 <span class="keyword">operator</span> +(Vec2 a, Vec2 b)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Vec2(a.X + b.X, a.Y + b.Y);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Vec2 <span class="keyword">operator</span> -(Vec2 a, Vec2 b)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Vec2(a.X - b.X, a.Y - b.Y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> A星寻路管理器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AstarManager</span> : <span class="title">Singleton</span>&lt;<span class="title">AstarManager</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> mapW;</span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">int</span> mapH;</span><br><span class="line">        <span class="keyword">public</span> AstarNode[,] map;</span><br><span class="line">        <span class="keyword">private</span> List&lt;AstarNode&gt; openList = <span class="keyword">new</span> List&lt;AstarNode&gt;();</span><br><span class="line">        <span class="keyword">private</span> List&lt;AstarNode&gt; closeList = <span class="keyword">new</span> List&lt;AstarNode&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 初始化地图信息</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;w&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;h&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitMapInfo</span>(<span class="params"><span class="built_in">int</span> w, <span class="built_in">int</span> h</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            mapW = w;</span><br><span class="line">            mapH = h;</span><br><span class="line">            map = <span class="keyword">new</span> AstarNode[w, h];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; h; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//随机阻挡</span></span><br><span class="line">                    map[i, j] = <span class="keyword">new</span> AstarNode(i, j, Random.Range(<span class="number">0</span>, <span class="number">100</span>) &lt; <span class="number">20</span> ? NodeType.Obstacle : NodeType.Walk);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 寻路</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;start&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;end&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;AstarNode&gt; <span class="title">FindWay</span>(<span class="params">Vec2 start, Vec2 end</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Debug.Log($&quot;开始点(&#123;start.X&#125;,&#123;start.Y&#125;) 结束点（&#123;end.X&#125;,&#123;end.Y&#125;）&quot;);</span></span><br><span class="line">            <span class="comment">//1.是否在地图范围内</span></span><br><span class="line">            <span class="keyword">if</span> (!(IsInMap(start) &amp;&amp; IsInMap(end)))</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(<span class="string">&quot;A* 寻路 起点或终点不在地图范围内&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.可达</span></span><br><span class="line">            <span class="keyword">var</span> s = map[start.X, start.Y];</span><br><span class="line">            <span class="keyword">var</span> e = map[end.X, end.Y];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (s.Type == NodeType.Obstacle || e.Type == NodeType.Obstacle)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(<span class="string">&quot;A* 寻路起点或 终点不可达&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//清空关闭和开启列表</span></span><br><span class="line">            openList.Clear();</span><br><span class="line">            closeList.Clear();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> path = <span class="keyword">new</span> List&lt;AstarNode&gt;();</span><br><span class="line">            <span class="comment">//3.计算</span></span><br><span class="line">            s.Father = <span class="literal">null</span>;</span><br><span class="line">            s.G = <span class="number">0</span>;</span><br><span class="line">            s.H = <span class="number">0</span>;</span><br><span class="line">            closeList.Add(s); <span class="comment">//开始点放入</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (s != e)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//开始写入</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">-1</span>, <span class="number">-1</span>), s, e, <span class="number">1.4f</span>); <span class="comment">//左上</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">0</span>, <span class="number">-1</span>), s, e); <span class="comment">//上</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">1</span>, <span class="number">-1</span>), s, e, <span class="number">1.4f</span>); <span class="comment">//右上</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">-1</span>, <span class="number">0</span>), s, e); <span class="comment">//左</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">1</span>, <span class="number">0</span>), s, e); <span class="comment">//右</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">-1</span>, <span class="number">1</span>), s, e, <span class="number">1.4f</span>); <span class="comment">//左下</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">0</span>, <span class="number">1</span>), s, e); <span class="comment">//下</span></span><br><span class="line">                WriteNear2OpenList(start + <span class="keyword">new</span> Vec2(<span class="number">1</span>, <span class="number">1</span>), s, e, <span class="number">1.4f</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                <span class="comment">//不存在任何路径</span></span><br><span class="line">                <span class="keyword">if</span> (openList.Count == <span class="number">0</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    Debug.Log(<span class="string">&quot;A* 死路&quot;</span>);</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="keyword">var</span> cc <span class="keyword">in</span> closeList)</span><br><span class="line">                    &#123;</span><br><span class="line">                        Debug.Log(cc.X + <span class="string">&quot;-&quot;</span> + cc.Y);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//选择消耗最小的点(根据F）</span></span><br><span class="line">                openList.Sort((a, b) =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">if</span> (a.F &gt; b.F)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (a.F == b.F)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">//放入关闭</span></span><br><span class="line">                closeList.Add(openList[<span class="number">0</span>]);</span><br><span class="line">                <span class="comment">//设置新起点，继续下一次寻路</span></span><br><span class="line">                s = openList[<span class="number">0</span>];</span><br><span class="line">                start = <span class="keyword">new</span> Vec2(s.X, s.Y);</span><br><span class="line">                openList.RemoveAt(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//回溯路径</span></span><br><span class="line">            path.Add(e);</span><br><span class="line">            <span class="keyword">while</span> (e.Father != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                path.Add(e.Father);</span><br><span class="line">                e = e.Father;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//翻转path</span></span><br><span class="line">            path.Reverse();</span><br><span class="line">            <span class="keyword">return</span> path;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 是否在地图中</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">IsInMap</span>(<span class="params">Vec2 pos</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (pos.X &lt; <span class="number">0</span> || pos.X &gt;= mapW || pos.Y &lt; <span class="number">0</span> || pos.Y &gt;= mapH)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 取得node</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> AstarNode <span class="title">GetNode</span>(<span class="params">Vec2 pos</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (IsInMap(pos))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> map[pos.X, pos.Y];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 将周围点数据计算并写入openList</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;pos&quot;&gt;</span>当前位置<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;father&quot;&gt;</span>父对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;end&quot;&gt;</span>终点<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;g&quot;&gt;</span>离上一个点的距离（移动花费）<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">WriteNear2OpenList</span>(<span class="params">Vec2 pos, AstarNode father, AstarNode end, <span class="built_in">float</span> g = <span class="number">1f</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> node = GetNode(pos);</span><br><span class="line">            <span class="keyword">if</span> (node == <span class="literal">null</span> || node.Type == NodeType.Obstacle || openList.Contains(node) || closeList.Contains(node))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            node.Father = father;</span><br><span class="line">            node.H = Mathf.Abs(end.X - node.X) + Mathf.Abs(end.Y - node.Y);</span><br><span class="line">            node.G = node.G + g;</span><br><span class="line">            openList.Add(node);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="寻路测试">寻路测试</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> FastyTools.Astar;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">FastyTools.Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">AStarTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> beginX;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> beginY;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Vector2 offset;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> mapW;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> mapH;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> GameObject prefab;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>,GameObject&gt; dictionary=<span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, GameObject&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Vector2 start = Vector2.right * <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> Vector2 end;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            start = Vector2.right * <span class="number">-1</span>;</span><br><span class="line">            AstarManager.Instance.InitMapInfo(mapW,mapH);</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; mapW; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; mapH; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> go= Instantiate(prefab, <span class="keyword">new</span> Vector3(beginX + offset.x * i, <span class="number">0</span>,beginY+offset.y * j),Quaternion.identity);</span><br><span class="line">                    go.transform.SetParent(transform);</span><br><span class="line">                    go.name = i + <span class="string">&quot;_&quot;</span> + j;</span><br><span class="line">                    <span class="keyword">if</span> (AstarManager.Instance.map[i,j].Type==NodeType.Obstacle)</span><br><span class="line">                    &#123;</span><br><span class="line">                        go.GetComponent&lt;MeshRenderer&gt;().material.color=Color.red;</span><br><span class="line">                    &#125;</span><br><span class="line">                    dictionary.Add(go.name,go);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.K))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> path = AstarManager.Instance.FindWay(<span class="keyword">new</span> Vec2((<span class="built_in">int</span>) start.x, (<span class="built_in">int</span>) start.y),</span><br><span class="line">                    <span class="keyword">new</span> Vec2((<span class="built_in">int</span>) end.x, (<span class="built_in">int</span>) end.y));</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> c <span class="keyword">in</span> path)</span><br><span class="line">                &#123;</span><br><span class="line">                    print(c.X+<span class="string">&quot;  &quot;</span>+c.Y);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Input.GetMouseButtonDown(<span class="number">0</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> ray= Camera.main.ScreenPointToRay(Input.mousePosition);</span><br><span class="line">                RaycastHit hit;</span><br><span class="line">                <span class="keyword">if</span> (Physics.Raycast(ray,<span class="keyword">out</span> hit,<span class="number">1000</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> c = hit.collider.gameObject;</span><br><span class="line">                    <span class="keyword">var</span> xy = c.name.Split(<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">                    <span class="comment">//开始终点</span></span><br><span class="line">                    <span class="keyword">if</span> (start==Vector2.right*<span class="number">-1</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        c.GetComponent&lt;MeshRenderer&gt;().material.color=Color.yellow;</span><br><span class="line">                        start=<span class="keyword">new</span> Vector2(<span class="built_in">int</span>.Parse(xy[<span class="number">0</span>]),<span class="built_in">int</span>.Parse(xy[<span class="number">1</span>]));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (end==Vector2.zero)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 终点</span></span><br><span class="line">                        c.GetComponent&lt;MeshRenderer&gt;().material.color=Color.blue;</span><br><span class="line">                            end=<span class="keyword">new</span> Vector2(<span class="built_in">int</span>.Parse(xy[<span class="number">0</span>]),<span class="built_in">int</span>.Parse(xy[<span class="number">1</span>]));</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        print(<span class="string">&quot;开始寻路&quot;</span>);</span><br><span class="line">                        <span class="comment">//寻路</span></span><br><span class="line">                        <span class="keyword">var</span> path = AstarManager.Instance.FindWay(<span class="keyword">new</span> Vec2((<span class="built_in">int</span>) start.x, (<span class="built_in">int</span>) start.y),</span><br><span class="line">                            <span class="keyword">new</span> Vec2((<span class="built_in">int</span>) end.x, (<span class="built_in">int</span>) end.y));</span><br><span class="line">                        <span class="keyword">foreach</span> (<span class="keyword">var</span> cc <span class="keyword">in</span> path)</span><br><span class="line">                        &#123;</span><br><span class="line">                            print(cc.X+<span class="string">&quot;  &quot;</span>+cc.Y);</span><br><span class="line">                            dictionary[cc.X+<span class="string">&quot;_&quot;</span>+cc.Y].GetComponent&lt;MeshRenderer&gt;().material.color=Color.green;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="相关阅读">相关阅读</h3><p><a href="https://zhuanlan.zhihu.com/p/54510444" title="路径规划之 A* 算法">路径规划之 A* 算法</a><br><a href="https://blog.csdn.net/Kprogram/article/details/81225176" title="迪杰斯特拉算法">迪杰斯特拉算法</a><br><a href="http://qiao.github.io/PathFinding.js/visual/" title="A*算法在线演示">A*算法在线演示</a></p>]]></content>
      
      
      <categories>
          
          <category> 算法设计 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Ink剧情编排</title>
      <link href="/2020/04/28/Ink%E5%89%A7%E6%83%85%E7%BC%96%E6%8E%92/"/>
      <url>/2020/04/28/Ink%E5%89%A7%E6%83%85%E7%BC%96%E6%8E%92/</url>
      
        <content type="html"><![CDATA[<h3 id="快速食用">快速食用</h3><ol><li>下载inky编辑器</li><li>编写ink文件</li><li>下载安装unity支持</li><li>找到ink示例，将对应的ink 生成的json导入运行游戏即可。</li></ol><h3 id="unity使用流程">unity使用流程</h3><p>在unity中，我们需要通过代码来驱动我们的剧情的进行。</p><ol><li><p>首先我们需要<code>创建至少2种Prefab</code>，一种表示文字，一种表示按钮。</p></li><li><p>然后我们需要创建一个story对象，载入对应的json文件<br><code>story = new Story (inkJSONAsset.text);</code></p></li><li><p>判断story能否继续，若能继续使用代码创建对应的游戏对象</p></li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (story.canContinue)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// Continue gets the next line of the story</span></span><br><span class="line"><span class="built_in">string</span> text = story.Continue ();</span><br><span class="line"><span class="comment">// This removes any white space from the text.</span></span><br><span class="line">text = text.Trim();</span><br><span class="line"><span class="comment">// Display the text on screen!</span></span><br><span class="line">CreateContentView(text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Display all the choices, if there are any!</span></span><br><span class="line"><span class="keyword">if</span>(story.currentChoices.Count &gt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; story.currentChoices.Count; i++) &#123;</span><br><span class="line">Choice choice = story.currentChoices [i];</span><br><span class="line">Button button = CreateChoiceView (choice.text.Trim ());</span><br><span class="line"><span class="comment">// Tell the button what to do when we press it</span></span><br><span class="line">button.onClick.AddListener (<span class="built_in">delegate</span> &#123;</span><br><span class="line">OnClickChoiceButton (choice);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// If we&#x27;ve read all the content and there&#x27;s no choices, the story is finished!</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">Button choice = CreateChoiceView(<span class="string">&quot;End of story.\nRestart?&quot;</span>);</span><br><span class="line">choice.onClick.AddListener(<span class="built_in">delegate</span>&#123;</span><br><span class="line">StartStory();</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CreateContentView</span> (<span class="params"><span class="built_in">string</span> text</span>)</span> &#123;</span><br><span class="line">Text storyText = Instantiate (textPrefab) <span class="keyword">as</span> Text;</span><br><span class="line">storyText.text = text;</span><br><span class="line">storyText.transform.SetParent (canvas.transform, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates a button showing the choice text</span></span><br><span class="line"><span class="function">Button <span class="title">CreateChoiceView</span> (<span class="params"><span class="built_in">string</span> text</span>)</span> &#123;</span><br><span class="line"><span class="comment">// Creates the button from a prefab</span></span><br><span class="line">Button choice = Instantiate (buttonPrefab) <span class="keyword">as</span> Button;</span><br><span class="line">choice.transform.SetParent (canvas.transform, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets the text from the button prefab</span></span><br><span class="line">Text choiceText = choice.GetComponentInChildren&lt;Text&gt; ();</span><br><span class="line">choiceText.text = text;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Make the button expand to fit the text</span></span><br><span class="line">HorizontalLayoutGroup layoutGroup = choice.GetComponent &lt;HorizontalLayoutGroup&gt; ();</span><br><span class="line">layoutGroup.childForceExpandHeight = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> choice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>要记得每次显示时清除上一次的显示结果</li></ol><h2 id="书写规则">书写规则</h2><blockquote><p>ink有一套自己的书写格式，不符合规范时无法编译。</p></blockquote><ul><li>选项 + xx 在选择后会重复 选项</li><li>选项 + [xx] 在选择后不会重复 选项</li><li>…</li></ul><h2 id="Unity支持">Unity支持</h2><p>更新时间：2022年12月8日16:39:09</p><blockquote><p>INk提供了Unity插件来支持。我们可以在github或者是AssterStore中获取。</p></blockquote><p>在Unity导入<code>.ink</code>文件可以在右侧检视图看到如下界面：</p><p>在这个界面可以对整个故事流程进行概览。</p><p>同时每次修改<code>.ink</code>文件后，都会自动生成一个<code>json</code>文件。我们要使用的就是生成的Json文件。</p><p><img src="http://pic.fasty97.top/NotePad/202212151532228.png" alt="image-20221215153223990"></p><h3 id="常用功能">常用功能</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置变量</span></span><br><span class="line">Ink.variablesState[<span class="string">&quot;hp&quot;</span>] = <span class="number">300</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//游戏端函数</span></span><br><span class="line">Ink.BindExternalFunction(<span class="string">&quot;log&quot;</span>, (<span class="built_in">string</span> info) =&gt; &#123; <span class="keyword">this</span>.Log(<span class="string">&quot;日志：&quot;</span> + info); &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//保存</span></span><br><span class="line"><span class="built_in">string</span> savedJson = _inkStory.state.ToJson();</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line">_inkStory.state.LoadJson(savedJson);</span><br><span class="line"></span><br><span class="line"><span class="comment">//从节点获取元数据</span></span><br><span class="line"><span class="keyword">var</span> tags= x.TagsForContentAtPath(<span class="string">&quot;DATA&quot;</span>);</span><br><span class="line">tags.ForEach(s=&gt;<span class="keyword">this</span>.Log(<span class="string">&quot;Tag|&quot;</span>+s));</span><br></pre></td></tr></table></figure><blockquote><p>2023年6月14日09:58:30 更新</p></blockquote><h3 id="Text-Animator-for-Unity">Text Animator for Unity</h3><blockquote><p>这里推荐一个插件用于字符动画的播放<code>Text Animator for Unity</code></p></blockquote><p>只需在Text上挂上相关组件即可以使用来实现文字的动画效果。</p><p><img src="http://pic.fasty97.top/NotePad/202306140946043.png" alt="Text Animator"></p><p>同时插件提供了很多内置的效果：</p><p><img src="http://pic.fasty97.top/NotePad/202306140949470.png" alt="image-20230614094916425"></p><p>使用ink和textAnimator配合实现的对话效果预览：</p><p><img src="http://pic.fasty97.top/NotePad/202306140956218.gif" alt="效果预览"></p><center>效果预览</center><h3 id="相关链接">相关链接</h3><ul><li><a href="https://www.inklestudios.com/ink/" title="inkle官网">inkle官网</a></li><li><a href="https://github.com/inkle/inky/releases/tag/0.11.0" title="inky编辑器">inky编辑器</a></li><li><a href="https://indienova.com/u/blindvolf/blogread/23249">相关教程参考-基础</a></li><li><a href="https://indienova.com/u/blindvolf/blogread/23257">相关教程参考-高级</a></li><li><a href="https://github.com/inkle/ink/blob/master/Documentation/RunningYourInk.md">ink/RunningYourInk.md at master · inkle/ink (github.com)</a></li><li><a href="https://blog.csdn.net/qq_43500611/article/details/109033414">Ink脚本语言学习笔记（一）_嘉神川优衣的博客-CSDN博客_unity ink使用</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 剧情 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 好物推荐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>YarnSpinner剧情编辑</title>
      <link href="/2020/04/27/YarnSpinner%E5%89%A7%E6%83%85%E7%BC%96%E8%BE%91/"/>
      <url>/2020/04/27/YarnSpinner%E5%89%A7%E6%83%85%E7%BC%96%E8%BE%91/</url>
      
        <content type="html"><![CDATA[<p>本来说好的每周一更又鸽了…<br>今天来水一期，介绍一款很棒的剧情编排应用 <code>YarnSpinner</code>。</p><h3 id="介绍">介绍</h3><p><code>YarnSpinner</code>是一款开源免费的剧情编排应用（或者说是一种用于剧情编排的标记语言）。<br>试想我们在开发游戏时，剧情有分支选择，有各种条件检查，如果我们全在代码中去判断和检查不仅繁杂而且非常麻烦，策划学习成本高，耦合性过强。你可能自己想出一套标记语言来表述剧情流程，但自己的力量毕竟是有限的，难免出现一些bug和坑。此时，不妨试试这款免费开源，多人共同维护的应用吧。</p><h3 id="快速食用">快速食用</h3><h4 id="代码式编辑">代码式编辑</h4><p>这里我使用vscode作为编辑器，下载一下插件：<br><img src="http://pic.fasty97.top/blog/20200427/a07bJtR8tRDh.png" alt="扩展"></p><p>我们先创建一个<code>.yarn</code>格式的文件，并写入以下内容：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">title: cc</span><br><span class="line">tags:</span><br><span class="line">colorID: 0</span><br><span class="line">position: 1,-22</span><br><span class="line">---</span><br><span class="line">Fasty97: Hi</span><br><span class="line">PC: 你好？！</span><br><span class="line">Fasty97: 我又回来了！</span><br><span class="line">PC: 是忘了什么东西吗？</span><br><span class="line">===</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是一段剧本最基本的格式（一个yarn文件至少包含一段剧本）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title: cc</span><br><span class="line">tags:</span><br><span class="line">colorID: 0</span><br><span class="line">position: 1,-22</span><br></pre></td></tr></table></figure><p>以上被称为一个剧本头，表示一段剧本，这些是一些剧本段的基本信息，其中<font color="red">title必填，position必填</font>.position为剧本段的标识符类似于ID一样的东西，不要重复。</p><h4 id="在unity中使用">在unity中使用</h4><ol><li>下载相关的unity支持包（官网有）</li><li>在场景中放入一个Dialogue预制体，预制体包含一个默认的设置示例。<br><img src="https://pic.fasty97.top/blog/20200427/AgJFSizXO2LE.png" alt=""></li><li>创建一个脚本</li><li>设定好相关的资源和引用</li><li>运行游戏尝试按下空格键吧</li></ol><h4 id="脚本设定">脚本设定</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEditorInternal;</span><br><span class="line"><span class="keyword">using</span> Yarn.Unity;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> Yarn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">YarnTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> DialogueRunner dr;</span><br><span class="line">    <span class="keyword">public</span> YarnProgram scriptToLoad;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//注入对话资源</span></span><br><span class="line">        dr.Add(scriptToLoad);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.Space))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;开始对话&quot;</span>);</span><br><span class="line">            <span class="comment">//开始一个对话</span></span><br><span class="line">            dr.StartDialogue(<span class="string">&quot;cc&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://pic.fasty97.top/blog/20200427/XkItpdgndrM8.gif" alt="默认"></p><h3 id="使用自定义方法">使用自定义方法</h3><p>我现在希望我第一次与角色交流时输出前2句，之后每次与角色交流只输出最后2句，这是一个游戏中常用的机制。但现在我们的对话只是按照流程依次执行，我们希望这个流程应该是能够动态控制的。<br>我们修改上面的yarn为：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">title: cc</span><br><span class="line">tags: </span><br><span class="line">colorID: 0</span><br><span class="line">position: 1,-22</span><br><span class="line">---</span><br><span class="line">&lt;&lt;if visited(&quot;cc&quot;) is false&gt;&gt;</span><br><span class="line">    Fasty97: Hi</span><br><span class="line">    PC: 你好？！</span><br><span class="line">&lt;&lt;else&gt;&gt;</span><br><span class="line">    Fasty97: 我又回来了！</span><br><span class="line">    PC: 是忘了什么东西吗？</span><br><span class="line">&lt;&lt;endif&gt;&gt;</span><br><span class="line">===</span><br></pre></td></tr></table></figure><p>可以看到这次我们使用 类似if语句的东西？ 这是yarn中提供的一种语法模式，在这里我们会执行一个自定义的方法visted并将&quot;cc&quot;传入方法中，如果返回的结果是 false就执行下面的语句块。</p><h4 id="处理自定义事件">处理自定义事件</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HashSet&lt;<span class="built_in">string</span>&gt; visitedNodes=<span class="keyword">new</span> HashSet&lt;<span class="built_in">string</span>&gt;();    <span class="comment">//已使用节点</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//注入对话资源</span></span><br><span class="line">    dr.Add(scriptToLoad);</span><br><span class="line">    <span class="comment">//注入处理方法</span></span><br><span class="line">    dr.AddFunction(<span class="string">&quot;visited&quot;</span>,<span class="number">1</span>,(Value[] parameters) =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> nodeName = parameters[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">return</span> visitedNodes.Contains(nodeName.AsString);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//绑定事件</span></span><br><span class="line">    dr.onNodeComplete.AddListener((name) =&gt; &#123; visitedNodes.Add(name); &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>创建一个HashSet集合用于存放所有已经被使用过的node，绑定一个onNodeComplete事件，这个事件有系统自动调用，在实现中为集合加入元素。<br>然后注入一个方法，第一个参数指定方法名（在yarn文件下的名称），第二个参数指定参数个数，第三个参数就是写入一个方法了，在方法中我们检查集合是否已经包含该值返回结果，一个自定义不可重复方法就处理好了。</p><p><img src="http://pic.fasty97.top/blog/20200427/zqkvGNEMJPMw.gif" alt="visited效果"></p><p>使用相同的方法你还可以创建各种各样的方法在yarn中使用。<br>值得注意的是：<br>通过源代码我们可以知道，yarn只支持以下几种数据类型。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> Value.Type.Number:</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">object</span>) <span class="keyword">this</span>.NumberValue;</span><br><span class="line"><span class="keyword">case</span> Value.Type.String:</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">object</span>) <span class="keyword">this</span>.StringValue;</span><br><span class="line"><span class="keyword">case</span> Value.Type.Bool:</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">object</span>) <span class="keyword">this</span>.BoolValue;</span><br><span class="line"><span class="keyword">case</span> Value.Type.Null:</span><br><span class="line">  <span class="keyword">return</span> (<span class="built_in">object</span>) <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><h3 id="相关链接">相关链接</h3><p><a href="https://yarnspinner.dev/" title="YarnSpinner">YarnSpinner 官网</a><br><a href="https://yarnspinnertool.github.io/YarnEditor/" title="YarnSpinner 在线编辑器">YarnSpinner 在线编辑器</a><br><a href="https://github.com/YarnSpinnerTool/YarnSpinner" title="YarnSpinner github">YarnSpinner github</a></p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 好物推荐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cinemachine的基本使用</title>
      <link href="/2020/04/15/Cinemachine%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/04/15/Cinemachine%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Unity版本：<font color=green>2019.3.6f1</font></p><p><font color=red>长文警告!!!</font></p><blockquote>  是否为摄像机脚本困扰？是否为镜头动画烦恼？ Cinemachine 超强插件解决你的问题！</blockquote><h3>安装Cinemachine</h3><p>现在Cinemachine作者已经投靠unity官方了，所以Cinemachine也成为了Unity的官方插件，我们可以直接在PackageManager中下载：<br><img src="http://pic.fasty97.top/blog/20200210/DBHDdslXchVa.png" alt=""></p><h3>各类相机简述</h3><p>安装之后我们可以在顶部菜单栏，看到如下的选项：<br><img src="http://pic.fasty97.top/blog/20200210/gd1H7MDqJgJs.png" alt=""></p><table><thead><tr>  <th>选项</th>  <th>说明</th></tr></thead><tbody><tr>  <td>Virtual Camera</td>  <td>虚拟摄像机</td></tr><tr>  <td>FreeLook Camera</td>  <td>自由相机，可以保证镜头内出现头和身体，及相机的活动范围在目标周围圆柱（曲面的）表面，一般用于第三人称控制器</td></tr><tr>  <td>State-driven Camera</td>  <td>状态驱动相机。添加虚拟相机列表，可以在不同的相机直接直接实现平滑切换，同时其子相机列表如果没有设置LookAt对象等，会直接使用这个父相机的对象。</td></tr><tr>  <td>ClearShot Camera</td>  <td>干净镜头相机。类似上一个相机，区别在于这个相机可以通过判断子相机的CinemachineCollider（如果有），看是否相机被场景物体阻碍，切换相机。具体可看其源码注释。</td></tr><tr>  <td>Dolly Camera with Track</td>  <td>可推拉的轨道相机。通过结合轨道路径，就可以模拟像拍电影般镜头轨道移动。</td></tr><tr>  <td>Group Target Camera</td>  <td>多目标相机。可以同时设置多个目标。</td></tr></tbody></table><h4>Cinemachine Brain</h4><p>在我们创建任意虚拟相机后，插件会为我们的摄像机添加此组件，此组件是我们虚拟相机的大脑，控制着真实相机的行为。（不可或缺）<br><img src="http://pic.fasty97.top/blog/20200210/4LQud3dfJPHP.png" alt=""></p><table><thead><tr>  <th>变量名</th>  <th>说明</th></tr></thead><tbody><tr>  <td>Live Camera</td>  <td>当前选择的虚拟相机。</td></tr><tr>  <td>Live Blend</td>  <td>当前的镜头转换名称。</td></tr><tr>  <td>Show Debug Text</td>  <td>在游戏画面左上角显示调试信息。</td></tr><tr>  <td>Show Camera Frustum</td>  <td>显示相机的视锥体，相比原来自带的边框，这个会裁切掉不在显示范围内的边线。</td></tr><tr>  <td>World Up Override</td>  <td>重载世界的向上方向（y轴），虚拟相机是通过这个来判断世界环境。</td></tr><tr>  <td>Default Blend</td>  <td>默认相机切换模式。</td></tr><tr>  <td>Custom Blends</td>  <td>自定义相机切换模式。</td></tr><tr>  <td>Camera Cut Event</td>  <td>相机立即切换时事件。</td></tr><tr>  <td>Camera Activated Event</td>  <td>相机混合（就是有切换变化，不是Cut时）切换时第一帧事件。</td></tr></tbody></table><h3 id="Virtual-Camera">Virtual Camera</h3><p>Cinemacine Virtual Camera 是Cinemachine最基本的相机，<br><img src="https://pic.fasty97.top/blog/20200415/oOMGlgOGXRpo.png" alt="Cinemacine Virtual Camera"></p><table><thead><tr><th style="text-align:left">变量名</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left">Status</td><td style="text-align:left">状态，Live为正在使用，Standby为准备使用（没在用，但如果上一级停用了，可能会切换到当前虚拟相机），Disable为不能用。按Solo按钮会让相机切换到这个虚拟相机（包括Disable）。</td></tr><tr><td style="text-align:left">Game Window Guides</td><td style="text-align:left">是否在game窗口显示辅助</td></tr><tr><td style="text-align:left">Save During Play</td><td style="text-align:left">保存游戏中的改变</td></tr><tr><td style="text-align:left">priority</td><td style="text-align:left">虚拟相机的优先级，如果同时有多个虚拟相机，使用优先级最高的。如果多个同等级的，应该是按Hierarchy顺序找到第一个虚拟相机。</td></tr><tr><td style="text-align:left">Lens</td><td style="text-align:left">镜头常用配置。视角区域，最近最远裁切平面， 镜头旋转角度。</td></tr><tr><td style="text-align:left">Body</td><td style="text-align:left">相机本身。四种：Hard constraint，固定距离，相当于第一人称。 Orbital Transposer：轨迹转换器？似乎是模拟第三人称。 Tracked Dolly，轨道推拉，相机只能在轨道上移动（即使设置了Follow对象），需要轨道路径CinemachinePath。 Transposer，普通的镜头转换。</td></tr><tr><td style="text-align:left">Aim</td><td style="text-align:left">瞄准设置，有三种：Hard constraint，固定距离，没有任何平滑效果。Composer，有平滑效果的瞄准目标。Group Composer，同时瞄准多个目标。</td></tr><tr><td style="text-align:left">Noise</td><td style="text-align:left">噪音，用于相机抖动，预设有多种效果，也可以自己建立新效果。</td></tr><tr><td style="text-align:left">Extension</td><td style="text-align:left">扩展，可以添加诸如相机碰撞器，相机变焦器等</td></tr></tbody></table><h4 id="TimeLine">TimeLine</h4><p>在TimeLine中实现2个镜头间的切换非常容易。<br><img src="https://pic.fasty97.top/blog/20200415/cfRA1u2z5SND.png" alt=""><br><img src="https://pic.fasty97.top/blog/20200415/D0m6KY0DjAHH.gif" alt=""></p><h3 id="FreeLook">FreeLook</h3><p><img src="https://pic.fasty97.top/blog/20200415/uFWo9v918gKw.png" alt="FreeLook 相机视野"><br>FreeLook相机是一个自由相机，类似于第三人称游戏中的相机，可以使用鼠标控制相机的朝向多方向的观察角色；其相机视野像是一个圆柱体，如上图所示。（相机始终会在这个圆柱体的轨道上运动。）<br><img src="https://pic.fasty97.top/blog/20200415/EMNEzmU0LM9r.gif" alt="FreeLook"><br>大多数参数与Virtual Camera相似，值得注意的是：<br><font color="red">在FreeLook相机中需要绑定 顶部，中间，底部三个位置，这三个位置将决定相机的最大视野。</font></p><h3 id="BlendList">BlendList</h3><p>如名字一样他管理的是一个camera列表，并将列表内的camera做混合到达射线机之间更自然的切换效果。<br><strong>我们可以控制摄像机切换的 缓动函数</strong>。<br>值得注意的是：当BlendList启用时,其下的摄像机会依次使用最后停留在最后一个摄像机里。</p><h3 id="CinemachineStateDrivenCamera">CinemachineStateDrivenCamera</h3><p>这是被动画状态所驱动的虚拟相机管理器，能够在觉得切换动画时，快速的切换该动画应该使用的相机。【注意设置层级和绑定动画控制器】<br><img src="https://pic.fasty97.top/blog/20200415/OnntsqFJoil7.png" alt="CinemachineStateDrivenCamera"></p><h3 id="ClearShoot">ClearShoot</h3><p>ClearShoot 也是一个管理器，负责管理一组camera，他的效果是时刻选择最优的摄像机。在复杂的场景中，我们的角色可能被环境所遮挡，我们需要多个摄像机来处理这种情况。<br>如下图所示，我设置了2个摄像机，一个在顶部，一个在后方，在角色移动到墙壁后面时，后方的摄像机被遮挡，此时会自动启动顶部摄像机。在角色回到墙壁后面时，顶部摄像机被遮挡，只能切换到后面的摄像机。<br><img src="https://pic.fasty97.top/blog/20200415/lDRTT3hjBhtH.gif" alt="ClearShoot"></p><h3 id="TargetGroup">TargetGroup</h3><p><img src="https://pic.fasty97.top/blog/20200415/ws4uSH9Nvs2O.png" alt="TargetGroup"><br>目标组管理器，可以让位于目标组管理器中的目标<code>尽可能</code>的位于屏幕中。<br>在使用目标组管理器时，务必为摄像机设置目标组类型：<br><img src="https://pic.fasty97.top/blog/20200415/rN7xlXVSamTd.png" alt=""></p><h3 id="Mixing">Mixing</h3><p>Mixing摄像机混合管理器，可以将多个摄像机的信息进行混合按照权重，得到最终的显示画面。<br>（通过多相机的焦点处建立坐标系按权重分配偏移）<br><img src="https://pic.fasty97.top/blog/20200415/mJ0BILNkgXu1.png" alt="Mixing"></p><h3 id="活区和死区">活区和死区</h3><p><img src="https://pic.fasty97.top/blog/20200415/L2dUgC4hSHQs.png" alt="活区和死区"></p><ul><li>A区域为死区（Dead Zone），对象在死区内任意移动<code>不会改变</code>摄像机的位置。</li><li>B区域为活区（Soft Zone），对象在活区时会触发摄像机<code>缓动</code>，最终将对象固定在死区。</li><li>C区域为界外区，对象在界外区活动时，摄像机会<code>立即</code>改变位置时，使对象位于活区。</li></ul><h3>本文参考</h3><p><a href="https://blog.csdn.net/qq_34552886/article/details/79388527" title="Unity Cinemachine插件学习笔记">[1]Unity Cinemachine插件学习笔记</a><br><a href="https://blog.csdn.net/kiritoV/article/details/96779497" title="个人笔记】Unity插件“Cinemachine”——实现尼尔机械纪元运镜设计">[2]个人笔记】Unity插件“Cinemachine”——实现尼尔机械纪元运镜设计</a></p><h3 id="Dolly轨道">Dolly轨道</h3><p>我们可以创建一个自定义的轨道，将摄像机限制在该轨道上。<br><img src="https://pic.fasty97.top/blog/20200415/5JS6PFq2vAWt.png" alt=""><br>如图所示我创建了一个圆形轨道，摄像机只能在轨道上运动。</p><h3 id="Dolly-with-Cart轨道">Dolly with Cart轨道</h3><p>让物体沿着轨道运动<br><img src="https://pic.fasty97.top/blog/20200415/O7FvKn3fSIff.gif" alt="Dolly with Cart轨道">（这是一个很强大的功能，其实我们不止能用在摄像机上，可以用在任何游戏对象上，让这个对象，或ui只能沿着这个轨道运动，并实时设置要达到哪个点，简言之这是一个曲线编辑器。）<br><img src="https://pic.fasty97.top/blog/20200415/iGxYjFgflcq3.png" alt=""></p><h3 id="总结">总结</h3><p>Cinemachine是一款非常棒的智能摄像机插件，非常的方便易用。解决大部分的摄像机问题，甚至无需编写代码。当然我们也可以使用代码来控制摄像机，更灵活的处理摄像机与角色之间的关系。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> Cinemachine </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
            <tag> Cinemachine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unity的对象池</title>
      <link href="/2020/04/13/unity%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%B1%A0/"/>
      <url>/2020/04/13/unity%E7%9A%84%E5%AF%B9%E8%B1%A1%E6%B1%A0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>对象池：在对象销毁时将对象放入池中，在使用对象时从池中取出对象，避免对象初始化和销毁时的昂贵代价。</p></blockquote><p>在游戏中我们需要很多的对象，这些对象可能是动态变化的，例如射击游戏中的子弹，是不断计数的，游戏中的特效也是随着游戏不断增加的。如果我们每次在使用时创建在消失时销毁，务必会造成很大的开销，使用对象池的概念我们可以初始化一定数量的对象在使用对象时使用池中的对象，在消失时把对象归还给对象池，实现对象的复用。</p><h3 id="单例模板">单例模板</h3><p>一般来说，对于全局的对象池我们需要一个全局的对象池管理器单例来管理所有的对象池。<br>在unity中我们会用到2种单例，一种是非mono单例，一种是mono单例。</p><h4 id="非mono单例">非mono单例</h4><p>纯粹的单例模式，添加了线程锁。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Threading;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ObjectPool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SingletonManager</span>&lt;<span class="title">T</span>&gt; <span class="keyword">where</span> <span class="title">T</span>:<span class="title">new</span> ()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> T _instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (_instance != <span class="literal">null</span>) <span class="keyword">return</span> _instance;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    _instance = <span class="keyword">new</span> T();</span><br><span class="line">                    Monitor.Enter(_instance);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">finally</span></span><br><span class="line">                &#123;</span><br><span class="line">                    Monitor.Exit(_instance);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="mono单例">mono单例</h4><p>mono单例用于挂载在游戏对象上。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ObjectPool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 通用单例模式</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span><span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt;: <span class="title">MonoBehaviour</span> <span class="keyword">where</span> <span class="title">T</span> : <span class="title">Singleton</span>&lt;<span class="title">T</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> T Instance &#123; <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Instance==<span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                Instance = <span class="keyword">this</span> <span class="keyword">as</span> T;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                Destroy(gameObject);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="对象池单例">对象池单例</h3><p>这里我以mono单例为例，其实现代码如下：<br>关键在于对象池的容量自动扩充，继承单例模板即可。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ObjectPool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 对象池</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPool</span> : <span class="title">Singleton</span>&lt;<span class="title">ObjectPool</span>&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> List&lt;GameObject&gt; freeObjects; <span class="comment">//自由对象</span></span><br><span class="line">        <span class="keyword">public</span> List&lt;GameObject&gt; useObjects; <span class="comment">//正在被使用的对象</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> GameObject objectPrefab;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> maxCount;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> addCount;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">base</span>.Awake();</span><br><span class="line">            InitPool();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 获得对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetItem</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (freeObjects.Count &gt; <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> item = freeObjects[<span class="number">0</span>];</span><br><span class="line">                freeObjects.Remove(item);</span><br><span class="line">                useObjects.Add(item);</span><br><span class="line">                item.SetActive(<span class="literal">true</span>);</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//扩充容量</span></span><br><span class="line">            maxCount += addCount;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; addCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                freeObjects.Add(InitObject());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> item2 = freeObjects[<span class="number">0</span>];</span><br><span class="line">            freeObjects.Remove(item2);</span><br><span class="line">            useObjects.Add(item2);</span><br><span class="line">            <span class="keyword">return</span> item2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 释放对象</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;t&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">FreeItem</span>(<span class="params">GameObject t</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            useObjects.Remove(t);</span><br><span class="line">            t.SetActive(<span class="literal">false</span>);</span><br><span class="line">            freeObjects.Add(t);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">InitPool</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; maxCount; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                freeObjects.Add(InitObject());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> GameObject <span class="title">InitObject</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> go = Instantiate(objectPrefab, transform, <span class="literal">true</span>);</span><br><span class="line">            go.SetActive(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">return</span> go;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="对象池的使用">对象池的使用</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">ObjectPool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ObjectPoolTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> GameObject go;</span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</span><br><span class="line">            &#123;</span><br><span class="line">                go= ObjectPool.Instance.GetItem();</span><br><span class="line">                print(go.name);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.S))</span><br><span class="line">            &#123;</span><br><span class="line">                ObjectPool.Instance.FreeItem(go);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="http://pic.fasty97.top/blog/20200413/OKbR5Jr1cYUP.gif" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>深入理解协程</title>
      <link href="/2020/04/12/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%8D%8F%E7%A8%8B/"/>
      <url>/2020/04/12/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E5%8D%8F%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在很多编程语言中都支持协程，例如在我们之前提到的lua中，协程是一个虚拟的线程技术。</p></blockquote><h3 id="简述">简述</h3><p>想一想我们平时购买电脑提及的，cpu是四核八线程，其实cpu原先只能处理处理一件事，也就是说cpu默认是一个核心对应一条线程的，但是如果我们需要同时处理多个任务，而我们并没有那么多的线程数量。<br>然后前人们就提出了虚拟线程的概念，将cpu的单个线程，虚拟出多条线程，也就有了我们四核八线程，八核十六线程等的概念；在应用程序这边也有了线程和进程的概念，在把进程再细分，虚拟化软件的线程就得到了协程的概念。</p><blockquote><p>至此你知道，协程就是对线程的再细分，是线程的再虚拟化即可。</p></blockquote><h3 id="unity的协程">unity的协程</h3><p>虽然说协程的概念并不新颖，但在现在大趋势的互联网开发领域可能很少涉及到<code>协程</code>这个词汇。<br>协程就是协力去完成一件事，这很容易想到多线程的概念，例如我们进行一次网络请求我们需要等待response之后才能下一步操作，此时我们就会用到<code>互斥锁</code>、<code>线程安全</code>等概念。<br>在unity中或者说在游戏引擎中，由于受到游戏主循环线程的制约，所以不能确保多线程的安全性，此时在同一线程下继续使用协程来承担多线程的工作就显得尤为重要。<br>（unity也退出了以性能优先的ECS模式，摒弃Mono框架，实现了可多线程协助开发的开发模式）<br>下面我们就主要以unity的协程详细介绍。</p><h3 id="unity协程示例">unity协程示例</h3><p>看这个例子：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建协程</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> IEnumerator <span class="title">Cor1</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title">WaitForSeconds</span>(<span class="params"><span class="number">2f</span></span>)</span>;</span><br><span class="line">    Debug.Log(<span class="string">&quot;2s到了&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//启动协程</span></span><br><span class="line">StartCoroutine(Cor1());</span><br></pre></td></tr></table></figure><p>这是一个简单示例，可以看到协程需要返回一个<code>IEnumerator</code>可迭代对象，这本来是Csharp中的迭代器模式的实现，在unity中unity以此为原型实现了协程。</p><h3 id="协程的参数">协程的参数</h3><p>在上面我们使用了 <code>new WaitForSeconds()</code>，这表示等待指定的时间。【注意WaitForSeconds与Time.Scale相关】<br>在上面使用的WaitForSeconds之外还有许多的参数，这些参数要么需要花费时间，要么返回bool，总之就是需要确定一个moveNext。</p><h3 id="协程的使用情况">协程的使用情况</h3><ol><li>用于不确定的时长情况（例如：网络请求，读写文件）</li><li>用于延迟执行</li><li>可当做简易计时器使用（例如：生产一批敌人）</li></ol><h3 id="协程的嵌套">协程的嵌套</h3><p>协程支持嵌套，如下是一个利用协程实现的巡逻的简单实现。<br><strong>注：在unity中，协程返回0或null表示等待下一帧。</strong></p><p><img src="https://pic.fasty97.top/blog/20200412/c1jAFxkeWJve.gif" alt=""></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Coroutines</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//协程测试</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CoroutTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> Transform[] wayPoints;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">bool</span> isLoop;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            isLoop = <span class="literal">true</span>;</span><br><span class="line">            StartCoroutine(StartLoop());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> IEnumerator <span class="title">StartLoop</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> point <span class="keyword">in</span> wayPoints)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="function"><span class="keyword">yield</span> <span class="keyword">return</span> <span class="title">StartCoroutine</span>(<span class="params">MoveTarget(point.position</span>))</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">while</span> (isLoop);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> IEnumerator <span class="title">MoveTarget</span>(<span class="params">Vector3 target</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (transform.position!=target)</span><br><span class="line">            &#123;</span><br><span class="line">                transform.position = Vector3.MoveTowards(transform.position, target, <span class="number">3</span> * Time.deltaTime);</span><br><span class="line">                <span class="keyword">yield</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="让协程动起来">让协程动起来</h3><ul><li><p>StartCoroutine(nameof(StartLoop));<br>以字符串形式启动协程，能够在外部停止协程，无法传递参数。</p></li><li><p>StartCoroutine(StartLoop);<br>以迭代器形式启动协程，能够传递参数，无法在外部使用stop停止协程。</p></li></ul><h3 id="让协程停下来">让协程停下来</h3><p>协程本质是一个迭代器，当moveNext为false时即认为协程中所有的项目都已经执行完毕。<br>在unity中有以下几种方式停止协程：</p><ol><li>StopCoroutine()  注意此方式只能停止以字符串形式启动的协程 【在协程外部使用】</li><li>yield break   跳出协程【在协程内部使用】</li><li>通过逻辑来停止 【使其协程执行条件不满足】</li><li>设置物体不激活 【再次激活协程也不会恢复】</li><li>StopAllCoroutine() 终止所有协程</li></ol><p>如上面协程嵌套的例子中，如果我们想要协程停止：</p><ol><li>设置isLoop=false；让其在执行一次后不满足条件自动停下</li><li>在协程内部break</li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (transform.position==wayPoints[<span class="number">2</span>].position)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>在协程外部 stop</li></ol><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">StopCoroutine(<span class="keyword">nameof</span>(StartLoop));</span><br></pre></td></tr></table></figure><h3 id="协程的设计思想">协程的设计思想</h3><h4 id="协程是否取代update？">协程是否取代update？</h4><p>通过上面的例子，你大可发现，协程其实是对update的另一种实现，我们甚至可以只使用协程而不使用任何update和fixedUpdate完成程序的编写。<br>但我们如果这样做不是本末倒置了吗？协程是unity推出的延迟执行的一种范式，其还是基于update为原理的上层实现。</p><h4 id="使用协程会大大提升程序效率吗？">使用协程会大大提升程序效率吗？</h4><p>不会，协程本质上还是在一条线程上，尽管可以多条协程并行，但这些协程始终还是运行在一条线程上，速度和效率并不会得到很大的提升。反而开辟多条线程并行，线程需要多多协程的状态保持监听，在协程大量结束时会触发大量GC 回收，可能会降低程序的运行效率。</p><h3 id="总结">总结</h3><p>协程是运行在线程上的线程，其运作方式任然基于单线程，并不会因为使用协程提高程序的运行效率，但协程方便的书写方式，强大的功能能够提高我们作为开发者的开发效率。<br>从某种意义上来讲，协程更像是一个精美的语法糖</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 协程 </tag>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第三人称角色摄像机案例分析</title>
      <link href="/2020/04/07/%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E8%A7%92%E8%89%B2%E6%91%84%E5%83%8F%E6%9C%BA%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/"/>
      <url>/2020/04/07/%E7%AC%AC%E4%B8%89%E4%BA%BA%E7%A7%B0%E8%A7%92%E8%89%B2%E6%91%84%E5%83%8F%E6%9C%BA%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<blockquote><p>很多第三人称角色扮演游戏都有一个很棒的角色摄像机</p></blockquote><h3 id="预览">预览</h3><p>实现后的效果如下：<br><img src="http://pic.fasty97.top/blog/20200407/DdMsrT65K52J.gif" alt="自由摄像机"><br>使用鼠标即可以移动摄像机，摄像机能智能的检测到碰撞体，并自动修正位置。</p><h4 id="备注">备注</h4><p>Camera.fieldOfView 属性可以获取到摄像机的焦距，修改该值，可以实现拉进拉远效果。</p><h3 id="核心参考">核心参考</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mouseX = Input.GetAxis(<span class="string">&quot;Mouse X&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> mouseY = Input.GetAxis(<span class="string">&quot;Mouse Y&quot;</span>);</span><br><span class="line">Camera.main.transform.localRotation = Camera.main.transform.localRotation *Quaternion.Euler(-mouseY, mouseX, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>以上代码是将鼠标移动和摄像机位置关联起来的关键代码，首先我们取得鼠标的x和y轴上的axis值，然后将摄像机的旋转量*(-mouseY, mouseX, 0)构成的四元数。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Quaternion.Euler(vector3)</span><br></pre></td></tr></table></figure><p>可以将一个3维向量转换为一个四元数。</p><h3 id="完整代码">完整代码</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> NaughtyAttributes;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">namespace</span> _<span class="title">Scripts</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 摄像机控制器</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CameraController</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;玩家&quot;</span>)</span>] <span class="keyword">private</span> Transform player;</span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;平滑速度&quot;</span>)</span>] <span class="keyword">private</span> <span class="built_in">float</span> smooth = <span class="number">10f</span>;</span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;h轴偏转速度&quot;</span>)</span>] <span class="keyword">private</span> <span class="built_in">float</span> hSpeed = <span class="number">6f</span>;</span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;v轴偏转速度&quot;</span>)</span>] <span class="keyword">private</span> <span class="built_in">float</span> vSpeed = <span class="number">6f</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;相机位置偏移&quot;</span>)</span>] <span class="keyword">private</span> Vector3 camOffset;</span><br><span class="line">        [<span class="meta">SerializeField,Header(<span class="string">&quot;锚点位置偏移&quot;</span>)</span>] <span class="keyword">private</span> Vector3 pivotOffset;</span><br><span class="line">        [<span class="meta">MinMaxSlider(-100, 100), SerializeField,Header(<span class="string">&quot;偏转角范围&quot;</span>)</span>]</span><br><span class="line">        <span class="keyword">private</span> Vector2 minMaxVAngle;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> targetFov;                        <span class="comment">//目标Fov</span></span><br><span class="line">        <span class="keyword">private</span> Vector3 targetPivotOffset;              <span class="comment">//目标锚点offset</span></span><br><span class="line">        <span class="keyword">private</span> Vector3 targetCamOffset;                <span class="comment">//目标相机offset</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Transform cam;    </span><br><span class="line">        <span class="keyword">private</span> Camera myCamera;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> Vector3 smoothPivotOffset;     <span class="comment">//当前锚点插值</span></span><br><span class="line">        <span class="keyword">private</span> Vector3 smoothCamOffset;       <span class="comment">//当前相机位置插值</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> defaultFov;           <span class="comment">//默认fov</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> relCameraPosMag;    <span class="comment">//射线检测长度</span></span><br><span class="line">        <span class="keyword">private</span> <span class="built_in">float</span> angleH, angleV;    </span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            cam = transform;</span><br><span class="line">            myCamera = GetComponent&lt;Camera&gt;();</span><br><span class="line">            defaultFov = myCamera.fieldOfView;</span><br><span class="line">            <span class="comment">//设置相机默认位置</span></span><br><span class="line">            cam.position = player.position + Quaternion.identity * pivotOffset + Quaternion.identity * camOffset;</span><br><span class="line">            cam.rotation = Quaternion.identity;</span><br><span class="line"></span><br><span class="line">            smoothPivotOffset = pivotOffset;</span><br><span class="line">            smoothCamOffset = camOffset;</span><br><span class="line">            angleH = player.eulerAngles.y;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//射线检测</span></span><br><span class="line">            relCameraPosMag = (transform.position - player.position).magnitude - <span class="number">0.5f</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment">//重置属性</span></span><br><span class="line">            ResetTargetOffsets ();</span><br><span class="line">            ResetFov ();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            angleH += Input.GetAxis(<span class="string">$&quot;Mouse X&quot;</span>) * hSpeed;</span><br><span class="line">            angleV += Input.GetAxis(<span class="string">$&quot;Mouse Y&quot;</span>) * vSpeed;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//限制偏转</span></span><br><span class="line">            angleV = Mathf.Clamp(angleV, minMaxVAngle.x, minMaxVAngle.y);</span><br><span class="line">            <span class="keyword">var</span> aimRotation = Quaternion.Euler(-angleV, angleH, <span class="number">0</span>);</span><br><span class="line">            cam.rotation = Quaternion.Euler(-angleV, angleH, <span class="number">0</span>);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//y 旋转</span></span><br><span class="line">            <span class="keyword">var</span> camYRotation = Quaternion.Euler(<span class="number">0</span>, angleH, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//焦距</span></span><br><span class="line">            myCamera.fieldOfView = Mathf.Lerp(myCamera.fieldOfView, targetFov, Time.deltaTime);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//射线检测动态修正位置</span></span><br><span class="line">            <span class="keyword">var</span> baseTempPosition = player.position + camYRotation * targetPivotOffset;</span><br><span class="line">            <span class="keyword">var</span> noCollisionOffset = targetCamOffset;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">var</span> zOffset = targetCamOffset.z; zOffset &lt;= <span class="number">0</span>; zOffset+=<span class="number">0.5f</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                noCollisionOffset.z = zOffset;</span><br><span class="line">                <span class="keyword">if</span> (PosCheck(baseTempPosition+aimRotation*noCollisionOffset,Mathf.Abs(zOffset)))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//碰撞修正相机位置</span></span><br><span class="line">            smoothPivotOffset = Vector3.Lerp(smoothPivotOffset, targetPivotOffset, smooth * Time.deltaTime);</span><br><span class="line">            smoothCamOffset = Vector3.Lerp(smoothCamOffset, noCollisionOffset, smooth * Time.deltaTime);</span><br><span class="line"></span><br><span class="line">            cam.position = player.position + camYRotation * smoothPivotOffset + aimRotation * smoothCamOffset;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 重置offset</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ResetTargetOffsets</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            targetPivotOffset = pivotOffset;</span><br><span class="line">            targetCamOffset = camOffset;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 重置FOV</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ResetFov</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            targetFov = defaultFov;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 检查摄像机位置</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;checkPos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;offset&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">PosCheck</span>(<span class="params">Vector3 checkPos, <span class="built_in">float</span> offset</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//获得碰撞器高度</span></span><br><span class="line">            <span class="keyword">var</span> playerH=player.GetComponent&lt;CapsuleCollider&gt;().height * <span class="number">0.75f</span> &gt; <span class="number">0</span></span><br><span class="line">                ? player.GetComponent&lt;CapsuleCollider&gt;().height * <span class="number">0.75f</span></span><br><span class="line">                : player.GetComponent&lt;CharacterController&gt;().height * <span class="number">0.75f</span>;</span><br><span class="line">            <span class="keyword">return</span> ViewPosCheck(checkPos, playerH) &amp;&amp; ReverseViewPosCheck(checkPos,playerH,offset);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 碰撞检查</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;checkPos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;playerH&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">ViewPosCheck</span>(<span class="params">Vector3 checkPos, <span class="built_in">float</span> playerH</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> target = player.position + (Vector3.up * playerH);</span><br><span class="line">            <span class="keyword">if</span> (Physics.SphereCast(checkPos,<span class="number">0.2f</span>,target-checkPos,<span class="keyword">out</span>  RaycastHit hit,relCameraPosMag))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (hit.transform!=player&amp;&amp;!hit.transform.GetComponent&lt;Collider&gt;().isTrigger)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 反向碰撞检测</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;checkPos&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;playerH&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;maxDistance&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">ReverseViewPosCheck</span>(<span class="params">Vector3 checkPos, <span class="built_in">float</span> playerH, <span class="built_in">float</span> maxDistance</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// Cast origin.</span></span><br><span class="line">            <span class="keyword">var</span> origin = player.position + (Vector3.up * playerH);</span><br><span class="line">            <span class="keyword">if</span> (Physics.SphereCast(origin, <span class="number">0.2f</span>, checkPos - origin, <span class="keyword">out</span> RaycastHit hit, maxDistance))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(hit.transform != player &amp;&amp; hit.transform != transform &amp;&amp; !hit.transform.GetComponent&lt;Collider&gt;().isTrigger)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动画补间DOTween</title>
      <link href="/2020/03/27/%E5%8A%A8%E7%94%BB%E8%A1%A5%E9%97%B4DOTween/"/>
      <url>/2020/03/27/%E5%8A%A8%E7%94%BB%E8%A1%A5%E9%97%B4DOTween/</url>
      
        <content type="html"><![CDATA[<blockquote><p>在游戏中，我们可能需要这样的效果，将一个物体放大2倍，在2s之内完成；或者在点击UI时将UI逐渐消失。这样需要多作用效果进行逐步展示的效果被称之为补间。</p></blockquote><p>为了引出我们今天的主角<code>DOTween</code>,我们先来看看用unity的animation系统制作一个帧动画序列。</p><p><img src="http://pic.fasty97.top/blog/20200327/QQOrLw0fzaM2.gif" alt="示例效果"></p><h3 id="普通的动画">普通的动画</h3><p>我们需要以下几个步骤：</p><ol><li>创建并录制动画</li><li>在Animator中设置</li><li>绑定按钮事件</li></ol><p>代码部分：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">int</span> Play = Animator.StringToHash(<span class="string">&quot;Play&quot;</span>);</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartAni</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    ui.GetComponent&lt;Animator&gt;().SetTrigger(Play);</span><br><span class="line">    print(<span class="string">&quot;播放动画&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们需要既需要创建资源，有需要绑定设置，操作过程略微麻烦。</p><h3 id="DoTween动画">DoTween动画</h3><p>在DoTween中我们仅仅需要绑定好按钮事件即可，不要创建动画资源，设置动画播发器等麻烦事。<br>这在轻度使用补间动画里是非常不错的。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">StartAni</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> rec = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">    rec.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>RectTransform组件，这是ui所特有的描述transform的组件，第二行代码我们使用扩展方法<br>让我们来分析一下这2行代码，第一行 我们找到UI的RectTransform组件，这是ui所特有的描述transform的组件，第二行代码我们使用扩展方法DOLocalMoveX对组件位置进行补间，目的地位置为0（此时也就是锚点的位置，我这里以中心作为锚点），第二个参数是完成动画的时间我选择2。也就是说在2s内让这个UI从飞到他x轴的锚点位置。</p><h4 id="通用方法">通用方法</h4><p>上面的扩展方法我们也可以使用如下的通用方法来替代。</p><p><img src="http://pic.fasty97.top/blog/20200327/pQepanWBOJ70.png" alt="通用方法"></p><h4 id="From动画">From动画</h4><p><img src="http://pic.fasty97.top/blog/20200327/DlX2YONOLHtW.gif" alt="From动画"></p><p>不论是我们使用扩展方法创建的动画还是通用方法创建的动画，我们都可以添加<code>.Form()</code>来设定为逆动画。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> rec = GetComponent&lt;RectTransform&gt;();</span><br><span class="line">rec.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>).From();</span><br></pre></td></tr></table></figure><h3 id="知识速记（扩展方法）">知识速记（扩展方法）</h3><blockquote><p>扩展方法使您能够向现有类型“添加”方法，而无需创建新的派生类型、重新编译或以其他方式修改原始类型</p></blockquote><p>如果之前的代码较多，在考虑重构时，扩展方法可比接口好用哦。</p><h3 id="小案例-打字机效果">小案例-打字机效果</h3><p><img src="http://pic.fasty97.top/blog/20200327/JSYE1SHQEGNg.gif" alt="打字机效果"></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Text info;</span><br><span class="line">[<span class="meta">ResizableTextArea</span>]<span class="keyword">public</span> <span class="built_in">string</span> infoData;</span><br><span class="line">info.DOText(infoData, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><h3 id="DoTween的约定">DoTween的约定</h3><p>在详细讲解DoTween之前，我们先来了解一下dotween的设计原理和约定。<br>0. dotween使用tween（补间）来描述一段动画或缓动：<br><code>rec.DOLocalMoveX(0, 2).From()</code>就是一个tween。<br>使用Sequence（序列）来表述一组tween，在下面介绍Sequence。</p><ol><li>和我们平时使用unity一样，动态变化的部分防止在update或fiexedUpdate中，dotween也是这样的，在游戏启动时他会将所有的tween的放置在一个容器中（使用了<code>对象池</code>）。</li><li>不论是tween或者是Sequence默认都将在执行完成后自动杀死。</li><li>tween默认使用timescale（也就是说我们常用的timescale=0暂停游戏也将暂停tween）</li></ol><h3 id="On事件监听">On事件监听</h3><p>我们可以对一个序列或者一个补间注册事件监听状态。<br>以下是一些事件：</p><table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>onComplete</td><td>注册完成委托</td></tr><tr><td>onKill</td><td>注册杀死委托</td></tr><tr><td>onPlaye</td><td>注册开始委托</td></tr><tr><td>onPause</td><td>注册暂停委托</td></tr><tr><td>onUpdate</td><td>注册更新委托</td></tr><tr><td>onRewind</td><td>注册倒带委托</td></tr><tr><td>OnStepComplete</td><td>每次循环完成时</td></tr></tbody></table><p><strong>每个委托都有对应的方法类型可使用。</strong></p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transform.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>).onKill += () =&gt; &#123; print(<span class="string">&quot;hi&quot;</span>); &#125;;</span><br><span class="line">transform.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>).OnStart(() =&gt; print(<span class="string">&quot;开始了&quot;</span>));</span><br></pre></td></tr></table></figure><h3 id="Set设定">Set设定</h3><p>我们可以对一个序列或者一个补间设定细节。</p><h4 id="setLoop设定循环">setLoop设定循环</h4><ul><li>参数一： 循环次数（设定为-1为无限循环）</li><li>参数二： 循环类型</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">transform.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>).SetLoops(<span class="number">-1</span>, LoopType.Incremental);</span><br></pre></td></tr></table></figure><table><thead><tr><th>循环类型</th><th>说明</th></tr></thead><tbody><tr><td>Incremental</td><td>递增，每次播放结束star和end都会加入到差异值中</td></tr><tr><td>Restart</td><td>重来，播放结束时从起点重新播放</td></tr><tr><td>Yoyo</td><td>摇摆播放</td></tr></tbody></table><h4 id="SetEase设定曲线">SetEase设定曲线</h4><p><img src="https://img-blog.csdn.net/20151022164141659" alt=""></p><h4 id="其他常用方法">其他常用方法</h4><ol><li>setLink(Gameobject) :<br>将tween链接到游戏物体，在物体被销毁时自动销毁对象（在序列中无效）</li><li>setId(object):<br>设定tween的id，用于找到tween，使用数字时效率最高，字符串次之</li><li>SetAutoKill（bool）：<br>设定tween执行完是否自动杀死，复用twenn设为false</li><li>SetDelay（float）:<br>设定开始播放前的延迟</li><li>SetUpdate(UpdateType):<br>设定更新模式</li><li>SetAs(tween)：<br>使用其他tween的设定模板</li></ol><h3 id="Sequence序列">Sequence序列</h3><p>将很多tween放在一起称为一个序列Sequence。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mySeq = DOTween.Sequence();</span><br><span class="line">           mySeq.Append(rec.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">           mySeq.Append(info.DOText(infoData, <span class="number">3</span>));</span><br><span class="line">           <span class="comment">//在所有补间执行完时回调</span></span><br><span class="line">           mySeq.AppendCallback(() =&gt; &#123; print(<span class="string">&quot;动画播放完成！&quot;</span>); &#125;);</span><br><span class="line">           <span class="comment">//插入</span></span><br><span class="line">           <span class="comment">/*在给定的时间位置插入给定的补间，从而使您可以重叠补间，而不仅仅是将它们一个接一个地放置。*/</span></span><br><span class="line">           mySeq.Insert(<span class="number">0.5f</span>, rec.DOScaleX(<span class="number">2f</span>, <span class="number">2f</span>));</span><br><span class="line">           <span class="comment">//给定时间插入回调</span></span><br><span class="line">           mySeq.InsertCallback(<span class="number">2f</span>, () =&gt; print(<span class="string">&quot;移动动画结束了&quot;</span>));</span><br><span class="line">           <span class="comment">//在序列开头插入补间</span></span><br><span class="line">           mySeq.Prepend(info.DOText(<span class="string">&quot;在开头插入的补间。。。&quot;</span>, <span class="number">3</span>));</span><br><span class="line">           mySeq.PrependCallback((() =&gt; print(<span class="string">&quot;开头插入开始/动画开始播放&quot;</span>)));</span><br><span class="line">           <span class="comment">//序列开始延迟</span></span><br><span class="line">           mySeq.PrependInterval(<span class="number">2</span>);</span><br><span class="line">           <span class="comment">//暂停序列</span></span><br><span class="line">           <span class="comment">// mySeq.Pause();</span></span><br><span class="line"></span><br><span class="line">           <span class="comment">//可以写在一起</span></span><br><span class="line">            mySeq.Append(rec.DOLocalMoveX(<span class="number">0</span>, <span class="number">2</span>))</span><br><span class="line">                .Append(info.DOText(infoData, <span class="number">3</span>))</span><br><span class="line">                .AppendCallback(() =&gt; &#123; print(<span class="string">&quot;动画播放完成！&quot;</span>); &#125;);</span><br></pre></td></tr></table></figure><h3 id="DoTween和协程">DoTween和协程</h3><p>看个例子：协程在完成动画之后执行</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">IEnumerator <span class="title">Wait</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> tt = transform.DOMoveX(<span class="number">2</span>, <span class="number">2f</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="keyword">return</span> tt.WaitForCompletion();</span><br><span class="line"></span><br><span class="line">    print(<span class="string">&quot;动画完成&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td>WaitForElapsedLoops（int）</td><td>在循环指定次数或tween被杀死后</td></tr><tr><td>WaitForKill</td><td>在tween被杀死后</td></tr><tr><td>WaitForPosition</td><td>到达给定位置或被杀死</td></tr><tr><td>WaitForRewind</td><td>被杀死或重新播放</td></tr><tr><td>WaitForStart</td><td>开始播放</td></tr></tbody></table><h3 id="全局设定">全局设定</h3><p>我们可以使用<code>DoTween</code>类的静态字段来设置对应的默认行为。<br>如设定是否自动播放，是否自动销毁，对象池大小，默认曲线方式，所有的tween和Sequence序列在没有设定参数时默认取全局设定的值。<br>在Pro版本我们也可以在可视化面板中设置这些参数。</p><p>在运行游戏后我们可以发现场景中多了一个twenn的对象，上面可以在游戏中实时查看tween的信息。</p><p><img src="http://pic.fasty97.top/blog/20200328/3TwHh67DgDOd.png" alt=""></p><h3 id="复用动画">复用动画</h3><blockquote><p>2021年12月9日18:37:03 更新</p></blockquote><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个序列</span></span><br><span class="line"><span class="keyword">private</span> Sequence seq;</span><br><span class="line"><span class="comment">//设置序列</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Awake</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">seq = DOTween.Sequence();</span><br><span class="line">seq.Append(titleTxt.rectTransform.DOLocalMoveX(<span class="number">-1500</span>, <span class="number">1f</span>).From());</span><br><span class="line">seq.Append(titleTxt.DOFade(<span class="number">0</span>, <span class="number">0.5f</span>).SetDelay(<span class="number">0.5f</span>));</span><br><span class="line">seq.SetLink(titleTxt.gameObject).AppendCallback(() =&gt; &#123; endBtn.gameObject.SetActive(<span class="literal">true</span>); &#125;)</span><br><span class="line">                .PrependCallback(</span><br><span class="line">                    () =&gt; &#123; endBtn.gameObject.SetActive(<span class="literal">false</span>); &#125;).SetAutoKill(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二次启用时需要这个</span></span><br><span class="line">seq.Restart();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unity ScriptableObject的使用</title>
      <link href="/2020/03/25/unity%20ScriptableObject%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/03/25/unity%20ScriptableObject%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h3 id="概念">概念</h3><p>ScriptableObject是unity提出的针对数据存储资源的解决方案，能够将数据配置项<code>可视化</code>的展示在unityd属性面板中，并且极易于json进行数据交互。<br>个人使用过后觉得，其操作方式和继承非常类似，感觉像是对继承进一步封装使其更符合unity开发需要，让数据实体化，具现化的展示，通过拖拽式即可像拆装零件一般自由组合数据。（总而言之是对继承和多态的封装）</p><h3 id="使用场景">使用场景</h3><p>用于ScriptableObject是针对unity的，在unity使用时比传统的数据格式如json，xml更加方便快捷。而且在面对诸如策划，美工等不了解程序的人员来说，上手更加快捷。<br>实质上，ScriptableObject主要还是对数据进行存储和处理，只要是使用数据的地方都可以使用ScriptableObject进行配置式管理，这样相比直接继承式的数据传递，耦合性更低。<br>更符合<code>多组合少继承</code>的设计理念。</p><h3 id="基本使用">基本使用</h3><p>遵循步骤：</p><ol><li>创建资源脚本，继承自<code>UnityEngine.ScriptableObject</code></li><li>创建资源对象</li><li>在其他脚本中以组件形式指定资源对象</li></ol><p>我们可以将一些诸如敌人的血量，攻击，防御等数值存储在ScriptableObject中。</p><h4 id="创建资源脚本">创建资源脚本</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;My Assets/Create ItemAssets&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemAssets</span> : <span class="title">UnityEngine.ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> title;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">$&quot;title:<span class="subst">&#123;title&#125;</span>  price:<span class="subst">&#123;price&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="指定资源使用">指定资源使用</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="keyword">public</span> ScriptableObject itemAsset;</span><br><span class="line">itemAsset.title;</span><br><span class="line">itemAsset.price;</span><br></pre></td></tr></table></figure><h3 id="单例资源脚本">单例资源脚本</h3><p>在平时我们一般使用GameManager实现单例模式并设置在切换场景时不销毁来达到全局数据的管理。<br>在ScriptableObject中，我们同样可以达到这个效果，由于ScriptableObject是一个资源可直接存储在磁盘，不需要设置不销毁也能存储全局数据，管理同步。</p><h4 id="创建单例资源">创建单例资源</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Assets</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;My Assets/Create GameStateAssets&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameStateAsset</span> : <span class="title">ScriptableObject</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> level;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">int</span> score;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> GameStateAsset _instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> GameStateAsset Instance &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_instance)</span><br><span class="line">                &#123;</span><br><span class="line">                    _instance= Resources.FindObjectsOfTypeAll&lt;GameStateAsset&gt;().FirstOrDefault();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!_instance)</span><br><span class="line">                &#123;</span><br><span class="line">                   _instance= CreateInstance&lt;GameStateAsset&gt;();</span><br><span class="line">                   _instance.hideFlags = HideFlags.DontSave;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="built_in">string</span> <span class="title">ToString</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">$&quot;level:<span class="subst">&#123;level&#125;</span>  score:<span class="subst">&#123;score&#125;</span>&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用单例资源">使用单例资源</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GameStateAsset.Instance.level = <span class="number">8</span>;</span><br><span class="line">GameStateAsset.Instance.score = <span class="number">255</span>;</span><br><span class="line">Debug.Log(GameStateAsset.Instance);</span><br></pre></td></tr></table></figure><h3 id="临时资源">临时资源</h3><p>有时我们需要动态的生成一些对象，这些对象的数据可能并不是静态的设置好的，并且只是临时的使用这些数据，我们可以直接创建临时的ScriptableObject来处理这种情况。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> item = ScriptableObject.CreateInstance&lt;ItemAssets&gt;();</span><br><span class="line">item.title = <span class="string">&quot;测试物品&quot;</span>;</span><br><span class="line">item.price = <span class="number">100</span>;</span><br><span class="line">Debug.Log(item);</span><br><span class="line"></span><br><span class="line">ScriptableObject.Destroy(item);</span><br></pre></td></tr></table></figure><h3 id="插槽式资源">插槽式资源</h3><p>有时数据是需要被再加工的，加工的过程不应该影响到数据的使用，对于使用数据的一方，不必知晓数据的具体加工过程，这些过程就好像一个个插槽，就等待着期望的数据进入即可。<br>从这里我们也可以看出，在ScriptableObject中是可以包含<code>方法</code>的。</p><h4 id="创建资源">创建资源</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">PowerUpAsset</span> : <span class="title">ScriptableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">GameObject go</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;My Assets/Create HealthUpAsset&quot;</span>)</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HealthUpAsset</span> : <span class="title">PowerUpAsset</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> <span class="keyword">value</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params">GameObject go</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        go.GetComponent&lt;Health&gt;().currHealth += <span class="keyword">value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="使用资源">使用资源</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemHpUp</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> HealthUpAsset hpAsset;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnTriggerEnter</span>(<span class="params">Collider other</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (other.CompareTag(<span class="string">&quot;Player&quot;</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            hpAsset.Add(other.gameObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="与Json交互">与Json交互</h3><p>ScriptableObject和json有很高的亲和性（ScriptableObject就是基于类的延伸）<br>在某些情况下，我们可能需要将json数据存入ScriptableObject或将ScriptableObject写入json 来实现一些如游戏存档等的功能。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"><span class="keyword">using</span> UnityEngine.Serialization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Assets.TalkJson</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">CreateAssetMenu(menuName = <span class="string">&quot;My Assets/Create GameFileAsset&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">GameFileAsset</span> : <span class="title">ScriptableObject</span></span><br><span class="line">    &#123;</span><br><span class="line">        [<span class="meta">System.Serializable</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Archive</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">string</span> DateTime &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">string</span> Name &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">            <span class="keyword">public</span> <span class="built_in">int</span> Level &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> GameFileAsset _instance;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> GameFileAsset Instance</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (!_instance)</span><br><span class="line">                    _instance = Resources.FindObjectsOfTypeAll&lt;GameFileAsset&gt;().FirstOrDefault();</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> UNITY_EDITOR</span></span><br><span class="line">                <span class="keyword">if</span> (!_instance)</span><br><span class="line">                    InitializeFromDefault(UnityEditor.AssetDatabase.LoadAssetAtPath&lt;GameFileAsset&gt;(<span class="string">&quot;Assets/Test game file.asset&quot;</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">                <span class="keyword">return</span> _instance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> List&lt;Archive&gt; archives;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">public</span> Archive currArchive;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">InitializeFromDefault</span>(<span class="params">GameFileAsset <span class="keyword">file</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_instance) DestroyImmediate(_instance);</span><br><span class="line">            _instance = Instantiate(<span class="keyword">file</span>);</span><br><span class="line">            _instance.hideFlags = HideFlags.HideAndDontSave;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">LoadFromJson</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line">       &#123;</span><br><span class="line">           <span class="keyword">if</span> (!_instance) DestroyImmediate(_instance);</span><br><span class="line">           _instance = ScriptableObject.CreateInstance&lt;GameFileAsset&gt;();</span><br><span class="line">           JsonUtility.FromJsonOverwrite(System.IO.File.ReadAllText(path), _instance);</span><br><span class="line">           _instance.hideFlags = HideFlags.HideAndDontSave;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveToJson</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line">       &#123;</span><br><span class="line">           Debug.LogFormat(<span class="string">&quot;Saving game file to &#123;0&#125;&quot;</span>, path);</span><br><span class="line">           System.IO.File.WriteAllText(path, JsonUtility.ToJson(<span class="keyword">this</span>, <span class="literal">true</span>));</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="个人理解">个人理解</h3><p>ScriptableObject其实就是对类的特殊处理，在unity中将这里的类脚本特异性的识别让其数据可视化，并在内部实现了实例化处理，让其可以直接在脚本中使用而无需实例化对象。</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 效率提升 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HDRP体验2B小姐姐</title>
      <link href="/2020/03/22/HDRP%E4%BD%93%E9%AA%8C2B%E5%B0%8F%E5%A7%90%E5%A7%90/"/>
      <url>/2020/03/22/HDRP%E4%BD%93%E9%AA%8C2B%E5%B0%8F%E5%A7%90%E5%A7%90/</url>
      
        <content type="html"><![CDATA[<p>在上一个文章<a href="https://www.fasty97.top/lwrp%e4%b8%8bshadergraph%e7%9a%84%e4%bd%bf%e7%94%a8/" title="LWRP">LWRP</a>中我们介绍了LWRP的基本使用方法，并使用ShaderGraph写了两个小例子。<br>这次我们就来尝试一下HDRP，效果上要比LWRP或者普通渲染管线好多少。</p><h3 id="效果预览">效果预览</h3><p><video src="http://pic.fasty97.top/blog/blog-nierHDRP.mp4" autoplay loop style="width:100%"></video></p><p>可以看到在HDRP中的效果还是比较不错的，各种光影的质量都还不错。</p><h3 id="HDRP-入门">HDRP 入门</h3><ol><li>下载安装以下依赖:<br><img src="http://pic.fasty97.top/blog/20200322/kl15u7a5e2GF.png" alt=""></li><li>创建HDRP资源并设置（这个和LWRP差不多）</li><li>设置颜色空间为<code>Linner</code>(这个设置很重要)</li><li>创建全局Volm管理环境</li></ol><p>以上就是主要的步骤，下面我详细说一下一些细节的地方。</p><h3 id="如何使用天空盒">如何使用天空盒</h3><p>在HDRP中有多种天空类型：<code>颜色渐变天空</code>，<code>纯色天空</code>，<code>HDRI天空</code>，<code>物理天空</code>等。<br>大家可以看到我的天空是有一些云朵的一个天空盒，在HDRP中默认是纯色的黑天空，我们可以添加一个Volume对象或者在游戏物体上挂载一个Volume脚本来对默认设置进行重写。<br>如我这样我可视化环境组件，用于设置天空类型，这里我将其设置为HDRI，再添加一个HDRI Sky组件用于详细设置，在Hdri Sky项目中设置导入的天空盒cubemap。<br><img src="http://pic.fasty97.top/blog/20200322/WnOvO7pHMlnr.png" alt=""><br>添加一个：<br><img src="http://pic.fasty97.top/blog/20200323/i4UgANuYjKXk.png" alt=""><br>在设置中设置：<br><img src="http://pic.fasty97.top/blog/20200323/5MV2zF3dOEoE.png" alt=""><br>此时就算是把天空盒光线环境搭好了,快放入模型试试吧。</p><h3 id="金属感和平滑度">金属感和平滑度</h3><p>在这个模型中，2B所持的剑是金属制品，但之前的之前的视频展示并没有去做这方面的处理。<br><img src="http://pic.fasty97.top/blog/20200323/PjUJNsJzTJ6j.png" alt=""><br>这里我将金属度设置为1，给一个很强的金属感，平滑度给个0.6。（如我们现实世界一样，一般来说金属度高的东西，平滑度也会高一些，反射光线的能力强一些。）<br>设置金属和平滑度一部分可以补足金属器物的质感和光泽。<br>调整金属和平滑度后：<br><img src="http://pic.fasty97.top/blog/20200323/wHbsjytdodBJ.png" alt=""><br>视频预览：<br><video src="http://pic.fasty97.top/blog/nierHDRP2.mp4" autoplay loop style="width:100%"></video></p><p>[toc]</p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LWRP下ShaderGraph的使用</title>
      <link href="/2020/03/21/LWRP%E4%B8%8BShaderGraph%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/03/21/LWRP%E4%B8%8BShaderGraph%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p><strong>丢失了好多文章，故更新一波，开一个新坑CG</strong></p><blockquote><p>不论是LWRP还是ShaderGraph都已经不是什么新技术了</p></blockquote><h3 id="CG杂谈">CG杂谈</h3><p>计算机图形学（ComputGraph）简称<code>CG</code>，是一门研究计算机图形图像处理的学科，将符号或电子信号可视化是一门比较晦涩难懂的东西，比如<code>傅里叶变换</code>用于研究声音和波的关系，让波得以表示。众所周知，建模时我们总是使用三角面来构成一个模型，以三角面的数量来衡量一个模型的精细程度。从三维物体坐标系到二维的屏幕坐标系，深度如何表示？遮挡关系如何计算？这就是CG所研究的东西，计算机图形学也被称为程序员的浪漫，这就是这个系列要说的东西。</p><h3 id="LWRP">LWRP</h3><p><code>LWRP</code>(轻度渲染管线)是unity推出的可自定义的渲染管线，其初衷是为了移动平台和轻度主机平台。在轻度渲染管线下，我们可以对渲染管线做更多的设置和处理，并且可以使用shaderGraph可视化的shader编辑器像连连看一样完成shader的编写。<br>通过shader我们可以实现许多视觉效果，如飘动的红旗，水面的倒影，卡通人物渲染等；有些可以使用模型来解决但使用shader不仅高效还能处理许多模型无法解决的东西。</p><p><em>不知道你是否看过游戏的模型，或者说取解包过游戏，很多游戏，模型可能并没有游戏中那么<strong>漂亮</strong>！</em><br>但是通过shader，光照，后处理等，玩家看到的就是非常赞的效果了！（就好像是美颜滤镜一样）</p><h3 id="HDRP">HDRP</h3><p><code>HDRP</code>(高清渲染管线)如名字所言，是专门在对画面质量要求较高的主机或PC端开发游戏所使用的。（但unity开发大型游戏真的够呛，目前在我看来ue4可能更适合）<br>使用HDRP我们可以更高程度的自定义我们的渲染系统，要知道在游戏引擎中，渲染占据了很大的一块。</p><h3 id="Shader的基础认知？">Shader的基础认知？</h3><p>关于shader的基础认知，我在之前曾写过一篇文章（虽然没写完），我会抽空把那篇文章写完的。<br>如果有兴趣不妨去看看：<a href="http://www.fasty97.top/unity%e5%9b%be%e5%bd%a2%e5%ad%a6-%e6%b8%b2%e6%9f%93%e6%b5%81%e7%a8%8b/" title="[传送门]unity图形学 渲染流程">[传送门]unity图形学 渲染流程</a></p><h3 id="LWRP下Shadergraph的搭建">LWRP下Shadergraph的搭建</h3><p><code>Unity版本 2019.3.0f6</code><br>听了这么多，也许你还是比较懵吧，没事。让我们来揭开shader的神秘面纱吧</p><ol><li><p>首先安装如下依赖包：<br><img src="http://pic.fasty97.top/blog/20200321/IHRSz6lfegXD.png" alt=""><br><img src="http://pic.fasty97.top/blog/20200321/BLWb4IR9U5wt.png" alt=""></p></li><li><p>创建渲染管线资源并设置：<br>值得一提的是，在unity2019.3中已经将LWRP更名为UWRP了，unity想在之后让LWRP变成通用的渲染管线取代原先的Stand渲染管线；所以我们需要创建一个UWRP的资源。<br><img src="http://pic.fasty97.top/blog/20200321/TR1o545kQ1Nz.png" alt=""></p></li><li><p>使用UWRP<br>首先我们创建一个Cube，一个材质，一个PBRGraph（基于物理的shader）。</p></li></ol><h4 id="PBRGraph">PBRGraph?</h4><p>这里补充一点小知识，所谓PBR就是基于物理的渲染，什么叫做基于物理的渲染呢？简单的说就是原先的模型在绘制贴图时，贴图师就会直接在贴图上绘制好高光，粗糙度，磨损等，这是基于经验的固定化的处理。而基于物理的渲染则是通过复杂的计算和光照模型的影响，动态的计算出模型的细节，让模型处于不同的环境中能够有不同的表现，是基于环境影响的。</p><p>打开PBRGraph：<br>创建如下结点并连接<br><img src="http://pic.fasty97.top/blog/20200321/KC6HrUGWV9pC.png" alt="PBRGraph"><br>然后将shader指定到对应材质，将材质指定到我们的Cube，尝试调整数值吧。<br><img src="http://pic.fasty97.top/blog/20200321/PkIawTx0mOAc.gif" alt=""><br>到这里我们已经知道如何基本的使用shaderGraph了呢，但你可能会说，这不是自带shader就拥有的功能吗？</p><h3 id="做一个边缘发光效果">做一个边缘发光效果</h3><p>下面我们使用菲涅尔效应做一个简单的边缘自发光，其shadergraph如图所示，通过菲涅尔结点指定一个发光颜色和强度来实现。（非常简单吧）<br><img src="http://pic.fasty97.top/blog/20200321/pmNHEXl7Y02o.png" alt=""><br><strong>效果图：</strong><br><img src="http://pic.fasty97.top/blog/20200321/dQdztRRmd7pH.gif" alt="边缘发光效果"></p><h3 id="做一个顶点动画">做一个顶点动画</h3><p>通过顶点偏移我们可以实现一个波浪或是，旗帜飘动的效果：<br>主要是使用顶点偏移通过sin正弦方式。<br><img src="http://pic.fasty97.top/blog/20200321/oKWCf4A3lDxM.png" alt=""></p><p>效果如图：<br><img src="http://pic.fasty97.top/blog/20200321/5yqXJieqbu2x.gif" alt=""></p>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
          <category> 渲染管线 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shaderGraph </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何优雅的看漫画</title>
      <link href="/2020/03/20/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%9C%8B%E6%BC%AB%E7%94%BB/"/>
      <url>/2020/03/20/%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E7%9C%8B%E6%BC%AB%E7%94%BB/</url>
      
        <content type="html"><![CDATA[<blockquote><p>最近挺迷漫画的，但如何正确优雅的看漫画却是一大难题</p></blockquote><h3 id="PC端">PC端</h3><p>在Pc端看漫画还是蛮爽的，屏幕比较大，看的字迹也会清楚一些。</p><h4 id="漫画阅读器">漫画阅读器</h4><ul><li><p>Cover<br>cover可以直接在win10商店下载，免费版可以同时管理25本漫画书，并且可以搭载云服务器同步您的漫画库，操作起来非常顺手，缺点是打开页数较多的漫画时，可能加载会较慢。<br><img src="http://pic.fasty97.top/blog/20200316/6s1teEz5I3JI.png" alt=""></p></li><li><p>Eriri<br>Eriri是<code>蝉时雨</code>大佬的开源项目，能够无限制的管理漫画书，操作简洁，加载漫画迅速，但在一些小方面仍需改进，如缺少漫画分类库，缺少日漫的从右至左的阅读方式等。<br><img src="http://pic.fasty97.top/blog/20200316/YSuhMUmh2t5Q.png" alt=""><br><a href="https://github.com/chanshiyucx/eriri" title="github">github</a></p></li></ul><h3 id="移动端">移动端</h3><p>在移动端可以方便的随时随地看漫画，当然移动端的软件可不必PC端差哦。</p><h4 id="tachiyomi">tachiyomi</h4><p>我强烈安利tachiyomi,tachiyomi完全开源免费，由全世界的动漫爱好者一同维护和迭代，现在的版本已经非常稳定和方便了，可以通过添加插件的方式，方便的查看和下载国内外的漫画，并且可绑定云存储容器实现漫画库的实时同步，使用原生android开发，流畅度极佳！<br><img src="http://pic.fasty97.top/blog/20200320/9hulbq79NiLw.png" alt=""></p><p><a href="https://github.com/inorichi/tachiyomi" title="github">github</a></p><h4 id="Exview">Exview</h4><p>Exview不仅仅是一个漫画阅读器，更像是一个二次元圈子，通过各种各样的插件和扩展，不仅能使用Exview来看漫画，更可以看小说，看动漫，看coser等等；但整体软件非android原生开发，且优化极差，导致经常卡死，此软件也有电脑版，但依然存在这些问题。<br><img src="http://pic.fasty97.top/blog/20200320/cWFnI8KVrldf.png" alt=""></p><h3 id="下载漫画">下载漫画</h3><p>下载漫画我推荐使用 漫画控，买个授权也挺便宜的。<br><img src="http://pic.fasty97.top/blog/20200316/NCm32ijzDtjY.png" alt=""></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Gitbook初体验</title>
      <link href="/2020/02/16/Gitbook%E5%88%9D%E4%BD%93%E9%AA%8C/"/>
      <url>/2020/02/16/Gitbook%E5%88%9D%E4%BD%93%E9%AA%8C/</url>
      
        <content type="html"><![CDATA[<blockquote>  有没有想过整理一下自己杂乱的学习笔记呢？有没有想自己写本书呢？</blockquote><p>如果你有以上的想法，那么gitbook将是非常适合你的东西。</p><h3>前置准备工作</h3><p>安装并配置好<code>node.js</code>即可。</p><h3>安装gitbook</h3><pre><code class="language-bash line-numbers">$ npm install gitbook-cli -g</code></pre><p>安装可能会比较耗时，若情况特殊请开启科学上网。<br>在安装完成后可以查看是否安装成功：</p><pre><code class="language-bash line-numbers">$ gitbook -V</code></pre><h3>使用gitbook</h3><p>在你想建立gitbook的文件下，输入<code>gitbook init</code>可以在此文件夹建立gitbook。<br><img src="http://pic.fasty97.top/note/20200216/0lPmKdMw8l0v.png" alt=""><br>你可以在文件中中发现这两个文件：（第一次可能有点慢）<br><img src="http://pic.fasty97.top/note/20200216/CPTnLXSDjhBW.png" alt=""><br>其中<code><a href="http://SUMMARY.md">SUMMARY.md</a></code>是本书的目录，我们可以编辑目录后再次使用<code>gitbook init</code>来更新书本。</p><pre><code class="language-markdown line-numbers"># Summary* [Introduction](README.md)* [笔记](note1/笔记.md)</code></pre><p>我们可以在SUMMARY下追加一个目录如上，其中<a class="wp-editor-md-post-content-link" href="指向的文件地址">在目录中显示的名字</a>，gitbook会自动生成目录和文件。<br>然后我们更新书本。</p><h3>启动本地预览</h3><pre><code class="language-bash line-numbers">gitbook serve</code></pre><p><img src="http://pic.fasty97.top/blog/20200216/ya5J8QhAWmmk.png" alt="本地预览"><br>完成后我们就可以在4000端口访问了。<br><img src="http://pic.fasty97.top/blog/20200216/p1IYlSMUaJDd.png" alt=""></p><h3>使用vscode编辑MD</h3><p>主要需要安装2个插件：</p><p><img src="http://pic.fasty97.top/blog/20200216/51kIQdpa1X3d.png" alt=""></p><p><img src="http://pic.fasty97.top/blog/20200216/IjGsvO37GS1W.png" alt=""></p><p>安装完这两个插件就可以愉快的写md了，可以使用<code>alt+shirt+f</code>快速格式化代码。<br>在这里还推荐大家一个插件用于记录文件的更新时间:<br><img src="http://pic.fasty97.top/blog/20200216/Kq43IQrCOP4P.png" alt=""><br>效果如图：<br><img src="http://pic.fasty97.top/blog/20200216/jBHBzThH1Rof.png" alt=""></p>]]></content>
      
      
      
        <tags>
            
            <tag> 好物推荐 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Timeline的基本使用</title>
      <link href="/2020/02/10/Timeline%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"/>
      <url>/2020/02/10/Timeline%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>Unity版本号：<font color=green>2019.3.0f6</font></p><hr /><p>TimeLine 是unity2017推出的新功能，其采用时间线的形式组合场景资源， 可以用于编排游戏剧情，过场动画，斩杀镜头，人物特写等效果。</p><h3>创建TimeLine</h3><p>用于播放TimeLine的物体必须有这个组件：<br><img src="http://pic.fasty97.top/blog/20200210/CUXzMDxo2tsx.png" alt="组件"></p><table><thead><tr>  <th align="center">参数名</th>  <th align="center">作用</th></tr></thead><tbody><tr>  <td align="center">Playable</td>  <td align="center">Playable资源（TimeLine资源）</td></tr><tr>  <td align="center">Update Method</td>  <td align="center">更新模式</td></tr><tr>  <td align="center">Play On Awake</td>  <td align="center">是否启动时自动播放</td></tr><tr>  <td align="center">Wrap Mode</td>  <td align="center">结束模式，None播放完回到原先属性，Loop循环播放，Hood播放完维持改变</td></tr><tr>  <td align="center">Initial Time</td>  <td align="center">延迟时间</td></tr></tbody></table><h3>轨道面板</h3><p><img src="http://pic.fasty97.top/blog/20200210/0l1DQytDcsA2.png" alt="轨道面板"><br>点击左侧的＋，可以添加轨道，这是一个类似视频剪辑的界面，我们可以方便的对轨道进行移动和剪辑。</p><h4>Activation</h4><p>Activation用于表示物体的激活状态：<br><img src="http://pic.fasty97.top/blog/20200210/vIzC588mJlSO.gif" alt="Activation"></p><h4>Animation</h4><p>Animation用于播放动画，既可以播放已有的动画，也可以自己录制帧动画来使用。<br><strong>注意：使用此轨道的物体会被创建一个Animator Controller，这个组件不能被删除。</strong><br><img src="http://pic.fasty97.top/blog/20200210/gizvroAPPTAo.gif" alt="Animation"></p><h4>Audio</h4><p>Audio轨道用于播放音效，如果不指定AudioSource就无法细致调节效果。<br><img src="http://pic.fasty97.top/blog/20200210/zEYKWKgDJrlk.png" alt="Audio"><br>每个轨道在属性面板都有不同的属性，Audio面板如下：<br>!{Audio 属性}(<a href="http://pic.fasty97.top/blog/20200210/GoEDb7qbdSHR.png">http://pic.fasty97.top/blog/20200210/GoEDb7qbdSHR.png</a>)</p><h4>Control</h4><p>Control轨道和Activation轨道有点相似，但不同的是Control轨道可以同时控制多个物体的激活状态。<br><img src="http://pic.fasty97.top/blog/20200210/y5G5Rhig2kPn.png" alt="Control"></p><h4>Signal-任意轨道</h4><p>Signal是非常重要的轨道，在使用TimeLine时，你可能会有这样的想法，能不能在时间线上，调用我们自定义的方法呢，在2019之前可以通过剪辑间接的完成事件的调用；但现在有了Signal轨道的加持，我们可以非常方便的在任意时刻调用方法了。<br>创建一个简单的测试脚本，并将脚本挂载在游戏物体上。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SignalTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Show</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">      Debug.Log(<span class="string">&quot;Signal!&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>右键单击任意轨道：<br><img src="http://pic.fasty97.top/blog/20200210/SAiR90ho2iVi.gif" alt=""><br>此时在属性面板中，可以看到：<br><img src="http://pic.fasty97.top/blog/20200210/rkIgMqVhBiI3.png" alt=""><br>为了监听这个事件，unity提示我们缺少一个监听器，点击Add添加一个。<br>添加好监听器，我们需要创建一个监听实例，这个实例是可以复用的。<br><img src="http://pic.fasty97.top/blog/20200210/fbn8zd2A3rD3.png" alt=""></p><p>完成以上步骤我们发现原先有警告的小白标变成了<font color=red>白色</font>。这说明我们设置正确了,然后我们需要绑定事件给实例：<br><img src="http://pic.fasty97.top/blog/20200210/YYCEgJkFVtkl.png" alt=""><br>尝试运行（播放游戏）一下发现在时间轴运行到小白标时会自动调用我们绑定的方法。</p><h3>Signal-指定轨道</h3><p>上面实现的Signal是针对于任意轨道来说的，如果我们需要很多的Signal处理起来可能会发生混乱，所以官方提供了专门的Signal轨道。<br>先给我们的物体添加：<br><img src="http://pic.fasty97.top/blog/20200210/07nzVWaY41Yw.png" alt=""><br>在属性面板中我们可以对事件实例绑定多个方法，统一管理：<br><img src="http://pic.fasty97.top/blog/20200210/IvGBUJotShrO.png" alt=""></p><h3>小技巧</h3><p>在轨道左侧可以点击三点，然后选择Mute（静音）对指定轨道进行屏蔽。<br>在右侧轨道面板中，可以通过重叠区块实现2个区块之间的过渡效果。<br>可设置轨道的淡入淡出效果：<br><img src="http://pic.fasty97.top/blog/20200210/TKt9DScaWgab.png" alt=""></p><h3>驱动摄像机</h3><p>做了一个超级丑的摄像机变换效果：<br><img src="http://pic.fasty97.top/blog/20200210/UVEeBVXqcg7D.gif" alt=""></p><h3>代码驱动TimeLine</h3><p>有时候我们可能需要通过代码动态的启动TimeLine，这也很容易实现：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Signal</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> PlayableDirector playDir;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Fac</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Fac..&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (Input.GetKeyDown(KeyCode.A))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">            playDir.Play();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 游戏开发 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> unity </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（九）面向对象</title>
      <link href="/2020/02/07/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B9%9D%EF%BC%89%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/"/>
      <url>/2020/02/07/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B9%9D%EF%BC%89%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<blockquote>  lua虽然没有面向对象的概念，但我们实现面向对象并不困难</blockquote><p>一下内容我参考了多处lua教程，很多教程讲解模糊晦涩，我整理了以下以简明的说明方式完成lua面向对象这部分的内容，希望大家喜欢。</p><h3>面向对象OOP</h3><p>学习过Java，C#，Ruby等的同学可能不会对面向对象陌生，如果你是第一次接触面向对象？<br>那么我总结一下就是:<code>将事物抽象成类，将特征抽象为字段和属性。</code><br>在Lua中，最强大的就是table这种数据结构了，来看下面这个例子：</p><pre><code class="line-numbers">Cat=&#123;name="defalut",color="白色"&#125;function Cat.say()    print(Cat.name..'  '..Cat.color..':','喵喵喵~')endCat.name='小白'Cat.say()</code></pre><p>运行结果为:<code>小白  白色:  喵喵喵~</code></p><p>在例子中，我们创建了一张表，并在表中提供2个字段和一个函数，并通过表名.字段名调用字段和方法，这像不像 一个<code>静态类</code>呢？<br>以下是Csharp的一个类似的静态类：</p><pre><code class="language-csharp line-numbers">class Program&#123;    static void Main(string[] args)    &#123;        Cat.name = "小白";        Cat.color = "白色";        Cat.Show();    &#125;&#125;static class Cat&#123;    public static string name;    public static string color;    public static void Show()    &#123;        System.Console.WriteLine("&#123;0&#125;  &#123;1&#125;   喵喵喵~", name, color);    &#125;&#125;</code></pre><p>分析一下：之所以是静态类是因为我们只在创建表的时候创建了一个对象，后面无论我们进行操作我们都没有创建一个新对象！</p><h3>创建对象</h3><pre><code class="line-numbers">function Cat:new()    local o=&#123;&#125;    setmetatable(o,self)    self.__index=self    return oendfunction Cat:say()    print(self.name..'  '..self.color..':','喵喵喵~')endlocal ca=Cat:new()ca:say()</code></pre><p>在上面的例子中，我们首先添加了一个Cat：new的函数，这类似于我们Csharp中的构造函数，<br>在构造函数中，我们主要做以下几件事：</p><ul><li>创建空表对象</li><li>设置空表的元表</li><li>设置_index</li><li>返回空表对象</li></ul><p>在每次创建对象时，我们都通过:new函数来创建。<br>在这里我们使用到了：<code>setmetatable(o,self)</code>这句话的意思是设置o的元表为自己（也就是Cat对象），<code>self.__index=self</code>是设置元方法索引为Cat对象，这2句话总体就是让对象o具有Cat对象的属性和函数。<br>当然元表，元方法的作用还有很多，也远比这要复杂，感兴趣可以自己去了解~</p><h3>继承和多态</h3><p>让我们来看这个例子：</p><pre><code class="line-numbers">-- 基础类Human=&#123;name='defaultName',age=0&#125;function Human:new()    local o=&#123;&#125;    self.__index=self    setmetatable(o,self)    return oendfunction Human:show()    print('Base:','Name:',self.name,'Age:',self.age)endlocal myhum=Human:new()myhum.name="小蓝"myhum.age=20myhum:show()-- 派生类Chinese=Human:new()function Chinese:new()    local o=&#123;&#125;    setmetatable(o,self)    self.__index=self    return oendfunction Chinese:show()    print('Chinese:','Name:',self.name,'Age:',self.age)endlocal ch=Chinese:new()ch.name="小红"ch.age=15ch:show()myhum:show()ch:show()local ch2=Chinese:new()ch2:show()English=Human:new()function English:show()    print('English:','Name:',self.name,'Age:',self.age)endlocal eg=English:new()eg.name="Fasty";eg.age=22eg:show()</code></pre><p>!{运行结果}(<a href="https://i.loli.net/2020/02/07/2NEPOSCDXtuZYLy.png">https://i.loli.net/2020/02/07/2NEPOSCDXtuZYLy.png</a>)</p><p>在lua中基于弱类型的优势，对于函数重写，只需要重新定义一遍函数即可。</p><p>至此面向对象的封装，继承，多态都实现咯~</p><p>[toc]</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（八）万用table构建数据结构</title>
      <link href="/2020/02/06/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%85%AB%EF%BC%89%E4%B8%87%E7%94%A8table%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"/>
      <url>/2020/02/06/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%85%AB%EF%BC%89%E4%B8%87%E7%94%A8table%E6%9E%84%E5%BB%BA%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<p>平时我们在其他语言中，经常会用到如数组，矩阵，队列和栈等一些数据结构，而lua似乎并没有这些数据类型，lua只提供了table类型，但是通过table类型我们几乎可以实现所有常用的数据类型。</p><h3>数组</h3><p>数组的实现非常简单，table的数据类型类似与C#中的字典，存储kv对，我们只取value即可。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> arr=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">4</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key,value)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3>矩阵</h3><p>矩阵也被称为多维数组，我们只需要嵌套一个table即可。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> mt=&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">    mt[i]=&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> j = <span class="number">1</span>, <span class="number">10</span> <span class="keyword">do</span></span><br><span class="line">        mt[i][j]=<span class="number">0</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3>链表</h3><p>对于像链表这样的数据结构，我们可以方便的通过一个指针域实现。</p><pre><code class="language-lua line-numbers">-- 链表local l=nillocal l2={next=nil,value=10}l={next=l2,value=200}while l do    print(l.value)    l=l.nextend</code></pre><h3>队列和栈</h3><p>下面以队列为例，栈也是类似的构造：</p><pre><code class="language-lua line-numbers">-- 队列和栈Queue={}function Queue.new()    return{first=0,last=-1}endfunction Queue.push(queue,value)    local first=queue.first-1    queue.first=first    queue[first]=valueendfunction Queue.pop(queue)    local last=queue.last    if queue.last>last then        error("queue 为空")    end    local value=queue[last]    queue[last]=nil    queue.last=last-1    return valueendlocal qq=Queue.new()Queue.push(qq,5)Queue.push(qq,8)</code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（七）程序协同</title>
      <link href="/2020/02/05/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%83%EF%BC%89%E7%A8%8B%E5%BA%8F%E5%8D%8F%E5%90%8C/"/>
      <url>/2020/02/05/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%83%EF%BC%89%E7%A8%8B%E5%BA%8F%E5%8D%8F%E5%90%8C/</url>
      
        <content type="html"><![CDATA[<blockquote>  使用协同程序可以更加高效的处理数据或执行任务</blockquote><h3>协同的基础</h3><h4>创建协同程序</h4><img src="https://i.loli.net/2020/02/05/QFZCUHvoqLlxs8W.png" alt="image.png" /><pre><code class="language-lua line-numbers">local co=coroutine.create(function ()    print('Hi')end)</code></pre><h4>协程的状态</h4><img src="https://i.loli.net/2020/02/05/jgQadC17IR5UKzs.png" alt="image.png" />协同有三个状态：<code>挂起态</code>、<code>运行态</code>、<code>停止态</code>。当我们创建一个协同程序时他开始的状态为挂起态，也就是说我们创建协同程序的时候不会自动运行，可以使用 status 函数检查协同的状态：<pre><code class="language-lua line-numbers">print(coroutine.status(co))</code></pre><h4>启动协程</h4><p>使用<code>coroutine.resume()</code>可以启动协程<br><img src="https://i.loli.net/2020/02/05/hfGsy8jZpeYXJK7.png" alt="image.png" /><br>例如：<br><code>coroutine.resume(co)</code><br>启动协程后，会立即执行协程方法中的内容。</p><h4>挂起协程</h4><p>如有需要<code>coroutine.yield()</code>可以挂起协程。<br>让我们来看下面这个例子，创建一个协程，在协程函数中构建一个循环，并在打印后挂起当前协程，我们不断的去调用协程。</p><pre><code class="line-numbers">local th=coroutine.create(function ()    for i = 1, 3 do        print("th=",i)        coroutine.yield()    endend)coroutine.resume(th)coroutine.resume(th)coroutine.resume(th)coroutine.resume(th)print(coroutine.resume(th)) -- 程序结束返回false</code></pre><p>其运行结果如下图所示:<br><img src="https://i.loli.net/2020/02/05/nbsoW7vOMuGApD4.png" alt="image.png" /><br>我们发现，<strong>在协程死亡时，coroutine.resume就返回false，并返回错误消息</strong>。</p><p><strong>Ps</strong>:resume 运行在保护模式下，因此如果协同内部存在错误 Lua 并不会抛出错误而是将错误返回给 resume 函数.</p><h4>在resume和yield间交换数据</h4><p>有没有办法在协程挂起时，返回一些数据呢？或在每次启动协程时，发送一些数据？<br>在lua中我们可以在resume和yield间交换数据。</p><p>传递参数：</p><pre><code class="line-numbers">-- 传递参数local th2=coroutine.create(function (a,b,c)    print("th2",a,b,c)end)coroutine.resume(th2,1,2,3)</code></pre><p>当然我们也可以传递协程结果：</p><pre><code class="line-numbers">local th3=coroutine.create(function ()    return 6,7end)print(coroutine.resume(th3))</code></pre><p><strong>Ps</strong>:<br>Lua提供的这种协同我们称为不对称的协同，就是说挂起一个正在执行的协同的函数与使一个被挂起的协同再次执行的函数是不同的，有些语言提供对称的协同，这种情况下，由执行到挂起之间状态转换的函数是相同的。</p><h3>管道和过滤器</h3><p>这个课题有点难，啃书中。。。<br>待更新</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（六）加载使用其他Lua的函数</title>
      <link href="/2020/02/04/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%85%AD%EF%BC%89%E5%8A%A0%E8%BD%BD%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96Lua%E7%9A%84%E5%87%BD%E6%95%B0/"/>
      <url>/2020/02/04/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%85%AD%EF%BC%89%E5%8A%A0%E8%BD%BD%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96Lua%E7%9A%84%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote>  lua的特点之一就是方便的调用chunk（代码块）</blockquote><p>通过这种特性，我们可以在a.lua中调用b.lua的内容，甚至可以从字符串文本中调用lua当做函数执行~</p><h3>load</h3><p>让我们先来看一下load函数的定义：<br>!{load函数}(<a href="https://i.loli.net/2020/02/04/DYGV2CSWoPcL49v.png">https://i.loli.net/2020/02/04/DYGV2CSWoPcL49v.png</a>)<br>通过定义我们可以知道load函数可以加载文本和二进制类型代码块，来让我们尝试一下：</p><pre><code class="line-numbers">local f=load('I=I+1')I=0f()print('I='..I)f()print('I2='..I)</code></pre><p>在这个例子中，我们使用load加载了<code>‘I=I+1’</code>这一串字符串，并把加载结果存储在f中。通过使用<code>f()</code>来调用函数。</p><h3>loadFile</h3><p><img src="https://i.loli.net/2020/02/04/vNUObGS7D4EczrV.png" alt="loadFile"><br>和load类似的还有loadfile，但loadfile加载的是文件而非字符串。</p><p>我们在funTest.lua文件中写一句输出：<code>print(‘Test’)</code><br>然后在其他文件中调用：</p><pre><code class="line-numbers">local fun=loadfile('funTest.lua',"t")fun()</code></pre><p>通过这种形式我们就可以吧funTest.lua的内容当做一个函数来使用，以上使用后会输出Test。</p><h3>dofile</h3><p><img src="https://i.loli.net/2020/02/04/PxjaiqrlKJ6S41e.png" alt="dofile"><br>dofile与loadfile最大的不同就是，loadfile只是加载函数，需要我们手动去调用，而dofile不但加载函数而且直接调用。</p><pre><code class="line-numbers">dofile('funTest.lua')</code></pre><h3>require</h3><p>require是包含的意思，与load系列不同的是，require会检查被加载的文件是否已经被加载过，防止重复加载。<br>另外使用require加载可以单独调用加载的文件中的函数，而不是把文件内容当做一个函数来使用，所以require加载时比较理想的加载形式。</p><h4>使用表加载</h4><p>在funTest.lua文件中:</p><pre><code class="line-numbers">local _M = {}function _M.test()    print('hi')endfunction _M.Hi()    print('hi100')endfunction _M.Say(arg)    print('hi:'..tostring(arg))endreturn _M</code></pre><p>在其他文件中调用：</p><pre><code class="line-numbers">-- 调用其他文件的函数local test = require('funTest')if not test then    print('错误')    returnendtest.Hi()test.test()test.Say(51)</code></pre><h4>非表加载</h4><p>在funTest.lua中：</p><pre><code class="line-numbers">function Ac(j)    print('100:'..j)end</code></pre><p>在其他文件中：</p><pre><code class="line-numbers">require("funTest")Ac('你好')</code></pre><h4>说明</h4><p>使用表加载和非表加载都可以实现效果，使用表加载时，有点面向对象的感觉可能更方便。</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（五）.和：的区别和联系</title>
      <link href="/2020/02/04/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%94%EF%BC%89.%E5%92%8C%EF%BC%9A%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/"/>
      <url>/2020/02/04/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%94%EF%BC%89.%E5%92%8C%EF%BC%9A%E7%9A%84%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<p>在前面我们学习函数时，我们说过函数其实是值，我们可以将函数放在表中。<br>那么我们是不是可以这么做：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> fasty=&#123;a=<span class="number">1</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fasty.Say</span><span class="params">(arg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Say:&#x27;</span>..<span class="built_in">arg</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fasty:Say2</span><span class="params">(arg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Say:&quot;</span>..<span class="built_in">arg</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>在这里，我们创建了一个表fasty,表中默认有a一个元素。然后我们给表创建了两个函数say和say2，这2个函数的作用都是将给与的参数输出。</p><h3>调用不同</h3><p>在我们调用这2个方法时，我们应该明确：</p><ul><li>使用<code>.</code>声明的方法使用<code>.</code>调用，使用<code>:</code>声明的方法使用<code>：</code>调用</li><li>假如我们要使用.调用：声明的方法，那我们需要传递一个this指针给函数</li><li>也就是说: 其实是自动传递一个this指针给函数。</li></ul><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">fasty.Say(<span class="number">100</span>)</span><br><span class="line">fasty:Say2(<span class="number">200</span>)</span><br><span class="line">fasty.Say2(fasty,<span class="number">200</span>)</span><br><span class="line">​```lua</span><br><span class="line"></span><br><span class="line">&lt;strong&gt;Ps&lt;/strong&gt;：也就是说一下函数是等效的：</span><br><span class="line"></span><br><span class="line">​```lua</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fasty.Say3</span><span class="params">(self,arg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;say:&quot;</span>..<span class="built_in">arg</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fasty:Say4</span><span class="params">(arg)</span></span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;say:&quot;</span>..<span class="built_in">arg</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3>self指针</h3><p>既然，：的形式是自动传递一个self指针给函数，那么就意味着我们可以方便的访问表的元素咯~</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fasty:Say2</span><span class="params">(arg)</span></span></span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Say:&quot;</span>..<span class="built_in">arg</span>..<span class="string">&quot;\ta=&quot;</span>..<span class="built_in">self</span>.a)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">fasty:Say2(<span class="number">200</span>)</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2020/02/04/7pvlgWErTAbiSDZ.png" alt=""></p><h3>总结</h3><ul><li>使用：声明函数时，函数会将第一个参数默认传递self指针。</li><li>如果使用.调用：声明的函数时，需要第一个参数传递self。：调用则不需要</li></ul>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（四）迭代器</title>
      <link href="/2020/02/03/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%9B%9B%EF%BC%89%E8%BF%AD%E4%BB%A3%E5%99%A8/"/>
      <url>/2020/02/03/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E5%9B%9B%EF%BC%89%E8%BF%AD%E4%BB%A3%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<blockquote>  迭代器是一种支持指针类型的结构，它可以遍历集合的每一个元素。在 Lua 中我们  常常使用函数来描述迭代器，每次调用该函数就返回集合的下一个元素。常常使用函数来描述迭代器，每次调用该函数就返回集合的<font color=green>下一个元素</font>。</blockquote><h3>闭包和迭代器</h3><ul><li>迭代器需要保留<font color=blue>上一次</font>成功调用的状态</li><li>迭代器需要保留<font color=blue>下一次</font>成功调用的状态</li></ul><p>我们知道闭包可以保留每次调用的状态。并且可以方便的访问局部变量；所以我们也可以使用闭包来构建迭代器。<br>还记得我们在做for循环遍历表时的pairs(t)的迭代器吗？我们尝试自己来写一个迭代器：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 迭代器</span></span><br><span class="line"><span class="keyword">local</span> <span class="function"><span class="keyword">function</span> <span class="title">list_iter</span><span class="params">(t)</span></span></span><br><span class="line">    <span class="keyword">local</span> i=<span class="number">0</span></span><br><span class="line">    <span class="keyword">local</span> n=#t</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        i=i+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> i&lt;=n <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> t[i]</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> t=&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">8</span>&#125; <span class="comment">--创建表</span></span><br><span class="line"><span class="keyword">local</span> iter = list_iter(t) <span class="comment">--创建迭代器变量实例</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> element=iter() <span class="comment">--使用迭代器</span></span><br><span class="line">    <span class="keyword">if</span> element==<span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;数据为:&#x27;</span>..element)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><strong>Ps</strong>：如果要创建一个闭包必须要创建其外部局部变量。所以一个典型的闭包的结构包含两个函数：一个是闭包自己；另一个是工厂（创建闭包的函数）。<br>当然我们可以将这个迭代器应用于for循环中：</p><pre><code class="line-numbers">for value in list_iter(t) do    print(value)end</code></pre><h4>迭代器小例子-访问文件</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 打开文件</span></span><br><span class="line"><span class="keyword">local</span> file = <span class="built_in">io</span>.<span class="built_in">open</span>(<span class="string">&#x27;hh.txt&#x27;</span>,<span class="string">&quot;r&quot;</span>)<span class="comment">--指定文件操作为读取</span></span><br><span class="line"><span class="keyword">if</span> <span class="literal">nil</span>==file <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;文件打开失败&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ReadFile</span><span class="params">(file)</span></span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="params">()</span></span></span><br><span class="line">        <span class="keyword">local</span> line=file:<span class="built_in">read</span>(<span class="string">&#x27;*l&#x27;</span>) <span class="comment">--以行的形式进行读取</span></span><br><span class="line">        <span class="keyword">if</span> <span class="literal">nil</span>==line <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> line</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> ReadFile(file) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用while的话</span></span><br><span class="line"><span class="keyword">local</span> readfile=ReadFile(file)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> line=readfile()</span><br><span class="line">    <span class="keyword">if</span> line==<span class="literal">nil</span> <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="built_in">print</span>(line)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3>深入了解for循环</h3><p>在上面的闭包迭代器中我们不难发现，如果使用for循环则可以免去while循环所需的迭代闭包变量，<br>这样使用起来就比while循环要方便一些。那for循环是怎么做到的呢？<br>让我们来看看for循环的格式：<br><code>for var_1, …, var_n in explist do block end</code><br>在for循环我们可以使用多个参数，如之前我们使用的系统自带的表迭代器，我们可以获得k和v的值。<br>在<code>in</code>关键字后接需要被迭代的数据源列表（也就是说可以迭代多个列表），然后在<code>do</code>后对遍历项进行处理。<br><strong>Ps</strong>：其实在lua中，for的执行顺序是这样的：</p><ol><li>首先，初始化，计算 in 后面表达式的值，表达式应该返回范性 for 需要的三个值：迭代函数，状态常量和控制变量；与多值赋值一样，如果表达式返回的结果个数不足三个会自动用 nil 补足，多出部分会被忽略。</li><li>第二，将状态常量和控制变量作为参数调用迭代函数（注意：对于 for 结构来说，状态常量没有用处，仅仅在初始化时获取他的值并传递给迭代函数）。</li><li>第三，将迭代函数返回的值赋给变量列表。</li><li>第四，如果返回的第一个值为 nil 循环结束，否则执行循环体。</li><li>第五，回到第二步再次调用迭代函数</li></ol><p><font color=red>从某种意义上来说，for循环还是依赖于while循环做的优化</font>。<br>其等价为：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="keyword">local</span> _f, _s, _var = explist</span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line"><span class="keyword">local</span> var_1, ... , var_n = _f(_s, _var)</span><br><span class="line">_var = var_1</span><br><span class="line"><span class="keyword">if</span> _var == <span class="literal">nil</span> <span class="keyword">then</span> <span class="keyword">break</span> <span class="keyword">end</span></span><br><span class="line">block</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3>无状态迭代器</h3><blockquote>  上面我们依据闭包的思想实现的迭代器其核心思想就是保留状态，那有没有一种方式<font color=red>无需保留状态</font>构建迭代器呢？</blockquote><p>让我们回想一下，系统自带的<code>pairs(t)</code>迭代器有使用到闭包吗？答案是：没有<br>所以<code>pairs(t)</code>迭代器就是一种无状态迭代器~<br>我们尝试着实现一个pairs的效果，其代码如下：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">iter</span><span class="params">(a,i)</span></span></span><br><span class="line">    i=i+<span class="number">1</span></span><br><span class="line">    <span class="keyword">local</span> v=a[i]</span><br><span class="line">    <span class="keyword">if</span> v <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">return</span> i,v</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ipairs</span><span class="params">(a)</span></span></span><br><span class="line">    <span class="keyword">return</span> iter,a,<span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> tt=&#123;<span class="number">45</span>,<span class="number">46</span>,<span class="number">100</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">ipairs</span>(tt) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key,value)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>我们每次调用ipairs时，都自动去调用iter，并且在调用时保留iter迭代函数，a迭代数据，0迭代索引。（很神奇吧，这种写法估计只有lua的作者才能想到，简直天才~）<br><strong>Ps</strong>：同理，lua中ipairs也是这样调用其他函数的（调用next函数）</p><h3>多状态控制器</h3><p>很多情况下，迭代器需要保存多个状态信息而不是简单的状态常量和控制变量，最<br>简单的方法是使用闭包，还有一种方法就是将所有的状态信息封装到 table 内，将 table<br>作为迭代器的状态常量，因为这种情况下可以将所有的信息存放在 table 内，所以迭代函<br>数通常不需要第二个参数。</p><p>[toc]</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（三）函数</title>
      <link href="/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%89%EF%BC%89%E5%87%BD%E6%95%B0/"/>
      <url>/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%89%EF%BC%89%E5%87%BD%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<blockquote>  函数可以完成2件事，<code>完成工作</code>或者<code>计算并返回结果</code>。</blockquote><h3>函数语法</h3><pre><code class="line-numbers">function func_name (arguments-list)statements-listend</code></pre><p><strong>Ps</strong>：Lua 使用的函数可以是 Lua 编写也可以是其他语言编写，对于 Lua 程序员来说用什<br>么语言实现的函数使用起来都一样。</p><pre><code class="line-numbers">function Show(a)    print(a)endShow(100)</code></pre><h4>返回多个值</h4><p>在lua中函数可以返回多个值，例如 string.find，其返回匹配串“开始和结束的下标”<br>（如果不存在匹配串返回 nil）。</p><pre><code class="line-numbers">s, e = string.find("hello Lua users", "Lua")print(s, e)  --> 7 9</code></pre><p>计算最大值和最大值的索引</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MaxM</span><span class="params">(arr)</span></span></span><br><span class="line">    <span class="keyword">local</span> maxIndex=<span class="number">1</span></span><br><span class="line">    <span class="keyword">local</span> <span class="built_in">max</span>=arr[maxIndex]</span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> value&gt;<span class="built_in">max</span> <span class="keyword">then</span></span><br><span class="line">            maxIndex=key</span><br><span class="line">            <span class="built_in">max</span>=value</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">max</span>,maxIndex</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">max</span>,maxIndex=MaxM(&#123;<span class="number">1.5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">9</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;最大值和索引为:&#x27;</span>..<span class="built_in">max</span>..<span class="string">&#x27;  &#x27;</span>..maxIndex)</span><br></pre></td></tr></table></figure><h4>返回函数</h4><p>如<code>return fac()</code>这样的形式就是返回函数，其意义是执行fac函数并返回fac的返回值，若没有返回nil。</p><h4>可变参数</h4><h5>unpack</h5><p><code>unpack</code>，接受一个数组作为输入参数，返回数组的所有元素。</p><pre><code class="line-numbers">f = string.finda = {"hello", "ll"}print(f(unpack(a))) --> 3 4</code></pre><h5>...可变参数</h5><p>可以使用…表示不明确数量的可变参数，在使用时在函数中以表的形式获取。</p><pre><code class="line-numbers">function Sum(a,b,c,...)    local arg={...} --将可变参数存储到arg表中    for key, value in pairs(arg) do        print(value) -- 9 7 4 10    endendSum(5,4,8,9,7,4,10)</code></pre><h4>使用命名参数</h4><p>由于lua使用弱类型的缘故，我们可以像这样使用命名参数，在这种情况下调用函数可以写为<code>函数名{参数}</code>的形式。</p><pre><code class="line-numbers">function Show(arg)    print(arg.name..'  '..arg.title)endShow{name='小屋',title='学习lua'}</code></pre><h3>深入理解函数</h3><p>Lua 中的函数是带有词法定界（lexical scoping）的第一类值（first-class values）。<br><font color=blue>第一类值</font>指：在 Lua 中函数和其他值（数值、字符串）一样，函数可以被存放在变量中，也可以存放在表中，可以作为函数的参数，还可以作为函数的返回值。</p><p><font color=blue>词法定界</font>指：被嵌套的函数可以访问他外部函数中的变量。这一特性给 Lua 提供了强大的编程能力。</p><h4>匿名函数</h4><p>得益于上面的第一条规则，其实我们声明函数，本是 <code>fac=function(arg) body end</code>。<br>这个语句创建了一个匿名函数，并把这个函数赋值为fac，我们就可以称这个函数为fac了。<br>在<strong><code>table.sort()</code></strong>函数中使用匿名函数：</p><p>在函数中接收2个参数，第一个参数接收一个表，第二个参数接收一个<strong>比较函数</strong>。</p><pre><code class="line-numbers">arr={    {name='A',age=16},    {name='B',age=20},    {name='C',age=9},}table.sort(arr,function (a,b)    return a.age>b.ageend)for key, value in pairs(arr) do    for k, v in pairs(value) do        print(k,v)    endend</code></pre><p>以其他函数作为参数的函数在 Lua 中被称作高级函数，高级函数在 Lua 中并没有特<br>权，只是 Lua 把函数当作第一类函数处理的一个简单的结果。</p><h4>闭包</h4><p>当一个函数内容嵌套另一个函数时，被嵌套的匿名函数还可以访问第一函数中的参数，这就被称为闭包；事实上仅有很少的语言支持这样的特性。<br>来看看下面这个例子：</p><pre><code class="line-numbers">function NewCount()    local i=0    return function ()        i=i+1        return i    endend</code></pre><p>在匿名函数中，我们依然可以直接正确的访问 i。</p><hr /><p>现在，假如我们这样调用这个函数结果是怎样呢？</p><pre><code class="line-numbers">local c1=NewCount()local c2=NewCount()print(c1())print(c1())print(c2())print(c1())</code></pre><p>!{函数闭包}(<a href="https://i.loli.net/2020/02/02/r2ftpGPjsVlmqyg.png">https://i.loli.net/2020/02/02/r2ftpGPjsVlmqyg.png</a>)<br>可以发现，函数的结果并非我们的预期，在第一函数体中的i的值可以被保留下来，而且c1和c2的保存值并不相同，这就是闭包。<br><strong>Ps</strong>：我们把这个i称为<font color=gree>外部的局部变量或者 <strong>upvalue</strong></font>。<br>简单的说闭包是一个函数加上它可以正确访问的 upvalues。如果我们再次调用 newCounter，将创建一个新的局部变量 i，因此我们得到了一个作用在新的变量 i 上的新闭包。</p><p><strong>分析</strong>：c1和c2是作用同一个局部变量上的不同实例上的两个闭包。</p><h4>使用闭包重写函数</h4><p>闭包在完全不同的上下文中也是很有用途的。因为函数被存储在普通的变量内我们<br>可以很方便的重定义或者预定义函数。通常当你需要原始函数有一个新的实现时可以重<br>定义函数。例如你可以重定义 sin 使其接受一个度数而不是弧度作为参数：</p><pre><code class="line-numbers">local oldSin=math.sinmath.sin=function (x)    return oldSin(x*math.pi/180)end</code></pre><p>通过这个特性我们可以对原函数进行修改，在某些时刻可以构建运行危险代码的沙盘。</p><h4>局部函数</h4><p>Lua中函数既可以作为全局变量也可以作为局部变量，函数作为table的域。<br><strong>使用表声明函数</strong>：</p><pre><code class="line-numbers">Lib={}Lib.foo=function (x,y)    return x+yendLib.goo=function (x,y)    return x-yendLib={    foo=function (x,y)        return x+y    end,    goo=function (x,y)        return x-y    end}Lib={}function Lib.foo(x,y)    return x+yendfunction Lib.goo(x,y)    return x-yend</code></pre><p><strong>Ps</strong>：在使用递归函数时，要注意要先声明函数在调用。</p><h4>尾调用</h4><p>尾调用是一种类似在函数结尾的 goto 调用，当函数最后一个动作是调用另外一个函<br>数时，我们称这种调用尾调用。<br><strong>Ps</strong>:Lua中尾调用不消耗栈空间，由于尾调用不需要使用栈空间，那么尾调用递归的层次可以无限制的</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（二）表&amp;流程控制</title>
      <link href="/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89%E8%A1%A8&amp;%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89%E8%A1%A8&amp;%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<h3>构建表</h3><p>构造器是创建和初始化表的表达式。表是 Lua 特有的功能强大的东西。最简单的构<br>造函数是{}，用来创建一个空表。可以直接初始化数组:<br><strong><font color=red>表的序号从1开始，并非0</font>。</strong><br><strong>Ps</strong>：假如空引用，lua也不会报错，会输出nil。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> numbers=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;numbers数据:&quot;</span>..<span class="built_in">tostring</span>(numbers[<span class="number">1</span>]))  <span class="comment">-- 输出1</span></span><br></pre></td></tr></table></figure><h4>构建自定义对象</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> arr=&#123;&#125;</span><br><span class="line">arr.name=<span class="string">&#x27;xiao&#x27;</span></span><br><span class="line">arr.age=<span class="number">16</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;arr的数据：&#x27;</span>..<span class="string">&#x27;  name:&#x27;</span>..arr.name..<span class="string">&#x27;   age: &#x27;</span>..arr.age)</span><br></pre></td></tr></table></figure><h4>表的组成</h4><p>表，可以包含任何类型的元素，也可以嵌套</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr=&#123;x=<span class="number">0</span>,tip=<span class="string">&#x27;text&#x27;</span>,func=<span class="built_in">print</span>&#125;</span><br></pre></td></tr></table></figure><h4>构造注意事项</h4><p>如果真的需要索引从0开始：<br><strong>Ps</strong>：极力<font color=red>不推荐</font>这么做，这么做将不能使用很多标准库。</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr=&#123;[<span class="number">0</span>]=<span class="string">&quot;Sunday&quot;</span>,<span class="string">&quot;Monday&quot;</span>,<span class="string">&quot;Tuesday&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>在构造表时既可以使用<code>,</code>分隔元素也可以使用<code>；</code>分隔元素。</p><h3>流程控制</h3><p>我们来看看lua中的流程控制语法~</p><h4>分支</h4><p>在lua中，每一个代码块的结束都要以<strong>end</strong>结尾（有点c++的味道）</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="number">3</span>&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="literal">false</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;AAA&quot;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;BBB&quot;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">local</span> a=<span class="number">8</span></span><br><span class="line"><span class="keyword">if</span> a&gt;<span class="number">8</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a&gt;8&#x27;</span>)</span><br><span class="line"><span class="keyword">elseif</span> a&gt;<span class="number">5</span>  <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a&gt;5&#x27;</span>)</span><br><span class="line"><span class="keyword">elseif</span> a&gt;<span class="number">3</span> <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;a&gt;3&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;不满足&#x27;</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4>循环</h4><p>使用步长for循环（可省略步长，默认为1）</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- for循环</span></span><br><span class="line"><span class="comment">-- 1起点 10终点 2步长</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;正向数据为:&#x27;</span>..i)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">for</span> i = <span class="number">10</span>, <span class="number">1</span>,<span class="number">-1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;负向数据为：&#x27;</span>..i)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><strong>Ps</strong>：在循环中不要改变控制变量的值，如果需要跳出循环可以使用<code>break</code>关键字。</p><p>使用for循环遍历表：</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr=&#123;<span class="string">&quot;Sunday&quot;</span>,<span class="string">&quot;Monday&quot;</span>,<span class="string">&quot;Tuesday&quot;</span>&#125;</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> <span class="built_in">pairs</span>(arr) <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(key..<span class="string">&#x27;   &#x27;</span>..value)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>while循环</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> a=<span class="number">5</span></span><br><span class="line"><span class="keyword">while</span> a&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    a=a<span class="number">-1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lua-基础（一）Say Hi</title>
      <link href="/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89Say%20Hi/"/>
      <url>/2020/02/01/Lua-%E5%9F%BA%E7%A1%80%EF%BC%88%E4%B8%80%EF%BC%89Say%20Hi/</url>
      
        <content type="html"><![CDATA[<blockquote>  本系列将从零开始学习Lua的基本语法，用于之后使用<font color=gree>xLua</font>进行unity<font color=red>热更新</font>~</blockquote><h3>使用Vscode开发Lua</h3><p>至少要下载Lua和LuaDebug这2个扩展~<br><img src="https://i.loli.net/2020/02/01/raxtmuBAnLNIqQO.png" alt=""><br>看到LuaDebug的作者actboy168，我有点惊讶，actboy168是大名鼎鼎的ydwe作者之一，在以前自己玩we的时候用的编辑器就是actboy168大佬的，后面听说支持lua来代替jass编写游戏逻辑（那时候已经弃坑~）；好的，闲话不多说，我们来编写我们的第一个脚本。</p><ul><li>创建一个空文件夹并用vscode打开</li><li>创建一个test.lua文件</li><li>编写一行代码 <code>print("Hi,Lua~")</code>（也可以使用<font color=red>'' 单引号</font>）</li></ul><p><img src="https://i.loli.net/2020/02/01/w4ds3ZquOteQX8p.png" alt=""></p><h3>基本使用</h3><h4>数据类型</h4><p>在lua中和python类型可以直接声明并使用，无需使用类型名，lua自动分析数据类型。<br>lua的数据类型为（8个）：</p><ul><li>nil 空</li><li>boolean 布尔型</li><li>number 数字型</li><li>function 函数型</li><li>string 字符串型</li><li>userdata 用户自定义类型</li><li>thread 线程型</li><li>table 表型</li></ul><p>可以使用<code>type()</code>来查看类型~<br>Ps:在lua中不强制使用;结尾</p><pre><code class="line-numbers">--lua类型print(type(3.4))print(type("JK"))print(type(print))print(type(3>5))print(type(nil))</code></pre><h5>Function类型</h5><p>Function类型有什么用呢？使用Function类型可以实现将函数作为函数的参数传递（类似c++中的句柄，C#中的委托）；有了这一特性，大大加强了代码的灵活性~</p><h5>Userdata类型</h5><p>userdata类型可以表述用户自己创建的数据结构，也可以表示调用c语言函数库创建的新类型。</p><h4>变量类型</h4><p><font color=blue>全局变量</font>：全局变量是在整个程序中都可以使用的，默认声明的就是全局变量。<br><font color=blue>局部变量</font>:局部变量在全局变量前添加<code>local</code>关键字声明的。</p><pre><code class="line-numbers">local a=100 --局部变量b='Fasty' --全局变量</code></pre><h4>运算符</h4><p>其他的数学运算符和其他语言是一致的，在这里看一下逻辑运算符<code>and or not</code>。<br>在lua中认为false和nil为假，其他为真。（0也为真，c语言中认为0为假，非0为真）<br>值得注意的是使用逻辑运算符并非返回逻辑值：</p><pre><code class="line-numbers">local aa = 4 and 5 -- 若a为false则返回a，否则返回b  返回5aa=nil and 7  --返回nillocal bb= 7 or 8 --若a为true则返回a，否则返回b 返回7aa=nil or 8 --返回8</code></pre><p><font color=gree>小技巧:</font>使用 <code>aa= nil or 5</code> 可以判断aa是否为nil，若为则赋值为5。</p><p>not则为取反，一直返回布尔值。</p><p>Ps：连接字符串使用<code>…</code>，如<code>A…B</code>。</p>]]></content>
      
      
      <categories>
          
          <category> 编程语言 </category>
          
          <category> Lua </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Lua </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
